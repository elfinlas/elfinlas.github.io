{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/nest_js/230213_nestjs_module_config_load/","result":{"data":{"cur":{"id":"752886b0-32a0-527a-ada5-034a7033896f","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"블로그용-작은-프로젝트를-만들다가\" style=\"position:relative;\"><a href=\"#%EB%B8%94%EB%A1%9C%EA%B7%B8%EC%9A%A9-%EC%9E%91%EC%9D%80-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EB%A7%8C%EB%93%A4%EB%8B%A4%EA%B0%80\" aria-label=\"블로그용 작은 프로젝트를 만들다가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>블로그용 작은 프로젝트를 만들다가…</h1>\n<p>이번에 <strong>Nest.Js</strong>에서 <strong>Jwt</strong>쓰기 주제로 포스팅을 준비중이다.<br>\n근데 처음부터 다시 설치해서 하려니까 몇 가지 막히는 부분이 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//auth.module.ts</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    JwtModule<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">,</span>\n      signOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'60s'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이런 코드가 있다.<br>\n근데 @Module 안에서 process.env로 설정파일에 접근하려 했다.</p>\n<p>근데 아래와 같이 에러가 발생했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2UlEQVQY0zWO6W6DMBCEeZpeSVtuaIOxDTFgczQlXOr7v8dUu1V/jGa0Gn07nhI1rpVD1d6gzMQulIMqKhilUEkJVdbQ4k/lRUNcKoRxgbfwE6f3DA8vIR5PEZ7OMbwglWjHHe2w4mpnNP2CbtzRDBsauo8HZ9MvMD117qjtzK7NhLwwCFOJ59eEoV6QCBg7w00HjLujGzfO3bDCjhuG2w8/a9zCzyhTv+6+IbRDlCnEuYafCPhxAY/otIxA/zD3dcBOO4syiWH9yk6w+EMjyiSCtMTZz3kh6Rfpo4884pD84gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/24c9340c13f5d6f39177875192ad9bf3/7c297/img01.webp 180w,\n/static/24c9340c13f5d6f39177875192ad9bf3/33ecc/img01.webp 360w,\n/static/24c9340c13f5d6f39177875192ad9bf3/df77d/img01.webp 720w,\n/static/24c9340c13f5d6f39177875192ad9bf3/493ca/img01.webp 952w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/24c9340c13f5d6f39177875192ad9bf3/e9ea2/img01.png 180w,\n/static/24c9340c13f5d6f39177875192ad9bf3/53918/img01.png 360w,\n/static/24c9340c13f5d6f39177875192ad9bf3/242a6/img01.png 720w,\n/static/24c9340c13f5d6f39177875192ad9bf3/be2fd/img01.png 952w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/24c9340c13f5d6f39177875192ad9bf3/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이유가 뭘까 잠깐 고민했는데…<br>\n기존 프로젝트는 이미 다 되어 있는 것이라서 내가 빼 먹은 설정과 패키지가 있었다.</p>\n<h2 id=\"nextjs에서-config\" style=\"position:relative;\"><a href=\"#nextjs%EC%97%90%EC%84%9C-config\" aria-label=\"nextjs에서 config permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js에서 Config</h2>\n<p>이유는 간단했다.<br>\n먼저 <strong>Config</strong>관련 패키지를 빼먹었었다.</p>\n<p>먼저 아래의 명령어로 패키지를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn add @nestjs/config</code></pre></div>\n<p>그리고 모듈의 최상단인 <strong>app.module</strong>을 연다.<br>\n아래와 같이 모듈 파일을 수정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/config'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./domain/auth/auth.module'</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AuthModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>imports</strong> 부분에서 저렇게 처리하면 된다.</p>\n<p>만약 구동 환경마다 설정파일을 좀 다르게 하고 싶다면 아래와 같이 처리가 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    envFilePath<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"prod\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\".production.env\"</span> <span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"stage-dev\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\".stagedev.env\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\".dev.env\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>NODE_ENV는 실행 인자에서 전달해주는 것으로 처리했다.<br>\n이렇게 하면 각 구동 인자에 따라 설정 파일을 다르게 넣을 수 있다.</p>\n<p>그리고 아까 예제를 다시 보면…<br>\n약간 코드를 바꿔야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//auth.module.ts</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    JwtModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">,</span>\n        signOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'60s'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>registerAsync</strong> 이걸 써줘야 정상적으로 값을 불러올 수 있다.<br>\n저 비동기 등록을 쓰는 이유는 아직 config에서 env를 가져와서 등록하기 위함이다.</p>\n<p>만약 일반적으로 <strong>JwtModule.register</strong>를 사용하면 에러가 발생한다.<br>\n그래서 비동기 등록을 사용해야 한다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>아주 간단한 문제였는데 덕분에 하나 배웠다.<br>\n항상 기존 틀을 이용해서 그대로 진행하니 이런 부분에서 문제가 생기는 것 같다.</p>\n<p>틀에서 벗어나 본질을 이해해야 하는데 이 부분이 부족했던 것 같다…</p>\n<br>\n<p><a href=\"https://stackoverflow.com/questions/63285055/nestjs-how-to-use-env-variables-in-main-app-module-file-for-database-connecti\">참고 Stackoverflow</a><br>\n<a href=\"https://docs.nestjs.com/techniques/configuration\">공식 Next.js confing 문서</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#nextjs%EC%97%90%EC%84%9C-config\">Next.js에서 Config</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</div>","excerpt":"블로그용 작은 프로젝트를 만들다가… 이번에 Nest.Js에서 Jwt쓰기 주제로 포스팅을 준비중이다. 근데 처음부터 다시 설치해서 하려니까 몇 가지 막히는 부분이 있었다. 이런 코드가 있다. 근데 @Module 안에서 process.env로 설정파일에 접근하려 했다. 근데 아래와 같이 에러가 발생했다.  이유가 뭘까 잠깐 고민했는데… 기존 프로젝트는 이미 다 되어 있는 것이라서 내가 빼 먹은 설정과 패키지가 있었다. Next.js에서 Config 이유는 간단했다. 먼저 Config관련 패키지를 빼먹었었다. 먼저 아래의 명령어로 패키지를 설치해준다. 그리고 모듈의 최상단인 app.module을 연다. 아래와 같이 모듈 파일을 수정해준다. imports 부분에서 저렇게 처리하면 된다. 만약 구동 환경마다 설정파일을 좀 다르게 하고 싶다면 아래와 같이 처리가 가능하다. NODE_ENV는 실행 인자에서 전달해주는 것으로 처리했다. 이렇게 하면 각 구동 인자에 따라 설정 파일을 다르게 넣을 …","frontmatter":{"date":"2023.02.13","title":"Nest.Js에서 @Module의 속성에서 process.env 사용하기","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230213_nestjs_module_config_load/"}},"next":{"id":"44351d83-6a48-55ee-95b1-afeec6de3875","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"nestjs-프로젝트-만들어보기\" style=\"position:relative;\"><a href=\"#nestjs-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%A7%8C%EB%93%A4%EC%96%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"nestjs 프로젝트 만들어보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.Js 프로젝트 만들어보기</h1>\n<p>이번에는 Nest.Js 프로젝트 시작하는 포스팅을 준비했다.<br>\n워낙 기초적인 내용이고, 별로 설명할 것도 없으며 공식 홈페이지에 상세히 나와있지만…<br>\n내가 또 프로젝트 셋업할 때 잊을까봐 남겨두는 포스팅이다.</p>\n<p>진행은 MacOS에서 했다.</p>\n<h2 id=\"nestjs-설치\" style=\"position:relative;\"><a href=\"#nestjs-%EC%84%A4%EC%B9%98\" aria-label=\"nestjs 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.Js 설치</h2>\n<p>크게 두 가지 방법이 있다.<br>\n하나는 그냥 npm이나 yarn 등으로 cli를 받은 다음 설치하는 법과 Github 클론 방식이 있다.</p>\n<br>\n<h3 id=\"npm-yarn-설치\" style=\"position:relative;\"><a href=\"#npm-yarn-%EC%84%A4%EC%B9%98\" aria-label=\"npm yarn 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Npm (Yarn) 설치</h3>\n<p>Npm이나 Yarn이 설치되어 있다면 너무 간단하다.<br>\n프로젝트를 시작할 디렉토리에서 아래의 명령어를 입력해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 단일 프로젝트 설치 시\n> yarn add @nestjs/cli\n\n# 글로벌 사용 시\n> yarn global add @nestjs/cli</code></pre></div>\n<p>나는 개인적으로 글로벌 설치를 안좋아해서 단일 프로젝트 방식으로 설치했다.<br>\n이렇게 하면 프로젝트 디렉토리 내에 <strong>node_modules</strong>, <strong>package.json</strong>, <strong>yarn.lock</strong> 파일과 디렉토리가 생긴다.</p>\n<p>여기서 아래와 같이 Next.Js를 설치해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 단일 프로젝트 설치 시\n> yarn nest new [프로젝트 이름]\n> yarn nest new NextJsExam\n\n# 글로벌 설치 방법 시\n> nest new NestJsExam</code></pre></div>\n<p>만약 자신이 특정 디렉토리에서 Nest.Js를 시작하길 원한다면 프로젝트 이름에 특정 디렉토리를 적어주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn nest new ./Exam/UserExam01</code></pre></div>\n<p><strong>new</strong> 명령어를 통해 프로젝트를 생성하면 아래와 같이 진행된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 578px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVQY022PzU7CUBBGeRgFCxav3F4uLW3pf22lgIimEqML9SmUJSY+9TGtyoK4OJlv852Z6ZjKp1zULDZP1PWK4HWP9/aF+/KJtf1APry3WNsd6nnPMCgRY42cRFh2hDEcc9of0Tu36A4knYGwmSUVfjInzivsqELYCXKaIac5yrv6yU6KmCQIHSCUi1Bey1BOaRyNrJF2mnAhfbSbYjkxtp/h+BnaTbDsEOVEeGHB2E05MxWGqdp5zEFoCEV2WxKXK9JyQza/I8xXxMWa9HqDUD5SB/R1QFdM6PZHbfmYw8umpUm2M6KyYn7zSLGsCbMleXVPUqzb7SfGZSvq/Rb/4+/Cb8CvqP0aUiiVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7bf08e99d0ab6c04c216a00fffbb0875/7c297/img01.webp 180w,\n/static/7bf08e99d0ab6c04c216a00fffbb0875/33ecc/img01.webp 360w,\n/static/7bf08e99d0ab6c04c216a00fffbb0875/9cd87/img01.webp 578w\"\n              sizes=\"(max-width: 578px) 100vw, 578px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7bf08e99d0ab6c04c216a00fffbb0875/e9ea2/img01.png 180w,\n/static/7bf08e99d0ab6c04c216a00fffbb0875/53918/img01.png 360w,\n/static/7bf08e99d0ab6c04c216a00fffbb0875/8c7b4/img01.png 578w\"\n            sizes=\"(max-width: 578px) 100vw, 578px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7bf08e99d0ab6c04c216a00fffbb0875/8c7b4/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>설치되기 앞서 먼저 npm 또는 yarn 그리고 pnpm 중 어느 패키지 메니저를 사용할지 물어본다.<br>\n자신이 원하는 것을 정하면 각종 Nest.Js를 구동하기 위한 파일들이 설치된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 419px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVQ4y3VTWXajQAzkLl7ZDL2xQ7PZxo6dxZnJm/tfpOa1CImd2B+FpEaIUkltrX2J7qNB9Vyj2b1i9/QH2+M72W54Q398R14f0B8u2J8/0B/e4fMMC4dj5clfsFa+hGoyiDKHyjrExRZR0RNMHOUdZNogLnqCSBssXXG3GBVcegK+KJAUe/o4ynsEqoTKO2R6wEbksDcR5jbHbBV+MXtU1Fq7AmlSQWbtJ8OxoExbxOUWKmvBIo0gSeEwifmafRUz9mdhK+QC/55SFO2JdDLatftXNLsXdIcL2sHo+hfN8YSyP0D3zwhV9VhDeyMRiJhac8OEDp0gpjYN1n5E526YwmMZsbc38eOWzUdmivX2DJW2EEmNQBbEYGppaXyH09nCYXeLTWeWeXhhQqwMJqZTwsKVmDuC7OiP8YSZbX56PWVX3LBZfDIx/tzhCEOJWCkIrsCYhJJqhFCIpEJRRFh53zWse9SNDDzS2MgSaaaxa1sUhYbWHVrdQJcaTaXJ77YdRKJJW9OZ9VODyV/7ihICVSGIatpVnjRgcQNflNjICmFUU2zyxgGq3wynKZN+kxRXQ7m2BJffSGaNWgnMbUYvZjZHzhM09YB2eKOrqPszbYLZz6o/U1x2J0I3XOgCLGz2PWUmFN3XUJU0ZXMFPZZSAu0hSyk2uPHD0ZqOprX5D3f3wRi3wB7rAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c4ab0db863a9c60b15838ec15772c17e/7c297/img02.webp 180w,\n/static/c4ab0db863a9c60b15838ec15772c17e/33ecc/img02.webp 360w,\n/static/c4ab0db863a9c60b15838ec15772c17e/82ebf/img02.webp 419w\"\n              sizes=\"(max-width: 419px) 100vw, 419px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c4ab0db863a9c60b15838ec15772c17e/e9ea2/img02.png 180w,\n/static/c4ab0db863a9c60b15838ec15772c17e/53918/img02.png 360w,\n/static/c4ab0db863a9c60b15838ec15772c17e/96e9b/img02.png 419w\"\n            sizes=\"(max-width: 419px) 100vw, 419px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c4ab0db863a9c60b15838ec15772c17e/96e9b/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>설치가 다 되면 테스트를 해본다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 662px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY01XDy26CQBiAUR6mLrAqCM6FnxkYbqICpmmtvoAxXfT9t1/XPcmJQnflvDw4L1f05y/J9CKdXySXJ+nlSTL/oJYn36dA5y1xZtmkwlucsYpzVuv/o2KoKU81KnisdOTao2yN+B5tA3GyxzlFKAyusJgg6L7E9CXF0bF3Be8Hze6gSVJFJIujvQVk9LTjF66dqIcr43InDB9sjGWaKh5Hx60vGeeK5t7gLhV+rmi7kswatkqT7BXR0A6oXsi9YNyRvGhQ0iH1CS0960xT1ULvLEEspS84NCUqCHklmFrIxbI1hkQb/gDgQIjfOaRKCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/7c297/img03.webp 180w,\n/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/33ecc/img03.webp 360w,\n/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/82a5e/img03.webp 662w\"\n              sizes=\"(max-width: 662px) 100vw, 662px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/e9ea2/img03.png 180w,\n/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/53918/img03.png 360w,\n/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/46b67/img03.png 662w\"\n            sizes=\"(max-width: 662px) 100vw, 662px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fa4ed8d88ca20c07ab5e2f1a8ea37061/46b67/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>이렇게 서버가 올라간 것을 확인할 수 있고, 브라우저에서 접근하면 아래와 같이 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.444444444444445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZUlEQVQI1z2KQQrDMBAD8/+H9QO9FlJKKI7t1drrB0xw2uQgpJG0pP2LcsOLExp0DUJBt6ArznxpdvMT9uOhQU1G2jKvVTyeO8vnveFqyJzmQbW4WdbOPNW8Y1V/t/tz7SVlPBcO18iXH9JIT9YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/38e36a20831e7a977870fb24a1399a35/7c297/img04.webp 180w,\n/static/38e36a20831e7a977870fb24a1399a35/33ecc/img04.webp 360w,\n/static/38e36a20831e7a977870fb24a1399a35/df77d/img04.webp 720w,\n/static/38e36a20831e7a977870fb24a1399a35/5c666/img04.webp 1080w,\n/static/38e36a20831e7a977870fb24a1399a35/ea084/img04.webp 1144w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/38e36a20831e7a977870fb24a1399a35/e9ea2/img04.png 180w,\n/static/38e36a20831e7a977870fb24a1399a35/53918/img04.png 360w,\n/static/38e36a20831e7a977870fb24a1399a35/242a6/img04.png 720w,\n/static/38e36a20831e7a977870fb24a1399a35/b4ad3/img04.png 1080w,\n/static/38e36a20831e7a977870fb24a1399a35/b1620/img04.png 1144w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/38e36a20831e7a977870fb24a1399a35/242a6/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>만약 Stric모드 활성화를 하려면 <strong>—strict</strong>옵션을 주면된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn nest new NextJsExam --strict</code></pre></div>\n<br>\n<h3 id=\"github-clone-설치\" style=\"position:relative;\"><a href=\"#github-clone-%EC%84%A4%EC%B9%98\" aria-label=\"github clone 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Github clone 설치</h3>\n<p>git 명령어 중 clone을 통해서 생성하는 법이 있다.<br>\n아래의 명령어를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ git clone https://github.com/nestjs/typescript-starter.git project\n$ cd project\n$ npm install\n$ npm run start</code></pre></div>\n<p>저기서 <strong>project</strong>는 자신의 디렉토리를 지정해주면 된다.</p>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>Nest.Js의 경우 Typescript를 기본으로 사용한다.<br>\n더 자세한 설명이 필요한 경우 <a href=\"https://docs.nestjs.com\">공식 페이지</a>를 참고하자.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#nestjs-%EC%84%A4%EC%B9%98\">Nest.Js 설치</a></p>\n<ul>\n<li><a href=\"#npm-yarn-%EC%84%A4%EC%B9%98\">Npm (Yarn) 설치</a></li>\n<li><a href=\"#github-clone-%EC%84%A4%EC%B9%98\">Github clone 설치</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.02.12","title":"Nest.Js 프로젝트 생성하기","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230212_start_nestjs/"}},"prev":{"id":"d719c440-a876-56ed-895e-3b57c5e8a7df","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQoz42S0Y6CMBBFW6Cl0GmhxYorrJpAsolP+v8fdzetrqtmxX24GToZztxOhzHGcC+vCEOzwqA9drTCJ3XYmRX2NuDQrJN647A2LYzSeP6fPSciQBTir8KknGegvESTqwRXolwGRmdK/haFEDBNE7bDAOf9Q+26btCWehkYryfy4nbWWmMcxwQmopTjjF+aVRauomVgnFWeZQ85znnSc21XEnxtl4FxLnFOPyApZXJpjEFd18jumnmp0Wn7D4dXYLziPM84Ho84n844n06pwc2hJHS6eePQBpTi8srRTV4UYJwl5fLx9Z3UCNQuA3tlMbuPtIss42grwtZ22BiHnlz6vpw9Dm2PWqpl4A1cWXyFEVRWqLmAzmQSpShSLHnxfrH5NZJQmNzm5YK/0jegveteJRG0qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/7c297/thumbnail_til.webp 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/33ecc/thumbnail_til.webp 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/df77d/thumbnail_til.webp 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dd3ab/thumbnail_til.webp 895w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/e9ea2/thumbnail_til.png 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/53918/thumbnail_til.png 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png 895w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"23년-2월-13일-til--개발노트-흑우집합소\" style=\"position:relative;\"><a href=\"#23%EB%85%84-2%EC%9B%94-13%EC%9D%BC-til--%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8-%ED%9D%91%EC%9A%B0%EC%A7%91%ED%95%A9%EC%86%8C\" aria-label=\"23년 2월 13일 til  개발노트 흑우집합소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>23년 2월 13일 TIL &#x26; 개발노트 (흑우집합소)</h1>\n<p>금일 흑우집합소를 개발하며 배운 내용 및 겪은 과정을 정리하여 올려본다.</p>\n<p>오늘은 JWT 인증 부분을 처리하였다.</p>\n<h2 id=\"nestjs에서-jwt-사용시-error-커스텀-처리\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C-jwt-%EC%82%AC%EC%9A%A9%EC%8B%9C-error-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%B2%98%EB%A6%AC\" aria-label=\"nestjs에서 jwt 사용시 error 커스텀 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.js에서 JWT 사용시 Error 커스텀 처리</h2>\n<ul>\n<li>Passport-JWT를 그대로 사용하려 했는데 Access Jwt의 토큰 만료시에도 401을 띄운다.</li>\n<li>나는 Access Token에 대해서는 토큰 만료 시 서버 내에서 저장된 리프레시 토큰을 확인하고 그에 따른 추가 작업을 하기 원했다.</li>\n<li>물론 try catch로 처리할 수 있지만 이렇게 하면 <strong>AuthExceptionHandler</strong>처리 부분이 너무 지저분해진다.</li>\n<li>그래서 좀 찾아본 결과 <strong>passport-custom</strong>이란 것으로 <strong>Strategy</strong>부터 커스텀 처리를 할 수 있는 것을 찾았다.(이건 따로 포스팅 예정)</li>\n<li>패키지를 설치하고 적용해봤다.</li>\n<li>일일히 JWT에 대한 에러를 핸들링 해야 하는 부분이 있지만 직접 핸들링을 할 수 있어서 더 좋은 것 같다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Inject<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PassportStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Strategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'passport-custom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthException <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../exceptions/auth.exception'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthJwtErrorCode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../exceptions/auth.jwt.error.code'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> VerifyJwtOutboundPort<span class=\"token punctuation\">,</span> <span class=\"token constant\">VERIFY_JWT_OUTBOUND_PORT</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../ports/out/jwt/verify.jwt.outbound.port'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">JWT_TYPE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../types/jwt.enums'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessJwtStrategy</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PassportStrategy</span><span class=\"token punctuation\">(</span>Strategy<span class=\"token punctuation\">,</span> <span class=\"token string\">'jwt'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">VERIFY_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> verifyjwtOutboundPort<span class=\"token operator\">:</span> VerifyJwtOutboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> payload<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> jwt <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'TestJwtKey'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>jwt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">jwtNotFound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verifyjwtOutboundPort<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> jwt<span class=\"token punctuation\">,</span> tokenType<span class=\"token operator\">:</span> <span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> payload<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>덕분에 기존에 있던 JwtStrategy에서 직접 처리를 할 수 있게 되었다.<br>\n전에 <strong>passport-jwt</strong>사용할 때는 생성자에도 주렁주렁 매달아서 보냈었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            jwtFromRequest<span class=\"token operator\">:</span> ExtractJwt<span class=\"token punctuation\">.</span><span class=\"token function\">fromExtractors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> req<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TestJwtKey\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            secretOrKey<span class=\"token operator\">:</span> key<span class=\"token punctuation\">,</span>\n            issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            ignoreExpiration<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            passReqToCallback<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> StrategyOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제는 <strong>Strategy</strong>영역이 좀 깔끔해 진 것 같다.</p>\n<p>그리고 Nest.js에서 제공하는 <strong>JwtService</strong>의 경우 <strong>verify</strong>메서드로 검증을 할 수 있는데,<br>\n이때는 생성했던 JWT의 속성을 다 가지고 와야 한다.<br>\n속성은 <strong>issuer</strong> <strong>audience</strong> 등을 의미한다.</p>\n<p>쉽게 생성할 때와 맞춰주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> payload <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    secret<span class=\"token operator\">:</span> secretKey<span class=\"token punctuation\">,</span>\n    expiresIn<span class=\"token operator\">:</span> expiredTime<span class=\"token punctuation\">,</span>\n    audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>jwtType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 생성할 때 <strong>issuer</strong> <strong>audience</strong>를 전달했다면 검증할 때도 같이 넣어줘야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">verify</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  secret<span class=\"token punctuation\">,</span>\n  audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> JwtVerifyOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이런 식으로 처리했다.<br>\n저 <strong>JwtVerifyOptions</strong> 타입을 타고 들어가면 아래와 같은 것을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token generic-function\"><span class=\"token function\">verify</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> object <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>token<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> JwtVerifyOptions<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">JwtVerifyOptions</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">jwt</span><span class=\"token punctuation\">.</span>VerifyOptions <span class=\"token punctuation\">{</span>\n    secret<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Buffer<span class=\"token punctuation\">;</span>\n    publicKey<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Buffer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">VerifyOptions</span> <span class=\"token punctuation\">{</span>\n    algorithms<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Algorithm<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    audience<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> RegExp <span class=\"token operator\">|</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> RegExp<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    clockTimestamp<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    clockTolerance<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/** return an object with the decoded `{ payload, header, signature }` instead of only the usual content of the payload. */</span>\n    complete<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    issuer<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    ignoreExpiration<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    ignoreNotBefore<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    jwtid<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/**\n     * If you want to check `nonce` claim, provide a string value here.\n     * It is used on Open ID for the ID Tokens. ([Open ID implementation notes](https://openid.net/specs/openid-connect-core-1_0.html#NonceNotes))\n     */</span>\n    nonce<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    subject<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    maxAge<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<h2 id=\"궁금점\" style=\"position:relative;\"><a href=\"#%EA%B6%81%EA%B8%88%EC%A0%90\" aria-label=\"궁금점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>궁금점</h2>\n<p>기존에 <strong>AuthGuard</strong>부분에서 좀 더 조작하면 할 수 있을 것 같았는데 너무 시간을 빼먹어서 진행하지 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ExecutionContext<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthGuard <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessJwtAuthGuard</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuthGuard</span><span class=\"token punctuation\">(</span><span class=\"token string\">'accessJwt'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token generic-function\"><span class=\"token function\">handleRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TUser <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>err<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TUser <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">JsonWebTokenError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'errror = '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// return { \"data : \": \"test\" } as any;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'data : '</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'data : '</span><span class=\"token operator\">:</span> <span class=\"token string\">'aaaa'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> info<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>기존에는 위와 같이 작성했는데 만료하는 시점은 잡을 수 있었지만 컨트롤러에서 바로 에러 응답을 해버렸다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseGuards</span></span><span class=\"token punctuation\">(</span>AccessJwtAuthGuard<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">testJwt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> ok<span class=\"token operator\">:</span> <span class=\"token string\">\"ok\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>정녕 <strong>passport-jwt</strong>에서는 약간의 커스텀 처리를 못하는 것인지…<br>\n이 부분은 시간이 나면 다시 찾아봐야겠다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#nestjs%EC%97%90%EC%84%9C-jwt-%EC%82%AC%EC%9A%A9%EC%8B%9C-error-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%B2%98%EB%A6%AC\">Nest.js에서 JWT 사용시 Error 커스텀 처리</a></li>\n<li><a href=\"#%EA%B6%81%EA%B8%88%EC%A0%90\">궁금점</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.02.13","title":"23년 2월 13일 TIL & 개발노트 (흑우집합소)","categories":"til","emoji":"📜"},"fields":{"slug":"/til/230119_til/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/nest_js/230213_nestjs_module_config_load/","nextSlug":"/nest_js/230212_start_nestjs/","prevSlug":"/til/230119_til/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}