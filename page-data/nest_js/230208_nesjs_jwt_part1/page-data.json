{"componentChunkName":"component---src-templates-blog-post-js","path":"/nest_js/230208_nesjs_jwt_part1/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab","siteUrl":"https://elfinlas.github.io","comment":{"disqusShortName":"","utterances":"elfinlas/blog_utterances"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"7a22f666-ea53-596d-8214-776091de756c","excerpt":"JWT를 원래 쓰고 있었지만… 전에도 썼었고, 지금도 쓰고 있는 JWT JWT에 대한 개념적인 것은 넘어가고, Nest.js에서 JWT를 쓰는 방법에 대해서 포스팅 해보려 한다. 사실 JWT를 그냥 쓰면 안되고, 몇 가지 기본적인 정책이나 알아야 할 점이 있지만, 이번 포스팅에서는 Nest.js에서 JWT를 생성하는 것에 포커스를 두려 한다. JWT에 대해서는 아주 예전에 포스팅을 했었다. JWT의 이론적인 부분이 궁금한 분은 JWT 포스팅을 참고해주시길… 이와 관련한 코드는 Github…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQoz5VSu0oDQRTNX1j5aOytxCIJiK1a2ASsLPQDBCsFizQKAQsRtbEQRBAsFFQM0WBAI9GoJI2Cj0B8ZU1CyO4m+5idOe5OsskuRowHzsyFmXvu4d7rgQlGKacTjDFOZ/wXLXjswIaRyULZC7cWtgo7Yvvd+dfDRXJ5iLMhFHwBFAbHUfAHQJ4ybscGdSXymxi1W66C6aTm0DrE+SUI3T4IXV7kOr0ojk5xWoWoJKOysQNl9wh66h7axTXU4zNoVykoB6cgjxlIi2swXj+aglSUwKoKtFgCX33DEHqHkOvoN5OT5psMMbgM9eSCFxbnQtBv0lDDMZSng1xUWlgFLZbqPTRqtrXEHSrrWyhNzEDo8SM/MAZi9pNVqlAOo9CTaWiXt1D2I1Cjce7IEiUPz1Aj5zDePuuCtNYP8pI1Bbchr2yiODIJLZ50Nb8dNIbinJSRfQcti63XhbLGpG0j9sr9WBv+iZBmNTvxH2wI/rprzO2+HXwDU8vrEbOHyiEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/77434/thumbnail_nestjs.webp 300w,\n/static/b7685b7a900370c34be4e657df3f862d/411c4/thumbnail_nestjs.webp 600w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/a8a0d/thumbnail_nestjs.png 300w,\n/static/b7685b7a900370c34be4e657df3f862d/dface/thumbnail_nestjs.png 600w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"jwt를-원래-쓰고-있었지만\" style=\"position:relative;\"><a href=\"#jwt%EB%A5%BC-%EC%9B%90%EB%9E%98-%EC%93%B0%EA%B3%A0-%EC%9E%88%EC%97%88%EC%A7%80%EB%A7%8C\" aria-label=\"jwt를 원래 쓰고 있었지만 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT를 원래 쓰고 있었지만…</h1>\n<p>전에도 썼었고, 지금도 쓰고 있는 JWT<br>\nJWT에 대한 개념적인 것은 넘어가고, Nest.js에서 JWT를 쓰는 방법에 대해서 포스팅 해보려 한다.</p>\n<p>사실 JWT를 그냥 쓰면 안되고, 몇 가지 기본적인 정책이나 알아야 할 점이 있지만,<br>\n이번 포스팅에서는 Nest.js에서 <strong>JWT를 생성</strong>하는 것에 포커스를 두려 한다.</p>\n<p>JWT에 대해서는 아주 예전에 포스팅을 했었다.<br>\nJWT의 이론적인 부분이 궁금한 분은 <a href=\"https://elfinlas.github.io/basic_know/180812_what_is_jwt/\">JWT 포스팅</a>을 참고해주시길…</p>\n<p>이와 관련한 코드는 <a href=\"https://github.com/elfinlas/NestJsJwt\">Github</a>에 등록하였다.<br>\n일단 메인 브런치인데 향후 Part별로 브런치를 나누거나, 커밋으로 할 예정이다.<br>\n이와 관련한 것은 향후 다시 업데이트 예정이다.</p>\n<h2 id=\"nestjs에서-jwt-사용하기\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C-jwt-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"nestjs에서 jwt 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.js에서 JWT 사용하기</h2>\n<p>본격적으로 설명에 앞서 위에 언급한 것처럼…<br>\n이번 포스팅에서는 Nest.js에서 JWT를 생성하는 것에 포커스를 둔 코드다.<br>\n그래서 약간 코드가 엉성할 수 있다.</p>\n<p>하지만 어떻게 사용해서 적용하는지를 볼 수 있는 예제성 코드다.<br>\n이 부분은 감안해서 봐주시길 바란다.</p>\n<p>구성은 controller에서 Url 호출하면 JWT 생성 서비스를 호출해서 반환하는 형태로 되어 있다.<br>\n<a href=\"https://github.com/elfinlas/NestJsJwt\">Github</a>에서 클론을 받아서 사용해도 되고,<br>\n각 코드를 보면서 참고해도 된다.</p>\n<h3 id=\"패키지-설치\" style=\"position:relative;\"><a href=\"#%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%84%A4%EC%B9%98\" aria-label=\"패키지 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>패키지 설치</h3>\n<p>먼저 아래와 같은 패키지를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn add @nestjs/jwt</code></pre></div>\n<p>이 패키지는 Nest.js에서 제공하는 패키지이며, JWT 조작을 하는데 도음을 주는 유틸리티 패키지다.<br>\n사실 JWT 전략이나 좀 더 편리하게 쓰기 위해서는 <strong>passport-jwt</strong>를 설치해야 하는데 이는 <strong>Part2</strong>에서 다룰 예정이다.</p>\n<p>일단 예제를 돕기 위해 <strong>auth</strong>라는 도메인으로 빼고 모듈로 나눴다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 740px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dd77549e484d9b6fd6d1ecb34eeeb93d/b38af/img01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQoz31Si26DMBDj//9xW1u6DgohIQ8ghOA5KeukshHJItydnDv7CvCMk4e2DuM4YfQL9LjAjDHfE5znfZrhnMO6rjg6RSrw84JGSKi+h5lWfLQBV7lAmIBWe3zyXrcSVVVlwiMUifVSXnE+lyRVaNoOUilIqdCKDto4TN7nR32IGDjNETLh+VLi7f2E6t7iq25ytzWJ07+QPeyQijny+Pju8RsvYjzWJJ3IUVLdHvGp6brVsMMVdxvRUCvRsqNOYt0K/sPDyAl9r2GspUTUnqZmUxLhRQacGouSWgql6WzYxtsjxZPjHetulKdqBMpbhbrpcjwTViaiZocqmcHCOQSEJfK7ILwgx5izbqC+ipthaB43RJscz6YoxxfNAKM1kwITx9mE2en5HJk7m9fMvIyc0jPXwlqDLq+KQE/ihxHxbzCXNNQkS0Q/hCn+DbFwCtArZ4iEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dd77549e484d9b6fd6d1ecb34eeeb93d/77434/img01.webp 300w,\n/static/dd77549e484d9b6fd6d1ecb34eeeb93d/411c4/img01.webp 600w,\n/static/dd77549e484d9b6fd6d1ecb34eeeb93d/c30c1/img01.webp 740w\"\n              sizes=\"(max-width: 740px) 100vw, 740px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dd77549e484d9b6fd6d1ecb34eeeb93d/a8a0d/img01.png 300w,\n/static/dd77549e484d9b6fd6d1ecb34eeeb93d/dface/img01.png 600w,\n/static/dd77549e484d9b6fd6d1ecb34eeeb93d/b38af/img01.png 740w\"\n            sizes=\"(max-width: 740px) 100vw, 740px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dd77549e484d9b6fd6d1ecb34eeeb93d/b38af/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br>\n<h3 id=\"jwtmodule-등록\" style=\"position:relative;\"><a href=\"#jwtmodule-%EB%93%B1%EB%A1%9D\" aria-label=\"jwtmodule 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JwtModule 등록</h3>\n<p>일단 <strong>module</strong>에 아래와 같이 <strong>JwtModule</strong>을 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//auth.module.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> JwtModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/jwt'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CreateJwtController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./controllers/create.jwt.controller'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./port/out/create.jwt.outbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CreateJwtService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./services/jwt/create.jwt.service'</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    JwtModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">,</span>\n        signOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'60s'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>CreateJwtController<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> provide<span class=\"token operator\">:</span> <span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">,</span> useClass<span class=\"token operator\">:</span> CreateJwtService <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>저기서 <strong>imports</strong> 부분에서 <strong>secret</strong>은 Jwt 서명키를 넣는 부분이다.<br>\n나는 설정 파일을 빼서 처리했다.</p>\n<p>왜 저렇게 했는지 궁금한 분은 아래 포스팅을 참고하자.<br>\n<a href=\"https://elfinlas.github.io/nest_js/230213_nestjs_module_config_load/\">Nest.Js에서 @Module의 속성에서 process.env 사용하기</a></p>\n<p><strong>JwtModule</strong> 모듈을 통해 Jwt를 생성하고, 검증하는 기능을 쉽게 사용할 수 있다.<br>\n일단 모듈을 등록했다면 Jwt를 생성해보도록 하자.</p>\n<br>\n<h3 id=\"jwt-생성-서비스\" style=\"position:relative;\"><a href=\"#jwt-%EC%83%9D%EC%84%B1-%EC%84%9C%EB%B9%84%EC%8A%A4\" aria-label=\"jwt 생성 서비스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jwt 생성 서비스</h3>\n<p>생성 서비스 로직은 아주 간단하다.<br>\n왜냐하면…그냥 생성만 하는 샘플이기 때문이다. -_-;;</p>\n<p>여기에서 비즈니스 요구사항이 붙기 시작하면 그때부터는 약간씩 무거워진다.<br>\n무튼 이번 포스팅은 Jwt 생성에 포커스가 되어 있기에 다른 요건은 무시하고 생성에만 집중한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//create.jwt.service.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Inject <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> JwtService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/jwt'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n  CreateJwtInputDto<span class=\"token punctuation\">,</span>\n  CreateJwtOutputDto<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../port/out/create.jwt.outbound.port'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateJwtService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">CreateJwtOutboundPort</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span>JwtService<span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> jwtService<span class=\"token operator\">:</span> JwtService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">excute</span><span class=\"token punctuation\">(</span>params<span class=\"token operator\">:</span> CreateJwtInputDto<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> CreateJwtOutputDto <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> payload <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> user<span class=\"token operator\">:</span> <span class=\"token string\">'bcow'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> jwt<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 보면 정말 아주 간단하게 Jwt를 생성할 수 있음을 확인할 수 있다.<br>\n아마 <strong>Part02</strong>로 가면 점점 코드가 늘어나게 될 것이다.</p>\n<br>\n<h3 id=\"jwt-생성-확인용-컨트롤러\" style=\"position:relative;\"><a href=\"#jwt-%EC%83%9D%EC%84%B1-%ED%99%95%EC%9D%B8%EC%9A%A9-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC\" aria-label=\"jwt 생성 확인용 컨트롤러 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jwt 생성 확인용 컨트롤러</h3>\n<p>이제는 생성된 jwt를 확인해봐야 하는데 간단하게 컨트롤러를 하나 만들자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//create.jwt.controller.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Inject <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../port/out/create.jwt.outbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CreateJwtService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../services/jwt/create.jwt.service'</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'auth'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateJwtController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> createJwtService<span class=\"token operator\">:</span> CreateJwtService\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'jwt'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">makeJwt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>createJwtService<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>코드가 뭔가 성의없어 보일 수 있지만…<br>\n예제 코드다.</p>\n<p>나도 다테일하게 짜고 싶지만…<br>\n시간 부족으로 인해…<br>\n자세하게 짜는 것은 <strong>Part02</strong> 포스팅에서 다시 다뤄보겠다.</p>\n<p>무튼 이렇게 작성하고 구동해보면…</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/848baedd666995975def0d05ee064e90/30373/img02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAZElEQVQI1zWMyRGAMAwD0xfkcC7ovwY7SRfCMfDYsUbasQtnBsUGr/c4G1IomgkxVKUg+qJdRfAZNV/I1NDrjfJlSt1c+0Mdbs6JjcgAK2sty5sxJphFr27M+N0hYt5m9+8u5j8/fmz5TzboQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/848baedd666995975def0d05ee064e90/77434/img02.webp 300w,\n/static/848baedd666995975def0d05ee064e90/411c4/img02.webp 600w,\n/static/848baedd666995975def0d05ee064e90/cbd37/img02.webp 1200w,\n/static/848baedd666995975def0d05ee064e90/deed9/img02.webp 1256w\"\n              sizes=\"(max-width: 1200px) 100vw, 1200px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/848baedd666995975def0d05ee064e90/a8a0d/img02.png 300w,\n/static/848baedd666995975def0d05ee064e90/dface/img02.png 600w,\n/static/848baedd666995975def0d05ee064e90/64756/img02.png 1200w,\n/static/848baedd666995975def0d05ee064e90/30373/img02.png 1256w\"\n            sizes=\"(max-width: 1200px) 100vw, 1200px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/848baedd666995975def0d05ee064e90/64756/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br>\n<p>잘 생성되는 것을 확인할 수 있다.<br>\n<a href=\"https://jwt.io\">Jwt.io</a>에서도 확인이 가능하다.<br>\n만든 jwt를 넣어보면 아래와 같이 유효한 Jwt가 생성되었음을 확인할 수 있다.</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/14c1614204ab5bc44099b7112be1df09/a7903/img03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABR0lEQVQoz4WSbW+DMAyE+f9/cNpUaRKi09rSQkhIyJtvRxgao0xzeOQPSezzkapuGlzbFjEnJMmYQzbMkXNGw3N1XcN7jxACYozLWZFfVKEbEO8KuTdEQ5jxIO0AqAkSBZmNlFLQ4wjnJ0zThJRSabSn8k3AdPJwxL4yE/U+oa0dWu55t2iWQEUjG5A1tsrWSaqHEVwV8KmYKeoyCM5WcE+8TwfS94XoJmRtIc4vduxGXRtUgudV3JMfF+fOxhj4FMr+0agzsw1VqS67P7HtXD4uT7U9EK5SfC1rp7KMvJV7xLqXPBVojk57JOEwlpE3l44OlMzO/TDg3nccyyOniMinEw74V6EsFXHmc3q5aXwwzyh6qonZMPJZVUfKnoIKb8OIt87h1DvUyqLTLHBUcDbyT3Ubs81ocdEzDlfmzlg4a2E3OOfwBbUQX8Y+FEgyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/14c1614204ab5bc44099b7112be1df09/77434/img03.webp 300w,\n/static/14c1614204ab5bc44099b7112be1df09/411c4/img03.webp 600w,\n/static/14c1614204ab5bc44099b7112be1df09/cbd37/img03.webp 1200w,\n/static/14c1614204ab5bc44099b7112be1df09/ebc99/img03.webp 1219w\"\n              sizes=\"(max-width: 1200px) 100vw, 1200px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/14c1614204ab5bc44099b7112be1df09/a8a0d/img03.png 300w,\n/static/14c1614204ab5bc44099b7112be1df09/dface/img03.png 600w,\n/static/14c1614204ab5bc44099b7112be1df09/64756/img03.png 1200w,\n/static/14c1614204ab5bc44099b7112be1df09/a7903/img03.png 1219w\"\n            sizes=\"(max-width: 1200px) 100vw, 1200px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/14c1614204ab5bc44099b7112be1df09/64756/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>이번 Part01에서는 Jwt 생성까지만 다뤄봤다.<br>\n다음 포스팅에서는 이제 Passport-Jwt 활용 및 어떤 식으로 사용하는지에 대해 포스팅해볼 예정이다.</p>\n<p>사실 이번주에 끝내려 했는데 현재 일정이 너무 타이트 해서 일단 맛보기 용으로 먼저 포스팅했다.<br>\n시간이 될 때 얼른 마저 끝내봐야겠다.</p>\n<p>참고 사이트는 아래와 같다.</p>\n<p><a href=\"https://docs.nestjs.com/security/authentication#jwt-functionality\">공식 문서</a></p>\n<br>\n<h3 id=\"ps\" style=\"position:relative;\"><a href=\"#ps\" aria-label=\"ps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PS</h3>\n<p>원래 레이어드 아키텍쳐를 쓰려 했지만…<br>\n<a href=\"https://elfinlas.github.io/til/230114_wanted_preon_back02/\">백엔드 프리온보딩</a>에서 배운 <strong>Ports and Adapter 아키텍쳐</strong>로 한번 짜봐야겠다 싶어서 써봤다.</p>\n<p>현재 개발중인 코드에서도 적용 중이긴 한데…\n약간 코드가 미흡할 수 있다.</p>\n<p>코드는 <a href=\"https://github.com/elfinlas/NestJsJwt\">Github</a>를 참고하시면 된다.</p>\n<p>이 부분은 혹시 고수가 있다면 댓글로 알려주시면 감사하겠다.</p>","frontmatter":{"title":"Nest.Js에서 JWT 사용하기 (Part01 JWT 생성해보기)","date":"February 08, 2023"}}},"pageContext":{"slug":"/nest_js/230208_nesjs_jwt_part1/","previous":{"fields":{"slug":"/book/230208_effective_typescript/"},"frontmatter":{"title":"(Book) 이펙티브 타입스크립트 동작 원리의 이해와 구체적인 조언 62가지 (Effective Typescript)"}},"next":{"fields":{"slug":"/nest_js/230212_start_nestjs/"},"frontmatter":{"title":"Nest.Js 프로젝트 생성하기"}}}},"staticQueryHashes":["3128451518","903436796"]}