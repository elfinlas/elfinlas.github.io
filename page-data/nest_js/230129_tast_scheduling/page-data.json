{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/nest_js/230129_tast_scheduling/","result":{"data":{"cur":{"id":"ee1502f7-4126-570b-aef1-c2dba6a8a52b","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAADWklEQVQozx3Ma0+TZwCA4QcylyXGjC3Lkn2YmyYmxuzTCEsQDCKMDVCEgMhxcuhIldIKWFuhUECQSmmhK8UCVRpgwDtWKJZSDgoKEwPSFjCIoYgZiZnJfsS9uOsHXKIs9mty0xKo7eiltltCb5fQWYdIzcgi90oBipp6aq3DVMgy+TnqKLpWIze1uVT+GskdUw127zLOpRB980F65oIIo2OcgnINjU4PNt86nRPLdHtWMEuPKZP9RPrpwzRoSmlI/YQLJwRFMZ+iV6dQlia4cl5wNf9zzE4HA8t7/6fCsRRCXm+m8EYr+fIqVHoD9dZBWrp+x9RlQZV3DM05QfEP4WRHHqIxQdBYFI2iMoarMkFJuqAw+TN6Jp/gfLqN6JkNYHavYjBoyI8WpER/QaulC6OxFdMdHRbJS/HlKLJOCZovhKFMEGSeOY6i7jaK6q+oqRGoSgSGtgqkwL8fQj+2+V3mepLZbBO0Xg5HfjGCjOiP6ZEdxm68xt2xFRTlMSjjBXlREfSNDDPwZIf7vkc0tUXRohboS47S0TuAePA4yG8zO4z35fDGLLDkCCrSPyLulKA4SuDIFhjUGYyuvqRRE8vdJi3e7feMvwgx4f+bsdV9+oa6uX5OUBgpEPd8L3AsvsLkHGGh7SRNWREUJR0h8aTgzDdhqE+HYU4W9I9KTK6u4F7bZOz5Lm7/Wx4G93Gvv2FibZ+GwuPI4wTCPrNOh+sp+gc+TENumm0OtKVniftW8P2X4dxMDMejErTrFbiD/zC86KdzdJrajm6G5p/j8e/h2XpHZ0sZyg9hp/sZunYbtdpqrA9XqGrvRyYrIC8qnGNHwmhJFyzrBH9OTdDpWmRoaYs/FtbQa9W02514N94ytXnA0KSHGwkCYZIe0djrouCXfGSKa1wqkqM2ObDVZHLxu0NY26uY1p/gdu8gpUoldc31zL16h+fZFl5/CG9gjyn/Lt6tA8x1MsQt4z3KKm9RWF5JWnI8qupKDNICcmU5uus5TG69Z1Dqxz4xg83lo0qjwrUcYHb7AN/GHr7gHt7ALlOBEJNrrxFFFVpSks6iaGgj9XwqlzLiabZ28WNiLElZ2bQ7JaS/XmKRPFS3dWEZdjGyuMbc1j6zGyFmNkJMB3bx+l8ztb7Dfw32XA3PcNGWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e7f1dd81de905b7face826931df4ca61/7c297/thumbnail.webp 180w,\n/static/e7f1dd81de905b7face826931df4ca61/33ecc/thumbnail.webp 360w,\n/static/e7f1dd81de905b7face826931df4ca61/df77d/thumbnail.webp 720w,\n/static/e7f1dd81de905b7face826931df4ca61/5c666/thumbnail.webp 1080w,\n/static/e7f1dd81de905b7face826931df4ca61/cbd37/thumbnail.webp 1200w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e7f1dd81de905b7face826931df4ca61/e9ea2/thumbnail.png 180w,\n/static/e7f1dd81de905b7face826931df4ca61/53918/thumbnail.png 360w,\n/static/e7f1dd81de905b7face826931df4ca61/242a6/thumbnail.png 720w,\n/static/e7f1dd81de905b7face826931df4ca61/b4ad3/thumbnail.png 1080w,\n/static/e7f1dd81de905b7face826931df4ca61/64756/thumbnail.png 1200w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e7f1dd81de905b7face826931df4ca61/242a6/thumbnail.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"nestjs에서-스케쥴링\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C-%EC%8A%A4%EC%BC%80%EC%A5%B4%EB%A7%81\" aria-label=\"nestjs에서 스케쥴링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NestJs에서 스케쥴링…</h1>\n<p>현재 하고 있는 프로젝트에서 스케쥴링이 필요하여 구현했었다.<br>\n그런데 스케쥴링을 돌렸는데 뭔가 시간이 안맞게 돌아간다고 해야 하나?</p>\n<p>분과 초단위는 잘 도는데 시간대가 좀 안맞았다.<br>\n그래서 테스트를 하고 자료를 찾다가 원인을 알게되었다…</p>\n<br>\n<h2 id=\"원인\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"원인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인?</h2>\n<p>이유는 바로 <strong>TimeZone</strong> 문제였다.</p>\n<p>내가 구현한 코드는 다음과 같이 구성되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Cron</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0 0-10 0-23 * * 0-5\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"UpdateDataSchedule\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">cron4Time4Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>taskSchedulerService<span class=\"token punctuation\">.</span><span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">stop4CronJob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UpdateDataSchedule\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>일요일에서 금요일까지 자정에서 11시까지 도는 스케쥴러다.<br>\n근데 로깅을 찍어보고 해봐도 뭔가 이상했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CronOptions</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Specify the name of your cron job. This will allow to inject your cron job reference through `@InjectCronRef`.\n   */</span>\n  name<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Specify the timezone for the execution. This will modify the actual time relative to your timezone. If the timezone is invalid, an error is thrown. You can check all timezones available at [Moment Timezone Website](http://momentjs.com/timezone/). Probably don't use both ```timeZone``` and ```utcOffset``` together or weird things may happen.\n   */</span>\n  timeZone<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * This allows you to specify the offset of your timezone rather than using the ```timeZone``` param. Probably don't use both ```timeZone``` and ```utcOffset``` together or weird things may happen.\n   */</span>\n  utcOffset<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * If you have code that keeps the event loop running and want to stop the node process when that finishes regardless of the state of your cronjob, you can do so making use of this parameter. This is off by default and cron will run as if it needs to control the event loop. For more information take a look at [timers#timers_timeout_unref](https://nodejs.org/api/timers.html#timers_timeout_unref) from the NodeJS docs.\n   */</span>\n  unrefTimeout<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Creates a scheduled job.\n * @param cronTime The time to fire off your job. This can be in the form of cron syntax or a JS ```Date``` object.\n * @param options Job execution options.\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">declare</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Cron</span><span class=\"token punctuation\">(</span>cronTime<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Date<span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> CronOptions<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MethodDecorator<span class=\"token punctuation\">;</span></code></pre></div>\n<p>저 <strong>@Cron</strong>의 함수 형태인데 뒤에 옵션이 수상했다.<br>\n위에 선언된 속성 중 <strong>timezone</strong>이 옵셔널로 들어오는데 이게 문제였었다.</p>\n<p>아무것도 선언을 안해주면 그냥 <strong>UTC</strong> 시간대가 적용된다.<br>\n그래서 이걸 아래와 같이 timezone을 선언해주면 아주 간단하게 해결되는 문제였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Cron</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0 0-10 0-23 * * 0-5\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"UpdateDataSchedule\"</span><span class=\"token punctuation\">,</span> timeZone<span class=\"token operator\">:</span> <span class=\"token string\">\"Asia/Seoul\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">...</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이렇게 해주니 한국시 기준으로 잘 동작하였다.</p>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n<ul>\n<li><a href=\"https://docs.nestjs.com/techniques/task-scheduling\">참고 공식 문서</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%9B%90%EC%9D%B8\">원인?</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n</ul>\n</div>","excerpt":"NestJs에서 스케쥴링… 현재 하고 있는 프로젝트에서 스케쥴링이 필요하여 구현했었다. 그런데 스케쥴링을 돌렸는데 뭔가 시간이 안맞게 돌아간다고 해야 하나? 분과 초단위는 잘 도는데 시간대가 좀 안맞았다. 그래서 테스트를 하고 자료를 찾다가 원인을 알게되었다… 원인? 이유는 바로 TimeZone 문제였다. 내가 구현한 코드는 다음과 같이 구성되어 있다. 일요일에서 금요일까지 자정에서 11시까지 도는 스케쥴러다. 근데 로깅을 찍어보고 해봐도 뭔가 이상했다. 저 @Cron의 함수 형태인데 뒤에 옵션이 수상했다. 위에 선언된 속성 중 timezone이 옵셔널로 들어오는데 이게 문제였었다. 아무것도 선언을 안해주면 그냥 UTC 시간대가 적용된다. 그래서 이걸 아래와 같이 timezone을 선언해주면 아주 간단하게 해결되는 문제였다. 이렇게 해주니 한국시 기준으로 잘 동작하였다. 참고 참고 공식 문서 원인? 참고","frontmatter":{"date":"2023.01.29","title":"Nest.Js에서 한국시간 기준 스케쥴링할 때 주의점 (With Timezone)","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230129_tast_scheduling/"}},"next":{"id":"119b5032-a7b2-530d-bfea-1d389174b97f","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 659px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVQoz2NgYGD4T2VMWBEjIyMYU81AqrtQRVXtv4KiImUGwryopaP7f96ipf9nzJ3/X1FJCUWOJAOZmJjAtLuXz/89h47+37H34H9TcwuIgVA5srzMzs7+Pzu/8H96VvZ/FhaWQRopIO8z4ffmALtwQA0EAPm4/UgmQ0M5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/7c297/thumbnail.webp 180w,\n/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/33ecc/thumbnail.webp 360w,\n/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/f67d4/thumbnail.webp 659w\"\n              sizes=\"(max-width: 659px) 100vw, 659px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/e9ea2/thumbnail.png 180w,\n/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/53918/thumbnail.png 360w,\n/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/4978c/thumbnail.png 659w\"\n            sizes=\"(max-width: 659px) 100vw, 659px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a2b8aa5f6e36ad9a2fdd733dbe63883e/4978c/thumbnail.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"aws-s3-사용할까-고민하다가\" style=\"position:relative;\"><a href=\"#aws-s3-%EC%82%AC%EC%9A%A9%ED%95%A0%EA%B9%8C-%EA%B3%A0%EB%AF%BC%ED%95%98%EB%8B%A4%EA%B0%80\" aria-label=\"aws s3 사용할까 고민하다가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS S3 사용할까 고민하다가…</h1>\n<p>전에 만들던 서비스에서는 보통 AWS의 S3 저장소를 사용했었다.<br>\n근데 <a href=\"https://myme.link\">myme.link</a>를 만들면서 노마드코더의 <a href=\"https://www.youtube.com/watch?v=-AwLsUuzgLw\">클라우드플레어</a> 소개 영상을 보면서 <a href=\"https://blog.cloudflare.com/ko-kr/introducing-r2-object-storage-ko-kr/\">R2</a>에 대해 알게 되었다.</p>\n<p>R2는 일단 S3에 비해 합리적인 가격을 제공한다.<br>\n아래에서 간단히 비교를 하게 되면…</p>\n<ul>\n<li>\n<p>아마존 S3</p>\n<ul>\n<li>1G 용량 한달 저장 비용 : 0.02$</li>\n<li>저장된 데이터를 송신하는 비용(유저가 다운받는 것) 1G 기준 : 0.09$</li>\n</ul>\n</li>\n</ul>\n<br>\n<ul>\n<li>CloudFlare R2\n<ul>\n<li>1G 용량 한달 저장 비용 : 0.015$</li>\n<li><strong>저장된 데이터를 송신하는 비용(유저가 다운받는 것) 1G 기준 : 거의 무료(초당 10회 이상은 비용 발생)</strong></li>\n</ul>\n</li>\n</ul>\n<br>\n<p>나 같은 경우 서비스를 오픈할 때 잘 되기 전까진 <strong>무료 플랜과 저렴한 비용으로 최대한의 효율을 뽑자</strong> 마인드이다.<br>\n그래서 이번엔 S3보다는 R2를 적용해봤다.</p>\n<p>근데 R2 자료가 거의 없었다.<br>\n대부분 S3 -> R2 마이그레이션만 있지, 이것을 S3처럼 사용하는 예제는 없었다.</p>\n<p>그래서 좀 삽질하고 배운 내용을 정리하는 용도로 이번 포스팅을 진행한다.<br>\n원래 깃허브에 레포 하나 파서 예제를 올리려 했는데…<br>\n이거 준비하는 것도 일이더라…</p>\n<p>그래서 이건 나중에 시간이 남아돌면 그 때 하는 것으로 하고…<br>\n이번 포스팅에서는 최대한 친절한 가이드 형식으로 하려 한다. (사실 내가 나중에 또 만들 때 보려는 목적이 더 크다 -_-;; )</p>\n<p>내가 진행한 환경은 <strong>Nest.Js</strong>로 했으며, <strong>Typescript</strong>로 작성되었다.<br>\n이와 관련된 예제는 <a href=\"https://elfinlas.github.io/nest_js/230203_r2_nestjs/\">CloudFlare R2 사용해보기 Part 2 (With Nest.Js)</a> 포스팅을 참고하면 된다.</p>\n<p>일부 로직은 대강 작성했기 때문에 좀 난해할 수 있음을 미리 고지한다.(서비스 코드는 공개할 수 없기에…)<br>\n이것을 적용햐려 할 때 힘든 점이 있다면 아래 댓글로 문의하면, 답변 드리도록 하겠다.</p>\n<p>포스팅의 전반적인 설명 흐름은 아래 도표대로 되어 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/0lEQVQ4y41Ua2+jMBDM//9z1+q+3CltEh4GvzAGvyCGzMnOJW3VPGrJSIy9w+7MLhsAOJ1ON/et9fns1p3Nd/D0JVhKBdJQVHUDxsX1/N4HNxfcDA6j9nlLNsC7KeNFQfDy6w9eX/7i9+sWvTLfMv1CmB7ruqIXAZLOoLWFaCcoYRGXiEF59DxC0gBBJ3TcY12X+yVfCCWzIMWA/VageOvAmh4xRrBGoT5oFO8d9luJpuzz/acaBj/D2wl2DNDKYJ6OGV/igqG3GeOtwjjY5yU/cvSSvWgdGBnh3fzMlPPBsiz5cnBHjNrBu4DgJyipUe97VIcBpBhhtH+c4QVMriZDqp3OOiWyS6CSBpIZkFLCWf+zDFNGbWlw2CpUO5nf00qadsJAKwfJRwimsa4/aOwkvrMTnJkwagvBO1DKwYhGW9pcbltZ8MZhWVbcmrA7k/J19d2ZhBEDWpssR9L7nombsyFrbpt5ipjCMet5KXkKM/puzK0jWA/J+4zHuFxjrPGIx/jRNomAFBrlTqF4l7m5SaEQfJoOjaYYUO47lLsOtB4QQgBv9f+GlznODOGDMGkn2gBKHJoqlebQVmMmlGwEJwGkHNGUFrQeM2HCGfG5M1h9/gdcCY9zzFqlnX4MlCgI2l8nSAmTWyeNI/+MS4OOJ7M+uuKhKY8m6J4p/wBDzinUe0ZNWAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/71f2f74af9b261580384373badd48aa6/7c297/img00.webp 180w,\n/static/71f2f74af9b261580384373badd48aa6/33ecc/img00.webp 360w,\n/static/71f2f74af9b261580384373badd48aa6/df77d/img00.webp 720w,\n/static/71f2f74af9b261580384373badd48aa6/5c666/img00.webp 1080w,\n/static/71f2f74af9b261580384373badd48aa6/1a410/img00.webp 1089w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/71f2f74af9b261580384373badd48aa6/e9ea2/img00.png 180w,\n/static/71f2f74af9b261580384373badd48aa6/53918/img00.png 360w,\n/static/71f2f74af9b261580384373badd48aa6/242a6/img00.png 720w,\n/static/71f2f74af9b261580384373badd48aa6/b4ad3/img00.png 1080w,\n/static/71f2f74af9b261580384373badd48aa6/97810/img00.png 1089w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/71f2f74af9b261580384373badd48aa6/242a6/img00.png\"\n            alt=\"img00\"\n            title=\"img00\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h2 id=\"사용법\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사용법</h2>\n<h3 id=\"1-클라우드플레어에-계정-생성을-해준다\" style=\"position:relative;\"><a href=\"#1-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%ED%94%8C%EB%A0%88%EC%96%B4%EC%97%90-%EA%B3%84%EC%A0%95-%EC%83%9D%EC%84%B1%EC%9D%84-%ED%95%B4%EC%A4%80%EB%8B%A4\" aria-label=\"1 클라우드플레어에 계정 생성을 해준다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 클라우드플레어에 계정 생성을 해준다.</h3>\n<p>그리고 R2 메뉴로 들어간다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 270px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 293.33333333333337%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAA7CAYAAAB7c6ruAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGLUlEQVRYw6VXyY7jVBQNhRA/w7Z3bJDY9I/0lwArWKBmxY4FAgmBgKKRgFJ3DaHGpiuVdGeoyugkTmwntuPY8fCGg96Nk6p0UkkKIt14ej4+d343I6WEEOJWOIMAIMIRWP2EziXUn5weN/wyCnDpZ1yBffUh5BcfAM1dBQ9aJuV2gM1mU7ZaLVQqZVmpNkTupy9F++dPRfHZ1yL3+1MR+Q6RllKuE0gpZUahFotFFAoFeZXPI3d5ieJ1AzdaH4XSDV7m3iAMI2AzQXqa4ZzPLwCMADQBtAFoMxFCaIwxjXO+Slqcc1PhMMZkJnVKohzCGPtMfWRvb+/9J0+e7Dx+/Hjn0aNHO7u7uzu5XG7n/Px85+LiYi7dbvc9tV4I8bHCYYyJTMosSY+fCEH33tV1PbNJALyTrv9IAXLOlwEZYwSYzWYzm0QBJkmyCJjGn+Ccjm3O+QHn4oRzccw5PxZCrJMTIcSREOJNajJJTpGSwlemDlp0nRDqy9uIZIyBVPZDLm+6E3UqBrbHbdfnA2fM+5bL44Spr2wSxYhACXDoJci+diAkUNcM1DQDra6F19dteH6YxqDcKIrpQurJeyJ30311mANimlMIY2IN5RylJSO7CDAu7rwo7//YXcDuIMLTX9pImMTA9nCaqyJf1lBrGci+rMDzJysBZ9cDZwzXmxAoAUaJgGaGxDRhDMEkwiSMSfwgAhdiLeC9NsSaireNfRlLVQ5jjrLmQxGxRz46PRtdw0anP6Tr+0Bn18EkRhglVKAJMIg4ii2fvKXsUa7ruG70UG32oRvOglqrAEfjCfxJRAmylcpSbmeKeaYkTKBnx8RQ2UEJpxxfDt6NTlE3esMIn/+o0UNNH+DookKh43jB1gwXABmXGAVs/iUVLjMjbxPUDw4bOc2tRVlnQ+Xlq+qIbGZYDsq1LnlYFQrlwdt8Tdko2yr2acA77piKCHlZsYqZRGMoiJ8bMmjmCPpwjK7lUtakhfFeDdSKRII2CRm1jEUJYOrglRJQvAJy55AnR2DHRwiPDhEczuQAk4N9RIf7YH8fgv9zBlEsgNdriAYOVH3JRMUi9D/28Wr3GHa+jMZVFZWyDmsQwhhEMOwEpsNSSWDaMcxhBMv0MdQsOKUanFcFONlTJKd/I8N/+wmliyq+/tNETwCH9QDPchYcCVgJMFghFpuKKQAT6To7RPziL2Qidww3ewJ77wXGB4eYnJ5i9CqPQaECq9SEed2GedOBedOlo1XRMCjW4F4V4Z1dwD88grd/APf5PuLaDTIL1vU9wBkAvTbQuAFKBYirfyByL6eizguXkOXXQKMKGDowciCjiBoLU11f4dijCHuXNt1QHs7XDRSaJmqGt3EzM/e76o4smZUvQVWbC5UlEYa2B8Ny4XnBPN5Wyiy//1OmPCSX/ZCjqPnE0A9C2K5PdVFlybpcvhfQcGK8yNlgAuiZDvKVNrIvr6lJqXR8uy/fd/0glTeBLTAkZ0R8qYiu7cOrqs0MsGWG+OS7JhIOdHpDXBZbqDR6KFTaqGkmKvUecqUWKnV9iRVtZVJ7Q4rbsGka074cxQzeeIJxEFGlCcJ4epyEFFKrVFY7jKk8oC9vo/LchuMJR7kdUAGd9eW+5aLa6sMdR4g7efSPvwcf1FcyXAobVbFVo1fPVWNSduv0bZSqXZi2j6STQz/7LbhVS19e7jUP3opsUnmp6znjhBiqzVKS9uZp55PEKI4TzLbMb8fgEqDrMxzkp1uOruHgIl9HSx9QkzrP1ykVe4aDKE4WAVdlilKThhYu58GpGKZTAYXRbFJdAFrBdM5wOk3JtVVlaahbp3IQcpyVXHqgm1OVNX1IvfnNdRvlhol4ZMI8+gbDsx+AJFjPkBq8E9ODsR+i2bHgegGckQ/bHUO3RmCTEbzSPvzqMcDj+wG3mQIerLLK4Y4VkWNU3lpDj5yzNJ/Mth+bnGKPEzy/tOmBCpWDs9J8C7I167sq33pY3l2x1fS0NEm9PQSqLZmSLQfGpfcydwj979+tDb0Ev55YpLBu2Dh+dU0D5EWhTsV23fA4m6QWKrbaH7atqRNU2jmjgAqDiknG+FYOUX4ghio8hJiOvHx+LtPwEHT9EDv+C9z5s+k4VpDbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d68256b6fc2ca00f6bc2e4d23f031a24/7c297/img01.webp 180w,\n/static/d68256b6fc2ca00f6bc2e4d23f031a24/78721/img01.webp 270w\"\n              sizes=\"(max-width: 270px) 100vw, 270px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d68256b6fc2ca00f6bc2e4d23f031a24/e9ea2/img01.png 180w,\n/static/d68256b6fc2ca00f6bc2e4d23f031a24/8c112/img01.png 270w\"\n            sizes=\"(max-width: 270px) 100vw, 270px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d68256b6fc2ca00f6bc2e4d23f031a24/8c112/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h3 id=\"2-r2-가서-구입-결제를-진행한다-프리플랜-가능\" style=\"position:relative;\"><a href=\"#2-r2-%EA%B0%80%EC%84%9C-%EA%B5%AC%EC%9E%85-%EA%B2%B0%EC%A0%9C%EB%A5%BC-%EC%A7%84%ED%96%89%ED%95%9C%EB%8B%A4-%ED%94%84%EB%A6%AC%ED%94%8C%EB%9E%9C-%EA%B0%80%EB%8A%A5\" aria-label=\"2 r2 가서 구입 결제를 진행한다 프리플랜 가능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. R2 가서 구입 결제를 진행한다. (프리플랜 가능)</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 438px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 193.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAnCAYAAAAPZ2gOAAAACXBIWXMAAAsTAAALEwEAmpwYAAADTklEQVRIx51XSW5TQRBFYsMVWHET7oDEGrHgFlwCxI5TIMGGDQsiQYJlFEwIURQlnv88z0P/h6ritr7tP5mWnsp2d7+uqq6h/SCKIuR5jizLGlGJHGWRoypz/ty2jhCGIR4kSYKuoToZvKiE4eXQnKxzLSm3JayqirE/Ti59XMxjnN9FuJjvHi73yH0HhDTKsoSu67BtG6qqwjY1+J7DMA0NmqZDURRYlrXd00kohIDruvB9n6VtO7AdB67rwbJsBEHAv5OsazrY5L7Ra3LdL4TxeIzRaMRyMpk0Hj6IkEZRCnw7/YGz0Rjjn+eY/P6DUjQf3Eq4f2rTEHva9WooN3w4M/H24xLvP68Z7z4t8WXibEl7NZSQZj19/QsPn33Fk1enePzyOx49P8GLN1cbdxxBKBeYfo6ZkWBupIyplsANiwNTGwmFKGlmkA93/CkE44AwLwHPDzkDCI7jQFFVGKYFVdU4wBVVg2GYPE+ZRGg1OS3uCXVNg64bMAyDU8w0TV6YpinLOI4Z9J32dhIGYQxNU5mI8pnISJsh2XJAmJWA6wUwDYOJpEnr9RpNJa43sJMCMC0X6/VqW2kIpCmR0iEk6TdZGDoJmTRJeTH5R/qK4HkeV2OaI5mlWTshbaao9zwXVSWOqjKNqUeEVFSn0yn3lib/7KSlEI2VaUtIzYVIZ7MZx570WV2LoiiwWCywWq14Ha3pJaQNREjOr2+QhPJCSNKldRISlsvlNkuIdJ9Q44DXmZRaQOelkO8oXFRVQRSG0u07hGQqBfx8Pmd/75MeZkqWIU5SxGmONBeMuvPpUPkgIEkX2UnohAXmeorrZYybVYzrZYQsF5tN/5F6MhxEQ8gMQWOmyElZ447BDiGRcEmiEMoylKTtxtR7HGrT+rYhB1OOUu+9+nuJu9sbJHE0uMG3mlxWQJQK7hn02nKCe2n7Gfwg4KeJfIbQTfdWm6wAP9du1yGmaoSbZYA7JcLtKoCuU6E1mYwCvKmxNRK6ng9TV/jFpSorLOZTljJzBlWbesW2HQ+KZsENS85XITZ9uixbq08noeN6WKs6FMNnE6mw1jOirbS19xQ/hKFrMA2diwQVgq4a2RPYx78NG+NQ9gqCDI865NwQ0L+Af/1d2ei6KW0nAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/df8dba9386f0089437569cb97980d2ae/7c297/img02.webp 180w,\n/static/df8dba9386f0089437569cb97980d2ae/33ecc/img02.webp 360w,\n/static/df8dba9386f0089437569cb97980d2ae/3f92f/img02.webp 438w\"\n              sizes=\"(max-width: 438px) 100vw, 438px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/df8dba9386f0089437569cb97980d2ae/e9ea2/img02.png 180w,\n/static/df8dba9386f0089437569cb97980d2ae/53918/img02.png 360w,\n/static/df8dba9386f0089437569cb97980d2ae/a3b87/img02.png 438w\"\n            sizes=\"(max-width: 438px) 100vw, 438px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/df8dba9386f0089437569cb97980d2ae/a3b87/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>요금제 구매 버튼을 클릭한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz5WSTU7DMBCFe1hWLLkLC1ZdILGAE7CoECskDoAQBYoqSFo1df6cxPHPPDR2EqVVuuhIT7bG9vibZ8+ICCyOrDKIhAJAcM558Zq1Fm3bDrmxtNboa7BmXMh1BT//Cry87fzc2nCAgw8VReHn/SX9RXmeYxwz8nhEYYRXR9znUJYlVquVp+wWDoocEIaJT/uECws+o5SClBJpmiKOY2RZhrquB/KxXQMhAAPQI4AHAPfW2kXTNBgRT5KcEhek91+ZiixPtNasrKoq9o2MMcRtMqkx5uAgB+eYnj3mfUPLjoBU5ojiCGIvsF6vabvdQgiBJEl8q0x9yr/jlkkpRaUs/chU/HpM2FGebJe9tI5QNwq7REBrE74NP/3x8095N0nmakgRQWx+0FRFaPkc08fFZWNx97zB7VOM+WKDr7gOhONNUzRTxBz7UuNq/o3LmyUurj/wuizwD97pWznY4leiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7db99ff3e26d689daa5c070a02c1bc36/7c297/img03.webp 180w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/33ecc/img03.webp 360w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/df77d/img03.webp 720w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/5c666/img03.webp 1080w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/9186d/img03.webp 1097w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7db99ff3e26d689daa5c070a02c1bc36/e9ea2/img03.png 180w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/53918/img03.png 360w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/242a6/img03.png 720w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/b4ad3/img03.png 1080w,\n/static/7db99ff3e26d689daa5c070a02c1bc36/c37c4/img03.png 1097w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7db99ff3e26d689daa5c070a02c1bc36/242a6/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>무료로 사용이 가능하며, 일단 해외 결제 카드가 필요하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.44444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVQ4y41TPW/UQBC9n8QviJCQ6PgfdIiGBhBKwV9BlBQ0NDS0ROIuuYTLoXDJBfnj7PPaO+v1ru19aMbZcFAx0sij2Z03b96sZyEEsLN9npcg2wMIGMcRwzBK/uu6xlVqJB7GUc64xjmHtm0lH3Fmh4DfbxScHxCtZ8AwhvW2QlrqgDCOYbrMnYL3Hl3Xhb8AY/EdplhkUBU5rtYr5LebsL5cYbW6RNM09+cyygGYAHIXY8w9SxlrGECkcb4tsNyWYb7ZgYjI2jYhoqzrujSE4O5AwmHtrG0tsiyDtVacNen7XkA/Lnd4d5IMH053qO34qSH/FMALAM+MMSsmwwMxIMfCkHUiIjR1fQ942DEqklUet3mDoXfo+4G146UEbszL2e/3QmLGAHmeQ2st2hxq4pxHmhWojJMOfvBI0xSktQAURRG4nmuZlDDsOieJOHJ8Cvy1psXy4kf4VZL0cYMPSZoEpVTQWoeqqlj/wGB3408MIzumzM5L4guRcWdbaaKUkvO45XGctCvLEkmSiPYz1qKuazlgVuwx5rPofJmfzL+mqr0slQG5bsaFlVIgMtCaxDmOgNZOYOzMktnziJoMat2iVC3qhuS+aMi6VaqWzcWR46hxQWy2NSiLHap9Ad0oYbtXhLyyUI2B69o/D5u7Rw05jvpx7Pz0b7//kuHB8xMcvfyGh68XePL2HI+PzyQ+erXAozen2O66CTBqFMF4rPjABXzosas95j8JZ9cGZ9eEi63B8oZwuiEsNiS5zo8TIBfHcWMD/k45Bu3xv/YbS8CA1wyHyycAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e56ceb1f23ba672d881f80f89e623c65/7c297/img04.webp 180w,\n/static/e56ceb1f23ba672d881f80f89e623c65/33ecc/img04.webp 360w,\n/static/e56ceb1f23ba672d881f80f89e623c65/df77d/img04.webp 720w,\n/static/e56ceb1f23ba672d881f80f89e623c65/5c666/img04.webp 1080w,\n/static/e56ceb1f23ba672d881f80f89e623c65/537ed/img04.webp 1086w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e56ceb1f23ba672d881f80f89e623c65/e9ea2/img04.png 180w,\n/static/e56ceb1f23ba672d881f80f89e623c65/53918/img04.png 360w,\n/static/e56ceb1f23ba672d881f80f89e623c65/242a6/img04.png 720w,\n/static/e56ceb1f23ba672d881f80f89e623c65/b4ad3/img04.png 1080w,\n/static/e56ceb1f23ba672d881f80f89e623c65/a1954/img04.png 1086w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e56ceb1f23ba672d881f80f89e623c65/242a6/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>카드 정보를 다 입력하고 진행하면 아래와 같이 완료가 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACfklEQVQ4y31TS2/TQBD2FaSeOPKTekDiwkOCA3eExInfwJEjcOHAmb8AhzSgloi2akmKaZvGTkjqJN712mt7Hx+adRy5itORRjs78+2817MWkKWFJcFWZ5MBC2MtZGk2bE2MNhXGS3ONV+8HiEVRGbSBMRWTTLrZMsfrj2eQhYK15gZGaQ2is1DgzScfntYao8kcemXYjA4opfBvdjumKBWmEYeHBrWXA5CbSbJGbcUReXQxLYZGGIzCKTqHAYIgRBs1HXsrhSOSpZSGc24YY4bkOI7N8fGR7R38QK/Xs4wxyzmHEAJJkqAoirVTl2EzAonULwLlee56V5Yl0iwDTxJLerqTjWTiZl/XDl1dVaIk+wC6APZXvGeMuSJHxhi7wm6UvO5ho2TaEZTKvEuz4qFW6rlS6jmAB0KIz3EcU3baAY3ZGMhGyVVw2MMLgV/+AoUUDlA/riuo79SO8XgM6mdryXW9hTI2V9qyhNnlcmmllFYIYaMoAg0kz3ObZZkbCmPMOW7LsNlD9wevl3M7GY9tmqY0VTudThFFkQuQpqlzSNlRb9syrKeylmfzawwvL91q1I8pIzprHU15aw+b36xUJbJcIhWpe0Q6Wo96behOjql06umtDuOYYRSESNNsBayYZkYImeeIGcf5+QVOTk4RRfMtJa93yUAKRive+s0EW2ASDN0ZL2ZIeHx7htO4RD+UOAsz9IMU/SDDIKy4H2b4PRI4vRI4GXIcXTBcsy1fT1d7iJcffHi7X7HzpIM7jzq4+7iD+y++O773rOt0xDtP9+DtfsPbLyP3rtSmPcPhTKI74DjwE+z/4Y5//k0qJp1f6Q58ju6AYbK4meF/MmGwW6SdiqcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c4233fc8936242d0e036630fe01e3f7a/7c297/img05.webp 180w,\n/static/c4233fc8936242d0e036630fe01e3f7a/33ecc/img05.webp 360w,\n/static/c4233fc8936242d0e036630fe01e3f7a/df77d/img05.webp 720w,\n/static/c4233fc8936242d0e036630fe01e3f7a/751eb/img05.webp 761w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c4233fc8936242d0e036630fe01e3f7a/e9ea2/img05.png 180w,\n/static/c4233fc8936242d0e036630fe01e3f7a/53918/img05.png 360w,\n/static/c4233fc8936242d0e036630fe01e3f7a/242a6/img05.png 720w,\n/static/c4233fc8936242d0e036630fe01e3f7a/fe1bc/img05.png 761w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c4233fc8936242d0e036630fe01e3f7a/242a6/img05.png\"\n            alt=\"img05\"\n            title=\"img05\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h3 id=\"3-대시보드에서-r2-메뉴로-이동한다\" style=\"position:relative;\"><a href=\"#3-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C%EC%97%90%EC%84%9C-r2-%EB%A9%94%EB%89%B4%EB%A1%9C-%EC%9D%B4%EB%8F%99%ED%95%9C%EB%8B%A4\" aria-label=\"3 대시보드에서 r2 메뉴로 이동한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 대시보드에서 R2 메뉴로 이동한다.</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQoz5WSTU4DMQyF5/4H4QYsEDtWSIg1UlkgUbpIxU9n2sSxY/uhZDplWoYFT3qKHMVfbCddCAFECSKMnDOYGWaGKnc/uSqxYrVJ3seCfSpQG/ePakFXQfuUkSifgBPg4iw+BvGru4DNe/zUwjel6K2qXovIquYxs3ckjqeXLdahh5si57FSImprdaSxopy5kTnTEGN8cPdHM7tX1TcRQSnFu8iG59eA9XaHUgQpUYNNngMjMdTMUxb0BwEXm49kbLkGooBddvmr5Z+kROy7/lDZ5u7q3tYK9u4sbfYI58bR463M0ma9lNP9DVl21RAZXwMtA/EPTcD6XUTHMUyVT8BvgXN0BGUVdmoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4db33a6b5da7c8d1fea82fc98704161b/7c297/img06.webp 180w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/33ecc/img06.webp 360w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/df77d/img06.webp 720w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/5c666/img06.webp 1080w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/082c4/img06.webp 1295w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4db33a6b5da7c8d1fea82fc98704161b/e9ea2/img06.png 180w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/53918/img06.png 360w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/242a6/img06.png 720w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/b4ad3/img06.png 1080w,\n/static/4db33a6b5da7c8d1fea82fc98704161b/beec5/img06.png 1295w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4db33a6b5da7c8d1fea82fc98704161b/242a6/img06.png\"\n            alt=\"img06\"\n            title=\"img06\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h3 id=\"4-버킷을-생성해준다\" style=\"position:relative;\"><a href=\"#4-%EB%B2%84%ED%82%B7%EC%9D%84-%EC%83%9D%EC%84%B1%ED%95%B4%EC%A4%80%EB%8B%A4\" aria-label=\"4 버킷을 생성해준다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 버킷을 생성해준다.</h3>\n<p>버킷 생성은 웹에서 해도 되고, <strong>Wrangler</strong>를 이용하여 콘솔에서도 생성이 가능하다.<br>\n<strong>Wrangler</strong>는 CloudFlare의 <strong>Workers</strong>서비스를 사용하기 위한 일종의 CLI 툴이다.</p>\n<p>이에 대해 <a href=\"https://www.cloudflare.com/ko-kr/products/workers/\">자세한 것</a>과 <a href=\"https://www.cloudflare.com/ko-kr/plans/developer-platform/\">요금</a>은 링크에서 확인이 가능하다.</p>\n<p>이 포스팅에서는 <strong>Wrangler CLI</strong>를 활용하여 생성해 보는 것으로 하겠다.<br>\n물론 대시보드에서 생성해도 똑같다.</p>\n<br>\n<h4 id=\"4-1-wrangler-설치\" style=\"position:relative;\"><a href=\"#4-1-wrangler-%EC%84%A4%EC%B9%98\" aria-label=\"4 1 wrangler 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-1. Wrangler 설치</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn global add wrangler</code></pre></div>\n<p>물론 나처럼 특정 프로젝트에서만 설치할 거면 global은 빼면 된다.</p>\n<p>그럼 아래와 같이 설치가 된다.</p>\n<blockquote>\n<p><strong>나는 global이 아닌 local으로 설치해서 wrangler 명령어 수행 시 마다 yarn wrangler 형태로 사용한다.</strong><br>\n이 부분은 각자 원하는 방식으로 설치하고, 사용하도록 하자</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">>  yarn add wrangler\nyarn add v1.22.19\n[1/4] 🔍  Resolving packages...\nwarning wrangler > @esbuild-plugins/node-modules-polyfill > rollup-plugin-node-polyfills > rollup-plugin-inject@3.0.2: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-inject.\n[2/4] 🚚  Fetching packages...\n[3/4] 🔗  Linking dependencies...\nwarning \" > ts-loader@9.4.1\" has unmet peer dependency \"webpack@^5.0.0\".\n[4/4] 🔨  Building fresh packages...\n....\n✨  Done in 19.39s.</code></pre></div>\n<p>설치가 잘 되면 다음과 같이 테스트 해본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> > yarn wrangler\nyarn run v1.22.19\n$ x/node_modules/.bin/wrangler\nwrangler\n\nCommands:\n  wrangler docs [command]              📚 Open wrangler's docs in your browser\n  wrangler init [name]                 📥 Initialize a basic Worker project, including a wrangler.toml file\n  wrangler generate [name] [template]  ✨ Generate a new Worker project from an existing Worker template. See https://github.com/cloudflare/templates\n  wrangler dev [script]                👂 Start a local server for developing your worker\n  wrangler publish [script]            🆙 Publish your Worker to Cloudflare.\n  wrangler delete [script]             🗑  Delete your Worker from Cloudflare.\n  wrangler tail [worker]               🦚 Starts a log tailing session for a published Worker.\n  wrangler secret                      🤫 Generate a secret that can be referenced in a Worker\n  wrangler secret:bulk &lt;json>          🗄️  Bulk upload secrets for a Worker\n  wrangler kv:namespace                🗂️  Interact with your Workers KV Namespaces\n  wrangler kv:key                      🔑 Individually manage Workers KV key-value pairs\n  wrangler kv:bulk                     💪 Interact with multiple Workers KV key-value pairs at once\n  wrangler pages                       ⚡️ Configure Cloudflare Pages\n  wrangler queues                      🇶 Configure Workers Queues\n  wrangler r2                          📦 Interact with an R2 store\n  wrangler dispatch-namespace          📦 Interact with a dispatch namespace\n  wrangler d1                          🗄  Interact with a D1 database\n  wrangler pubsub                      📮 Interact and manage Pub/Sub Brokers\n  wrangler login                       🔓 Login to Cloudflare\n  wrangler logout                      🚪 Logout from Cloudflare\n  wrangler whoami                      🕵️  Retrieve your user info and test your auth config\n  wrangler types                       📝 Generate types from bindings &amp; module rules in config\n  wrangler deployments                 🚢 Displays the 10 most recent deployments for a worker\n\nFlags:\n  -c, --config   Path to .toml configuration file  [string]\n  -e, --env      Environment to use for operations and .env files  [string]\n  -h, --help     Show help  [boolean]\n  -v, --version  Show version number  [boolean]\n✨  Done in 1.23s.</code></pre></div>\n<br>\n<h4 id=\"4-2-wrangler-콘솔-로그인\" style=\"position:relative;\"><a href=\"#4-2-wrangler-%EC%BD%98%EC%86%94-%EB%A1%9C%EA%B7%B8%EC%9D%B8\" aria-label=\"4 2 wrangler 콘솔 로그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-2. Wrangler 콘솔 로그인</h4>\n<p>다음은 콘솔에서 로그인 해준다. (y 입력해주면 된다.)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDklEQVQY03XLS06DQACAYc5iZKAMlMIwPGagvCmkKQsStU2TLnoRD+MdXBTFu7ibSdtUN62RBBMToxsXX/7VL8ybTRmXzVKEaHU9MlZAMe6ATra3dfW6WYSDRfxPTLMeuXEva7gHEPWSag3/EeJ0dnTJ9E0zvBOcuCdZw0dZwxcR4uFKsYfR2BlkDX/7mQBEHwCiM4Do8qfvAKKDkM7qLikWXVo1XZDMO+TFL5hmz9602NGwaJ0gb0lUtSQsdzSqnkhYPhpOuB0jutStYK1b/lpD9EZS8b2kWg9ClNcszGvm+BnDJGE2TZnlxcwNCm7TlNs048iNuONnfIIDrhoeB9DcSxDtwS8uKuYZKObwBfkudHtpG6E1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/da12366ece5cb133215ecc951568ccfe/7c297/img07.webp 180w,\n/static/da12366ece5cb133215ecc951568ccfe/33ecc/img07.webp 360w,\n/static/da12366ece5cb133215ecc951568ccfe/df77d/img07.webp 720w,\n/static/da12366ece5cb133215ecc951568ccfe/d8a71/img07.webp 888w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/da12366ece5cb133215ecc951568ccfe/e9ea2/img07.png 180w,\n/static/da12366ece5cb133215ecc951568ccfe/53918/img07.png 360w,\n/static/da12366ece5cb133215ecc951568ccfe/242a6/img07.png 720w,\n/static/da12366ece5cb133215ecc951568ccfe/8dc7d/img07.png 888w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/da12366ece5cb133215ecc951568ccfe/242a6/img07.png\"\n            alt=\"img07\"\n            title=\"img07\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 브라우저 열리고 Allow 해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 603px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 158.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAAsTAAALEwEAmpwYAAADhUlEQVRIx41Wu27UUBDNj1HTUPIFCGpEyzdAAR0tokWKqCgiUUQChRRJlJD1vuJd79r73vU68fPa96Bz4zG72QexNBo/7hyfOTMe3wOtNXZZdeQJYB8DeQze3RdzgI3jH1iaJPBGE7j1M/S+f0Awce5X6AK7joM8z0ErigKF8WIFlFIIwxBRnCIqgDRT5tlaTGly74BsCBQnKZKsQJwVJpBgtCpAZSaA98SnaYo4js31WsoqL7CYjhDWDxH/+YKR24Xd6aLT6cC2bWOu65prWqvVQrfbxWw2w3K5RJIkpRQCWGgsxg6Cb2+Qfn2BjnWOXyen+H1ygqOjIxwfH+Ps7Mz4Wq2GZrNpgHcDKoXgLkI4shEOWuZ86ftm8Xw+h+/7WCwWBoCaSqo8v729NddrgPcaKSRKI8mBLE3NoizLjPGcOlV98KBV5FkFyBMGep4Lt9+H53lwHMfo1u/3jYZkJ8WQF0l7bQBKJeXmaDQyogsY9bq5ucFgMMB0OjWea/4LKPQJJMI3Go3KCEQ9CUpAKcZehnzIlNvttgGlv7q6Mp6Fubu7QxAEBpjp/xeQi8iwXq8bQMuyKiNL9qB4rpOs1hr7IUMBZBC9GEHJlLoSlEWTmL2AvV6vAiHA9fU1Li8vcXFxYXRl2qx6FEWP05AtI4Vg2iwCG3zV06jlozVkevzMmDZTZBuRHQvGDAgsIHsBecgAoEbD4bACkwHB9iHoo9uGAQSaTCZGK/me6dk64/HYfMt7GcpNLiSYsKSXfuR9FoLgqxNmL0N+o9SQ+kmlqSELRf34hZA5jS+TIbyzbeipFdlJQdgmZMZRxZFGWz12pazLlLXjOLrZbOpWq6Xb7ba2LIuebWSuKQF1ppbMaBdD+W/q8XisGdzr9bRt27rT6egwDHWWZTpNU82X+r6v2Yckwtg1QJ5wiHqep0UnMaZP4zMyn06n5tdcmgmX7B4C6nLO6eVy+SqO42dRFD0PguBpkiQfZHKzCCvTWu+b2Jo9N5vNtOcNzt3B6KTveqfD4fDnZDJx8zz/COAlgNf0SZJ84nql1GbKK1Uuh3CVzf1/+P4fPVdKDZVS49L7JdvtKfNN8/kCS3+uTxt+8fnHIP/d8AtwG5DnhewMVk2YbU2Zb6vVLNgtC+8PHTx5e453h339jzX0FtteFNnHiA7cv6hy77KN2TbbYLi5ldN7t23btn4E/AuBh5SW4zFz4AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/71e0095ff5c928482b0171d61c7c8f15/7c297/img08.webp 180w,\n/static/71e0095ff5c928482b0171d61c7c8f15/33ecc/img08.webp 360w,\n/static/71e0095ff5c928482b0171d61c7c8f15/82b4d/img08.webp 603w\"\n              sizes=\"(max-width: 603px) 100vw, 603px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/71e0095ff5c928482b0171d61c7c8f15/e9ea2/img08.png 180w,\n/static/71e0095ff5c928482b0171d61c7c8f15/53918/img08.png 360w,\n/static/71e0095ff5c928482b0171d61c7c8f15/85b8d/img08.png 603w\"\n            sizes=\"(max-width: 603px) 100vw, 603px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/71e0095ff5c928482b0171d61c7c8f15/85b8d/img08.png\"\n            alt=\"img08\"\n            title=\"img08\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>다 해주면 브라우저가 이제 준비되었다고 알려준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABe0lEQVQoz62SS27bMBRFs+yupjsp0FnRQYICkV0jjt1EEkXqQ30oUZblzylIR0YaO8mkBA6eKJD3XTzem6pqaJqWcTyw3W7Y7eF4hMPhVPf7I9vt7lPqusVp3VRljbEju/yBw/cvqPtv/LwNuLu9IwhmvplbTvwtrumEO3cSrGpMNzBUkv7HV8pwwf38gVkwJ5jNUSpjHPcMw+idTNXh3E+8EmzoWkttLKu4IIwVIk5Yr58QIuH5OWS5XLFa/SEMY1+DYE5RlGfnF4Jta+k6SyqVPyhl5p0lSUqaFmTZCfevyPV5XxQaY7orDrvebx4fl4g4oioLqkpT6hyt9cvlklRlaF2R59qL17Xx47jisMcaTRQZQnEkkhArEAqajg+Xe5ALQWMsm97ytO5YzHp+zyzBr5blwpInlqbY/PMA17iYoUNJSZamSCFIpSSJBVEoELHylyY3r+PyjsPuHI3hJRrDOSLjRUQ+deiGO7l8D9f0I5yGF5w+/gdO6y8xY5XEQGpySwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/23475e42f36e258c9281bbc4833a61df/7c297/img09.webp 180w,\n/static/23475e42f36e258c9281bbc4833a61df/33ecc/img09.webp 360w,\n/static/23475e42f36e258c9281bbc4833a61df/df77d/img09.webp 720w,\n/static/23475e42f36e258c9281bbc4833a61df/e6f0c/img09.webp 817w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/23475e42f36e258c9281bbc4833a61df/e9ea2/img09.png 180w,\n/static/23475e42f36e258c9281bbc4833a61df/53918/img09.png 360w,\n/static/23475e42f36e258c9281bbc4833a61df/242a6/img09.png 720w,\n/static/23475e42f36e258c9281bbc4833a61df/52151/img09.png 817w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/23475e42f36e258c9281bbc4833a61df/242a6/img09.png\"\n            alt=\"img09\"\n            title=\"img09\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>인증이 되면 아래와 같이 사용자에게 질의를 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 555px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbklEQVQoz1WSvXLTQBSF9SAUIcRa25Isa7Va/f/LsmTLthLHCQmBLjVmMmQoQoMdnoV3oOMJqPCkhI6Cocb6uYwFJENx5nx7dou7cw9jRdNqOn8B46fTH5OTY0vEzh7iZdQWFBbxhO0IBD1qSXsmVbzliffz+swHaqqVZDi1Zsc1MYJaok7d6uIa8aRm3Cj7vri4fBNni9fRePFKkK3lPhKXrS5eIp7s9BLx5EqUrW8ydUBSrG2PmEVfsQuRWI06PVqwnFwgnhRMPEwhn+Vb2/Z+2ZZTEGoW3b5WcH2taHVxI8QTaAtKI8Qr9/yQEWA5uXHGcIdfB6OjL3aQ3jnBaOOG2WYwmm/C9Gij2fGdrPmfWU5+xnKy2+riCHFyyHI4ZDk5RDy597agNMxQM/oQZ4u3pjd678X52otnawEba17S1yKxbnlsvHvMCqetLp61BeWQ5XCOeJLvIzHfR738oN3Pn7TF5rzLGdNPYDp/DlF6BHG2gHR6CkFyCG40AT+eNbkTZuDFMzD9FCx/BFYwarLdm3h8DE40AWpG0OlRYARsVkQPSqIHlWKEO66oGVVE9ytqhpVmx5VqDUqseqVE3VIkdsOaE5e6MyxlzS8FbDRiOblkEK+UIrG2WHW3EnW3kur+4b+OVa/J+4pTqmYAsurWmDo10YNaJHbd6dH6oCM91KbbI824UTqHYDiDMDkEL5qA6SWgmhEYzhCcYAR96oAW5JXsjKGv+8397outLm62+2/TjKobH5NscROmR7fZ6eXKn16sBD1eiWayErR4JVnJLasmN9P52aer8wiuzwdVogyA5Xd1kf+rzK42vwGEZybpU3uCmgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9ce602b998c3901cafe512950772a331/7c297/img10.webp 180w,\n/static/9ce602b998c3901cafe512950772a331/33ecc/img10.webp 360w,\n/static/9ce602b998c3901cafe512950772a331/fac4c/img10.webp 555w\"\n              sizes=\"(max-width: 555px) 100vw, 555px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9ce602b998c3901cafe512950772a331/e9ea2/img10.png 180w,\n/static/9ce602b998c3901cafe512950772a331/53918/img10.png 360w,\n/static/9ce602b998c3901cafe512950772a331/98c96/img10.png 555w\"\n            sizes=\"(max-width: 555px) 100vw, 555px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9ce602b998c3901cafe512950772a331/98c96/img10.png\"\n            alt=\"img10\"\n            title=\"img10\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>질문 내용이 사용자 메트릭(?)을 클라우드 플레어에 제공할거냐 묻는데 난 거절했다.(아마 사용자 피드백이나 유저 데이터 수집용일것으로 사료됨)</p>\n<br>\n<h4 id=\"4-3-버킷-생성\" style=\"position:relative;\"><a href=\"#4-3-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1\" aria-label=\"4 3 버킷 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-3. 버킷 생성</h4>\n<p>다음의 명령어를 쳐서 버킷을 생성해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn wrangler r2 bucket create [bucket name]\n\n> yarn wrangler r2 bucket create lucky-num-dev\nyarn run v1.22.19\n$ x/node_modules/.bin/wrangler r2 bucket create lucky-num-dev\n ⛅️ wrangler 2.8.1\n-------------------\nCreating bucket lucky-num-dev.\nCreated bucket lucky-num-dev.\n✨  Done in 6.90s.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 653px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVQY032OTU7CQBzFexUDtLRTpu3QztDpNPQLBASUQOUErgiuiok79TRuvIULIPEmlJUbF87f0ETjRhe/vOQl70MJ08ltPJhvxOC6QF5SGF5c6G5UIC/enGGxGo5nL+tlD9Z5/EkFlzTMgIkeuH4CVGTg8bTSk9cJ+6Ccjy7feJhtWZDs60Z7VzfITmvRvdai2yZmr8jxP5oWBxX7EtkcTIeDjikguwOGxX5Atl/5Sq8/hG6UghBd6AQpMJGBjj1QDQdURKChO1DTiazpBBqIgIra/6IMpstDdpEf41Fe8mRS8mRc6k5QapZ/1Cz/YBL+7rkMqMuk2WLyFNJM908Uyw3uMBVPVpI/aHxaYUbzBxwvHtVwcd+fLJ5vZhGsrhIZ2l1ZQ6QKfhf/Hjg9/AKZ65gNFPznBwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/eb76d3b76797c393dc486371be4ffe97/7c297/img11.webp 180w,\n/static/eb76d3b76797c393dc486371be4ffe97/33ecc/img11.webp 360w,\n/static/eb76d3b76797c393dc486371be4ffe97/0f409/img11.webp 653w\"\n              sizes=\"(max-width: 653px) 100vw, 653px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/eb76d3b76797c393dc486371be4ffe97/e9ea2/img11.png 180w,\n/static/eb76d3b76797c393dc486371be4ffe97/53918/img11.png 360w,\n/static/eb76d3b76797c393dc486371be4ffe97/ffe7f/img11.png 653w\"\n            sizes=\"(max-width: 653px) 100vw, 653px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/eb76d3b76797c393dc486371be4ffe97/ffe7f/img11.png\"\n            alt=\"img11\"\n            title=\"img11\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>나는 lucky-num-dev 이라는 이름으로 만들어줬다.</p>\n<p>그리고 다음의 명령어를 통해 잘 생성되었는지 확인해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn wrangler r2 bucket list\n\n> yarn wrangler r2 bucket list\nyarn run v1.22.19\n$ x/node_modules/.bin/wrangler r2 bucket list\n[\n  {\n    \"name\": \"lucky-num-dev\",\n    \"creation_date\": \"2023-01-27T13:29:58.769Z\"\n  }\n]\n✨  Done in 1.74s.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 549px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQoz3WPO0/cQBSF/VOIsmt78PgxD493PH6NvSuzCisEVhSJpI3SBCnNQkEbUW1Sp8nCH8n/SIlMn2JpUCR8I5uQIAHFp3vPke7RuUZS7BzJvD4pF4dLkr5aIl4ut8V0uS2qO8Ly2BT1pw+vZz9P32n42BS3REUQJhpkVgOJchDJFMK4AhoVYMh85yxKZl9UXq9wEK3GKFhZDr3n6xiRzziY/PB5Cj7Pbl2qOo8lEIQZuDQGTGLotUsVIE+AYbvhZoTI9QiRjYn5xsJ8Yzqs9/75I0RuLDcE2w072+WdfbeDhfnAw93Iql1Iq13IpwsoZnswnTeg9BwCkQGTenijfwd5orMc1h8N03wG476yzxQ4vgCPSAi4Ao/KwfNZPOiXiMGWTbsXNoWxQ4c25t9WDzFkVl8SkbWiWLSemrcW063Fy9bm5TAt3uvqKlHp71k6gSKWnY8lmJg9ChsC2UR/IyI7p3p/7Vdv1jg/WLtF8598/zuuDi/eNotfR00K7/d0l3oaxs7TgX8AfMnTm452DOwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ff5b0016ba97bad573384a2efa30cdee/7c297/img12.webp 180w,\n/static/ff5b0016ba97bad573384a2efa30cdee/33ecc/img12.webp 360w,\n/static/ff5b0016ba97bad573384a2efa30cdee/a6384/img12.webp 549w\"\n              sizes=\"(max-width: 549px) 100vw, 549px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ff5b0016ba97bad573384a2efa30cdee/e9ea2/img12.png 180w,\n/static/ff5b0016ba97bad573384a2efa30cdee/53918/img12.png 360w,\n/static/ff5b0016ba97bad573384a2efa30cdee/ffc28/img12.png 549w\"\n            sizes=\"(max-width: 549px) 100vw, 549px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ff5b0016ba97bad573384a2efa30cdee/ffc28/img12.png\"\n            alt=\"img12\"\n            title=\"img12\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h3 id=\"5-workers-생성\" style=\"position:relative;\"><a href=\"#5-workers-%EC%83%9D%EC%84%B1\" aria-label=\"5 workers 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Workers 생성</h3>\n<p>CloudFlare의 대시보드로 이동해서 사이드 메뉴의 <strong>Workers</strong>를 선택한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 265px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 258.8888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAA0CAYAAACKJRg7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFKElEQVRYw7WXa3PaRhSG/d/7B/IL2m+dfEkn05mmza1OHYwdjGPXxhdIAGPMTRJIQveVVk9nF4zB5pY21cxBQizv7rm955ydNE3JshTIyNIUmWVIOZFcSrIsQ63ZRoQQ7ACkWY7pCmQOiUiJk5QkSQnCBJFmbHupzTWg7ae8PraIBLQ6BufVNvXbAeXzBj3D1ovzPF8rC4BS5oRxpu9K0iybLboHm78ve68eNeDjRauuVevm3ys76hOOg5TnH/r4kcQPQiq1Oy6+3NEd2BxXmhhDd+0Jlc2N0Vg7UQP6Ucbbz0PCWBLFCa2OxV1vyMjx9bMXRGsBs0wSxuL/UHnOKZYryJRD0mwmKmSklFs5JZvGrAaMEsnBpUMscsyhS+msQbnS5PPFDVf1rgZfBxjFgq7hkOdTG8o8J0nlLKZU2AjxcNJVJ3yi8lY2VL/fB+8jebzRTGUvTPnxjw5xIrFsj7Nah6tGH8ubeneZKEApFzIlnQDmRCLn9/OARMVUFNOot/lyWcfvdmFkgmXAyALPhSQCTSbzl5x8apUBEcZwW0MeHSCKBTgowKci6dEnolKJUMnhIWGhQPhhV0tyUCA/LZN0+4QSokw5J2Un7PQYvdulWTjFavbp9HzqhqA5ktzYOXceGDEMIhiEU3ElZsdmVL3B+VhkWCxxa6U4QcZOsL/P4OCEV9WcXgrl25Cf3tR4Wbjh+fsauyddDC9nGIAVghWDlYIpwQBGrsD+5QXX1R7jBHaiWOIclnFfv2FcKmNXqli1NmbbwuiPMc0Qw4owjQCz62A2+gwv67inFby/9hi/fceo1dcbOf6UHHTYCgG9NlQvyM9OEKVDxEEBUdxD7O8hih8Rh0XE8RHZ+Sk0akjHRihSVn9PcxIxDRvHS3hZNPGlUktQ7zubc3v+KZeLcajYpnTlECUZQRDSHYxmgftEVOxJqQhgRqwLgb0N22xa8yRTsizH9oTeLU4EYz/SCR9Eic7zTaBPABVjvzke4seSgelQPm9qtjmrtlcyzVrAfMo2cgsS3Qi4uDj/PjZ0gpT3pyPCJGfkeFSbPSq1Nl9b/X+nsgqbq1tfB2cQRnQGtgbtGvYCYP6IA5fy4bZFapUJ5p9nJ4yF5PzGJ1Hpkwjd0yiyDKNEh5G6T3oesfSEqsipgjYDVBXvh5+bmn6G9lgXqYsvHf6+amnVa80+J5c3umipuv0YUG3UM92HIjUpgw82Ujuq4j3ZXerv26isW5FvtWE+LVz5qmZJvQiijHLN1V5W7cfl1w7NtsnJRZP63Qg5uObmt2eE138+UXdp2IhM0hpEWm0hUozhGNsNGFguQzdEegOcy13EoLYZ8JtVXlPsH06YPpxQBbJimzBO8MNYizp1HCdatlJZda+qt1FJYVguR+cNGm1Dt3Klszo908EcjnHGwdKO9r+rvMTLiz32BvpaFTorVVZg+xVbjxWqtymUq1rl63qXi1qbk8sWY3eMU3pO+9Uzcrs1BZLLVVYyHAsm1TTVbKPaYOUQdTdHY+2QpFPB+3pIHjnfz4bMdV/LVZ5+UWETCamZpWc4ml2eDjxy1sKxzileOJkCVNgMLIe90jVD29tqglo6SX2vSwOqj3tJ0+zJ9Dn/+ybR0+jkuFNZU0a3UXk2mqki9euBqccKx/X5eHRNs23oFOybzkZSUIytmGnG2GpebvRCFEkrtZVDPD/Suavm5m3SMc3kgw3V9K5Unkzz8mGcUO+mE9ImUetmNtQ1RE5yeVJDFmWT/e7XKBv+Azwo17w+pZ72AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3b6f9bbc6314781ed49358eea1a45ae9/7c297/img13.webp 180w,\n/static/3b6f9bbc6314781ed49358eea1a45ae9/dda86/img13.webp 265w\"\n              sizes=\"(max-width: 265px) 100vw, 265px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3b6f9bbc6314781ed49358eea1a45ae9/e9ea2/img13.png 180w,\n/static/3b6f9bbc6314781ed49358eea1a45ae9/28773/img13.png 265w\"\n            sizes=\"(max-width: 265px) 100vw, 265px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3b6f9bbc6314781ed49358eea1a45ae9/28773/img13.png\"\n            alt=\"img13\"\n            title=\"img13\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>Workers도 무료/유료 요금제로 나눠져있는데 무료로 써도 충분하다. (물론 서비스 커지면 유료로…)</p>\n<p>하위도메인이란 것을 입력해야 하는데 쉽게 url 접근할 때 이름이다.<br>\n이미지의 하단에 보면 my-worker 해서 설명 보면 주소가 예시로 표시된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8klEQVQ4y6VUPZPTQAzN/6aioKGnouUHUNAxQ0nJcCVwR0hytjd2sv7e79VjtDnnfE44hkEzb6TVap93JVkrLCRGSvpmPeD7roVRA6x1sNZCKYUQAp6TVYwRc/AB1tYFWOfhvU8+xmTP4+YgIqyYlY0J/yLzMxPpahlQliXyPE8QQiDLsrPmPbaLokBVVRfkZ0I2OD/DMKDv+4TJZj1hvtd1HbTWCReEvDDGJNI5+DbTbfl2TMJ+Jpk0n7sgTJWjgP+RJ4TGOhK1jta66L2PnIVTtimFYla0a1gS0mACPt961G0PKSXGUaHuHQ6tJ9l5yM6haZqUu2VXXCPk5RGgHwB+ArgD0dpaF7Q20NoQa+7Bh9gHLH6IOWE9xk9f7oYXmyNebWq83Eq8/lW046Zosd13tBEt8qNGo4FaAXIEDp2HqA2K2kK704fOTy4bh2/bGvcHg+xokR0NdpVBLi2JxoGRS3Palw5VDwjpsKsU1nuD3tATQhBFisFH7130zkbnbPTOUNcriMNAlRwhqh6jMojB//3Jf5KvtwPevL/Hu48Cbz9kyA/2MYvzwlxr7Kla3JNKaRitUbcjsn2HvOywK1WqNjc0N/O8uniOkJ3OncZV8A4UfUKIEcYFGGPT/rJ1zsNhOYKmMfQYOIH98YJgOfZ+A1NOLvIZ/mWuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b4aca18805e62d8c291735d0e089e317/7c297/img14.webp 180w,\n/static/b4aca18805e62d8c291735d0e089e317/33ecc/img14.webp 360w,\n/static/b4aca18805e62d8c291735d0e089e317/df77d/img14.webp 720w,\n/static/b4aca18805e62d8c291735d0e089e317/887dd/img14.webp 873w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b4aca18805e62d8c291735d0e089e317/e9ea2/img14.png 180w,\n/static/b4aca18805e62d8c291735d0e089e317/53918/img14.png 360w,\n/static/b4aca18805e62d8c291735d0e089e317/242a6/img14.png 720w,\n/static/b4aca18805e62d8c291735d0e089e317/cd4d8/img14.png 873w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b4aca18805e62d8c291735d0e089e317/242a6/img14.png\"\n            alt=\"img14\"\n            title=\"img14\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>일단 무료 요금제를 선택한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAADNUlEQVQ4y3VUy44cNRSd780nILZIIBYs8gdsEWwQEYsIfiBZROxQOjNKJ1Nvu1xuv+17kF3t6uruwdLpclVfH99zXw9EhLzosvJbAgghphGgP4joDYC/mPRRap//Xg+BzrishzPZ/lt5S0SwPrEQ6XVM9COA10+9Dc+DRIqhHMk/K7DhId9gPHAcLT22p/TUKrTc/aw8XklL37iEb7lKb4+DQS88SQfiCuCKsD5XMAXEdCbMG+MTaVcAF6gPkR5DwpM27l82y5YJFUcuSdsIF0EuEC5AQfFwVXst+SIckMuCtm0x9B11XQvvHa7jd42HLSmXMKCGJm+dc2SMJa01rLUUY6R6H9Heg5ukpJTWJ11uS1vQt0o4297b1POFML9UECX03ELbUPb5W4yxoNrkqmKLgziVEtqd3RHmZa3Fsgg0/YyJzViE2AwzYV7GGCh1QjdwjExgnmfkcFQFG2GVFULAp08fMY0j9uHY2/gQcTgc8PFwQExrsO88rMZ5b60pxHXdEoIsvJ6hxIBoJfAS4fok5NYaZlti5ELajKvkRUf88NsR3//6Bd/9csRPv3/NNbwmKN14mO+3PkKZUJISYtokx5IMgnERbz8w/Pl+xJt3A/7+h8GHNZnFw1oKSmtM04SZc8wzh5hnCCF2JZHgnAPnDMkuiHYBooY3OXFxK6mNMHv03DRomgZd15XMVZlbWRHQdBM+f2kwThxKmysVVzHM2colkYky8v4S27TtjSdIs5Lvp9RGWD2Up1Mh8d5vyBL3t1vnMAwDpmksWJYFjLFieyfZuoCJsXJgHEdwzountR2r5H7kaNruJr47yet8TgghQUpZpovW6gy93VyyDEIeb1ny9Zz+nzos48okDLPHKDx8TFfGWhssUsI5W8KTW7XG+l6yNaV3F6kQIhXs5dSMSx3AhIF1Ht65QvoiobEOjHHMQkApVS64bb21DkUZHNa6lyWvg7KMfQxM4rkX+NoM6Lu2BD6T5L7ONnko9P2Arm3Q931J3Ol0uiE8J8VHQscM2kljnA24ULDGFMI6C/M6mYjpLDnL3Rf/lYfGJTw9czweB2jjkOheTibIHRLibY4vhP8Bhimfm2aKbOIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f4f29a269caad62cac37a4bff256ce4e/7c297/img15.webp 180w,\n/static/f4f29a269caad62cac37a4bff256ce4e/33ecc/img15.webp 360w,\n/static/f4f29a269caad62cac37a4bff256ce4e/df77d/img15.webp 720w,\n/static/f4f29a269caad62cac37a4bff256ce4e/c76fd/img15.webp 961w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f4f29a269caad62cac37a4bff256ce4e/e9ea2/img15.png 180w,\n/static/f4f29a269caad62cac37a4bff256ce4e/53918/img15.png 360w,\n/static/f4f29a269caad62cac37a4bff256ce4e/242a6/img15.png 720w,\n/static/f4f29a269caad62cac37a4bff256ce4e/4f70e/img15.png 961w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f4f29a269caad62cac37a4bff256ce4e/242a6/img15.png\"\n            alt=\"img15\"\n            title=\"img15\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>생성이 되면 아래의 계정 ID를 잘 확인해둔다.<br>\n근데 어짜피 CLI 툴에서 또 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVQoz51Sy24bMQzcv29vAfIDufYj2lMvzS2HoucUhYMkrl+7kiiK4kzBrQ04dpAEHmCW1Iogh6SGxWLB+/vfFBGa2Rlba7MFAJJB1lohImjW0c3gINdTh6hzWK8S85QoUlhKieDZHvwoFH7g5tsjv3xfoknicrmkTFuqahAR25pxgDv/jkbrIAG6e6g5o7ujVINoZy7VU0rdZOoAfB8zNzH0pvz6y7gaK3OemFJiznm2JWfuknI9GbdTAbx7KC2qt6J6TfIawI/4FzXVnEMoMusMpf42EQwVafEHtt1Ecj8oi48258A9cGL/V8WLQ7QXrjw//ZTHh88duOq9f6q13sWsVdWH4zm9h/2mOUrHalQcqryY4WsLeIsBVWPVPvdzej/wgzhOuEuN27R/GUd3FyeUqtTWzpJdnHAzVpZq54sj+Q/WJF8UxKGDKgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c552714830f4a1a6578cc6e6c9126a88/7c297/img16.webp 180w,\n/static/c552714830f4a1a6578cc6e6c9126a88/33ecc/img16.webp 360w,\n/static/c552714830f4a1a6578cc6e6c9126a88/df77d/img16.webp 720w,\n/static/c552714830f4a1a6578cc6e6c9126a88/5c666/img16.webp 1080w,\n/static/c552714830f4a1a6578cc6e6c9126a88/bdb72/img16.webp 1300w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c552714830f4a1a6578cc6e6c9126a88/e9ea2/img16.png 180w,\n/static/c552714830f4a1a6578cc6e6c9126a88/53918/img16.png 360w,\n/static/c552714830f4a1a6578cc6e6c9126a88/242a6/img16.png 720w,\n/static/c552714830f4a1a6578cc6e6c9126a88/b4ad3/img16.png 1080w,\n/static/c552714830f4a1a6578cc6e6c9126a88/4c573/img16.png 1300w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c552714830f4a1a6578cc6e6c9126a88/242a6/img16.png\"\n            alt=\"img16\"\n            title=\"img16\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>이제 서비스 생성을 해야 하는데 여기도 대시보드에서 가능하지만, 난 <strong>Wrangler CLI</strong>로 콘솔에서 생성하였다.<br>\n취향차이인데 편한대로 해보자.</p>\n<p>아까 맨 위에서 <strong>wrangler</strong> 실행하면 나온 명령어 중 아래와 같은 것이 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wrangler init [name] 📥 Initialize a basic Worker project, including a wrangler.toml file</code></pre></div>\n<p>아래와 같이 실행해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQY03XPwU7CQBAG4D6K0dAi3ZZ2d0q7bLtsixRBxUKMoPGkB6++gIlJ8S18N5/CozNmMRo8ePgOM8n/J79Tn6/DebMZXN08gD65gE6PQ6+fgscAugySw2MRCzFYPC5HH0/XJVVGYpAqyoqaeDoinhpK1JjSfEJ+lJGzvrt/q6bLZ1MvXnlq2oMOa4+6UesxsLauL15Cod4DUZDP808WD6kPBYVCEYvljr0DPiTXF+Q0lw1pXdJIG1K5oSjRFCUFdXp8H7o+R88XNoQeA/qPM5k3WJ2ucDxb4Wyx2TlrblGVM5R6iiyWGAqFocjtJLRs0P0u/2NXCMMKs6JGkBUKWaLIDIIs0f6teKB/fnaWLadukPwW7LOTvwDPTZeOYM6lugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/37b6cd4f359d6e044f71dad432deb0cc/7c297/img17.webp 180w,\n/static/37b6cd4f359d6e044f71dad432deb0cc/33ecc/img17.webp 360w,\n/static/37b6cd4f359d6e044f71dad432deb0cc/411c4/img17.webp 600w\"\n              sizes=\"(max-width: 600px) 100vw, 600px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/37b6cd4f359d6e044f71dad432deb0cc/e9ea2/img17.png 180w,\n/static/37b6cd4f359d6e044f71dad432deb0cc/53918/img17.png 360w,\n/static/37b6cd4f359d6e044f71dad432deb0cc/dface/img17.png 600w\"\n            sizes=\"(max-width: 600px) 100vw, 600px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/37b6cd4f359d6e044f71dad432deb0cc/dface/img17.png\"\n            alt=\"img17\"\n            title=\"img17\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>여기서 물어보는것이 서비스 자체에 package.json을 두고 관리할 것인지를 묻는건데 난 프로젝트 내에서 같이 사용할 것이라서 <strong>N</strong>을 선택했다.<br>\n만약 외부에서 따로 관리하거나 할 경우 <strong>y</strong>를 선택해서 사용하자.</p>\n<p>즉 쉽게 worker 서비스는 위 링크에 들어가서 확인한 것처럼 <strong>서버리스</strong>를 위한 서비스이고, 그냥 수행할 코드 조각이다.<br>\n그래서 이것을 <strong>worker에 배포하는 작업을 하는 프로젝트</strong>라 보면 된다.<br>\n근데 하는 역할이 그냥 코드 조각 수정이나 배포밖에 없고, 또 프로젝트랑 같이 사용하는것이라서 나는 프로젝트 내에 넣어서 사용했다.</p>\n<p>궁금하면 따로 만들어서 해보고 하면 이해가 될 것이다.<br>\n그래도 이해가 안되면 따로 찾아보거나 댓글로…</p>\n<p>무튼 다시 이어나가자면…</p>\n<p>위 명령어까지 수행하면 아래와 같이 폴더가 하나 프로젝트 디렉토리에 생성되며 <strong>wrangler.toml</strong> 파일이 추가된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 227px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/klEQVQ4y42TS2/aQBRG+R9VAD8Gj8fjN8YvMGAHBZqEIDWq1FUXlbKvuu9fP5XdpA2kkbo4Gt/R9dHcbzQjR8/xwpz25sTu9pF52WLJiJmXMvOS/0clOF7KqBeqcEGx2tFs9oRphe3GQ5NQf7ms32NkuxETSzK2JD9Pnzi2e5wgZyYjrqYzxoZkYkjGU4eJ5b6PKTGEx0j6GX66JMoaupsT5XZP0rTMtx1JsyVebYjqNWnb4c9rdFyhk+ps7ffDfIUXFYxUmJOWHYvljocv32j291THO5anI8uHI9XdHfX9Pc3jiaRsifPtOYstadUxb3YE84aRUDGW42PaLhNV4j38QC0WRNsVUbcm3m3Qy4qobXDnGYbtYc58zJke6Gvhx7hphin83xn2s5vCQxcZsrxGJim6LgnWNUFTo/J8qG0dDnlNbXWG6Wgs18cQmpFw40Foy4Cv32+5/thhiIQgqZFeig6L4btHuNEg6PtfM7EUY9MdTv5HKGRAcCjwi4y6KBBugNGPdPHzpXBiK4T0UTo8P6GQIdnnJck6Z1UsEFIPzS+SFy6l02eh610IHTfkw9MTanegqndE2ZIrw3kjuZS9rH22ZyNPbY/iukCnKVm5JUhLpE6xZfjP3N5GoIZbfxYqxpbHfiWJQk21OdC0B9bdLTrOh5f0nvC1uBf+AlRDkEsc/W7KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1a153235fdecadee8dce3a1f9fdf78e3/7c297/img18.webp 180w,\n/static/1a153235fdecadee8dce3a1f9fdf78e3/a57da/img18.webp 227w\"\n              sizes=\"(max-width: 227px) 100vw, 227px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1a153235fdecadee8dce3a1f9fdf78e3/e9ea2/img18.png 180w,\n/static/1a153235fdecadee8dce3a1f9fdf78e3/b0b98/img18.png 227w\"\n            sizes=\"(max-width: 227px) 100vw, 227px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1a153235fdecadee8dce3a1f9fdf78e3/b0b98/img18.png\"\n            alt=\"img18\"\n            title=\"img18\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>여기까지 한 다음에 계정의 정보를 알아야 하는데 대시보드에서도 볼 수 있지만 아래의 명령어를 통해서 볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn wrangler whoami\nyarn run v1.22.19\n$ x/node_modules/.bin/wrangler whoami\n ⛅️ wrangler 2.8.1\n-------------------\nGetting User settings...\n👋 You are logged in with an OAuth Token, associated with the email test@test.com!\n┌─────────────────────────────────┬──────────────────────────────────┐\n│ Account Name                    │ Account ID                       │\n├─────────────────────────────────┼──────────────────────────────────┤\n│ test@test.com's Account         │ 12345677880                      │\n└─────────────────────────────────┴──────────────────────────────────┘\n🔓 Token Permissions: If scopes are missing, you may need to logout and re-login.\nScope (Access)\n- account (read)\n- user (read)\n- workers (write)\n- workers_kv (write)\n- workers_routes (write)\n- workers_scripts (write)\n- workers_tail (read)\n- d1 (write)\n- pages (write)\n- zone (read)\n- offline_access\n✨  Done in 2.42s.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 558px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC4UlEQVQ4y5WTy47cRBSG+z3YzUyX3a7ytcrX8rXd5Uxfhr7M9CTAEiERBRZMNjxCHiIsJuJxAAskVtlFnYQlRCyQ066D7Mw0Iy4CFp/+Y5fq1H/OqRqY4eS7pJhvxPziMq9Wlzrl26HmbBXCOi5HOr18D7H1/Pyj7z9dZ/DJKmtp5APlhfS5kH4spOPncqg5UiFMDspq8ebhZ1dfzpf3v5ieXTy23eTqeGRfKYRdIUwfI0w/HxneE92J3hKaALa51B0uLTcB3eHQqaq7gDAFhTAYZMVEzmeLfRxn+yRO936Y7hFhe4TpXiGsB+H+u1Uw7V0gTO9ySNbpoCpDKMYC3KiEbHIGSbno41tYkIHjJuDxSQ8LC2DRGFg4/gVh+oFCWKUQtkCYCoWwjweE8tYS540pto3O7zUqoY1m+o1mBg22o8Yslo0lLhrdL95qpn9D0PGbqnuvFMJ2CmEvEaad/jQ40dyvR9k61OL5KXJSgbTuJFccq3avalAJNZoKZIbiRLUFwkwMNVodq3auEPeHoeZAx6FknhWveSa+CeJJHSSiZlFZO0Fe+308rn1e1m5Y1Cwsai+e1B6f1G40roOk+tbx858dP+8G0/Y97qYc5xMQsw0U91bA8ylgKwDNDEB3oj4mdvgutsM+7v513FmX2Ar/mLLppnK6fLCv5hdtWi7aoea0JyO7138DYUfelCwPJVtuCtP3H0BczKCcbnrt3Nye+F85ODQoh/J0DbyY9tdGzM4hSKtDo/8vA9vL5Hz1YVtON63Hy5aFRavqbosw65rcg96pvNkk7zr6S8Ku5NOz+1AttuBGYzhSDLi9/YdXgGnv+GhE5dGIwvDOy/hz4gHzwl/L09WLvFruUrHcEZrsFMPfqWawU4xgpxrBDhnBC5PyN5HvQ+QFUtf9f3ZoOOFzy02/stzkmZOvro3i/Bony2vSka6u9WT5DMWbp7Pl9seHmxQercdtZuVwgv++x78D0zTBxRuGI60AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ba03419c6ae118520bbda8a953731c92/7c297/img19.webp 180w,\n/static/ba03419c6ae118520bbda8a953731c92/33ecc/img19.webp 360w,\n/static/ba03419c6ae118520bbda8a953731c92/92196/img19.webp 558w\"\n              sizes=\"(max-width: 558px) 100vw, 558px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ba03419c6ae118520bbda8a953731c92/e9ea2/img19.png 180w,\n/static/ba03419c6ae118520bbda8a953731c92/53918/img19.png 360w,\n/static/ba03419c6ae118520bbda8a953731c92/65207/img19.png 558w\"\n            sizes=\"(max-width: 558px) 100vw, 558px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ba03419c6ae118520bbda8a953731c92/65207/img19.png\"\n            alt=\"img19\"\n            title=\"img19\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이제 위 정보를 토대로 <strong>wrangler.toml</strong> 파일을 수정해야 한다.</p>\n<p>파일을 열면 아래의 정보만 기입되어 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token key property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"[아까 wrangler init 에서 입력한 이름]\"</span>\n<span class=\"token key property\">compatibility_date</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"2023-01-28\"</span></code></pre></div>\n<p>여기를 아래처럼 수정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token key property\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"luckynum_dev\"</span>\n<span class=\"token key property\">main</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"index.ts\"</span>\n<span class=\"token key property\">compatibility_date</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"2023-01-28\"</span>\n\n<span class=\"token key property\">account_id</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"12345677880\"</span>\n\n<span class=\"token key property\">workers_dev</span> <span class=\"token punctuation\">=</span> <span class=\"token boolean\">true</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token table class-name\">vars</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">AUTH_KEY_SECRET</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"key-key\"</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token table class-name\">r2_buckets</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">binding</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"MY_BUCKET\"</span>\n<span class=\"token key property\">bucket_name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"lucky-num-dev\"</span></code></pre></div>\n<p>그리고 해당 toml이 있는 디렉토리에 index.ts 파일을 하나 생성해준다.<br>\n이 파일의 경로는 위 <strong>toml</strong>파일의 <strong>main</strong>항목과 연계된다.<br>\n경로 또는 파일명을 바꾸고 싶다면 저 <strong>toml</strong>과 함께 수정 처리하면 된다.</p>\n<p>내가 작성한 코드는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Env</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">DEV_BUCKET</span><span class=\"token operator\">:</span> R2Bucket<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hasValidHeader</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'X-Auth-Key'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">AUTH_KEY_SECRET</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">authorizeRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'PUT'</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'DELETE'</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'GET'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">hasValidHeader</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">parseRange</span><span class=\"token punctuation\">(</span>encoded<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span> offset<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> length<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>encoded <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> parts <span class=\"token operator\">=</span> encoded<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bytes='</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Not supported to skip specifying the beginning/ending byte at this time'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    offset<span class=\"token operator\">:</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    length<span class=\"token operator\">:</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>parts<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">objectNotFound</span><span class=\"token punctuation\">(</span>objectName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Response <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;html>&lt;body>R2 object \"&lt;b></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>objectName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/b>\" not found&lt;/body>&lt;/html></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    status<span class=\"token operator\">:</span> <span class=\"token number\">404</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'content-type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/html; charset=UTF-8'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">isNullOrUndefine</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> x <span class=\"token operator\">===</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>request<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> env<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Response<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">URL</span></span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> objectName <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">authorizeRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Forbidden'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token number\">403</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'PUT'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">const</span> uploadObj <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">DEV_BUCKET</span><span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>objectName<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          httpMetadata<span class=\"token operator\">:</span> request<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> resultJson <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          uploaded<span class=\"token operator\">:</span> <span class=\"token function\">isNullOrUndefine</span><span class=\"token punctuation\">(</span>uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'uploaded'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'uploaded'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span>\n          etag<span class=\"token operator\">:</span> <span class=\"token function\">isNullOrUndefine</span><span class=\"token punctuation\">(</span>uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'httpEtag'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'etag'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span>\n          size<span class=\"token operator\">:</span> <span class=\"token function\">isNullOrUndefine</span><span class=\"token punctuation\">(</span>uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'size'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span>\n          version<span class=\"token operator\">:</span> <span class=\"token function\">isNullOrUndefine</span><span class=\"token punctuation\">(</span>uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span>\n          key<span class=\"token operator\">:</span> <span class=\"token function\">isNullOrUndefine</span><span class=\"token punctuation\">(</span>uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> uploadObj<span class=\"token punctuation\">[</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>resultJson<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            etag<span class=\"token operator\">:</span> uploadObj<span class=\"token punctuation\">.</span>httpEtag<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'GET'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">const</span> object <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">DEV_BUCKET</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>object<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'fail'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Object Not Found'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>object<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">'DELETE'</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">DEV_BUCKET</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>objectName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          status<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'fail'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Method Not Allowed'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token number\">405</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>몇몇 죽은 코드가 있는데 필요에 맞게 커스텀 해서 쓰면 될듯 하다.</p>\n<br>\n<h3 id=\"6-암호키-만들기\" style=\"position:relative;\"><a href=\"#6-%EC%95%94%ED%98%B8%ED%82%A4-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"6 암호키 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 암호키 만들기</h3>\n<p>이제 worker와 통신할 때 쓸 암호키를 만들어줘야 한다.\n콘솔 CLI에서 아래와 같은 명령어를 봤을 것이다.</p>\n<blockquote>\n<p>wrangler secret 🤫 Generate a secret that can be referenced in a Worker</p>\n</blockquote>\n<p>그렇다면 이제 만들어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn wrangler secret put lucky_key -c ./luckynum_dev/wrangler.toml\nyarn run v1.22.19\n$ X/node_modules/.bin/wrangler secret put lucky_key -c ./luckynum_dev/wrangler.toml\n ⛅️ wrangler 2.8.1\n-------------------\n✔ Enter a secret value: … ********************\n🌀 Creating the secret for the Worker \"luckynum_dev\"\n✨ Success! Uploaded secret lucky_key\n✨  Done in 57.18s.</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVQY033MMU+DQAAFYP6Ds4nGyHkUqPU4jgORHvQ4KkaLTYyDiYvGP2UcahP9F44uxf/i5KI8U1ycOnzJe8N7ljLN6+z6TlSzG019ke87Rzn1uN7apuK0Mi8P8wm0Sr5HctzxuACLxmCRApMKhzyFzAzirOpFaQmrmtafRWFWSZK1zjBs7QFriRusqB9+EC/82nMFiCc6Zyhw4HFQP+yt8/++RtwAllRnyMvzXqqmkGmJk6JGdDwBkzl2aNDt0hFsl8EebNYfpkq/5dXlU9ncPsfmasHVxSLW8yUJzWOpzft9k6FOsh/b4R1x/0ab/AK1qHpEUVvzvAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/68f2ead198795fc1c837d2f77c91936e/7c297/img20.webp 180w,\n/static/68f2ead198795fc1c837d2f77c91936e/33ecc/img20.webp 360w,\n/static/68f2ead198795fc1c837d2f77c91936e/df77d/img20.webp 720w,\n/static/68f2ead198795fc1c837d2f77c91936e/1d625/img20.webp 766w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/68f2ead198795fc1c837d2f77c91936e/e9ea2/img20.png 180w,\n/static/68f2ead198795fc1c837d2f77c91936e/53918/img20.png 360w,\n/static/68f2ead198795fc1c837d2f77c91936e/242a6/img20.png 720w,\n/static/68f2ead198795fc1c837d2f77c91936e/e4da8/img20.png 766w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/68f2ead198795fc1c837d2f77c91936e/242a6/img20.png\"\n            alt=\"img20\"\n            title=\"img20\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>여기서 입력한 암호는 위 <strong>toml</strong>에서 <strong>AUTH_KEY_SECRET</strong>이 값과 같아야 한다.<br>\n그리고 이 값은 향후 헤더에 넣어서 보내야 하는 값이다.</p>\n<br>\n<h3 id=\"번외-서비스-대시보드로-생성법\" style=\"position:relative;\"><a href=\"#%EB%B2%88%EC%99%B8-%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C%EB%A1%9C-%EC%83%9D%EC%84%B1%EB%B2%95\" aria-label=\"번외 서비스 대시보드로 생성법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(번외) 서비스 대시보드로 생성법</h3>\n<p>만약 CLI가 좀 어렵다면 대시보드로도 가능하다.<br>\n사람마다 다르지만 사실 GUI로 하는게 더 편하고 좋다.</p>\n<p>아까 대시보드에서 서비스 생성을 누르면 아래와 같이 뜬다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACPUlEQVQ4y5VUy3ITMRDc3+TG/8CBygHO/Aw3uMGBJI5TXm9ix7ZWq/drmhqtHTbBm4St6pK0klqtmdY0hQDjCQQARKAJxl9j+9avSSlht++htP5n8n/JKqH3Hm27Qtu20FrDGFNRSnkkfa76pcManogxwvsA5xy892StpSMh7yoT0JFoVnrDG0MI5+bqZp4/AUeySjqnkFXxdTebTYXWuirka3vvDznnq5zzIsZ0o4yPT0jPEeacYa3FMAxQSjFISll4bK39BuADgAsifM659PQa4RjDdC7INBeH54maognBo+s6CCGQYoT1iazPxEny3pF3roQQKmgiby77TYgJctBQ2kJpg52MdCcSSeUxKE29VCQHRRzbyT3n1KPxsUAOCqtVi+7uHlqPPrTWQRtbw8FrQozYbrdYLpfo+77G/eRZ3sPj8cqpIGaCcaFCmVGpNq62zgcOA1LKGKTEMfvVs1Pwv0rIC8XDDv3+AHEQMNrB2gBt+YAIbT20tlWxc/5I9red9tmrTS4F+/Ua3fUllosr3CxWWLcddt0a4uEeUggopTEM6lVUQi4OvRwwyAGyl9j3AodeVCIpDvXfW8ieELJl2CZ8/RQTpZQocj9l7pcYH0GcpElb60AII2oMx/eaz7pg5v2/WNMqIavkAsGnxRjZ1MTjlJIgostSynUpZXkydCmjx3m9Mg63W4flxiKmMlYbTvvJDsYYUkoVro3OuR8APhHRFwBfAeTpQ5Zij+8/b/H+4jfeffyF7hDwB8fLyhtoLfc5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fad03a014527e1971f36c5380b8eb15d/7c297/img21.webp 180w,\n/static/fad03a014527e1971f36c5380b8eb15d/33ecc/img21.webp 360w,\n/static/fad03a014527e1971f36c5380b8eb15d/df77d/img21.webp 720w,\n/static/fad03a014527e1971f36c5380b8eb15d/d8a71/img21.webp 888w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fad03a014527e1971f36c5380b8eb15d/e9ea2/img21.png 180w,\n/static/fad03a014527e1971f36c5380b8eb15d/53918/img21.png 360w,\n/static/fad03a014527e1971f36c5380b8eb15d/242a6/img21.png 720w,\n/static/fad03a014527e1971f36c5380b8eb15d/8dc7d/img21.png 888w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fad03a014527e1971f36c5380b8eb15d/242a6/img21.png\"\n            alt=\"img21\"\n            title=\"img21\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>서비스 이름을 원하는 것으로 작성한다.<br>\n그리고 아래 <strong>스타터 선택</strong>은 해당 워커로 접근 시 처리할 코드 조각인데 다른거 건들지말고 <strong>HTTP 처리기</strong>를 선택하고 진행한다.<br>\n어짜피 위에서 작성한 <strong>index.ts</strong>파일로 수행할 것이라서 서비스 생성을 진행한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+UlEQVQ4y6VTTYsTQRCd/61Hb/4Ab378AE+K4MFFPAmLH3gRvC3BDWZDzEz6o6qrq55Uz2QTsklWseFRPUzNm36vXndU7Fet9hLAMwA/AdgE7NWTS9VQq2LZF9z0BZ2ZPTGzh6r6QFVfmBlst3AOMANxRcwFry+XeHW5RBdj/EFEbwC8M7O3qnphZtlPNzHCxn0jGMsBceuoqFIa4SyE8EGqXaSUnPRzEUVKESLVilSLMUCqgosghgAibsR35JuhY+aZiCxSZuRM7slVJvnCzN9VTYkFIsWqurwCEWnk7puZQlXbKWut7V2nqt+Y+SvlDGbOtfBHM31vZp9s7J481UmyNSKv/voO4SYSUiZ/UGYCb1ZOfNtcq9rtfqqnYKPkok62/eOB4fdOeguPj3/fpZTQ93010+cAHgF47FWkPt2EgGHoMQxDO+W55UNy0s5HvuyLXc373/P59WI2m92s1+sFgNUuFucDPvWMklXVWBSZK0opDW7ufsBPeeaTHve7AXUhBM+cMZMR7ZBzdsDhPz3mm0cpZkG/SRgCt5x2ROQetQz63ie8xfb55NUDWlx8DiKjsi4kApWKJjsfvwFn7/NBXxcTwcGlIkRCjKn5uJ+tv4+OonOP5vM5mpc5t7qFy73vhEcJV6tV0/+/q0l2Q2OM/yzvmJdO+Aemi4LumrITOwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0b6cf24b443f1c29e5a86654a7ffa6c6/7c297/img22.webp 180w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/33ecc/img22.webp 360w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/df77d/img22.webp 720w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/5c666/img22.webp 1080w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/6d1d1/img22.webp 1298w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0b6cf24b443f1c29e5a86654a7ffa6c6/e9ea2/img22.png 180w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/53918/img22.png 360w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/242a6/img22.png 720w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/b4ad3/img22.png 1080w,\n/static/0b6cf24b443f1c29e5a86654a7ffa6c6/11824/img22.png 1298w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0b6cf24b443f1c29e5a86654a7ffa6c6/242a6/img22.png\"\n            alt=\"img22\"\n            title=\"img22\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 서비스가 생성되고 아래와 같이 서비스에 대한 요약 내용이 나온다.</p>\n<br>\n<h3 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h3>\n<p>여기까지가 준비 과정이었다.<br>\n좀 복잡하고 과정이 길었는데 천천히 하다보면 어렵지 않게 할 수 있다.<br>\n혹여나 이해가 안되거나 문제가 있고, 해결하기 어려운 경우 댓글을 통해 공유주시면 같이 해결해 볼 수 있도록 노력해보겠다.</p>\n<p>다음은 <strong>Nest.JS</strong>에서 파일 업로드, 다운로드, 삭제 등을 구현해볼 예정이다.</p>\n<p>아래의 포스팅은 Nest.Js에서 구현한 부분을 다룬다.</p>\n<p><a href=\"https://elfinlas.github.io/nest_js/230203_r2_nestjs/\">CloudFlare R2 사용해보기 Part 2 (With Nest.Js)</a></p>\n<br>\n<h3 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h3>\n<ul>\n<li><a href=\"https://developers.cloudflare.com/workers/wrangler/install-and-update/\">Wrangler 설치법</a></li>\n<li><a href=\"https://developers.cloudflare.com/workers/wrangler/\">Wrangler CLI 사용 가이드</a></li>\n<li><a href=\"https://dash.cloudflare.com/af0fb192ecd83eade23b5f72b1677fc2/r2/overview/cli?from=overview\">R2 사용 가이드</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%82%AC%EC%9A%A9%EB%B2%95\">사용법</a></p>\n<ul>\n<li>\n<p><a href=\"#1-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%ED%94%8C%EB%A0%88%EC%96%B4%EC%97%90-%EA%B3%84%EC%A0%95-%EC%83%9D%EC%84%B1%EC%9D%84-%ED%95%B4%EC%A4%80%EB%8B%A4\">1. 클라우드플레어에 계정 생성을 해준다.</a></p>\n</li>\n<li>\n<p><a href=\"#2-r2-%EA%B0%80%EC%84%9C-%EA%B5%AC%EC%9E%85-%EA%B2%B0%EC%A0%9C%EB%A5%BC-%EC%A7%84%ED%96%89%ED%95%9C%EB%8B%A4-%ED%94%84%EB%A6%AC%ED%94%8C%EB%9E%9C-%EA%B0%80%EB%8A%A5\">2. R2 가서 구입 결제를 진행한다. (프리플랜 가능)</a></p>\n</li>\n<li>\n<p><a href=\"#3-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C%EC%97%90%EC%84%9C-r2-%EB%A9%94%EB%89%B4%EB%A1%9C-%EC%9D%B4%EB%8F%99%ED%95%9C%EB%8B%A4\">3. 대시보드에서 R2 메뉴로 이동한다.</a></p>\n</li>\n<li>\n<p><a href=\"#4-%EB%B2%84%ED%82%B7%EC%9D%84-%EC%83%9D%EC%84%B1%ED%95%B4%EC%A4%80%EB%8B%A4\">4. 버킷을 생성해준다.</a></p>\n<ul>\n<li><a href=\"#4-1-wrangler-%EC%84%A4%EC%B9%98\">4-1. Wrangler 설치</a></li>\n<li><a href=\"#4-2-wrangler-%EC%BD%98%EC%86%94-%EB%A1%9C%EA%B7%B8%EC%9D%B8\">4-2. Wrangler 콘솔 로그인</a></li>\n<li><a href=\"#4-3-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1\">4-3. 버킷 생성</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#5-workers-%EC%83%9D%EC%84%B1\">5. Workers 생성</a></p>\n</li>\n<li>\n<p><a href=\"#6-%EC%95%94%ED%98%B8%ED%82%A4-%EB%A7%8C%EB%93%A4%EA%B8%B0\">6. 암호키 만들기</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B2%88%EC%99%B8-%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%8C%80%EC%8B%9C%EB%B3%B4%EB%93%9C%EB%A1%9C-%EC%83%9D%EC%84%B1%EB%B2%95\">(번외) 서비스 대시보드로 생성법</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.01.27","title":"CloudFlare R2 사용해보기 Part 1 (With Nest.Js)","categories":"cloud","emoji":"📜"},"fields":{"slug":"/cloud-flare/"}},"prev":{"id":"25661be2-fac1-5849-97cf-c686c89cf9c5","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"저번-포스팅에-이어\" style=\"position:relative;\"><a href=\"#%EC%A0%80%EB%B2%88-%ED%8F%AC%EC%8A%A4%ED%8C%85%EC%97%90-%EC%9D%B4%EC%96%B4\" aria-label=\"저번 포스팅에 이어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>저번 포스팅에 이어…</h1>\n<p>저번 포스팅(<a href=\"https://elfinlas.github.io/cloud-flare/230127_use_r2/\">CloudFlare R2 사용해보기 Part 1</a>)에 이어 이번에는 R2에 파일 업로드와 다운로드, 삭제 등을 <strong>Nest.Js</strong>로 구현하는 것을 해보려 한다.<br>\n일단 프로젝트를 따로 파서 깃허브에 올려서 하려 했으나…</p>\n<p>생각해보니 각 설정들 부터 해서 <strong>Wrangler</strong>의 설정 및 배포 등 생각할 것과 직접 구현해야 할 부분이 많아지는 관계로…<br>\n일단 코드 조각으로 예시를 만들어보려 한다.</p>\n<p>그렇다고 생략을 엄청 하는 것은 아니고, 환경이 구성되어 있다면 해당 코드 예제가 도움될 것이라 생각이 든다.</p>\n<p>설명에 앞서 구성, 그리고 기타 사항은 다음과 같이 되어 있다.</p>\n<ul>\n<li>Nest.JS 사용</li>\n<li>Typescript 사용</li>\n<li><a href=\"https://elfinlas.github.io/cloud-flare/230127_use_r2/\">CloudFlare R2 사용해보기 Part 1</a> 포스팅까지 진행 완료된 CloudFlare 계정</li>\n<li><strong>Wrangler</strong> 프로젝트가 현재 진행하는(또는 따로 만든) 곳 내부에 존재하는 것을 예시로 진행</li>\n<li>먼저 <strong>files</strong>라는 도메인에서 진행한다. (아래 사진은 참고용)</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 261px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADS0lEQVRIx5VVXW/iVhD1H6jUp7Zqm2DA2Bh/Xdv4G9uADSYmJVllV90oD63Uh0qV2qf9/6eaMdDsLh/pw9HF2PfcmXNm5koDzYIysuFuEzirGJM0Rm+k40ZWISsT9EfGVdB3quOCuKS+aqKvTKC7PtLVBnaYwpmmENMMQ81Cb6jzhmvoq0RuQlLGDka6A8MOUax2CJIFZos7FMsWujXlU4dj+zy0/1bikgyRwPZnMN0U9fY9moePaLZP+OXdM3ZPLxBBAcNNYXkZTPc86L0h0i5CgjYRENkK0fwO8axCWjYYmz4GqtVFcRWUibPXcDSBPDJR5DEW1QJhViPKllDG9ps1lBWdDZJYI9XA7cjFr2sDL48J/KyB5Ub4WVYx4AONN4GykQ629xUd0bxFUDSw3Rj58g7TuMRNX+Uoe8PxBXTviUcyRMymEKr2qTPm/j3KegcvXrBZppd26yWwKQkke1rAT2pMkwrLllx+xstvf6LavIPl5/CTCl68hBstLoK+cYIS0sEhMsAUIZrHj7D9FPmyhRvMWEdKhbS8BuKRDqLTg+EEKJsHiCBjl6l8/Kjg/9/iNncKOUOEChGKEKvdBzh+ijBdIilWCFLSMWLCa/1MwR0Jh3vC+v4Jjp8gLdcc4e1gjJu+dtx0bmCcJnRCLO6fYXsJsrJBmC6OBX5t8pwgtGEJD7tdyaZk84bJqBbpw/9FOKAq1wSEMPDpDxt+PGeHk7xmPSntUx3z+pCvIlTHFhQnwQ/tPzwLSUMy46feiAlvB9p+7XAge71+RkguD3QBOWm5VLJyDS/MYbkxD1wyyhQRP9P6pQwnNDTR12z8GGzghjk7TPp1o2zNoDKKZhUf9KVRnxOqJhTVQM8I8M3jJ7hRgWRWc6RBMmeSdB8xldDVlDtTLGiqiQd1DC/IEGZdJERI5UPRqhNxojvOuEwpK5qDIFhxZEm+YpJw34L0WzPc491B99BrHU+mLE+m+Hb7N9yw6Po4LjGbb7j9qC5Jw3yxQVlt2TS6Ig4t+RUhTW1Z9/B9/Tv8qESc13wDpsWaa5I2knbdMNWPw+KiKfLEx3ftXzBExLqR26SjFxXQLR+a4Z0t7osREtGMW6/iVIuq5RQp4nNteCD8F9y6PcvqoD05AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/63f833163615a6da2efd925b95c803eb/7c297/img01.webp 180w,\n/static/63f833163615a6da2efd925b95c803eb/3f80a/img01.webp 261w\"\n              sizes=\"(max-width: 261px) 100vw, 261px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/63f833163615a6da2efd925b95c803eb/e9ea2/img01.png 180w,\n/static/63f833163615a6da2efd925b95c803eb/51582/img01.png 261w\"\n            sizes=\"(max-width: 261px) 100vw, 261px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/63f833163615a6da2efd925b95c803eb/51582/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<ul>\n<li><strong>레이어드 아키텍처</strong> 기반으로 코드가 구성되어 있다. (원래 <strong>포트 앤 어뎁터</strong>로 하려 했는데 아직 배우는 단계라…)</li>\n</ul>\n<br>\n<h2 id=\"1-worker-처리기-배포\" style=\"position:relative;\"><a href=\"#1-worker-%EC%B2%98%EB%A6%AC%EA%B8%B0-%EB%B0%B0%ED%8F%AC\" aria-label=\"1 worker 처리기 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Worker 처리기 배포</h2>\n<p><a href=\"https://elfinlas.github.io/cloud-flare/230127_use_r2/\">CloudFlare R2 사용해보기 Part 1</a> 까지 한 뒤에 작성했던 <strong>index.ts</strong>에 대해서 CloudFlare에 배포를 해줘야 한다.<br>\n이 부분은 자주 쓸 수 있기에 <strong>package.json</strong>의 <strong>scripts</strong>에 등록을 해두고 쓰자.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        ...\n        <span class=\"token property\">\"r2:build:dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"wrangler publish -c ./my_worker/wrangler.toml\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 <strong>my_worker</strong>의 경우 서비스 생성할 때 이름을 적어주면 된다.<br>\n각자 프로젝트 디렉토리에 보면 자신이 정한 디렉토리명이 있는데 이를 넣어주면 된다.<br>\n그리고 실행 명령어도 입맛에 바꿔도 된다.</p>\n<p>이렇게 하고 아래 명령어처럼 배포를 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn r2:build:dev</code></pre></div>\n<br>\n<p>그럼 콘솔에 배포가 잘 되고, CloudFlare 사이트의 Workers에서 등록한 서비스를 들어가서 배포 항목을 보면 확인이 가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVklEQVQoz22STU7DMBCF3V1vwg3Y9EaIJWyR4AbcoYfgECCxqkS3XbQhapvEiT3j+UMT0qhIWBo9OW/8ZZ6TQESGiEZULCa0pt4bDL0Rs10tvdL/avbC8Xi0PkbLKVvsB+v6ZF2MFmO0lJINw3ApdW2aZty7d/FTStq2rXmFuvq2w7m2JkdjIvOJc052Op0MAKyU4iWTfm02m9XhcLht23ZVVdVNzvmVma3rOooxasg5WyYw5DLnE1VvGIFjFtVL/o/1eh3qug673S4AQDCzezeIqBCRBo/A9NsvIn54nPJ8Po9A34sIu6rqZ9d1y+12uyilLM0siMiDeznnAgAafBIHTAdH9Qj+ov+AIrIEgIWrqs5AACiIqMEv1QHTgRnoH8Xv7RJ58t49JhEFRHRYUNU770HEUkr5C7ye0IH+O03PfbnumfmFmZ+Y+ZmZH0XkzXsQkR34A50rV+t6PMZNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f6641b9ce995167297d289d8977bffc1/7c297/img02.webp 180w,\n/static/f6641b9ce995167297d289d8977bffc1/33ecc/img02.webp 360w,\n/static/f6641b9ce995167297d289d8977bffc1/df77d/img02.webp 720w,\n/static/f6641b9ce995167297d289d8977bffc1/5ce83/img02.webp 1032w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f6641b9ce995167297d289d8977bffc1/e9ea2/img02.png 180w,\n/static/f6641b9ce995167297d289d8977bffc1/53918/img02.png 360w,\n/static/f6641b9ce995167297d289d8977bffc1/242a6/img02.png 720w,\n/static/f6641b9ce995167297d289d8977bffc1/92844/img02.png 1032w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f6641b9ce995167297d289d8977bffc1/242a6/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h2 id=\"2-프로젝트-구성\" style=\"position:relative;\"><a href=\"#2-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%84%B1\" aria-label=\"2 프로젝트 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 프로젝트 구성</h2>\n<p>먼저 <strong>Nest.JS</strong>환경이 구성되어 있어야 한다.(아마 진행자라면 다들 구성되어 있을 것이다.)<br>\n위에서 설명한 것과 같이 <strong>레이어드 아키텍쳐</strong> 기반으로 구성하고 설명한다.<br>\n각 구성은 다음과 같다.</p>\n<ul>\n<li>FileController : URL로 직접 접근하는 부분</li>\n<li>FileR2Service : R2 관련 로직을 핸들링하는 서비스 로직</li>\n<li>multerR2Options : Multer 처리 옵션 로직</li>\n</ul>\n<p>기타 설치해야 할 패키지는 아래와 같다.(같은 역할을 하는 다른 패키지를 써도 무방하다)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @types/multer --dev\nyarn add @nestjs/axios\nyarn add axios\nyarn add rxjs</code></pre></div>\n<p>각 구성 영역에 대해 설명한다.</p>\n<br>\n<h3 id=\"2-1-filecontroller\" style=\"position:relative;\"><a href=\"#2-1-filecontroller\" aria-label=\"2 1 filecontroller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1 FileController</h3>\n<p>컨트롤러 영역은 별거 없다.<br>\n물론 파일 업로드 및 다운로드, 삭제 등의 작업 시 권한이나 그런 로직은 제외한다.<br>\n순수하게 기능에만 집중한 예제이기에 해당 코드를 바로 사용하기 보다는 약간 로직을 추가해서 쓰는 것이 좋다.</p>\n<p>그리고 아래 예제는 내가 사용하던 코드인데 일부 코드는 공개가 불가능해서 조작하였다.<br>\n약간 억지같은 부분도 있지만 기능 구현이라는 관점만 봐주셨으면 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Delete<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Param<span class=\"token punctuation\">,</span> Post<span class=\"token punctuation\">,</span> Req<span class=\"token punctuation\">,</span> Res<span class=\"token punctuation\">,</span> UploadedFile<span class=\"token punctuation\">,</span> UseInterceptors <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FileInterceptor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/platform-express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FilesSuccessCode<span class=\"token punctuation\">,</span> FilesSuccessResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./files.response.success'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> multerR2Options <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./multer.options'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FilesService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./services/files.service'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'files'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilesController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> fileService<span class=\"token operator\">:</span> FilesService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'upload'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseInterceptors</span></span><span class=\"token punctuation\">(</span><span class=\"token function\">FileInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token string\">'file'</span><span class=\"token punctuation\">,</span> multerR2Options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fileUpload</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UploadedFile</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> file<span class=\"token operator\">:</span> Express<span class=\"token punctuation\">.</span>Multer<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Req</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileService<span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> FilesSuccessResponse<span class=\"token punctuation\">.</span><span class=\"token function\">returnRes</span><span class=\"token punctuation\">(</span>FilesSuccessCode<span class=\"token punctuation\">.</span><span class=\"token function\">uploadFile4R2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'get/:file_id'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">downloaFiles</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Res</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> response<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> param<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileService<span class=\"token punctuation\">.</span><span class=\"token function\">fileDownload</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span>file_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'Content-disposition'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">attachment; filename=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>result<span class=\"token punctuation\">.</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> result<span class=\"token punctuation\">.</span>axiosResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Delete</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'delete/:file_id'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">deleteFiles</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> param<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileService<span class=\"token punctuation\">.</span><span class=\"token function\">updateDeleteStatus</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span>file_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> FilesSuccessResponse<span class=\"token punctuation\">.</span><span class=\"token function\">returnRes</span><span class=\"token punctuation\">(</span>FilesSuccessCode<span class=\"token punctuation\">.</span><span class=\"token function\">deleteFile4R2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 <strong>FilesService</strong>가 있는데 이 서비스 로직은 디비에 저장 및 로깅, 기타 작업 등을 처리하는 메인 서비스 로직인데 이 부분은 아래 서비스 로직에서 다루겠다.</p>\n<br>\n<h3 id=\"2-2-fileservice--filer2service\" style=\"position:relative;\"><a href=\"#2-2-fileservice--filer2service\" aria-label=\"2 2 fileservice  filer2service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2 FileService &#x26; FileR2Service</h3>\n<p>여기는 실제 기능을 담당하는 구현 로직이다.<br>\n<strong>FilesService</strong>의 경우 일부 로직만 구현되어 있기에 그냥 호출 흐름 정도만 공개한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//FilesService</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilesService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> r2Service<span class=\"token operator\">:</span> FilesR2Service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * 파일 업로드 영역\n   * @param req\n   * @param file\n   */</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> file<span class=\"token operator\">:</span> Express<span class=\"token punctuation\">.</span>Multer<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Files<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//R2에 파일 업로드를 처리한다.</span>\n    <span class=\"token keyword\">const</span> fileKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token function\">getUuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> r2Result<span class=\"token operator\">:</span> R2UploadResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>r2Service<span class=\"token punctuation\">.</span><span class=\"token function\">uploadR2</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * 파일 다운로드 영역\n   * @param id\n   * @returns\n   */</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fileDownload</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GetDownloadFile<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> entity <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filesRepo<span class=\"token punctuation\">.</span><span class=\"token function\">findEntityById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>r2Service<span class=\"token punctuation\">.</span><span class=\"token function\">getFileR2</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">.</span>r2Key<span class=\"token punctuation\">,</span> entity<span class=\"token punctuation\">.</span>uploadName <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">+</span> entity<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">updateDeleteStatus</span><span class=\"token punctuation\">(</span>fileId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>r2Service<span class=\"token punctuation\">.</span><span class=\"token function\">deleteFileData4R2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>내가 구성한 코드의 경우 파일 업로드 시 해당 파일명을 <strong>uuid</strong>로 바꿔서 관리했다.<br>\n그래서 실제 R2에 파일 업로드 시 <strong>aaa.png</strong> 파일명이라면 R2에는 acbv-3342 등의 UUID로 변경되어 저장된다.<br>\n이는 향후 다운로드 시 디비에 저장된 값으로 다시 바꿔서 전달하면 되는 부분인데 여기서는 자세하게 설명하지 않는다.</p>\n<p>다운로드는 컨트롤러에서 받은 유니크한 UUID 생성 키 값으로 파일 데이터를 찾아서 R2에 저장된 파일명을 가져온다.</p>\n<p>삭제의 경우 원래 파일 상태만 바꾸는데 이번 예제에서는 직접 삭제를 진행한다.</p>\n<p>다음은 실제 구현 로직인 <strong>FileR2Service</strong>이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HttpService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/axios'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AxiosError<span class=\"token punctuation\">,</span> AxiosRequestConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> firstValueFrom<span class=\"token punctuation\">,</span> lastValueFrom<span class=\"token punctuation\">,</span> map <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'rxjs'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilesR2Service</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> http<span class=\"token operator\">:</span> HttpService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">uploadR2</span><span class=\"token punctuation\">(</span>file<span class=\"token operator\">:</span> Express<span class=\"token punctuation\">.</span>Multer<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">,</span> fileKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>R2UploadResult<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> baseHeader<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> file<span class=\"token punctuation\">.</span>mimetype<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> data<span class=\"token operator\">:</span> R2UploadResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">lastValueFrom</span><span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">,</span> baseHeader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//데이터가 안올 때 처리 필요</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">getFileR2</span><span class=\"token punctuation\">(</span>r2Key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> fileName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GetDownloadFile<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>r2Key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> axiosConfg<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    axiosConfg<span class=\"token punctuation\">.</span>responseType <span class=\"token operator\">=</span> <span class=\"token string\">'arraybuffer'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//AxiosRequestConfig 추가</span>\n    <span class=\"token keyword\">const</span> fileData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> axiosConfg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      axiosResponse<span class=\"token operator\">:</span> <span class=\"token function\">firstValueFrom</span><span class=\"token punctuation\">(</span>fileData<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      fileName<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * [주의] R2에서 물리적 파일 삭제 처리 함수\n   * @param fileKey R2에 저장된 파일명\n   * @returns\n   */</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">deleteFileData4R2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> axiosConfg<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> axiosConfg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> callback <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">firstValueFrom</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> callback<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * R2에 업로드 Url을 생성해주는 메서드\n   * @param fileName\n   * @returns\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>fileName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//CF_R2_WORKER_URL = \"https://myworker.workers.dev/\"</span>\n    <span class=\"token keyword\">return</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CF_R2_WORKER_URL</span> <span class=\"token operator\">+</span> fileName<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span>headerOpt<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> baseHeader <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'X-Auth-My-S-Key'</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CF_R2_AUTH_KEY</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      headers<span class=\"token operator\">:</span> headerOpt <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> baseHeader <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>baseHeader<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>headerOpt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>자잘자잘한 로직이 많다.<br>\n코드를 보면 알겠지만 좀 지저분하고, 로직이 난잡한데 이는 비공개 코드를 지우느라 어색한 부분이 있어서 그렇다.(물론 코드 리팩토링이 아직 제대로 안됨 -_-;)</p>\n<p><strong>getUrl4WorkerR2</strong> 메서드의 경우 .env 파일에 있는 값을 가져오는데 저기서는 Worker Url이다.<br>\n자신이 설정한 URL로 설정해두자.</p>\n<p><strong>getR2DefaultAxiosHeader</strong> 메서드의 경우 Axios 요청 시 헤더 값이다.<br>\n여기서 헤더의 키 값은 <strong>wrangler.toml</strong>파일과 맞춰줘야 한다.<br>\n전 포스팅에서 만들었던 암호키를 넣으면 된다.</p>\n<p>그리고 헤더 이름도 <strong>index.ts</strong>에서 처리한 것과 같게 해줘야 한다. (너무 당연한 이야기…)<br>\n각자 구성에 맞춰서 진행해야 에러가 안난다.</p>\n<p>403뜨면 이 부분을 잘 확인해보자.</p>\n<p>그 외에 부분은 코드를 보면 이해가 될 것이다.<br>\n업로드 후 <strong>data</strong>를 로깅으로 찍어보면 아래와 같은 값이 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">data =  {\n  uploaded: '2023-01-31T00:59:59.713Z',\n  etag: '8b0e11242eda10911c1d203f33ab841b',\n  size: 630046,\n  version: '5307c9d4821a4ea903f7015ec19d72ef',\n  key: '7c7e5ae2-8260-499e-883c-949a0a687ada'\n}</code></pre></div>\n<p>각 설명은 아래를 참고하자</p>\n<ul>\n<li>uploaded : 업로드 날짜</li>\n<li>etag : 고유 etag 값</li>\n<li>size : 파일 사이트</li>\n<li>version : R2에서 사용하는 값</li>\n<li>key : 업로드한 파일명</li>\n</ul>\n<p>저기 로직에서 axios 통신을 보면 Workers의 HTTP 처리기 로직(index.ts)와 매칭이 된다.<br>\n이 부분을 잘 응용하면 좀 더 고도화 된 코드를 구현할 수 있는데, 귀찮으면 일단 여기 로직으로 시작해도 된다.</p>\n<br>\n<h3 id=\"2-3-multerr2options\" style=\"position:relative;\"><a href=\"#2-3-multerr2options\" aria-label=\"2 3 multerr2options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3 multerR2Options</h3>\n<p>이건 약간 번외 파일인데…<br>\n각자 업로드에 맞춰서 사용하면 된다.</p>\n<p>아래는 그냥 내가 사용했던 샘플 코드인데…<br>\n그냥 어디선가 긁어온 코드를 그냥 사용했었다…</p>\n<p>물론 지금 내 서비스 코드는 다르게 되어 있지만…<br>\n여러분들도 입맛에 맞춰서 바꿔 사용해보시는 것을 추천한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HttpException<span class=\"token punctuation\">,</span> HttpStatus <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> existsSync<span class=\"token punctuation\">,</span> mkdirSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> diskStorage <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'multer'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extname <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> multerR2Options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">fileFilter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>mimetype<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/(jpg|jpeg|png|gif)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpException</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">{</span>\n            message<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            error<span class=\"token operator\">:</span> <span class=\"token string\">'지원하지 않는 이미지 형식입니다.'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          HttpStatus<span class=\"token punctuation\">.</span><span class=\"token constant\">BAD_REQUEST</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  limits<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    fieldNameSize<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 필드명 사이즈 최대값 (기본값 100bytes)</span>\n    filedSize<span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 필드 사이즈 값 설정 (기본값 1MB) 10MB</span>\n    fields<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 파일 형식이 아닌 필드의 최대 개수 (기본 값 무제한)</span>\n    fileSize<span class=\"token operator\">:</span> <span class=\"token number\">16777216</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//multipart 형식 폼에서 최대 파일 사이즈(bytes) \"16MB 설정\" (기본 값 무제한)</span>\n    files<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//multipart 형식 폼에서 파일 필드 최대 개수 (기본 값 무제한)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>좀 성급한 정리의 감이 없지않아 있지만…\n위 코드를 참고하면 구현할 수 있을 것이다.</p>\n<p>R2와 S3는 사실 각각의 장단점을 가지고 있다.<br>\nS3는 접근 제어를 할 수 있지만, R2는 내가 알기론 다 공개형태이다.</p>\n<p>URL만 있으면 접근이 가능하다는 뜻이다.<br>\n그래서 이 부분이 서비스 구현에 맞다면 R2를 쓰는것이 좋지만…</p>\n<p>보안이 좀 필요하거나 하면 S3를 쓰는게 맞는 것 같다.</p>\n<p>각자 구성환경이 좀 다르겠지만…<br>\n보통 React 또는 Next.JS를 프론트에 두고, 백엔드는 Nest.js 또는 스프링, FastApi 등을 쓰고 할 것이다.</p>\n<p>근데 나는 Next.Js + Nest.Js 에 Ngix를 통해서 작업을 했다.<br>\n근데 Next.Js에서 미들웨어에서 파일에 대한 ByteArray를 전달할 때 좀 문제가 있었다.</p>\n<p>물론 이 부분은 다 구현해서 정리해뒀다.</p>\n<p>나중에 시간날 때 저 환경에서 파일 업로드 다운로드를 하는 부분에 대해 포스팅 해볼 예정이다.</p>\n<p>예제를 최대한 친절하게 작성해뒀지만…<br>\n이해가 안되는 부분이 있다면 댓글로 남겨주시면 확인 후 답변 드릴 예정이다.</p>\n<p>나중에 시간이 좀 많이 널널해지면 그땐 깃허브에 예제를 올리고 해당 포스팅 문서도 업데이트 하도록 할 예정이다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#1-worker-%EC%B2%98%EB%A6%AC%EA%B8%B0-%EB%B0%B0%ED%8F%AC\">1. Worker 처리기 배포</a></p>\n</li>\n<li>\n<p><a href=\"#2-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%84%B1\">2. 프로젝트 구성</a></p>\n<ul>\n<li><a href=\"#2-1-filecontroller\">2-1 FileController</a></li>\n<li><a href=\"#2-2-fileservice--filer2service\">2-2 FileService &#x26; FileR2Service</a></li>\n<li><a href=\"#2-3-multerr2options\">2-3 multerR2Options</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.02.03","title":"CloudFlare R2 사용해보기 Part 2 (With Nest.Js)","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230203_r2_nestjs/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/nest_js/230129_tast_scheduling/","nextSlug":"/cloud-flare/","prevSlug":"/nest_js/230203_r2_nestjs/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}