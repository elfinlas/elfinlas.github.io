{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/nest_js/230401_ipv6_ipv4/","result":{"data":{"cur":{"id":"47381a8f-360f-584e-a6ce-367c4896ad22","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"배포를-하기-전에\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC%EB%A5%BC-%ED%95%98%EA%B8%B0-%EC%A0%84%EC%97%90\" aria-label=\"배포를 하기 전에 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포를 하기 전에…</h1>\n<p><a href=\"https://bcow.world\">흑우집합소</a> 테섭에 배포를 하고나서 몇 가지 테스트를 진행하던 도중 pm2 로그를 잠시 확인했다.</p>\n<p><img src=\"/img01.png\" alt=\"\"></p>\n<p>저기 보면 clientIp라고 되어 있는 곳에 IP가 뜨는데 뭔가 좀 이상했다…<br>\nIpV4가 나와야 하는데 IpV6 형식으로 나왔다.</p>\n<p>사실 큰 상관은 없을 것 같은데 그래도 서버 내에서 로깅이나 확인할 때 IpV6 형식으로 되어 있다면 불편할 것 같았다.<br>\n그래서 이걸 V4 형식으로 바꿨다.</p>\n<p>방법은 여러가지가 있지만, 제일 쉽고 아무것도 설치하지 않아도 되는 방식으로 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> NestFactory<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>AppModule<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> bodyParser<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//Some init</span>\n\n  <span class=\"token keyword\">await</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">4000</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'[SERVER-ON] = '</span><span class=\"token punctuation\">,</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>저렇게 <strong>app.listen</strong>함수 뒤에 전달인자로 <strong>hostname</strong>을 전달해주면 된다.<br>\n저 함수를 타보면 아래와 같은 형태이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/**\n     * Starts the application.\n     *\n     * @param {number|string} port\n     * @param {string} [hostname]\n     * @param {Function} [callback] Optional callback\n     * @returns {Promise} A Promise that, when resolved, is a reference to the underlying HttpServer.\n     */</span>\n    <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> callback<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> hostname<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> callback<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>저 hostname에 ipv4 형식을 문자열로 전달하면 이제 Nest.Js 내에서 ip 주소 표현은 IpV4로 바뀌게 된다.</p>","excerpt":"배포를 하기 전에… 흑우집합소 테섭에 배포를 하고나서 몇 가지 테스트를 진행하던 도중 pm2 로그를 잠시 확인했다.  저기 보면 clientIp라고 되어 있는 곳에 IP가 뜨는데 뭔가 좀 이상했다… IpV4가 나와야 하는데 IpV6 형식으로 나왔다. 사실 큰 상관은 없을 것 같은데 그래도 서버 내에서 로깅이나 확인할 때 IpV6 형식으로 되어 있다면 불편할 것 같았다. 그래서 이걸 V4 형식으로 바꿨다. 방법은 여러가지가 있지만, 제일 쉽고 아무것도 설치하지 않아도 되는 방식으로 했다. 저렇게 app.listen함수 뒤에 전달인자로 hostname을 전달해주면 된다. 저 함수를 타보면 아래와 같은 형태이다. 저 hostname에 ipv4 형식을 문자열로 전달하면 이제 Nest.Js 내에서 ip 주소 표현은 IpV4로 바뀌게 된다.","frontmatter":{"date":"2023.04.01","title":"Nest.js에서 Ip 조회할 때 IpV6로 표시되는 것을 IpV4로 바꾸기","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230401_ipv6_ipv4/"}},"next":{"id":"566581a9-4bbb-5ce4-b5ee-1c760a5fd617","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB4zZGdJL/AP/EABoQAAICAwAAAAAAAAAAAAAAAAABAhEQEiH/2gAIAQEAAQUCtibucu6rCP/EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwHSv//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAZEAEBAAMBAAAAAAAAAAAAAAABABAhIjH/2gAIAQEABj8C9jbcsxj/xAAbEAACAwADAAAAAAAAAAAAAAABEQAhMVFhkf/aAAgBAQABPyFI37Hs6XdRgYdS0FCFXiAC3P/aAAwDAQACAAMAAAAQwP8A/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAwEBPxCMEp//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QykP/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhQXH/2gAIAQEAAT8QWGInt4cFCtTFPPmByQI0na/PJjksDmFCgeuuMhYzu//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/7c297/thumbnail_nginx.webp 180w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/33ecc/thumbnail_nginx.webp 360w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/84c6d/thumbnail_nginx.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/98e5d/thumbnail_nginx.jpg 180w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/543cd/thumbnail_nginx.jpg 360w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/40619/thumbnail_nginx.jpg 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/40619/thumbnail_nginx.jpg\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"파일-업로드를-했는데\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C%EB%A5%BC-%ED%96%88%EB%8A%94%EB%8D%B0\" aria-label=\"파일 업로드를 했는데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 업로드를 했는데…</h1>\n<p>흑우집합소를 개발하고, 로컬에서 잘 되던 파일 업로드 기능이 이상하게 배포만 하면 에러가 났다. -_-;;<br>\nNest.Js의 서버측에서는 파일 사이즈를 분명 설정하고 잘 맞춰뒀는데 왜 그런 에러가 발생하는지 이유가 궁금했다…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVQI1y2M64qDMBhE+/7v1i5eoFA10Xrpqux2f8RqviR7SqMDhwPDMCexnuA93h34A+cIISDWshizsyz71nvESdyISMRayyenop6odIVqGiqtKbWmUIprcYsulULVNasI/+zZgsPYFyKO17qyblt0PHx+XRiznCnNGJOUKcuZs5zH+RK77yRhTFNMWeGaO9K2+H5A2o7nMPDX9/x2HT/3FjM/eAMGm+KgcbtBsAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5478dd8f9eb0b70a42a8af6e0c0d8917/7c297/img01.webp 180w,\n/static/5478dd8f9eb0b70a42a8af6e0c0d8917/33ecc/img01.webp 360w,\n/static/5478dd8f9eb0b70a42a8af6e0c0d8917/df77d/img01.webp 720w,\n/static/5478dd8f9eb0b70a42a8af6e0c0d8917/d571a/img01.webp 809w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5478dd8f9eb0b70a42a8af6e0c0d8917/e9ea2/img01.png 180w,\n/static/5478dd8f9eb0b70a42a8af6e0c0d8917/53918/img01.png 360w,\n/static/5478dd8f9eb0b70a42a8af6e0c0d8917/242a6/img01.png 720w,\n/static/5478dd8f9eb0b70a42a8af6e0c0d8917/55aab/img01.png 809w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5478dd8f9eb0b70a42a8af6e0c0d8917/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>에러는 복잡했는데 Status코드가 <strong>413</strong>이 돌아왔다.</p>\n<p>이 에러 코드는 클라이언트에서 보낸 요청의 크기가 서버에서 설정한 최대 한도를 초과해서 발생하는 문제다.<br>\n근데 서버는 분명 설정을 해뒀으니 누가 문제일까?</p>\n<p>역시 범인은 Nginx였다.</p>\n<h2 id=\"처리방법은\" style=\"position:relative;\"><a href=\"#%EC%B2%98%EB%A6%AC%EB%B0%A9%EB%B2%95%EC%9D%80\" aria-label=\"처리방법은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>처리방법은?</h2>\n<p>몹시 간단하다.<br>\nNginx의 설정 값 중 <strong>client_max_body_size</strong> 값을 지정해주면 된다. <strong>(마크다운 문법 에러 때문에 _ 조심)</strong></p>\n<h3 id=\"client_max_body_size-설정하기\" style=\"position:relative;\"><a href=\"#client_max_body_size-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"client_max_body_size 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>client_max_body_size 설정하기</h3>\n<p>nginx의 설치된 경로에 별도로 바꾸지 않았다면, <strong>nginx.conf</strong>파일을 열고 아래와 같이 값을 입력해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">user www-data;\nworker_processes auto;\npid /run/nginx.pid;\n\nhttp {\n\n\t##\n\t# Basic Settings\n\t##\n\n\tsendfile on;\n\ttcp_nopush on;\n\ttypes_hash_max_size 2048;\n\tclient_max_body_size 100m; # 이 부분처럼 설정해주고 용량을 적당하게 지정하자.\n\n    ....\n}</code></pre></div>\n<p>이렇게 처리하면 잘 될 것이다.<br>\n만약 위에 client_max_body_size 옵션 만으로도 에러가 지속되면 버퍼쪽도 올려줘야 한다.</p>\n<h3 id=\"proxy_buffer_size와-proxy_buffers-설정하기\" style=\"position:relative;\"><a href=\"#proxy_buffer_size%EC%99%80-proxy_buffers-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"proxy_buffer_size와 proxy_buffers 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>proxy_buffer_size와 proxy_buffers 설정하기</h3>\n<p>참고로 Nginx는 기본 버퍼가 16KB다.<br>\n그래서 이 부분을 더 늘려서 사용하면 된다.</p>\n<p>이것도 위에 나온 경로에 아까 설정한 client_max_body_size 값 바로 아래에 정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">user www-data;\nworker_processes auto;\npid /run/nginx.pid;\n\nhttp {\n\n\t##\n\t# Basic Settings\n\t##\n\n\tsendfile on;\n\ttcp_nopush on;\n\ttypes_hash_max_size 2048;\n\tclient_max_body_size 100m;\n    proxy_buffer_size   64k; # 버퍼 설정 64KB\n    proxy_buffers   4 64k; # 버퍼 설정 64KB\n\n    ....\n}</code></pre></div>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p><strong>마크다운 버그인지 저기 속성들이 _(언더바)가 들어가는데 2개 이상 쓰면 저렇게 글이 뭉개진다.</strong><br>\n<strong>그래서 저 옵션은 꼭 잘 확인하자.</strong></p>\n<p>이렇게 처리한다면 더 이상 413이니 이상한 에러는 안날 것이다.<br>\n물론 백엔드 코드가 잘못되어 있다면 에러는 발생하겠지만…</p>\n<p>PS : 하다보니 Nginx가 범인이 아니라 무지한 내가 범인인듯…</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%B2%98%EB%A6%AC%EB%B0%A9%EB%B2%95%EC%9D%80\">처리방법은?</a></p>\n<ul>\n<li><a href=\"#client_max_body_size-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">client_max_body_size 설정하기</a></li>\n<li><a href=\"#proxy_buffer_size%EC%99%80-proxy_buffers-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">proxy_buffer_size와 proxy_buffers 설정하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.03.31","title":"Nginx에서 파일 업로드 사이즈 용량 처리","categories":"nginx","emoji":"📜"},"fields":{"slug":"/nginx/230331_file_upload_size/"}},"prev":{"id":"88dc838e-7fb7-51b1-8879-691337b52b2c","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB4zZGdJL/AP/EABoQAAICAwAAAAAAAAAAAAAAAAABAhEQEiH/2gAIAQEAAQUCtibucu6rCP/EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwHSv//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAZEAEBAAMBAAAAAAAAAAAAAAABABAhIjH/2gAIAQEABj8C9jbcsxj/xAAbEAACAwADAAAAAAAAAAAAAAABEQAhMVFhkf/aAAgBAQABPyFI37Hs6XdRgYdS0FCFXiAC3P/aAAwDAQACAAMAAAAQwP8A/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAwEBPxCMEp//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QykP/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhQXH/2gAIAQEAAT8QWGInt4cFCtTFPPmByQI0na/PJjksDmFCgeuuMhYzu//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/7c297/thumbnail_nginx.webp 180w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/33ecc/thumbnail_nginx.webp 360w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/84c6d/thumbnail_nginx.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/98e5d/thumbnail_nginx.jpg 180w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/543cd/thumbnail_nginx.jpg 360w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/40619/thumbnail_nginx.jpg 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/40619/thumbnail_nginx.jpg\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"서비스를-열어두면\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A5%BC-%EC%97%B4%EC%96%B4%EB%91%90%EB%A9%B4\" aria-label=\"서비스를 열어두면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서비스를 열어두면…</h1>\n<p>오픈을 하고나면 정말 많은 일들이 생긴다.<br>\n도메인 주소를 어떻게 알고 이상한 메일들도 오고, 다양한 방법으로 연락이 온다. -_-;;</p>\n<p>그래봤자 넷상이니까?<br>\n근데 이제 서비스 접근 로그 또는 nginx에 접근 로그를 보면 대환장 파티다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">128.90.135.254 - - [04/Feb/2023:14:03:43 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0\"\n159.223.56.86 - - [04/Feb/2023:14:17:38 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n20.231.80.56 - - [04/Feb/2023:14:24:53 +0000] \"GET /wp-login.php HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:09 +0000] \"GET /.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:10 +0000] \"POST /.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:10 +0000] \"GET /.aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:11 +0000] \"POST /.aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:12 +0000] \"GET /.aws/config HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:12 +0000] \"POST /.aws/config HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:13 +0000] \"GET /aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:14 +0000] \"POST /aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:14 +0000] \"GET /credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:15 +0000] \"POST /credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:16 +0000] \"GET /test.php HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:16 +0000] \"POST /test.php HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:17 +0000] \"GET /laravel/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:17 +0000] \"POST /laravel/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:18 +0000] \"GET /demo/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:19 +0000] \"POST /demo/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:19 +0000] \"GET /web/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:20 +0000] \"POST /web/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:21 +0000] \"GET /phpinfo HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:21 +0000] \"POST /phpinfo HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n178.62.72.53 - - [04/Feb/2023:20:28:52 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n159.223.56.86 - - [04/Feb/2023:23:44:00 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n165.227.89.199 - - [05/Feb/2023:00:23:58 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n159.223.56.86 - - [05/Feb/2023:01:15:39 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n5.62.58.235 - - [05/Feb/2023:02:16:29 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n205.210.31.157 - - [05/Feb/2023:04:08:24 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Xpanse, a Palo Alto Networks company, indexes customer network perimeters. If you have any questions or concerns, please reach out to: scaninfo@paloaltonetworks.com.\"</code></pre></div>\n<br>\n<p>이건 내 Nginx 접근 기록에서 따온 로그 중 일부다.<br>\n저기 <strong>109.237.98.53</strong>IP 접근을 보라.</p>\n<p>파이썬이나 기타 언어로 봇 만들어서 취약점을 열심히 찾는…<br>\n참 부지런하다…</p>\n<p>난 게을러서 저런 노력도 못할 듯 싶다 -_-;;<br>\n무튼 서비스가 오픈되면 어떻게들 귀신같이 알고 저렇게 온다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQD/2gAMAwEAAhADEAAAAZM3ylOsNqUGgR//xAAcEAACAgMBAQAAAAAAAAAAAAAAAQIDERITITL/2gAIAQEAAQUC4WjosOEzd5hN7tmPYfbR/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEDAQE/ASN//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAECAQE/AWd//8QAGhAAAQUBAAAAAAAAAAAAAAAAAAEQEUGR4f/aAAgBAQAGPwLpWlNCtLVh/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERMSFRQWHw/9oACAEBAAE/Id7Q2g8GUJGGr7ZC6MG5QLLDWw//2gAMAwEAAgADAAAAEPvIAv/EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxBlP//EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QVlCz/8QAHBABAQACAwEBAAAAAAAAAAAAAREAUTFB4SFh/9oACAEBAAE/ECh8Pc8Yz4oHT4xNkz5G6pMcKJTRomFFXHWIF5RNZCsmkygVP76z/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3e4311ec4e2b3062af0e05a248a4cac2/7c297/img01.webp 180w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/33ecc/img01.webp 360w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/df77d/img01.webp 720w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/5ce83/img01.webp 1032w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3e4311ec4e2b3062af0e05a248a4cac2/98e5d/img01.jpg 180w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/543cd/img01.jpg 360w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/20801/img01.jpg 720w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/1c049/img01.jpg 1032w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3e4311ec4e2b3062af0e05a248a4cac2/20801/img01.jpg\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>무튼 예전부터 나는 이걸 보호할 방법을 찾았고 적용했었다.<br>\n그리고 포스팅 해야지 하다가..(아마 흑우집합소 1세대쯤이었…)</p>\n<p>그래서 이걸 이제야 포스팅 해본다.</p>\n<h2 id=\"how-to\" style=\"position:relative;\"><a href=\"#how-to\" aria-label=\"how to permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How To?</h2>\n<p>일단 nginx가 설치되어 있다는 것을 가정한다.<br>\nnginx의 기본 설정 파일을 vim이던 원하는 편집기로 연다.</p>\n<p>보통은 경로가 <strong>/etc/nginx/nginx.conf</strong> 일거다.<br>\n물론 보안을 생각하면 다른 장소로 옮겨둔 사람도 있겠지만…</p>\n<p>이 conf파일에 작성해도 좋지만 나 같은 경우 따로 빼뒀다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http {\n    ## Some Config\n\n    ## 별도 경로로 빼둔 설정파일들\n\tinclude /home/mymy/nginx/ip-block-list.conf;  #ip block\n  \tinclude /home/mymy/nginx/hack_word.conf; #Hack word\n  \tinclude /home/mymy/nginx/ip-range-block-list.conf; #ip range block\n}</code></pre></div>\n<p>저 설정파일들은 nginx에서 사용할 변수를 만들어 둔 파일들이다.<br>\n그리고 저 설정파일들은 아래서 더 자세하게 설명하겠다.</p>\n<br>\n<h3 id=\"개별-ip-막기\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%B3%84-ip-%EB%A7%89%EA%B8%B0\" aria-label=\"개별 ip 막기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개별 IP 막기</h3>\n<p>위의 <strong>ip-block-list.conf</strong> 파일에는 다음과 같이 되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip {\n    5.62.41.163 1;\n    5.62.58.235 1;\n    default 0;\n}</code></pre></div>\n<p>상단에 geo를 적고 **$**표시가 변수 이름이다.<br>\n그리고 안에 값은 밴 시킬 ip는 1을 주고, 그 외는 허용하려 하기에 0을 줬다.</p>\n<p>여기까지 하고 되면 참 좋겠지만…<br>\n이제 몇 가지 설정이 남았다.</p>\n<p>다시 nginx.conf 파일을 열거나 자신의 서비스에 맞는 설정을 빼뒀으면 그 config를 열어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n  #기본 설정\n  listen 80;\n  listen [::]:80;\n  root /var/www/html;\n\n  server_name bcow.world;\n\n  #Ban black ip\n  if ($bad_ip) { return 444; }\n\n  #Ban ip range\n  if ($bad_ip_range) { return 444;  }\n\n  #특정 url 패턴을 거부\n  if ($bad_word = 1) { return 444; }\n\n  underscores_in_headers    on;  #1. 언더형식의 헤더를 허용 합니다.\n\n  #실제 사용 처리\n  location / {\n    proxy_set_header Range $saferange;\n\n    proxy_pass http://localhost:11122334;\n    proxy_pass_request_headers\ton; ## 요청 헤더 바로 전달\n  }\n}</code></pre></div>\n<p>설정을 저렇게 해주면 된다.<br>\n<strong>if ($bad_ip) { return 444; }</strong> 이 설정으로 인해,<br>\n해당 IP는 444응답… 즉 아무 응답도 못받고 죽은 서버라는 응답을 받게 된다.</p>\n<p>만약 특정 Ip 영역대를 밴 시키고 싶다면?</p>\n<br>\n<h3 id=\"ip-class로-막기\" style=\"position:relative;\"><a href=\"#ip-class%EB%A1%9C-%EB%A7%89%EA%B8%B0\" aria-label=\"ip class로 막기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IP Class로 막기</h3>\n<p>IP는 알다시피 A클래스, B클래스, C클래스 영역으로 나눠져있다.<br>\n그리고 서브넷 등등…</p>\n<p>자세한 건 네트워크 쪽 찾아보거나 시스코의 CCNA 자격증 공부하면 줄기차게 나온다.<br>\n무튼…</p>\n<p>이번엔 위에서 설명된 <strong>ip-range-block-list.conf</strong> 설정을 열람해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip_range {\n\t# A\n\t103.0.0.0/8 1; #VN-21-11-29\n  \t185.0.0.0/8 1; #DE-21-12-27\n\n    # B\n  \t5.161.0.0/16 1; #22-01-02\n  \t45.83.0.0/16 1; #log4j\n\n    # C\n  \t77.111.247.0/24 1; #NO-21-12-16\n  \t167.172.62.0/24 1; #22-01-02\n\n    default 0;\n}</code></pre></div>\n<p>얘도 아까 단일 Ip랑 같은 설정을 가진다.<br>\n단지 A클래스일 경우 앞 대역 주소를 적고 나머진 0.0.0 즉 해당 네트워크 주소(시작 주소)를 적어둔다.</p>\n<p>그리고 뒤에 서브넷을 입력한다.<br>\nA클래스니까 당연 서브넷은 8이다.</p>\n<p>B랑 C는 A랑 같기에 설명은 생략한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 199px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 127.22222222222224%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAFa6hQNREJ1XnaQmNB//8QAHhAAAwACAQUAAAAAAAAAAAAAAQIDABIEEyIxMjT/2gAIAQEAAQUCdjbJDWC7YEIsGdlej7pXvk/TlVy1X88n5p+n/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHhAAAgIBBQEAAAAAAAAAAAAAAQIAESEDEBJBcTH/2gAIAQEABj8CZaJfliKFHUzHr7AVHsNairXRjc8FoS5wIxCxpp+7f//EAB0QAAMAAgIDAAAAAAAAAAAAAAABESExQVEQYfD/2gAIAQEAAT8hq9g466HziZLmmJ5bLoxadEqVdmyNRNAu7IGNLngve03trxPl9Go//9oADAMBAAIAAwAAABDTCwz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAhEAEAAgIBAwUAAAAAAAAAAAABABEhMUFRobEQYYGRwf/aAAgBAQABPxBospgxaldoH1nirBn5u4k1ToPBFwC0G7d59mdXHwqmkD7zKHEWC9F8dWK4NrrOj8IHDnVbb0dW2WFXilcE7h8zuHl6f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0d97179dbf34cf3d16f524aa7fce4407/7c297/img04.webp 180w,\n/static/0d97179dbf34cf3d16f524aa7fce4407/cb05f/img04.webp 199w\"\n              sizes=\"(max-width: 199px) 100vw, 199px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0d97179dbf34cf3d16f524aa7fce4407/98e5d/img04.jpg 180w,\n/static/0d97179dbf34cf3d16f524aa7fce4407/ac59e/img04.jpg 199w\"\n            sizes=\"(max-width: 199px) 100vw, 199px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0d97179dbf34cf3d16f524aa7fce4407/ac59e/img04.jpg\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>무튼 이것도 변수를 선언하고 메인 설정에서 단일 Ip 밴시키듯 아래 설정을 두면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#Ban ip range\n  if ($bad_ip_range) { return 444;  }</code></pre></div>\n<p>근데 이 블록 Ip는 잘보고 막자.<br>\n가끔 B클래스가 같은거 같아서 막 막다보면 엄한 영역도 막을 수 있다.</p>\n<p>그래서 ip조회 서비스 등을 조회해서 대상 B클래스 주소가 같은 지역 같은 호스트,<br>\n비슷한 것 같으면 그 때 막는게 좋다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVQoz22TS3LbMBBEdf9L5AC5SKpSWWSdhS1Z4hck8Rn8CEKdmiElO3YWUwAJ4qGnGzytpSCvq1TKGeS9jFut2Lbtvfi5VtRakdYN339XfPtZ0egN91qQSwGzTjEl+agctR4LZdveq2zIa0bOWUY+8Nc54sdLgrIRa04IMUqdrHO4DQqLUnB9jxSCKPkI5AN8IBBZkHcwVsO7CTVbOKef7xw5nLjF16bD+XLFcrshWPtstxytMpDIwXsH5yxGNWLWC8iTgBi4yLPfgX8uN7yeLyClkFP6R+EDGIIXIAOss1CzgjYLQiB5L/MYduC56dC3HRIRSin/BfpjIyt0ZEXRMA6Y5glqntD2HXzw7CGhHRT8PKBsZQ/nQ6qfgVzWGWijBf5Qy0DOY1fY9lBdAz+NiERfUn60zF5xzcsMY43MWS0fEqNHTBEnR4TbMEK9XWD7FnYcQPMs4QRjEJ17KpQknRW/OCQr7R+js4jxAF67Aep6wXJ9g24aeK1FaXAW67qKSgbItaG9TYZz0qz04amEwsCXa4tRT8g57X/F/f7FQ7ketAdijBYPF7OI2t1LswN9CM9f76Nnn4tbYx9jDFK82YuvJHNeSznhLzKUnhxY8kGvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dc9ea991615ab825e918c5032c2d0094/7c297/img03.webp 180w,\n/static/dc9ea991615ab825e918c5032c2d0094/33ecc/img03.webp 360w,\n/static/dc9ea991615ab825e918c5032c2d0094/df77d/img03.webp 720w,\n/static/dc9ea991615ab825e918c5032c2d0094/5c666/img03.webp 1080w,\n/static/dc9ea991615ab825e918c5032c2d0094/10f44/img03.webp 1158w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dc9ea991615ab825e918c5032c2d0094/e9ea2/img03.png 180w,\n/static/dc9ea991615ab825e918c5032c2d0094/53918/img03.png 360w,\n/static/dc9ea991615ab825e918c5032c2d0094/242a6/img03.png 720w,\n/static/dc9ea991615ab825e918c5032c2d0094/b4ad3/img03.png 1080w,\n/static/dc9ea991615ab825e918c5032c2d0094/69083/img03.png 1158w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dc9ea991615ab825e918c5032c2d0094/242a6/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이건 <a href=\"https://ip-api.com/\">IP-API</a>사이트에서 조회한 것인데 저렇게 밑에 hosting이라 되어 있으면 일단 막는게 좋다.<br>\n그리고 사진에 나온 것처럼 미국인데 asname이 텐센트…</p>\n<p>물론 클라우드를 통해 접근해서 지역은 상관 없긴 하지만…<br>\n일단 중국은 다 막자.</p>\n<p>다음은 url에 특정 키워드가 포함된 것을 잡는 것을 알아보자.</p>\n<br>\n<h3 id=\"url-keyword\" style=\"position:relative;\"><a href=\"#url-keyword\" aria-label=\"url keyword permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Url keyword</h3>\n<p>이것도 원리는 같다.<br>\n<strong>hack_word.conf</strong> 설정 파일을 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#Request Bad Word\nmap $request_uri $bad_word {\n\tdefault 0;\n\t~*(wp-includes|wlwmanifest|xmlrpc|wordpress|administrator|wp-admin|wp-login|owa|a2billing) 1;\n\t~*(fgt_lang|flu|stalker_portal|streaming|system_api|exporttool|ecp|vendor|LogService|invoke|phpinfo) 1;\n\t~*(Autodiscover|console|eval-stdin|staging|magento|demo|rss|root|mifs|git|graphql|sidekiq|c99|GponForm) 1;\n\t~*(header-rollup-554|fckeditor|ajax|misc|plugins|execute-solution|wp-content|php|telescope) 1;\n\t~*(idx_config|DS_Store|nginx|wp-json|ads|humans|exec|level|monitoring|configprops|balancer|actuator) 1;\n\t~*(meta-data|web_shell_cmd|latest|remote|_asterisk|bash|Bind|binding|appxz|bankCheck|GetAllGameCategory) 1;\n\t~*(exchangerateuserconfig|exchange_article|kline_week|anquan|dns-query|nsepa_setup|java_script|gemini-iptv) 1;\n\t~*(j_spring_security_check|wps|cgi|asmx|HNAP1|sdk|evox) 1;\n\t~*(_ignition|alvzpxkr|ALFA_DATA|wp-plain) 1;\n\t~*(ldap|jndi|dns|securityscan|rmi|ldaps|iiop|corba|nds|nis) 1; # log4j\n}</code></pre></div>\n<p>일단 내가 주로 막는 유형만 가져왔다.<br>\n저렇게 하면 url에 저 키워드가 들어가면 조건에 걸린다.</p>\n<p>내가 집요하게 로그를 분석하며 취약점 찾으려 들어온 놈들 키워드를 분석했다.<br>\n이것도 메인 설정에 박아두면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if ($bad_word = 1) { return 444; }</code></pre></div>\n<p>이렇게 하면 어느정도 취약점 찾는 놈들은 막을 수 있을 것이다.</p>\n<h2 id=\"기타\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%ED%83%80\" aria-label=\"기타 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기타</h2>\n<p>또 막는 설정은 다양한게 있겠지만…</p>\n<p>요새는 영악해서 가짜 UA 달고 오는게 예의지만…<br>\nUserAgent 공백으로 오는 무성의한 놈들도 있다. (아주 가끔…)</p>\n<p>이런 놈들은 아래 설정으로 막을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#공백 UserAgent 차단\nif (\\$http_user_agent = \"\") { return 444; }</code></pre></div>\n<p>그리고 악의적인 행위로 유명한 봇들도 있다.<br>\n이건 아래 내용을 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#Bot\nmap $http_user_agent $limit_bots {\n        default 0;\n        ~*(MJ12bot|ltx71|Adsbot/3.1/WordPress|BLEXBot|UCBrowser|Mb2345Browser) 1;\n        ~*(MicroMessenger|LieBaoFast|Headless|netEstate|PetalBot) 1;\n        ~*(bingbot|FeedDemon|GrapeshotCrawler|DuckDuckBot|MegaIndex) 1;\n        ~*(VelenPublicWebCrawler|SimplePie|YandexBot|SCMGUARD|DotBot) 1;\n        ~*(AhrefsBot|SemrushBot) 1;\n\t~*(wget|curl) 1;\n    }</code></pre></div>\n<p>이걸 또 메인 설정(또는 개인 서비스 설정)에 아래와 같이 넣어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#불필요 로봇 차단\nif (\\$limit_bots = 1) { return 444; }</code></pre></div>\n<p>이렇게하면 일단 가드를 완전히 올린 셋팅은 아니지만 어중이 떠중이는 못들어오게 막아준다.</p>\n<br>\n<p>nginx 책도 빌렸는데 공부를 좀 해서 더 견고하게 막아보도록 노오력해봐야겠다.<br>\n아래는 범위 ip 설정을 올려본다.</p>\n<p>단일은 진짜 넘 커서…<br>\n이건 깃허브나 파일로 제공해야 할 듯 싶다.</p>\n<p>해외 서비스 하는 분은 잘 알아보고 적용하고,<br>\n국내나 국외 크게 신경 안쓰시는 분은 아래 내용을 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip_range {\n\t# A\n    #34.0.0.0/8 1; #22-07-01 => Google Bot 있을 수 있음\n\t103.0.0.0/8 1; #VN-21-11-29\n  \t185.0.0.0/8 1; #DE-21-12-27\n\t159.0.0.0/8 1; #22-04-17\n\t20.0.0.0/8 1; #22-04-30\n\t15.0.0.0/8 1; #22-06-10\n\t51.0.0.0/8 1; #22-06-27\n\t35.0.0.0/8 1; #22-07-01\n\n  \t# B\n    # 66.249.0.0/16 1; #US_21-11-15 => Google Bot 있을 수 있음\n  \t5.161.0.0/16 1; #22-01-02\n  \t45.83.0.0/16 1; #log4j\n  \t51.159.0.0/16 1; #FR-21-11-17\n  \t137.184.0.0/16 1; #22-01-02\n  \t167.71.0.0/16 1; #US(NE)-21-11-25\n  \t185.220.0.0/16 1; #log4j\n\t20.119.0.0/16 1; #22-02-02\n\t92.223.0.0/16 1; #22-04-05\n\t46.101.0.0/16 1; #22-06-09\n\t163.172.0.0/16 1; #22-06-10\n\t198.235.0.0/16 1; #22-06-28\n\t5.62.0.0/16 1;\n\t178.62.0.0/16 1;\n\t146.70.0.0/16 1;\n\t14.116.0.0/16 1;\n\t144.168.0.0/16 1;\n\t144.126.0.0/16 1;\n\t143.198.0.0/16 1;\n\t128.199.0.0/16 1;\n\t18.118.0.0/16 1;\n\t18.234.0.0/16 1;\n\t159.65.0.0/16 1;\n\t159.65.0.0/16 1;\n\t34.240.0.0/16 1;\n\t157.245.0.0/16 1;\n\t170.247.0.0/16 1;\n\t159.223.0.0/16 1;\n\t165.232.0.0/16 1;\n\t168.119.0.0/16 1;\n\t188.166.0.0/16 1;\n\t198.244.0.0/16 1;\n\t35.86.0.0/16 1;\n\t35.89.0.0/16 1;\n\t106.75.0.0/16 1;\n\t205.185.0.0/16 1;\n\t209.141.0.0/16 1;\n\t209.127.0.0/16 1;\n\t43.130.0.0/16 1;\n\t35.93.0.0/16 1;\n\n  \t# C\n  \t77.111.247.0/24 1; #NO-21-12-16\n  \t167.172.62.0/24 1; #22-01-02\n  \t171.25.193.0/24 1; #log4j\n\t92.118.160.0/24 1; #22-04-10\n\t220.181.51.0/24 1; #22-04-12\n\t95.142.120.0/24 1; #22-04-25\n\t5.188.62.0/24 1; #22-05-10\n\t116.179.33.0/24 1; #22-06-10\n\n\t92.223.85.0/24 1;\n\t93.158.91.0/24 1;\n\t93.158.90.0/24 1;\n\t36.99.136.0/24 1;\n\t111.7.100.0/24 1;\n\t117.187.173.0/24 1;\n\t156.146.35.0/24 1;\n\t185.54.229.0/24 1;\n\t185.27.99.0/24 1;\n\t185.181.60.0/24 1;\n\t198.235.24.0/24 1;\n\t205.169.39.0/24 1;\n\t205.210.31.0/24 1;\n\t208.80.194.0/24 1;\n\t111.7.100.0/24 1;\n\t205.210.31.0/24 1;\n\t51.222.253.0/24 1;\n\t89.187.163.0/24 1;\n\t95.142.120.0/24 1;\n\t42.83.147.0/24 1;\n\t54.36.148.0/24 1;\n\t64.43.117.0/24 1;\n\t191.102.179.0/24 1;\n\t199.244.88.0/24 1;\n\n  \tdefault 0;\n}</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#how-to\">How To?</a></p>\n<ul>\n<li><a href=\"#%EA%B0%9C%EB%B3%84-ip-%EB%A7%89%EA%B8%B0\">개별 IP 막기</a></li>\n<li><a href=\"#ip-class%EB%A1%9C-%EB%A7%89%EA%B8%B0\">IP Class로 막기</a></li>\n<li><a href=\"#url-keyword\">Url keyword</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B8%B0%ED%83%80\">기타</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.04.01","title":"Nginx에서 특정 IP 접근 금지 시키기 (With Url 문자열 접근 막기)","categories":"nginx","emoji":"📜"},"fields":{"slug":"/nginx/230401_defense_attacker/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/nest_js/230401_ipv6_ipv4/","nextSlug":"/nginx/230331_file_upload_size/","prevSlug":"/nginx/230401_defense_attacker/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}