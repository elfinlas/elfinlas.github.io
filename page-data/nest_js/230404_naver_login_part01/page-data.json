{"componentChunkName":"component---src-templates-post-jsx","path":"/nest_js/230404_naver_login_part01/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab"}},"markdownRemark":{"id":"4dab9f29-33ec-5306-b958-0c8f75560570","excerpt":"네이버 로그인 포스팅 3부작 (현재 글) Part01 네이버 로그인 구현하기 (Nest.js 코드 구현) Part02 네이버 로그인 구현하기 (네이버 개발자 센터) Part03 네이버 로그인 구현하기 (검수 요청 및 거절 그리고 기타 경험) 서비스에 SNS…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7685b7a900370c34be4e657df3f862d/8c557/thumbnail_nestjs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.14723926380368%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVR42p2Su0oDQRSG8xR2WlmID2ATCy3UJ7CxsbUQFGwECyGi2NgYVMRCJFHxgmhQQTCNhZgURkQISDBGA+ayxuwme8nuzPzOTrLLkiAaDyz7D+fwzX/OGR+coBQwLYAQ/nHN8K/wuTDWINhQy2oPyJgH2DiQ7Adq0VtooRMoM4t1pz8CfnGo7UVQ6BlCrqMP+a5+fI6MQz+8cMdAMllxoT0KplRAiyUw0wSVFTBVg3mXAOPaBaobYchTAQHKdw9CGhhDsXcYJP0OWpBQWViFun0Eff8M6uYutIMI9NMrVJbWYMYSUGaXQaWSZ4Z2F0YNJPUKyT8qoPlOP8z7J7AvGep6CLWbGKorWxweBHlOw4w/CG1Ernk+DFp2HNob5WGcR1GemIM8HRBty5Pz/BIDrKrBSqZAXt5Ac0VYHGY9JgXASqXBdIPnMmBlucmhposW9eNLVIM7vEBp2eDfn413gfaTaQbZmrL639WeGifXAnQLaNvOHIffj+jrKwtXR3EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"thumbnail\"\n        title=\"\"\n        src=\"/static/b7685b7a900370c34be4e657df3f862d/a6d36/thumbnail_nestjs.png\"\n        srcset=\"/static/b7685b7a900370c34be4e657df3f862d/222b7/thumbnail_nestjs.png 163w,\n/static/b7685b7a900370c34be4e657df3f862d/ff46a/thumbnail_nestjs.png 325w,\n/static/b7685b7a900370c34be4e657df3f862d/a6d36/thumbnail_nestjs.png 650w,\n/static/b7685b7a900370c34be4e657df3f862d/8c557/thumbnail_nestjs.png 700w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<br>\n<h2 id=\"네이버-로그인-포스팅-3부작\" style=\"position:relative;\"><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91\" aria-label=\"네이버 로그인 포스팅 3부작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>네이버 로그인 포스팅 3부작</h2>\n<p><a href=\"https://elfinlas.github.io/nest_js/230404_naver_login_part01/\">(현재 글) Part01 네이버 로그인 구현하기 (Nest.js 코드 구현)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part02/\">Part02 네이버 로그인 구현하기 (네이버 개발자 센터)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part03/\">Part03 네이버 로그인 구현하기 (검수 요청 및 거절 그리고 기타 경험)</a></p>\n<hr>\n<br>\n<h1 id=\"서비스에-sns-로그인을-구현하려-했다-sns-naver-oauth-login\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90-sns-%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%98%EB%A0%A4-%ED%96%88%EB%8B%A4-sns-naver-oauth-login\" aria-label=\"서비스에 sns 로그인을 구현하려 했다 sns naver oauth login permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서비스에 SNS 로그인을 구현하려 했다. (SNS Naver OAuth Login)</h1>\n<p>흑우집합소를 개발하다가 사용자 계정 관련해서 사용자 계정과 관련하여 고민을 했다.<br>\n직접 계정 가입을 받을 것인지... 아니면 SNS를 활용한 계정을 처리할 것인지...</p>\n<p>마음은 SNS 로그인쪽으로 기울긴 했다.<br>\n왜냐하면 직접 받는다면, 계정의 신원을 E-Mail로 잡을텐데 여기서 검증 이메일을 보내는 로직과 더불어,<br>\n일일히 계정 정보를 다 입력받는 창을 만들고 하면 시간이 너무 많이 먹을 듯 싶었다.</p>\n<p>그래서 구글 네이버 카카오를 사용하기로 결정했다.</p>\n<p>카카오 사태때 SNS 로그인 문제가 있던걸 봐서 고민을 좀 했지만...<br>\n이 부분은 내가 따로 구현처리해서 피할 수 있는 것 같아서 SNS 로그인을 선택했다.</p>\n<p>내가 직접 한 부분을 다 녹여낸 포스팅이니 참고하면 붙이는데 도움이 되실 것이라 사료된다.</p>\n<p>설명에 앞서 Part01에서는 코드 구현부분이 들어가 있다.<br>\n그리고 Part02에서는 네이버 개발자 센터에서 할 일이 있고,<br>\nPart03에서는 몇 가지 정리할 내용들이 들어간다.</p>\n<h2 id=\"뭐-먼저-할까\" style=\"position:relative;\"><a href=\"#%EB%AD%90-%EB%A8%BC%EC%A0%80-%ED%95%A0%EA%B9%8C\" aria-label=\"뭐 먼저 할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>뭐 먼저 할까?</h2>\n<p>코딩적인 부분은 그냥 쉽게쉽게 하던대로 하면 편하지만, 네이버 개발자 센터가 약간 귀찮다.<br>\n아래 순서로 진행해보자.</p>\n<h3 id=\"1-nestjs에-라이브러리-설치\" style=\"position:relative;\"><a href=\"#1-nestjs%EC%97%90-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%84%A4%EC%B9%98\" aria-label=\"1 nestjs에 라이브러리 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Nest.Js에 라이브러리 설치</h3>\n<p>먼저 아래의 패키지들을 설치해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @nestjs/passport\nyarn add passport\nyarn add passport-naver-v2</code></pre></div>\n<p>뭐 npm을 쓰면 npm으로 바꿔서 설치하면 된다.<br>\n참고로 <a href=\"https://www.npmjs.com/package/passport-naver-v2\">passport-naver-v2</a>는 네이버에서 구현한 passport-naver를 개량한 버전이다.<br>\n네이버에서 만든게 아니라 개인이 만드신 듯 하다.</p>\n<br>\n<h3 id=\"2-naver-authguard-작성\" style=\"position:relative;\"><a href=\"#2-naver-authguard-%EC%9E%91%EC%84%B1\" aria-label=\"2 naver authguard 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Naver AuthGuard 작성</h3>\n<p>이제 AuthGuard를 작성해야 한다.<br>\nNest.Js에서 AuthGuard에 대해서는 추후 포스팅하고 여기에 업데이트 하도록 하겠다.</p>\n<p>아래 나오는 것은 샘플 코드이므로 본인의 취향에 맞게 작성해도 된다.<br>\n여기 나온 코드나 위치는 참고만...</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ExecutionContext<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthGuard <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NaverAuthGuard</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuthGuard</span><span class=\"token punctuation\">(</span><span class=\"token string\">'naver'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token generic-function\"><span class=\"token function\">handleRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TUser <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>err<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TUser <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//에러가 존재하면 에러 처리로 넘긴다.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>handleRequest</strong>메서드의 경우 저 nestjs의 AuthGuard의 선언된 타입 중 하나를 구현한 것이다.<br>\n그래서 만약 처리 중 에러가 발생할 경우 에러 자체를 넘겨서 처리할 수 있도록 했다.</p>\n<p>아래 원형을 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">declare</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">IAuthGuard</span> <span class=\"token operator\">=</span> CanActivate <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token generic-function\"><span class=\"token function\">logIn</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n    TRequest <span class=\"token keyword\">extends</span> <span class=\"token punctuation\">{</span>\n      logIn<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    request<span class=\"token operator\">:</span> TRequest<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token generic-function\"><span class=\"token function\">handleRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TUser <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>err<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TUser<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">getAuthenticateOptions</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IAuthModuleOptions <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">declare</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AuthGuard</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>type<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Type<span class=\"token operator\">&lt;</span>IAuthGuard<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>에러는 보통 ExceptionHandler로 처리를 할텐데 이 부분에 대해서는 각자 처리하는 방식이 있기에,<br>\n여기서는 논외로 하겠다.</p>\n<br>\n<h3 id=\"3-naver-strategy-수립-및-코드-작성\" style=\"position:relative;\"><a href=\"#3-naver-strategy-%EC%88%98%EB%A6%BD-%EB%B0%8F-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"3 naver strategy 수립 및 코드 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Naver Strategy 수립 및 코드 작성</h3>\n<p><strong>Strategy</strong>의 경우에도 nest.js의 전략(Strategy)를 받아서 구현하는데,<br>\n이 부분도 향후에 다시 다뤄볼 예정이다.</p>\n<p>일단 내가 구현한 Naver Strategy 코드는 다음과 같다.<br>\n보안을 위해 일부 코드는 누락되어 있으니 참고만 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Inject<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PassportStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Profile<span class=\"token punctuation\">,</span> Strategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'passport-naver-v2'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountErrorCode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/exceptions/account.error.code'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountException <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/exceptions/account.exception'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  IsExistAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">IS_EXIST_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/is.exist.account.inbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  JoinAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">JOIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/join.account.inbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  LoginAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">LOGIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/login.account.inbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">ACCOUNT_FIND_TYPE</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">ACCOUNT_STATUS_TYPE</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/types/account.enums'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../ports/out/jwt/create.jwt.outbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SnsLoginOutputDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../types/strategy.type'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> snsAccountJoin <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helper/join.account.helper'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> snsLoginAccount <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helper/sns.login.helper'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> makeNickName <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/utils/make.nickname.util'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  IsResignAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">IS_RESIGN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/is.resign.account.inbound.port'</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NaverOAuthStrategy</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PassportStrategy</span><span class=\"token punctuation\">(</span>Strategy<span class=\"token punctuation\">,</span> <span class=\"token string\">'naver'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">JOIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> joinAccountOutboundPort<span class=\"token operator\">:</span> JoinAccountInboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOGIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> loginAccountInboundPort<span class=\"token operator\">:</span> LoginAccountInboundPort<span class=\"token punctuation\">,</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">IS_EXIST_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> isExistAccountInboundPort<span class=\"token operator\">:</span> IsExistAccountInboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> createJwtOutboundPort<span class=\"token operator\">:</span> CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">IS_RESIGN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> isResignAcountInbound<span class=\"token operator\">:</span> IsResignAccountInboundPort\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      clientID<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NAVER_CLIENT_ID</span><span class=\"token punctuation\">,</span>\n      clientSecret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NAVER_CLIENT_PW</span><span class=\"token punctuation\">,</span>\n      callbackURL<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NAVER_CALLBACK</span><span class=\"token punctuation\">,</span>\n      passReqToCallback<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>\n    req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n    accessToken<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    refreshToken<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    profile<span class=\"token operator\">:</span> Profile\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>SnsLoginOutputDto<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> email <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> profile\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>email <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        email<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        joinType<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        lastLoginInfo<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        accessToken<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        bcode<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//탈퇴 6개월 이내를 체크한다.</span>\n    <span class=\"token keyword\">const</span> isResignAccount <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isResignAcountInbound<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      email<span class=\"token punctuation\">,</span>\n      joinType<span class=\"token operator\">:</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SNS_GOOGLE</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isResignAccount<span class=\"token punctuation\">.</span>isResign<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountException</span><span class=\"token punctuation\">(</span>AccountErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">AccessResignAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//계정이 존재하는지 체크</span>\n    <span class=\"token keyword\">const</span> isExistAccountType <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isExistAccountInboundPort<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      email<span class=\"token punctuation\">,</span>\n      joinType<span class=\"token operator\">:</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SNS_NAVER</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//회원이 가입 안된 상태 => 회원 가입 진행</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isExistAccountType<span class=\"token punctuation\">.</span>findType <span class=\"token operator\">===</span> <span class=\"token constant\">ACCOUNT_FIND_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NO_EXIST</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//회원가입 진행 로직 수행</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">snsAccountJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//이미 계정이 존재 => 로그인</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isExistAccountType<span class=\"token punctuation\">.</span>findType <span class=\"token operator\">===</span> <span class=\"token constant\">ACCOUNT_FIND_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXIST</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">snsLoginAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>상단의 **PassportStrategy(Strategy, 'naver')**클래스를 상속받아서,<br>\n<strong>validate</strong>메서드에서 실질적인 구현을 한다.</p>\n<p><strong>PassportStrategy</strong>의 경우 <strong>Strategy</strong>와 구분자 이름을 받는다.<br>\n여기는 깊게 갈 필요는 없고, Strategy는 <strong>passport-naver-v2</strong>의 값을 넣는다.</p>\n<p>그리고 생성자에서 부모 생성자에게 넘길 인자로 네이버 개발자 센터에서 값을 받아와야 하는데,<br>\n이 부분은 일단 공백으로 둬도 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">super({\n      clientID: process.env.NAVER_LOGIN_CLIENT_ID,\n      clientSecret: process.env.NAVER_LOGIN_CLIENT_PW,\n      callbackURL: process.env.NAVER_LOGIN_CALLBACK,\n      passReqToCallback: true,\n    })</code></pre></div>\n<p>지금 작성된 코드의 경우 내가 구현한 것이라서 env파일에서 값을<br>\n끌어오지만 실제로 구현할 때는 잠시 공백으로 둬도 된다.</p>\n<p><strong>passReqToCallback</strong>옵션의 경우 req객체 접근 여부인데,<br>\n나는 req에 실어나를 데이터가 있어서 true로 했다.</p>\n<p><strong>validate</strong>메서드의 전달인자에는 다음과 같이 되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">req: Request,\naccessToken: string,\nrefreshToken: string,\nprofile: Profile</code></pre></div>\n<p>req는 express Request 객체고, accessToken과 refreshToken의 경우 네이버에서 제공하는 토큰이다.<br>\n이걸로 사용자 인증을 사용해도 되고, 나처럼 직접 JWT 토콘을 사용하여 구현해도 된다.</p>\n<p>Nest.Js에서 Jwt 사용이 궁금한 분은 <a href=\"https://elfinlas.github.io/nest_js/230208_nesjs_jwt_part1/\">이곳 포스팅(Nest.Js에서 JWT 사용하기)</a>을 참고하자.</p>\n<p>그리고 마지막으로 profile의 경우 네이버 로그인을 통해 동의받은 사용자 정보를 받는 부분이다.<br>\n값은 아래를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Profile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  provider<span class=\"token operator\">:</span> <span class=\"token string\">'naver'</span><span class=\"token punctuation\">;</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  nickname<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  profileImage<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  age<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  gender<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  email<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  mobile<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  mobileE164<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  name<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  birthday<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  birthYear<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  _raw<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  _json<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<h3 id=\"4-로그인-전략-수립-생각-및-고민해볼-부분\" style=\"position:relative;\"><a href=\"#4-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%A0%84%EB%9E%B5-%EC%88%98%EB%A6%BD-%EC%83%9D%EA%B0%81-%EB%B0%8F-%EA%B3%A0%EB%AF%BC%ED%95%B4%EB%B3%BC-%EB%B6%80%EB%B6%84\" aria-label=\"4 로그인 전략 수립 생각 및 고민해볼 부분 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 로그인 전략 수립 (생각 및 고민해볼 부분)</h3>\n<p>개발자가 신경 쓸 부분은 전략부분이다.<br>\n사용자가 네이버 로그인을 시 <strong>profile</strong>객체 값을 통해 이메일 정보를 알아낼 수 있을 것이다.</p>\n<p>그럼 이 이메일 정보를 토대로 이미 가입이 되어 있는 계정인지...<br>\n아니면 가입이 안되어 있는 계정인지를 확인할 수 있다.</p>\n<p>그래서 위 코드에서도 조회를 해서 가입 처리 또는 로그인 처리를 진행한다.<br>\n참고로 회원 가입 시 몇 가지 정할 것이 있다.</p>\n<p>다중 계정 허용을 할 것인지, 아니면 다중 계정을 막을지,<br>\n이 부분은 향후 포스팅에서 다루겠다.</p>\n<p>일단은 난 다중 계정은 허용하는 방향으로 갔지만,<br>\n다중 게정을 직접적으로 이용하는 것은 막는 방향으로 갔다.</p>\n<p>그리고 만약 탈퇴한 회원이 재가입 하는 경우도 생각해 볼 수 있겠다.</p>\n<p>무튼 이 부분은 프로젝트 성향에 따라 다르기 때문에 각자 알맞게 구현해서 가도록 하자.</p>\n<br>\n<h3 id=\"5-컨트롤러-작성\" style=\"position:relative;\"><a href=\"#5-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EC%9E%91%EC%84%B1\" aria-label=\"5 컨트롤러 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 컨트롤러 작성</h3>\n<p>컨트롤러는 별거 없다.<br>\n아래의 코드를 참고하자.</p>\n<p>참고로 여기에서 쓰이는 주소 값은 나중에 네이버 개발자 센터에서 사용해야 한다.<br>\n이 부분은 Part02 포스트를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Inject<span class=\"token punctuation\">,</span> Req<span class=\"token punctuation\">,</span> Res<span class=\"token punctuation\">,</span> UseFilters<span class=\"token punctuation\">,</span> UseGuards <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthExceptionHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/auth/exceptions/auth.exception.handle'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NaverAuthGuard <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/auth/guard/naver.guard'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CustomLoggerService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/logger/services/custom.logger'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountExceptionHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../exceptions/account.exception.handler'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../types/account.enums'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> LoginControllerHelper <span class=\"token keyword\">from</span> <span class=\"token string\">'./login.controller.helper'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'account'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginSnsNaverController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LoginControllerHelper</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span>CustomLoggerService<span class=\"token punctuation\">)</span> <span class=\"token keyword\">readonly</span> logger<span class=\"token operator\">:</span> CustomLoggerService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'login/sns/naver'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseGuards</span></span><span class=\"token punctuation\">(</span>NaverAuthGuard<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">snsLogin4Naver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'login/sns/naver/cb'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseGuards</span></span><span class=\"token punctuation\">(</span>NaverAuthGuard<span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseFilters</span></span><span class=\"token punctuation\">(</span>AccountExceptionHandler<span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseFilters</span></span><span class=\"token punctuation\">(</span>AuthExceptionHandler<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">snsLogin4NaverCallBack</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Req</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> req<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Res</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> redirectUrl <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginCallback</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SNS_NAVER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span>redirectUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>@Get('login/sns/naver')</strong> 접근 시 네이버의 로그인 쪽으로 가게 된다.<br>\n그래서 여기는 뭔가 따로 처리할 것은 없다.</p>\n<p>그리고 **@Get('login/sns/naver/cb')**콜백을 받는 부분은 아까 Strategy쪽에서 언급한 바와 같이,<br>\nreq 객체에 로그인 또는 회원 가입한 정보를 담고 있다.</p>\n<p>아래와 같이 한번 콘솔을 찍어보면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'req = '</span><span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>물론 저 Strategy쪽에서 return할 때 {} 와 같이 객체로 만들어 보내면 된다.<br>\n일단 이렇게 하면 코드에서 할 부분은 끝이다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>코드쪽은 위에서 언급한 바와 같이 그렇게 복잡한 것이 없다.</p>\n<p>단지 프로젝트 성향에 따라 다중 계정 및 회원 가입, 로그인 처리,<br>\n그리고 사용자 인증을 위한 토큰 처리 정도?</p>\n<p>만약 accessToken 및 refreshToken을 직접 구현하는게 아니라,<br>\n네이버에게 위임하여 구현할 겅우 <a href=\"https://developers.naver.com/docs/login/devguide/devguide.md#3-4-5-%EC%A0%91%EA%B7%BC-%ED%86%A0%ED%81%B0%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%ED%94%84%EB%A1%9C%ED%95%84-api-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0\">접근 토큰을 이용하여 프로필 API 호출</a> 문서를 확인하자.</p>\n<p>다음은 네이버 개발자 페이지에서 처리할 것을 다루는 포스팅으로 넘어간다.</p>\n<br>\n<hr>\n<h4 id=\"네이버-로그인-포스팅-3부작-1\" style=\"position:relative;\"><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91-1\" aria-label=\"네이버 로그인 포스팅 3부작 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>네이버 로그인 포스팅 3부작</h4>\n<p><a href=\"https://elfinlas.github.io/nest_js/230404_naver_login_part01/\">(현재 글) Part01 네이버 로그인 구현하기 (Nest.js 코드 구현)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part02/\">Part02 네이버 로그인 구현하기 (네이버 개발자 센터)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part03/\">Part03 네이버 로그인 구현하기 (검수 요청 및 거절 그리고 기타 경험)</a></p>\n<hr>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"toc\"><pre class=\"language-toc\"><code class=\"language-toc\"></code></pre></div>","tableOfContents":"<ul>\n<li>\n<ul>\n<li><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91\">네이버 로그인 포스팅 3부작</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90-sns-%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%98%EB%A0%A4-%ED%96%88%EB%8B%A4-sns-naver-oauth-login\">서비스에 SNS 로그인을 구현하려 했다. (SNS Naver OAuth Login)</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%AD%90-%EB%A8%BC%EC%A0%80-%ED%95%A0%EA%B9%8C\">뭐 먼저 할까?</a></p>\n<ul>\n<li><a href=\"#1-nestjs%EC%97%90-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%84%A4%EC%B9%98\">1. Nest.Js에 라이브러리 설치</a></li>\n<li><a href=\"#2-naver-authguard-%EC%9E%91%EC%84%B1\">2. Naver AuthGuard 작성</a></li>\n<li><a href=\"#3-naver-strategy-%EC%88%98%EB%A6%BD-%EB%B0%8F-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\">3. Naver Strategy 수립 및 코드 작성</a></li>\n<li><a href=\"#4-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%A0%84%EB%9E%B5-%EC%88%98%EB%A6%BD-%EC%83%9D%EA%B0%81-%EB%B0%8F-%EA%B3%A0%EB%AF%BC%ED%95%B4%EB%B3%BC-%EB%B6%80%EB%B6%84\">4. 로그인 전략 수립 (생각 및 고민해볼 부분)</a></li>\n<li><a href=\"#5-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EC%9E%91%EC%84%B1\">5. 컨트롤러 작성</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Nest.Js에서 네이버 로그인 구현하기 Part.01 (Naver OAuth Login)","description":null,"date":"April 04, 2023","tags":["NestJs","OAuth"],"series":"NestJs","previewImage":"nestjs_logo.jpg","isPrivate":null,"writer":null}},"previous":{"fields":{"slug":"/gatsby/230404_google_analytics/"},"frontmatter":{"title":"Gasty에서 구글 애널리틱스 GA4 처리 문제","isPrivate":null}},"next":{"fields":{"slug":"/nest_js/230405_naver_login_part02/"},"frontmatter":{"title":"Nest.Js에서 네이버 로그인 구현하기 Part.02 (네이버 개발자 센터)","isPrivate":null}}},"pageContext":{"id":"4dab9f29-33ec-5306-b958-0c8f75560570","previousPostId":"307d6c13-c688-5c98-bd13-82775c75748c","nextPostId":"1690ef1a-26e5-5a18-bdbf-7bee095a92a1"}},"staticQueryHashes":[],"slicesMap":{}}