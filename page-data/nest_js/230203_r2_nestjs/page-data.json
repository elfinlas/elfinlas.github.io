{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/nest_js/230203_r2_nestjs/","result":{"data":{"cur":{"id":"25661be2-fac1-5849-97cf-c686c89cf9c5","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"저번-포스팅에-이어\" style=\"position:relative;\"><a href=\"#%EC%A0%80%EB%B2%88-%ED%8F%AC%EC%8A%A4%ED%8C%85%EC%97%90-%EC%9D%B4%EC%96%B4\" aria-label=\"저번 포스팅에 이어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>저번 포스팅에 이어…</h1>\n<p>저번 포스팅(<a href=\"https://elfinlas.github.io/cloud-flare/230127_use_r2/\">CloudFlare R2 사용해보기 Part 1</a>)에 이어 이번에는 R2에 파일 업로드와 다운로드, 삭제 등을 <strong>Nest.Js</strong>로 구현하는 것을 해보려 한다.<br>\n일단 프로젝트를 따로 파서 깃허브에 올려서 하려 했으나…</p>\n<p>생각해보니 각 설정들 부터 해서 <strong>Wrangler</strong>의 설정 및 배포 등 생각할 것과 직접 구현해야 할 부분이 많아지는 관계로…<br>\n일단 코드 조각으로 예시를 만들어보려 한다.</p>\n<p>그렇다고 생략을 엄청 하는 것은 아니고, 환경이 구성되어 있다면 해당 코드 예제가 도움될 것이라 생각이 든다.</p>\n<p>설명에 앞서 구성, 그리고 기타 사항은 다음과 같이 되어 있다.</p>\n<ul>\n<li>Nest.JS 사용</li>\n<li>Typescript 사용</li>\n<li><a href=\"https://elfinlas.github.io/cloud-flare/230127_use_r2/\">CloudFlare R2 사용해보기 Part 1</a> 포스팅까지 진행 완료된 CloudFlare 계정</li>\n<li><strong>Wrangler</strong> 프로젝트가 현재 진행하는(또는 따로 만든) 곳 내부에 존재하는 것을 예시로 진행</li>\n<li>먼저 <strong>files</strong>라는 도메인에서 진행한다. (아래 사진은 참고용)</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 261px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAADS0lEQVRIx5VVXW/iVhD1H6jUp7Zqm2DA2Bh/Xdv4G9uADSYmJVllV90oD63Uh0qV2qf9/6eaMdDsLh/pw9HF2PfcmXNm5koDzYIysuFuEzirGJM0Rm+k40ZWISsT9EfGVdB3quOCuKS+aqKvTKC7PtLVBnaYwpmmENMMQ81Cb6jzhmvoq0RuQlLGDka6A8MOUax2CJIFZos7FMsWujXlU4dj+zy0/1bikgyRwPZnMN0U9fY9moePaLZP+OXdM3ZPLxBBAcNNYXkZTPc86L0h0i5CgjYRENkK0fwO8axCWjYYmz4GqtVFcRWUibPXcDSBPDJR5DEW1QJhViPKllDG9ps1lBWdDZJYI9XA7cjFr2sDL48J/KyB5Ub4WVYx4AONN4GykQ629xUd0bxFUDSw3Rj58g7TuMRNX+Uoe8PxBXTviUcyRMymEKr2qTPm/j3KegcvXrBZppd26yWwKQkke1rAT2pMkwrLllx+xstvf6LavIPl5/CTCl68hBstLoK+cYIS0sEhMsAUIZrHj7D9FPmyhRvMWEdKhbS8BuKRDqLTg+EEKJsHiCBjl6l8/Kjg/9/iNncKOUOEChGKEKvdBzh+ijBdIilWCFLSMWLCa/1MwR0Jh3vC+v4Jjp8gLdcc4e1gjJu+dtx0bmCcJnRCLO6fYXsJsrJBmC6OBX5t8pwgtGEJD7tdyaZk84bJqBbpw/9FOKAq1wSEMPDpDxt+PGeHk7xmPSntUx3z+pCvIlTHFhQnwQ/tPzwLSUMy46feiAlvB9p+7XAge71+RkguD3QBOWm5VLJyDS/MYbkxD1wyyhQRP9P6pQwnNDTR12z8GGzghjk7TPp1o2zNoDKKZhUf9KVRnxOqJhTVQM8I8M3jJ7hRgWRWc6RBMmeSdB8xldDVlDtTLGiqiQd1DC/IEGZdJERI5UPRqhNxojvOuEwpK5qDIFhxZEm+YpJw34L0WzPc491B99BrHU+mLE+m+Hb7N9yw6Po4LjGbb7j9qC5Jw3yxQVlt2TS6Ig4t+RUhTW1Z9/B9/Tv8qESc13wDpsWaa5I2knbdMNWPw+KiKfLEx3ftXzBExLqR26SjFxXQLR+a4Z0t7osREtGMW6/iVIuq5RQp4nNteCD8F9y6PcvqoD05AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/63f833163615a6da2efd925b95c803eb/7c297/img01.webp 180w,\n/static/63f833163615a6da2efd925b95c803eb/3f80a/img01.webp 261w\"\n              sizes=\"(max-width: 261px) 100vw, 261px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/63f833163615a6da2efd925b95c803eb/e9ea2/img01.png 180w,\n/static/63f833163615a6da2efd925b95c803eb/51582/img01.png 261w\"\n            sizes=\"(max-width: 261px) 100vw, 261px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/63f833163615a6da2efd925b95c803eb/51582/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<ul>\n<li><strong>레이어드 아키텍처</strong> 기반으로 코드가 구성되어 있다. (원래 <strong>포트 앤 어뎁터</strong>로 하려 했는데 아직 배우는 단계라…)</li>\n</ul>\n<br>\n<h2 id=\"1-worker-처리기-배포\" style=\"position:relative;\"><a href=\"#1-worker-%EC%B2%98%EB%A6%AC%EA%B8%B0-%EB%B0%B0%ED%8F%AC\" aria-label=\"1 worker 처리기 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Worker 처리기 배포</h2>\n<p><a href=\"https://elfinlas.github.io/cloud-flare/230127_use_r2/\">CloudFlare R2 사용해보기 Part 1</a> 까지 한 뒤에 작성했던 <strong>index.ts</strong>에 대해서 CloudFlare에 배포를 해줘야 한다.<br>\n이 부분은 자주 쓸 수 있기에 <strong>package.json</strong>의 <strong>scripts</strong>에 등록을 해두고 쓰자.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"scripts\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        ...\n        <span class=\"token property\">\"r2:build:dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"wrangler publish -c ./my_worker/wrangler.toml\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 <strong>my_worker</strong>의 경우 서비스 생성할 때 이름을 적어주면 된다.<br>\n각자 프로젝트 디렉토리에 보면 자신이 정한 디렉토리명이 있는데 이를 넣어주면 된다.<br>\n그리고 실행 명령어도 입맛에 바꿔도 된다.</p>\n<p>이렇게 하고 아래 명령어처럼 배포를 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn r2:build:dev</code></pre></div>\n<br>\n<p>그럼 콘솔에 배포가 잘 되고, CloudFlare 사이트의 Workers에서 등록한 서비스를 들어가서 배포 항목을 보면 확인이 가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVklEQVQoz22STU7DMBCF3V1vwg3Y9EaIJWyR4AbcoYfgECCxqkS3XbQhapvEiT3j+UMT0qhIWBo9OW/8ZZ6TQESGiEZULCa0pt4bDL0Rs10tvdL/avbC8Xi0PkbLKVvsB+v6ZF2MFmO0lJINw3ApdW2aZty7d/FTStq2rXmFuvq2w7m2JkdjIvOJc052Op0MAKyU4iWTfm02m9XhcLht23ZVVdVNzvmVma3rOooxasg5WyYw5DLnE1VvGIFjFtVL/o/1eh3qug673S4AQDCzezeIqBCRBo/A9NsvIn54nPJ8Po9A34sIu6rqZ9d1y+12uyilLM0siMiDeznnAgAafBIHTAdH9Qj+ov+AIrIEgIWrqs5AACiIqMEv1QHTgRnoH8Xv7RJ58t49JhEFRHRYUNU770HEUkr5C7ye0IH+O03PfbnumfmFmZ+Y+ZmZH0XkzXsQkR34A50rV+t6PMZNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f6641b9ce995167297d289d8977bffc1/7c297/img02.webp 180w,\n/static/f6641b9ce995167297d289d8977bffc1/33ecc/img02.webp 360w,\n/static/f6641b9ce995167297d289d8977bffc1/df77d/img02.webp 720w,\n/static/f6641b9ce995167297d289d8977bffc1/5ce83/img02.webp 1032w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f6641b9ce995167297d289d8977bffc1/e9ea2/img02.png 180w,\n/static/f6641b9ce995167297d289d8977bffc1/53918/img02.png 360w,\n/static/f6641b9ce995167297d289d8977bffc1/242a6/img02.png 720w,\n/static/f6641b9ce995167297d289d8977bffc1/92844/img02.png 1032w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f6641b9ce995167297d289d8977bffc1/242a6/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h2 id=\"2-프로젝트-구성\" style=\"position:relative;\"><a href=\"#2-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%84%B1\" aria-label=\"2 프로젝트 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 프로젝트 구성</h2>\n<p>먼저 <strong>Nest.JS</strong>환경이 구성되어 있어야 한다.(아마 진행자라면 다들 구성되어 있을 것이다.)<br>\n위에서 설명한 것과 같이 <strong>레이어드 아키텍쳐</strong> 기반으로 구성하고 설명한다.<br>\n각 구성은 다음과 같다.</p>\n<ul>\n<li>FileController : URL로 직접 접근하는 부분</li>\n<li>FileR2Service : R2 관련 로직을 핸들링하는 서비스 로직</li>\n<li>multerR2Options : Multer 처리 옵션 로직</li>\n</ul>\n<p>기타 설치해야 할 패키지는 아래와 같다.(같은 역할을 하는 다른 패키지를 써도 무방하다)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @types/multer --dev\nyarn add @nestjs/axios\nyarn add axios\nyarn add rxjs</code></pre></div>\n<p>각 구성 영역에 대해 설명한다.</p>\n<br>\n<h3 id=\"2-1-filecontroller\" style=\"position:relative;\"><a href=\"#2-1-filecontroller\" aria-label=\"2 1 filecontroller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1 FileController</h3>\n<p>컨트롤러 영역은 별거 없다.<br>\n물론 파일 업로드 및 다운로드, 삭제 등의 작업 시 권한이나 그런 로직은 제외한다.<br>\n순수하게 기능에만 집중한 예제이기에 해당 코드를 바로 사용하기 보다는 약간 로직을 추가해서 쓰는 것이 좋다.</p>\n<p>그리고 아래 예제는 내가 사용하던 코드인데 일부 코드는 공개가 불가능해서 조작하였다.<br>\n약간 억지같은 부분도 있지만 기능 구현이라는 관점만 봐주셨으면 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Delete<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Param<span class=\"token punctuation\">,</span> Post<span class=\"token punctuation\">,</span> Req<span class=\"token punctuation\">,</span> Res<span class=\"token punctuation\">,</span> UploadedFile<span class=\"token punctuation\">,</span> UseInterceptors <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FileInterceptor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/platform-express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FilesSuccessCode<span class=\"token punctuation\">,</span> FilesSuccessResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./files.response.success'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> multerR2Options <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./multer.options'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FilesService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./services/files.service'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'files'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilesController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> fileService<span class=\"token operator\">:</span> FilesService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'upload'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseInterceptors</span></span><span class=\"token punctuation\">(</span><span class=\"token function\">FileInterceptor</span><span class=\"token punctuation\">(</span><span class=\"token string\">'file'</span><span class=\"token punctuation\">,</span> multerR2Options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fileUpload</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UploadedFile</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> file<span class=\"token operator\">:</span> Express<span class=\"token punctuation\">.</span>Multer<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Req</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileService<span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> FilesSuccessResponse<span class=\"token punctuation\">.</span><span class=\"token function\">returnRes</span><span class=\"token punctuation\">(</span>FilesSuccessCode<span class=\"token punctuation\">.</span><span class=\"token function\">uploadFile4R2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'get/:file_id'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">downloaFiles</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Res</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> response<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> param<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileService<span class=\"token punctuation\">.</span><span class=\"token function\">fileDownload</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span>file_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'Content-disposition'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">attachment; filename=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>result<span class=\"token punctuation\">.</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> result<span class=\"token punctuation\">.</span>axiosResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Delete</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'delete/:file_id'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">deleteFiles</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Param</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> param<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileService<span class=\"token punctuation\">.</span><span class=\"token function\">updateDeleteStatus</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span>file_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> FilesSuccessResponse<span class=\"token punctuation\">.</span><span class=\"token function\">returnRes</span><span class=\"token punctuation\">(</span>FilesSuccessCode<span class=\"token punctuation\">.</span><span class=\"token function\">deleteFile4R2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 <strong>FilesService</strong>가 있는데 이 서비스 로직은 디비에 저장 및 로깅, 기타 작업 등을 처리하는 메인 서비스 로직인데 이 부분은 아래 서비스 로직에서 다루겠다.</p>\n<br>\n<h3 id=\"2-2-fileservice--filer2service\" style=\"position:relative;\"><a href=\"#2-2-fileservice--filer2service\" aria-label=\"2 2 fileservice  filer2service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2 FileService &#x26; FileR2Service</h3>\n<p>여기는 실제 기능을 담당하는 구현 로직이다.<br>\n<strong>FilesService</strong>의 경우 일부 로직만 구현되어 있기에 그냥 호출 흐름 정도만 공개한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//FilesService</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilesService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> r2Service<span class=\"token operator\">:</span> FilesR2Service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * 파일 업로드 영역\n   * @param req\n   * @param file\n   */</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> file<span class=\"token operator\">:</span> Express<span class=\"token punctuation\">.</span>Multer<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Files<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//R2에 파일 업로드를 처리한다.</span>\n    <span class=\"token keyword\">const</span> fileKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token function\">getUuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> r2Result<span class=\"token operator\">:</span> R2UploadResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>r2Service<span class=\"token punctuation\">.</span><span class=\"token function\">uploadR2</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * 파일 다운로드 영역\n   * @param id\n   * @returns\n   */</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fileDownload</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GetDownloadFile<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> entity <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filesRepo<span class=\"token punctuation\">.</span><span class=\"token function\">findEntityById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>r2Service<span class=\"token punctuation\">.</span><span class=\"token function\">getFileR2</span><span class=\"token punctuation\">(</span>entity<span class=\"token punctuation\">.</span>r2Key<span class=\"token punctuation\">,</span> entity<span class=\"token punctuation\">.</span>uploadName <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">+</span> entity<span class=\"token punctuation\">.</span>extension<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">updateDeleteStatus</span><span class=\"token punctuation\">(</span>fileId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>r2Service<span class=\"token punctuation\">.</span><span class=\"token function\">deleteFileData4R2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>내가 구성한 코드의 경우 파일 업로드 시 해당 파일명을 <strong>uuid</strong>로 바꿔서 관리했다.<br>\n그래서 실제 R2에 파일 업로드 시 <strong>aaa.png</strong> 파일명이라면 R2에는 acbv-3342 등의 UUID로 변경되어 저장된다.<br>\n이는 향후 다운로드 시 디비에 저장된 값으로 다시 바꿔서 전달하면 되는 부분인데 여기서는 자세하게 설명하지 않는다.</p>\n<p>다운로드는 컨트롤러에서 받은 유니크한 UUID 생성 키 값으로 파일 데이터를 찾아서 R2에 저장된 파일명을 가져온다.</p>\n<p>삭제의 경우 원래 파일 상태만 바꾸는데 이번 예제에서는 직접 삭제를 진행한다.</p>\n<p>다음은 실제 구현 로직인 <strong>FileR2Service</strong>이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HttpService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/axios'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AxiosError<span class=\"token punctuation\">,</span> AxiosRequestConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> firstValueFrom<span class=\"token punctuation\">,</span> lastValueFrom<span class=\"token punctuation\">,</span> map <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'rxjs'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FilesR2Service</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> http<span class=\"token operator\">:</span> HttpService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">uploadR2</span><span class=\"token punctuation\">(</span>file<span class=\"token operator\">:</span> Express<span class=\"token punctuation\">.</span>Multer<span class=\"token punctuation\">.</span>File<span class=\"token punctuation\">,</span> fileKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>R2UploadResult<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> baseHeader<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> file<span class=\"token punctuation\">.</span>mimetype<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> data<span class=\"token operator\">:</span> R2UploadResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">lastValueFrom</span><span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>buffer<span class=\"token punctuation\">,</span> baseHeader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//데이터가 안올 때 처리 필요</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">getFileR2</span><span class=\"token punctuation\">(</span>r2Key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> fileName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GetDownloadFile<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>r2Key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> axiosConfg<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    axiosConfg<span class=\"token punctuation\">.</span>responseType <span class=\"token operator\">=</span> <span class=\"token string\">'arraybuffer'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//AxiosRequestConfig 추가</span>\n    <span class=\"token keyword\">const</span> fileData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> axiosConfg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      axiosResponse<span class=\"token operator\">:</span> <span class=\"token function\">firstValueFrom</span><span class=\"token punctuation\">(</span>fileData<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      fileName<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * [주의] R2에서 물리적 파일 삭제 처리 함수\n   * @param fileKey R2에 저장된 파일명\n   * @returns\n   */</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">deleteFileData4R2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>fileKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> axiosConfg<span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> axiosConfg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> callback <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">firstValueFrom</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> callback<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * R2에 업로드 Url을 생성해주는 메서드\n   * @param fileName\n   * @returns\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">getUrl4WorkerR2</span><span class=\"token punctuation\">(</span>fileName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//CF_R2_WORKER_URL = \"https://myworker.workers.dev/\"</span>\n    <span class=\"token keyword\">return</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CF_R2_WORKER_URL</span> <span class=\"token operator\">+</span> fileName<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">getR2DefaultAxiosHeader</span><span class=\"token punctuation\">(</span>headerOpt<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> AxiosRequestConfig <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> baseHeader <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'X-Auth-My-S-Key'</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CF_R2_AUTH_KEY</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      headers<span class=\"token operator\">:</span> headerOpt <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">?</span> baseHeader <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>baseHeader<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>headerOpt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>자잘자잘한 로직이 많다.<br>\n코드를 보면 알겠지만 좀 지저분하고, 로직이 난잡한데 이는 비공개 코드를 지우느라 어색한 부분이 있어서 그렇다.(물론 코드 리팩토링이 아직 제대로 안됨 -_-;)</p>\n<p><strong>getUrl4WorkerR2</strong> 메서드의 경우 .env 파일에 있는 값을 가져오는데 저기서는 Worker Url이다.<br>\n자신이 설정한 URL로 설정해두자.</p>\n<p><strong>getR2DefaultAxiosHeader</strong> 메서드의 경우 Axios 요청 시 헤더 값이다.<br>\n여기서 헤더의 키 값은 <strong>wrangler.toml</strong>파일과 맞춰줘야 한다.<br>\n전 포스팅에서 만들었던 암호키를 넣으면 된다.</p>\n<p>그리고 헤더 이름도 <strong>index.ts</strong>에서 처리한 것과 같게 해줘야 한다. (너무 당연한 이야기…)<br>\n각자 구성에 맞춰서 진행해야 에러가 안난다.</p>\n<p>403뜨면 이 부분을 잘 확인해보자.</p>\n<p>그 외에 부분은 코드를 보면 이해가 될 것이다.<br>\n업로드 후 <strong>data</strong>를 로깅으로 찍어보면 아래와 같은 값이 나온다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">data =  {\n  uploaded: '2023-01-31T00:59:59.713Z',\n  etag: '8b0e11242eda10911c1d203f33ab841b',\n  size: 630046,\n  version: '5307c9d4821a4ea903f7015ec19d72ef',\n  key: '7c7e5ae2-8260-499e-883c-949a0a687ada'\n}</code></pre></div>\n<p>각 설명은 아래를 참고하자</p>\n<ul>\n<li>uploaded : 업로드 날짜</li>\n<li>etag : 고유 etag 값</li>\n<li>size : 파일 사이트</li>\n<li>version : R2에서 사용하는 값</li>\n<li>key : 업로드한 파일명</li>\n</ul>\n<p>저기 로직에서 axios 통신을 보면 Workers의 HTTP 처리기 로직(index.ts)와 매칭이 된다.<br>\n이 부분을 잘 응용하면 좀 더 고도화 된 코드를 구현할 수 있는데, 귀찮으면 일단 여기 로직으로 시작해도 된다.</p>\n<br>\n<h3 id=\"2-3-multerr2options\" style=\"position:relative;\"><a href=\"#2-3-multerr2options\" aria-label=\"2 3 multerr2options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3 multerR2Options</h3>\n<p>이건 약간 번외 파일인데…<br>\n각자 업로드에 맞춰서 사용하면 된다.</p>\n<p>아래는 그냥 내가 사용했던 샘플 코드인데…<br>\n그냥 어디선가 긁어온 코드를 그냥 사용했었다…</p>\n<p>물론 지금 내 서비스 코드는 다르게 되어 있지만…<br>\n여러분들도 입맛에 맞춰서 바꿔 사용해보시는 것을 추천한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HttpException<span class=\"token punctuation\">,</span> HttpStatus <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> existsSync<span class=\"token punctuation\">,</span> mkdirSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> diskStorage <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'multer'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extname <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'path'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> multerR2Options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">fileFilter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>mimetype<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/(jpg|jpeg|png|gif)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpException</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">{</span>\n            message<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            error<span class=\"token operator\">:</span> <span class=\"token string\">'지원하지 않는 이미지 형식입니다.'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          HttpStatus<span class=\"token punctuation\">.</span><span class=\"token constant\">BAD_REQUEST</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  limits<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    fieldNameSize<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 필드명 사이즈 최대값 (기본값 100bytes)</span>\n    filedSize<span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 필드 사이즈 값 설정 (기본값 1MB) 10MB</span>\n    fields<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 파일 형식이 아닌 필드의 최대 개수 (기본 값 무제한)</span>\n    fileSize<span class=\"token operator\">:</span> <span class=\"token number\">16777216</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//multipart 형식 폼에서 최대 파일 사이즈(bytes) \"16MB 설정\" (기본 값 무제한)</span>\n    files<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//multipart 형식 폼에서 파일 필드 최대 개수 (기본 값 무제한)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>좀 성급한 정리의 감이 없지않아 있지만…\n위 코드를 참고하면 구현할 수 있을 것이다.</p>\n<p>R2와 S3는 사실 각각의 장단점을 가지고 있다.<br>\nS3는 접근 제어를 할 수 있지만, R2는 내가 알기론 다 공개형태이다.</p>\n<p>URL만 있으면 접근이 가능하다는 뜻이다.<br>\n그래서 이 부분이 서비스 구현에 맞다면 R2를 쓰는것이 좋지만…</p>\n<p>보안이 좀 필요하거나 하면 S3를 쓰는게 맞는 것 같다.</p>\n<p>각자 구성환경이 좀 다르겠지만…<br>\n보통 React 또는 Next.JS를 프론트에 두고, 백엔드는 Nest.js 또는 스프링, FastApi 등을 쓰고 할 것이다.</p>\n<p>근데 나는 Next.Js + Nest.Js 에 Ngix를 통해서 작업을 했다.<br>\n근데 Next.Js에서 미들웨어에서 파일에 대한 ByteArray를 전달할 때 좀 문제가 있었다.</p>\n<p>물론 이 부분은 다 구현해서 정리해뒀다.</p>\n<p>나중에 시간날 때 저 환경에서 파일 업로드 다운로드를 하는 부분에 대해 포스팅 해볼 예정이다.</p>\n<p>예제를 최대한 친절하게 작성해뒀지만…<br>\n이해가 안되는 부분이 있다면 댓글로 남겨주시면 확인 후 답변 드릴 예정이다.</p>\n<p>나중에 시간이 좀 많이 널널해지면 그땐 깃허브에 예제를 올리고 해당 포스팅 문서도 업데이트 하도록 할 예정이다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#1-worker-%EC%B2%98%EB%A6%AC%EA%B8%B0-%EB%B0%B0%ED%8F%AC\">1. Worker 처리기 배포</a></p>\n</li>\n<li>\n<p><a href=\"#2-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%84%B1\">2. 프로젝트 구성</a></p>\n<ul>\n<li><a href=\"#2-1-filecontroller\">2-1 FileController</a></li>\n<li><a href=\"#2-2-fileservice--filer2service\">2-2 FileService &#x26; FileR2Service</a></li>\n<li><a href=\"#2-3-multerr2options\">2-3 multerR2Options</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","excerpt":"저번 포스팅에 이어… 저번 포스팅(CloudFlare R2 사용해보기 Part 1)에 이어 이번에는 R2에 파일 업로드와 다운로드, 삭제 등을 Nest.Js로 구현하는 것을 해보려 한다. 일단 프로젝트를 따로 파서 깃허브에 올려서 하려 했으나… 생각해보니 각 설정들 부터 해서 Wrangler의 설정 및 배포 등 생각할 것과 직접 구현해야 할 부분이 많아지는 관계로… 일단 코드 조각으로 예시를 만들어보려 한다. 그렇다고 생략을 엄청 하는 것은 아니고, 환경이 구성되어 있다면 해당 코드 예제가 도움될 것이라 생각이 든다. 설명에 앞서 구성, 그리고 기타 사항은 다음과 같이 되어 있다. Nest.JS 사용 Typescript 사용 CloudFlare R2 사용해보기 Part 1 포스팅까지 진행 완료된 CloudFlare 계정 Wrangler 프로젝트가 현재 진행하는(또는 따로 만든) 곳 내부에 존재하는 것을 예시로 진행 먼저 files라는 도메인에서 진행한다. (아래 사진은 참고용)  …","frontmatter":{"date":"2023.02.03","title":"CloudFlare R2 사용해보기 Part 2 (With Nest.Js)","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230203_r2_nestjs/"}},"next":{"id":"ee1502f7-4126-570b-aef1-c2dba6a8a52b","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAADWklEQVQozx3Ma0+TZwCA4QcylyXGjC3Lkn2YmyYmxuzTCEsQDCKMDVCEgMhxcuhIldIKWFuhUECQSmmhK8UCVRpgwDtWKJZSDgoKEwPSFjCIoYgZiZnJfsS9uOsHXKIs9mty0xKo7eiltltCb5fQWYdIzcgi90oBipp6aq3DVMgy+TnqKLpWIze1uVT+GskdUw127zLOpRB980F65oIIo2OcgnINjU4PNt86nRPLdHtWMEuPKZP9RPrpwzRoSmlI/YQLJwRFMZ+iV6dQlia4cl5wNf9zzE4HA8t7/6fCsRRCXm+m8EYr+fIqVHoD9dZBWrp+x9RlQZV3DM05QfEP4WRHHqIxQdBYFI2iMoarMkFJuqAw+TN6Jp/gfLqN6JkNYHavYjBoyI8WpER/QaulC6OxFdMdHRbJS/HlKLJOCZovhKFMEGSeOY6i7jaK6q+oqRGoSgSGtgqkwL8fQj+2+V3mepLZbBO0Xg5HfjGCjOiP6ZEdxm68xt2xFRTlMSjjBXlREfSNDDPwZIf7vkc0tUXRohboS47S0TuAePA4yG8zO4z35fDGLLDkCCrSPyLulKA4SuDIFhjUGYyuvqRRE8vdJi3e7feMvwgx4f+bsdV9+oa6uX5OUBgpEPd8L3AsvsLkHGGh7SRNWREUJR0h8aTgzDdhqE+HYU4W9I9KTK6u4F7bZOz5Lm7/Wx4G93Gvv2FibZ+GwuPI4wTCPrNOh+sp+gc+TENumm0OtKVniftW8P2X4dxMDMejErTrFbiD/zC86KdzdJrajm6G5p/j8e/h2XpHZ0sZyg9hp/sZunYbtdpqrA9XqGrvRyYrIC8qnGNHwmhJFyzrBH9OTdDpWmRoaYs/FtbQa9W02514N94ytXnA0KSHGwkCYZIe0djrouCXfGSKa1wqkqM2ObDVZHLxu0NY26uY1p/gdu8gpUoldc31zL16h+fZFl5/CG9gjyn/Lt6tA8x1MsQt4z3KKm9RWF5JWnI8qupKDNICcmU5uus5TG69Z1Dqxz4xg83lo0qjwrUcYHb7AN/GHr7gHt7ALlOBEJNrrxFFFVpSks6iaGgj9XwqlzLiabZ28WNiLElZ2bQ7JaS/XmKRPFS3dWEZdjGyuMbc1j6zGyFmNkJMB3bx+l8ztb7Dfw32XA3PcNGWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e7f1dd81de905b7face826931df4ca61/7c297/thumbnail.webp 180w,\n/static/e7f1dd81de905b7face826931df4ca61/33ecc/thumbnail.webp 360w,\n/static/e7f1dd81de905b7face826931df4ca61/df77d/thumbnail.webp 720w,\n/static/e7f1dd81de905b7face826931df4ca61/5c666/thumbnail.webp 1080w,\n/static/e7f1dd81de905b7face826931df4ca61/cbd37/thumbnail.webp 1200w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e7f1dd81de905b7face826931df4ca61/e9ea2/thumbnail.png 180w,\n/static/e7f1dd81de905b7face826931df4ca61/53918/thumbnail.png 360w,\n/static/e7f1dd81de905b7face826931df4ca61/242a6/thumbnail.png 720w,\n/static/e7f1dd81de905b7face826931df4ca61/b4ad3/thumbnail.png 1080w,\n/static/e7f1dd81de905b7face826931df4ca61/64756/thumbnail.png 1200w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e7f1dd81de905b7face826931df4ca61/242a6/thumbnail.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"nestjs에서-스케쥴링\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C-%EC%8A%A4%EC%BC%80%EC%A5%B4%EB%A7%81\" aria-label=\"nestjs에서 스케쥴링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NestJs에서 스케쥴링…</h1>\n<p>현재 하고 있는 프로젝트에서 스케쥴링이 필요하여 구현했었다.<br>\n그런데 스케쥴링을 돌렸는데 뭔가 시간이 안맞게 돌아간다고 해야 하나?</p>\n<p>분과 초단위는 잘 도는데 시간대가 좀 안맞았다.<br>\n그래서 테스트를 하고 자료를 찾다가 원인을 알게되었다…</p>\n<br>\n<h2 id=\"원인\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"원인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인?</h2>\n<p>이유는 바로 <strong>TimeZone</strong> 문제였다.</p>\n<p>내가 구현한 코드는 다음과 같이 구성되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Cron</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0 0-10 0-23 * * 0-5\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"UpdateDataSchedule\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">cron4Time4Data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>taskSchedulerService<span class=\"token punctuation\">.</span><span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">stop4CronJob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"UpdateDataSchedule\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>일요일에서 금요일까지 자정에서 11시까지 도는 스케쥴러다.<br>\n근데 로깅을 찍어보고 해봐도 뭔가 이상했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CronOptions</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Specify the name of your cron job. This will allow to inject your cron job reference through `@InjectCronRef`.\n   */</span>\n  name<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Specify the timezone for the execution. This will modify the actual time relative to your timezone. If the timezone is invalid, an error is thrown. You can check all timezones available at [Moment Timezone Website](http://momentjs.com/timezone/). Probably don't use both ```timeZone``` and ```utcOffset``` together or weird things may happen.\n   */</span>\n  timeZone<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * This allows you to specify the offset of your timezone rather than using the ```timeZone``` param. Probably don't use both ```timeZone``` and ```utcOffset``` together or weird things may happen.\n   */</span>\n  utcOffset<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * If you have code that keeps the event loop running and want to stop the node process when that finishes regardless of the state of your cronjob, you can do so making use of this parameter. This is off by default and cron will run as if it needs to control the event loop. For more information take a look at [timers#timers_timeout_unref](https://nodejs.org/api/timers.html#timers_timeout_unref) from the NodeJS docs.\n   */</span>\n  unrefTimeout<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Creates a scheduled job.\n * @param cronTime The time to fire off your job. This can be in the form of cron syntax or a JS ```Date``` object.\n * @param options Job execution options.\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">declare</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Cron</span><span class=\"token punctuation\">(</span>cronTime<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Date<span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> CronOptions<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> MethodDecorator<span class=\"token punctuation\">;</span></code></pre></div>\n<p>저 <strong>@Cron</strong>의 함수 형태인데 뒤에 옵션이 수상했다.<br>\n위에 선언된 속성 중 <strong>timezone</strong>이 옵셔널로 들어오는데 이게 문제였었다.</p>\n<p>아무것도 선언을 안해주면 그냥 <strong>UTC</strong> 시간대가 적용된다.<br>\n그래서 이걸 아래와 같이 timezone을 선언해주면 아주 간단하게 해결되는 문제였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Cron</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0 0-10 0-23 * * 0-5\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"UpdateDataSchedule\"</span><span class=\"token punctuation\">,</span> timeZone<span class=\"token operator\">:</span> <span class=\"token string\">\"Asia/Seoul\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">...</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이렇게 해주니 한국시 기준으로 잘 동작하였다.</p>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n<ul>\n<li><a href=\"https://docs.nestjs.com/techniques/task-scheduling\">참고 공식 문서</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%9B%90%EC%9D%B8\">원인?</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.01.29","title":"Nest.Js에서 한국시간 기준 스케쥴링할 때 주의점 (With Timezone)","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230129_tast_scheduling/"}},"prev":{"id":"d96c43aa-76c2-5976-9689-4e0a0afd812d","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 662px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQY002PS0/DMBCEc2/jtDY50IY2bzvpA6EITgk4TckBUh5C/P+fMmi3DephpPHs5/XYkVJiPp+zRr9cSiwXEotbifVK4rFSnAWBRLg+5yN/LcocMkopKEUBwQrts4/vk4+fDx+d9fH5ftGbj98vH0/VDbN0b7z/v1AIgclkAtd1WUK4yFKBTSHwcC8QRwKFFshTF6XxoDMPqztxxQtMp1N4nsdLnSRJsNvtkGUZjDHQ2iDPDdKUfAljSiQJzTaI4wxRlCKKEubzPEccxyiKAkEQYDabwTkej+j7Hl3XgXxd1+j7VzRNjWEYOLP2BadhwOFwQNtaWGvRNA3atmWeuKqquLGz3+/5FWpJCsMQZUmtEm48NqGz1pp1/onmZjTbbrfMUcM/Y8CqEMBza1wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a8d0ea289f057622777bc3907cca8803/7c297/thumbnail.webp 180w,\n/static/a8d0ea289f057622777bc3907cca8803/33ecc/thumbnail.webp 360w,\n/static/a8d0ea289f057622777bc3907cca8803/82a5e/thumbnail.webp 662w\"\n              sizes=\"(max-width: 662px) 100vw, 662px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a8d0ea289f057622777bc3907cca8803/e9ea2/thumbnail.png 180w,\n/static/a8d0ea289f057622777bc3907cca8803/53918/thumbnail.png 360w,\n/static/a8d0ea289f057622777bc3907cca8803/46b67/thumbnail.png 662w\"\n            sizes=\"(max-width: 662px) 100vw, 662px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a8d0ea289f057622777bc3907cca8803/46b67/thumbnail.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"코드를-이쁜-이미지로\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%9D%B4%EC%81%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A1%9C\" aria-label=\"코드를 이쁜 이미지로 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드를 이쁜 이미지로…</h1>\n<p>가끔 코딩 유튜브나 블로그에 보면 코드 이미지를 괜찮게 만들어서 올리는 것을 봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQoz4WS24rcMAyG5w3anVnHsi0fkkwmk8webwqFFkqhff83+oqdnWWWQnvxIUu2xC/Ju98/vrO8zpTjzDidGKaZ8XT+wHCaP5yb395d7dLyLs+v7E7zmZIFLQNuPCO5p9OI1dCsOI/6Hu8TRoTgM6o9NvcYzUjKGGv4vD/ggrI7ziveZUqZiGlAY08nDmMFI47Oypu/xTrrNv8WKxxMh6bCblouqFp8Lkg5It7T+YhLGVFFYsSHiIaeGHtcHrCxKutxGlAtpDjgfCTEXBUuhJCQoBgXNmVXqkK3KbISEBfovNJVW3mPa1MeUq4KV5y3iCZspSoMsfnit3buO/tfDsZsBY/nlb44xnnCjRMhZ8K0EI4z2lflvs2nJb1xLXLbTX3TCo7zwr0xXNZCGkY09xyHlZRGnNfWZm2pzsjXOdUf4Hxr1Vj7d8G6lE6EVJSgW2LQ3GyMGR8SGkrbftRCzgUXYru/FquzrIo1F3bD6YwVQ4wOEcXagHMRI7b9rY39O5/u9u/xu8OV+xavynfffv5ieXhifXxmfXxhubHnh6d/8PzhPF8eef3ylT/ONCZFy/xrTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8e9d7408175eaabb20155cc809acc9d0/7c297/img01.webp 180w,\n/static/8e9d7408175eaabb20155cc809acc9d0/33ecc/img01.webp 360w,\n/static/8e9d7408175eaabb20155cc809acc9d0/df77d/img01.webp 720w,\n/static/8e9d7408175eaabb20155cc809acc9d0/79c77/img01.webp 925w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8e9d7408175eaabb20155cc809acc9d0/e9ea2/img01.png 180w,\n/static/8e9d7408175eaabb20155cc809acc9d0/53918/img01.png 360w,\n/static/8e9d7408175eaabb20155cc809acc9d0/242a6/img01.png 720w,\n/static/8e9d7408175eaabb20155cc809acc9d0/c6456/img01.png 925w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8e9d7408175eaabb20155cc809acc9d0/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이런 느낌으로 된 이미지였는데 이걸 한땀한땀 올리진 않을거 같아서 찾아봤다.</p>\n<h2 id=\"carbon-now\" style=\"position:relative;\"><a href=\"#carbon-now\" aria-label=\"carbon now permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Carbon now</h2>\n<p><a href=\"https://carbon.now.sh\">Carbon Now</a><br>\n위와 같은 이미지를 만들어주는 사이트다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACLUlEQVQoz32Sy08TURTGu+DhwunMtPPodGY6j86UFnmZFlppohsNiQZcoBAkSBBTiYYYH4mPRDEYEhDwsQDjxmjcufMv/Jl7GxpY6OK7ZybnnO9855HJ5XII6LouraZpqGoWRVGJQo12S2e6qdNsdO1wTee8oqKqqow9nSuQOfk4cdi2TRAEeJ5PmpS4OBEyNhoyciFkdKREJfVxXY9SyadQKJwh6xGKSsKhKAqVSoV2u02r1aLRmKRebzI1dYnJySaNRlPaer3O9HSbWq0mczRN73FkxGNZlqwmUCwWe3AcB9dzcV0Xz/MoFGxM08BxhK9A0XGkFRA+qdA0TarVKmmaUi6X8X1fIkkSwiDAMg0MI4+qKIyNTzBzfZZyHBGnFbywTBglBH5EJR3CtmwyQl0cx1KNQD6fxzAMiZkbcyytdVhYXuPWnbs8fPKCzuYzqd52iuQsB9MsYOQsglIo558Rj2gpm832BmwYJgP9fWwfHvPz9x/e7B/yaucTB99+sf/1hyymaSq5nC4hNi5G0iMUP6dPIG8YnBsc4PXOAUvL6yTpMKW4ypVrs7z/eIxpWWe2K3L/SdhVKAgHebm9y83Fe5TjcZKhES5fnWVr74tc4n8JRcvd9Ws94v7+Pt7ufebdwRELqx0WVzd4vrXLh6PvsgNx/CfxYlyCQxKKamEYdk/EdeXAXc/DMk3m5hfobD5lZX2DlfUH3H/0mNvLq1KNjHO7JyVyoyiSyv8CTNA+BAJUv7QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a183587070c2af0fe2f134de4e575d8b/7c297/img02.webp 180w,\n/static/a183587070c2af0fe2f134de4e575d8b/33ecc/img02.webp 360w,\n/static/a183587070c2af0fe2f134de4e575d8b/df77d/img02.webp 720w,\n/static/a183587070c2af0fe2f134de4e575d8b/8e7f8/img02.webp 1057w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a183587070c2af0fe2f134de4e575d8b/e9ea2/img02.png 180w,\n/static/a183587070c2af0fe2f134de4e575d8b/53918/img02.png 360w,\n/static/a183587070c2af0fe2f134de4e575d8b/242a6/img02.png 720w,\n/static/a183587070c2af0fe2f134de4e575d8b/c3ac1/img02.png 1057w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a183587070c2af0fe2f134de4e575d8b/242a6/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>코드를 입력하면 언어에 맞춰서 잘 꾸며준다.<br>\n보여주는 창의 테마도 상단에서 바꿀 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 691px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHklEQVQoz5WS20uTYRjA33QnE78dvrnp1vbNcHOb7uAUInFzUxTSoosgNzoYakRdpASVnexKusgsMFwimumSnBqUIFp3sW6D/qJffJ8jvFhgF7/3eU/Pj+d9eUQkEkGlra2tIupZNBYjGo0SjcYOKa/bEwmSqR4tqnfj8TgiHA7j8Xjw+/0oioLVatWw2Wy43W6CwSA2qwWrxYxeV41Br8Og11MlBMFQiJnXeTo6O/F6vSSTSURDQwMqLpeLxsZGnE7nXxwOB15F4VLuGldHb5EbGSN3Y5zcyDjZ62Pa3sTDZ/SfO49dljWpsFgsHOVohVJdHV7Fx+rOPl9//GJjv8TmXomtgxJb30oUD0rs/fzN/ekZjAa9liPUoRKyLGM2S3i8Cosbn3nyYp6eVIb2CwP4En34Ehli6Yssb+8x+eg5JqMBu93+b6GKWSoLP+4wOvmUaknhpKeVE/YQwtqMydXKm5XN/xQqPhbWiozcfYzJGcPlTyM3d2HztWM53cHsYoGJqWlNKB+3wvxakSt3HiB0DoTUhKhTEDVuquoDvHy3fjzh4R+aUXxN5AvbTM/m6R7KkhwapnvwMt2Dwwxmb7K0uas9ucZkxF5fj5AkiUqostraWtynPMwtFVgu7jK/ssGr/HtmF1aYW/zA29VPrH/5zu17U+h1Oq1LREtLC5VQG1qNauOn0r2k+/q1mMqUKc97+wc4c7aLQCCg5fwBNmFmARRjoA4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/791a0531ee80160b6f5ef9f13834c87e/7c297/img03.webp 180w,\n/static/791a0531ee80160b6f5ef9f13834c87e/33ecc/img03.webp 360w,\n/static/791a0531ee80160b6f5ef9f13834c87e/366f1/img03.webp 691w\"\n              sizes=\"(max-width: 691px) 100vw, 691px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/791a0531ee80160b6f5ef9f13834c87e/e9ea2/img03.png 180w,\n/static/791a0531ee80160b6f5ef9f13834c87e/53918/img03.png 360w,\n/static/791a0531ee80160b6f5ef9f13834c87e/2928f/img03.png 691w\"\n            sizes=\"(max-width: 691px) 100vw, 691px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/791a0531ee80160b6f5ef9f13834c87e/2928f/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>코드의 배경색도 변경이 가능하며…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 326px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF9klEQVQ4y2WV20+b9xnHTc4cjLFfn/369L4YfHx9BBtjDrYxwRBMQjglKSSM0JKENmmTBmI2ciBp2nRk0pIipGbNst1MS5uMrFLUaV13t3VIu5gm9Y9Yxy52s6t9Jpx0Ku3FVz/9pJ8+ep7v8/yeRyUIegyCls6DQ7QuPid37Xe0dhfxNXuIRKLIsowkSZXT3exHbzRjEt3oTRYMFhHBbMUh+dELekxGCyrR7sRht9HVP0J48XMyV/9IS1eRTDpFJtOBy+UiFouRSCRwenwIZhFRacfijaO3OjE4ZFyeCEa9EcnhRWXWazELGpo8HvqOz3N4+k2CShS7KNLU1EwgEMDn8+H3+/EFw9hdMnanC5ckI3sDWBxujBY7FpPtRYTu0gKOUpmW0Uv4PW68HqkSUTqdxuvzIcuNZHM5+or99PcPMDY2zujYeOU+MHCItlSKutpatDotDdoGVIFLn+G7/AWFpScY9AI1tbW4XU5CwW1ftGjUNUTDAdLJOJ3trRwdGmBipERnW4x8Z5r2TAa1Wo0gCOh0OlS+c4/xnf8tmTcecnrmB9y4dYc3F65y9q1lzlxcYebCCifPv8Px+dscee0WB0/doOuV67RN3iE2fKnibX19PTrdS6Bj+CauiVWaSpd48OBnfP3v//KXr/7BF3/7F0/+tMVHf9hi9dMtfvh4i3OP/smx9S0Kq18Teu8/CDPPCfh9NDQ0VGAVYJUgoxIaEVwh3rvzPl/+9Ss+fv5nfvFskw8eb/LuLzcpf7jJ/L1NJt/fZOjmJl1LX+Jf+DvGYw8JhQJovg3cZWimyuDF2BjjypUyTz/9PWs/f8rqhxvcuP+My6vPOHN7g6lrG5QWNxhcfEbH+Q1cs58hDP74+8DdL4Hmpjhzc2e4t/6Qq7fvs7CyxuvLa8wsrjHx1hql+TXyr66RPLVG4NgH2EYfoMktEgoF0Wi+Bax3RTkgKliaE4yPj7OwdJ3X3lhk+lyZiVfLHJ4uc/CVMp3jZVqGywQGy7gPXkHouYq6dQblu8A9Jh9VhmZEf5JCocCJqRmGRiYpDk+RL02R6Z+ipXcKJTdFc+cUzvQUptZJ6uLT1PhLKKEQGo1mp4cqwYMjmCYej9PZ3UNruptYKkuoJYs3lkWOZHGEslj8WYTmLOrGLHvdeaodKRTlO8DdRi8qoQl3+MW/dbplRIeMxS5jtMkIFokGk4TaKFGtl9ink9jTIKGql9mvlVAUZSewSiej0riQwu3U1dWiUqnYtXs3Vbu+0Z4XqnqhXRXtrbw7sG/f94EHpHYOyB3Y2oZYCtj5fNnFR79xMvLEiemTE1h+/YjY2x9jc3zCaeEpjwzrrGnSRPsv4DyyjBLw7Wwb8fA1nBM/IXziJnPTJ7n307ss37rOxZUVZpZucPztWxw5u0LhxDL50R/ROnCZdHGWpuI8Yn4OJejfCXRP3MU9tU7q9F2i0Qi5ngK5bJ6oEiGdTJJJJYlHFLLd7cSiIXp7s7S2JujpztCRShAOR3am3DjzkMa5X5E6u048rFDs66Ovr5dYLEKqLUkmkyEcCZPryRMKhSj0FIhHE3R1Zkkm0wRDwcpw0Gq1lT+tsvuTWLwttOUOUW8zY5UbkZvD1NQZaNDasLsldFojTqsHo2BBkmQ0VjVmp4BNMpKIJzAYDJjN5opUme0oUi30HipyVG+nz2HheEFkeMDG0SErSdlBIi2SGhVxR7UEvY2U9MdImY/QZhmjUMxWVsV2JttSVVfXcGD/flyhALPVRiYsOi6OmJiZ0DN7Sk9WFmnLmcidM2OP70XxyUxWz9OtnSWvfx1PwEldrbqS9rZUsViUQDBI2CfjGipjK57EcuE0uckc/Se7Kv2mF8xIopf+3kEODZZ49/47CNZ69qtVRMLRinf/n9jbqzIQCKOEAqS6S8Q78rSUesn2tZMvpvHIjYTDComWOJ1dHXR3dTE2MkY4FEEJhYlGoy8n9ssqm4xq3E41er0Bq9mA1WTEajBi2t6/RjN2ux2bzYbVaq2YbjKZKtFs30VRrBRku8LfAP8HFDdKmDA4RDAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/254cdc475023a6e8699ea0d2ce58ac58/7c297/img04.webp 180w,\n/static/254cdc475023a6e8699ea0d2ce58ac58/10585/img04.webp 326w\"\n              sizes=\"(max-width: 326px) 100vw, 326px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/254cdc475023a6e8699ea0d2ce58ac58/e9ea2/img04.png 180w,\n/static/254cdc475023a6e8699ea0d2ce58ac58/15a61/img04.png 326w\"\n            sizes=\"(max-width: 326px) 100vw, 326px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/254cdc475023a6e8699ea0d2ce58ac58/15a61/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz32Sz2sTQRTHg1Jt2mR/zKbRzW52Zja7O5uNWAj1VEUI6EENIg3YYHvLXyBeeuqhHhVR6Vnaf/QjM9ESRTx8+fLmvfeZN8NrZVlGnudorZFSYmPrNlYuHq41TFF5gR6VaK2QSiOVQkrl6i2j3+/TGo/HTCYTjDEopUiSxHnTNJSVIZOKoVSkg5hmdszD2YIHdUluGmJVIq3SnLpqSJKUlqWHYUgQBM5DIQi8Dr3MUJ5+Jz+9ZHTyjeLkK2b1A/XyA36nTSiimx7P8xgMBsRxTMtOI4TYUETg7XJvtE+xuiZ/ukQ8ekXbPOf+izOK5SeCzl1EFN30WLB92R9Ae9PfQPn2M0JOCYb7bEcKb3pEvrgg6Gz/HxhtJG1h+Auol1/YSqfc3qu5FSr8g2NGiwvCbhsR9f4NtH9oD3zfXysI8Xbb9NSEYnVFPD9n79l7J/nuEn30EW/njquz9ba32+06mAP+Xhk76Vp2XTJ0WWMO55jHr9d+OKd+8obyYObyaqPHDlVVlQP+BGLP4PZ2mcxLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a6cdac9355dec29e7571c9f648c1b15b/7c297/img05.webp 180w,\n/static/a6cdac9355dec29e7571c9f648c1b15b/33ecc/img05.webp 360w,\n/static/a6cdac9355dec29e7571c9f648c1b15b/df77d/img05.webp 720w,\n/static/a6cdac9355dec29e7571c9f648c1b15b/a42ef/img05.webp 1025w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a6cdac9355dec29e7571c9f648c1b15b/e9ea2/img05.png 180w,\n/static/a6cdac9355dec29e7571c9f648c1b15b/53918/img05.png 360w,\n/static/a6cdac9355dec29e7571c9f648c1b15b/242a6/img05.png 720w,\n/static/a6cdac9355dec29e7571c9f648c1b15b/cf562/img05.png 1025w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a6cdac9355dec29e7571c9f648c1b15b/242a6/img05.png\"\n            alt=\"img05\"\n            title=\"img05\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>에디터 표시 설정 및 라인 높이 줄번호 폰트 등의 설정, 그리고 미리 설정된 테마 기능도 지원한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC30lEQVQoz1WS/U8TZxzA+zMzveOu99bry/WuBWxLKSg4XmrbrNYWphDA/TKnsGCMhIEZqIytY2xOYyBu0ZllZhNNJr5AFpO5+faDiYv+Wx/zXNFkP3zy3D25fJ7PN/cERsYm8RmdYHgX8Vw7MsaJmVk+nT5FrjOLHbYI22FsU8U2WolYBpLs0dKSIJXM4XkuwWCQwM7z12y/eMO9f1/xQPC0yf0nr9h58Zobtx8wv7RC49IGJ08vkJ9cpXf6N/rGZ7l+xeDhpsnMVCem5SHLQQJ/Pn7JwsI5RmoHGRiucGCgxIeFJn2DBzlxapZjx6eoj04y/Mk0A599T/5Yg+LxOc5+4fL5VITD1SzRqIskBQncefScWv0omtKCHtFQFBlZVZE1gw/27KFUOczyd5dYXrvMmfNr1M5tcWj5b8YW17m3meGvrb3MTHdjWi6tovDW9j9URkZRNY3OjEdn1iWSbCPVniYctikfqnH12i/cvHWH9avXWFnfZPXGI1Y3fmVna4GXzy4wPzeBaUZpbZUI/LH9mMrwUZSQRtyJ+mhhm5hloSiqX1iv1+jdv48Dfb0kohaWJhE2NIJSGEV1yOf78NzdnyIKP6ofQdV1NMNCCemEdAPVMJEVlUK5wlChQDKVoqenByfhYpoWpmXhJuI4Tox8vgvP85pCUVj9eIygLKObli8TaL5QoVIbYXx8glKpRLFYpL29nY6ODgzDIJfL0d/fT7VaJZFIIEkSgYfP/uPn3+9yYe0KS9/+yGLjHRf55vJP/LBxnVKxyNDQEIVCgba2NjKZDLZtEwqF/AOEMBaLNYVLjYt8+fUa8+cbzC2t/I+zX60yt7jsi0TJ4OAgqVTKF7qu61cKaTabJZlMNkeORGzi8RjxWAxHrLs48TgR2yaTTlMul98XCllXVxfpdNqvEqN2d3djWRayLBNQFMW3O04C1/X8DwTNPccfSdd1v0asougd4l2ginsrywjXWwANprHJpOgAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/44a50850a4181a4d9d248878b6515374/7c297/img06.webp 180w,\n/static/44a50850a4181a4d9d248878b6515374/33ecc/img06.webp 360w,\n/static/44a50850a4181a4d9d248878b6515374/df77d/img06.webp 720w,\n/static/44a50850a4181a4d9d248878b6515374/0692d/img06.webp 728w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/44a50850a4181a4d9d248878b6515374/e9ea2/img06.png 180w,\n/static/44a50850a4181a4d9d248878b6515374/53918/img06.png 360w,\n/static/44a50850a4181a4d9d248878b6515374/242a6/img06.png 720w,\n/static/44a50850a4181a4d9d248878b6515374/0b3a5/img06.png 728w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/44a50850a4181a4d9d248878b6515374/242a6/img06.png\"\n            alt=\"img06\"\n            title=\"img06\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 331px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADZklEQVQ4y32TW0ybZRjHPy/tIdDTGLC26/fRghw+EMpoCy2MKaxh62Q4OXQDw8WCG8qM6ES6AwSQQcRtHYU5mBBgCxlZPM7MGecOdT1MvUDvnPHCS+LilYle/Mz3TW807uKX/5sn7/t//k/yPsKB7oN4PFVUVropLCwkLy+P/Px8XE4nkuhAdPwXx7+QJBFRdODxeBBmFlex20VcrmJEqQCT2UJObi5myyZ0Oj0ajRaNVotOp0On16LVa9D9zaOzFn1mJnqDgfKKCoRT0XmWz+fw4/1skjdMHO7eRmzsOHOTg8xNRrgwEWHxzAk6m/fR4Z6id/sSPYH36Qlc5OXtlwiVDzC71UHKLrK3yoPw9pn3+PIjGzy0s/Egi+GjdXyyMMvnl6JcXznHZ0tRvlqb4ciLBzlUs8qJplsMBr9gMHiDoV1x9vtOc11y8rurkHaPF2FsapqtUh5ZVicen5X+wz5aW1rZ3bSTUFOQpuBOWvY20flcmKdyd5BrLMZmlNlilLGZZWRTDddeHeDXn36mbd8LCEPj72LenMcTT4oUFG+hv9dH854Wnnl2B/X19QRqa2lorOfAnjCunBo2GyUsOgcWjR2DxkphRiXXIqNsPPyN1tY2hDdPnmJtMYdfvt/ED/cyGXjFw8LUOMvRYVaiIyyfHWHtwjg9bZ10Vpynr+4Kh2pWeKl6mb7aqzSXnmRVcvJAfprnvV6E1wZHSN8sB3z8uVHO6bFW7nxwmcSnS9y6epGba3N8/fECb/Ue4ejuD5kMJ3mnM8lUV4po9zp9zQvcrq7hD6+fsD+A0PdGhNj0WdbXvyOZjJNI3COVShGP32V+fp5YLMbszIyq0+dizMRmuXP7LvfT35BKpkkmUnybTpOIx9kfDiMcG53A7w/gdm+jqsqLz+fD4/Xi9/spKipSP3tJSckjZEWLkeUS5FJZ1dJSmWJZxlVQQGNjI8Lx0UnCHR10dXXR3t5GXV0tDQ0NhEIhysrKkGUZk8mExWLBbP4Hs4pSMxgM6h232021rxrh2MgEtYGAmkxJpayP1+slGAwiSRKiKGK32/8Xm82G0+lUVzYQCCD0Dw6pSZQOWVlZZGRkqKp0Veoul0tNoaR8HMpqKh7C65FhtUt2drY6hvJYUcXQarWq5krtcRiNRvR6vWr4FzA3GkXF45YVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5f6959dfe49f9b28d9bbc7b53ccd91d8/7c297/img07.webp 180w,\n/static/5f6959dfe49f9b28d9bbc7b53ccd91d8/c28f2/img07.webp 331w\"\n              sizes=\"(max-width: 331px) 100vw, 331px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5f6959dfe49f9b28d9bbc7b53ccd91d8/e9ea2/img07.png 180w,\n/static/5f6959dfe49f9b28d9bbc7b53ccd91d8/2ba93/img07.png 331w\"\n            sizes=\"(max-width: 331px) 100vw, 331px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5f6959dfe49f9b28d9bbc7b53ccd91d8/2ba93/img07.png\"\n            alt=\"img07\"\n            title=\"img07\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>그리고 내보내기는 단순 이미지 뿐만 아니라 iframe 링크, 이미지 자체 링크 등으로 제공이 가능하다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 160px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 159.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE2UlEQVRIx61WTU8bVxSdqhIpNmA8xthgwI6/x994PMYfGBC4ARsbIlokShYJID6jiCipmtBEURckbZVE6S7ZtMtKkdpU3VRVmzTdZFFV6l861blkHCdBRJW6OLp33ozuO+/cc5+t9Pb24v+EsrW1BcH29usw1/8jFLfbDVe/E061F07HS6i9cLtd4Lv+/v7XwLXj1uWdywVlwO3CkC8IzZhCJDsu0HKTcHtG4PEMIhgKIRgMCkKhEAYGBuDxeOQ5EAi0YiDgh3vIByU/mkB59Roqd/5G6dYzFG4+RfXuPygvriMdj+K0PwCXyyUMYrEYdF1HJpOB3+/HyMgIhoeHMTQ0hNHRUWQqs1D0lAZj+VNErv6GyKUnCO79gMzBHygubCAS8MFiseL8+fNoNBqw2WxSLB6Po6OjAxMTE1hZWZFmDHu9SBamjgrml68i8dlTJPZ/gnbpCYybz1FcWEM06IPq6MPjx4/x4MEDqKoqTJLJJDo7O7G2tiYIh0IY8fqQKk5DMTIxjK1+Du3gBbQrvyJ8+Rdkv/gL40s7iIX9sFi7RDOHwyHIZrNS0GKxIJFIoFKpwGq1wnfaj1RpBkoyHkVyehljuw+RW78Pfe0eyhcfITZWRThwGqFwBF6vV0ANI5EIwuGw6GbC5/OJFFquAsXWbUE46IeRiUNPx5BLH0UtEkYikUQ+n4dhGK3IomR4eHiI6elpaRLfeb0j6LXboRgzZ/HRx8solMoolSsolsoCCl4ul1EsFiUWCgUBcx5zdXUVk5OTslar1TA3Nye6Kmfvv0Amm8N7iiI2IHgM6kVLDA4Owul0tvzWvkbrsAi9yaLUVWl+9SeMsSI+OHVKqNMe7Bx3JJMzZ84Ii3PnzmFjYwPNZhMXLlzA0tISFhcXpfPUkN+/LPgcuXwBFksnVNUBu90uu9PM7UPPdbKmF/nMSPT09EjDWgUbd56hsXAWkXAY6XQaqVRKRCfYOa6ZsT1nJGgd6k22omHj8Hfk8mNQVTsGBz0tdoxkxSOdhLcYNu88w6huIJ1KYa5WEyvMz89D0zQxLIuedP91dXVJo1oFZ658J3ZxOFR5wc7RuOwcu2lGM28H13hp0Oz1ev2oYKxUR61WF0tw6MksGo1KTlCj9rwd1Jnfl0qlVxrGy3VkMqNC3+Vyo6+vTy5Q6sOucp2RmrKr3d3dopsJsuKsz87OHjGMl+eR1XXZhR6j+6vVqoBd5GhR1/HxcfEbi57YFDLMGXlhwp2oixmpT3tO8AQmTCdQ99akxMp1zDcaCIWCLV3M2O5J5oTpRxPUlhPVpuG8aNjvdAobMuXux9nFnA4Tx9rG1JBaUb+pqSmxAHM24yRTm6P42ixTQxa0WizCjP6iNuw0Wb4L7DpvqFbBVxqGRCPqZ2rH/E3N2nHsLJOhrueEGe9B80ec88zuka15vOPw1pE5KVk9h0KhiEZzATPVD6HFYsjnx7DyySrS6UzLe28et92HLWOnJpowcjo63lfQ77DDqdqg9ljRZ++BvceCPtX2Tg1ZkBezFByIlbB9+Tp2rt3GzvUvsXvwNfZu3MXejXu4eOsb7F67jc3NzZfYass35c8Rb/H9/X252UVDxeZDl1ZFdO0RtM1vkdj7Hqn9H5G+8jOyB8+RWH+IAbf7rZvmTdCTlOBfEojOXSaU0toAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7d3d8e82dcb35c62436fc39aef509d43/748b5/img08.webp 160w\"\n              sizes=\"(max-width: 160px) 100vw, 160px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7d3d8e82dcb35c62436fc39aef509d43/065de/img08.png 160w\"\n            sizes=\"(max-width: 160px) 100vw, 160px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7d3d8e82dcb35c62436fc39aef509d43/065de/img08.png\"\n            alt=\"img08\"\n            title=\"img08\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>아래는 <strong>iframe</strong>으로 가져온건데 코드를 복사하거나 할 수 있다.</p>\n<iframe\n  src=\"https://carbon.now.sh/embed?bg=rgba%2528171%252C+184%252C+195%252C+1%2529&t=seti&wt=none&l=auto&width=680&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=true&fl=1&fm=Hack&fs=18px&lh=184%2525&si=false&es=2x&wm=false\"\n  style=\"width: 1024px; height: 483px; border:0; transform: scale(1); overflow:hidden;\"\n  sandbox=\"allow-scripts allow-same-origin\">\n</iframe>\n<p>그리고 export를 선택하면 이미지 확대 및 파일명, 확장자 등을 선택할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 361px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVQoz22RyYrUUBiFeylaVUklleFmvJXhZqwhna4eEEQQfAQRFITGnSuRxoVPJgi+gODGjeJa8RHUxSdJa0N1uzj8l/ycj3P+HCilGFQUBWXTUpQVRVFS1i1ls6KqW5q6pSpryqIcZ1uvqMqGo37HyckJk8kE0zQxDIODmaYxnU6ZaTpzJ8AMEqy4YG4JDH+JCHNM3cRzIqSvEHaIMV8QipREKg4Pu9F/BRzouq6xsGycYImXNQRVjxNIHKmIkhrHcslkzUrtWIY5ri1IohKVVfR9v5+wbVtqtSWNK/JsQyob8mVLkXUUqqfMOurskDLdUCQrimSYa043D9k0x3SH2/2E37/94OnjcwzdJo1LsrjGWtho2mxMPkj7O3Vdx7ZcHFtgmQ7rur9Z+dfP3zx/9gJ9ZpLExQj13HA0uba3p+Gb5wbjPhCS7f8Sfvn8lSePzgndjExWmObiCjbMf3IdH19E4+1CTxKIJZtmdxO4252xbU6JvAQZ5gjnMoFwg9E4QIa363jjLvITAi8m9nP69V267hrQXLikcc1Mm47pBhmGyXw+xxcxi4U13nS47fCnBw071/Y57e6z7Tb7QM+PSGXFnckthOPTqt1YcTK9PdYezINiPyX0lsggR9NnWAuH4+29m0CpGlp1RCDisc5guqwlUcvVeIbIT0miAhlkI1A4IdIvOOsfsO3W+0ARRMRRThypa8pZxgUyvnzLOMcTktcXb3j39j0fP3zi1csLlMrRNO0K+AfnxFFoxkwpGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2e94d59ee5e68b0c19fdafd14f232d9c/7c297/img09.webp 180w,\n/static/2e94d59ee5e68b0c19fdafd14f232d9c/33ecc/img09.webp 360w,\n/static/2e94d59ee5e68b0c19fdafd14f232d9c/b6ca0/img09.webp 361w\"\n              sizes=\"(max-width: 361px) 100vw, 361px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2e94d59ee5e68b0c19fdafd14f232d9c/e9ea2/img09.png 180w,\n/static/2e94d59ee5e68b0c19fdafd14f232d9c/53918/img09.png 360w,\n/static/2e94d59ee5e68b0c19fdafd14f232d9c/88969/img09.png 361w\"\n            sizes=\"(max-width: 361px) 100vw, 361px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2e94d59ee5e68b0c19fdafd14f232d9c/88969/img09.png\"\n            alt=\"img09\"\n            title=\"img09\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>잘 쓰면 유용할 것 같다.<br>\n근데 유튜브 같은데는 괜찮을지 모르겠지만…<br>\n블로그 같은데는 복붙 해야 하는 경우가 좀 있는데 이미지일 경우 또 이미지 내 텍스트 따서 긁으려면 좀 답답할 때가 있다.</p>\n<p>그래서 블로그는 그냥 코드를 올리던지 둘다 하던지 개인의 선택으로 쓰면 될 것 같다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#carbon-now\">Carbon now</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.02.03","title":"(Web) 코드를 예쁜 이미지로 변환해주는 Carbon now","categories":"utils","emoji":"📜"},"fields":{"slug":"/utils/230203_web_carbon/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/nest_js/230203_r2_nestjs/","nextSlug":"/nest_js/230129_tast_scheduling/","prevSlug":"/utils/230203_web_carbon/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}