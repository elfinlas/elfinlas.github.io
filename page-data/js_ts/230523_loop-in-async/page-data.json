{"componentChunkName":"component---src-templates-blog-post-js","path":"/js_ts/230523_loop-in-async/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab","siteUrl":"https://elfinlas.github.io","comment":{"disqusShortName":"","utterances":"elfinlas/blog_utterances"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"e3ff5141-dd06-5f4d-9d7d-5b186adec3a2","excerpt":"반복문에서 비동기를… 최근 개발 일정 및 개인 사정으로 인해 포스팅을 전혀 하지 못했다. 네이버 블로그는 일상이나 가벼운 소재라서 막 쓸수 있지만 개발 블로그는… 아무렇게나 막 싸지르는 공간도 아니고, 다른 예제 복붙하는거는 정말 싫어해서… 그래서 더 미루지 않았나 싶다. ㅎㅎ 흑우집합소 패치 내역이나 개발한 걸 TIL…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c7f6f9db4d1789eb57b2411d018c3137/a4f00/img00.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c7f6f9db4d1789eb57b2411d018c3137/77434/img00.webp 300w,\n/static/c7f6f9db4d1789eb57b2411d018c3137/d0171/img00.webp 562w\"\n              sizes=\"(max-width: 562px) 100vw, 562px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c7f6f9db4d1789eb57b2411d018c3137/a8a0d/img00.png 300w,\n/static/c7f6f9db4d1789eb57b2411d018c3137/a4f00/img00.png 562w\"\n            sizes=\"(max-width: 562px) 100vw, 562px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c7f6f9db4d1789eb57b2411d018c3137/a4f00/img00.png\"\n            alt=\"무더운 여름(?)엔 스파클링 와인과 개발을...\"\n            title=\"무더운 여름(?)엔 스파클링 와인과 개발을...\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"반복문에서-비동기를\" style=\"position:relative;\"><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%A5%BC\" aria-label=\"반복문에서 비동기를 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복문에서 비동기를…</h1>\n<p>최근 개발 일정 및 개인 사정으로 인해 포스팅을 전혀 하지 못했다.<br>\n네이버 블로그는 일상이나 가벼운 소재라서 막 쓸수 있지만 개발 블로그는…</p>\n<p>아무렇게나 막 싸지르는 공간도 아니고, 다른 예제 복붙하는거는 정말 싫어해서…<br>\n그래서 더 미루지 않았나 싶다. ㅎㅎ</p>\n<p>흑우집합소 패치 내역이나 개발한 걸 TIL 쪽에 올리려다가 이제는 따로 카테고리를 빼야 할 듯 싶다.<br>\n이것도 많이 밀렸는데 언제 적는지…</p>\n<p>무튼…<br>\n평화롭게(?) 개발을 하다가 반복문을 사용하면서 비동기 처리하다가 조금 막힌 부분이 있었다.<br>\n이번 포스팅에서는 그 문제, 그리고 조사, 해결방법을 공유하고자 포스팅을 남겨본다.</p>\n<h2 id=\"반복문에서-비동기를-쓸-때\" style=\"position:relative;\"><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%A5%BC-%EC%93%B8-%EB%95%8C\" aria-label=\"반복문에서 비동기를 쓸 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복문에서 비동기를 쓸 때</h2>\n<p>일반적으로 반복문 내에서 비동기 처리를 하는 경우는 드물게 있다.<br>\n예를 들어 특정 파라메터를 가지는 url의 데이터를 크롤링하거나,<br>\n데이터베이스에서 순차적으로 뽑아오는등… 몇 가지 케이스가 있다.</p>\n<p>근데 <strong>while</strong>이나 <strong>for</strong> 등과 같은 고전파 방식인 반복 순회에서는 비동기가 잘 동작한다.<br>\n하지만 <strong>고차함수(高次函數)</strong>의 <strong>map</strong>, <strong>filter</strong>, <strong>foreach</strong>등에서는 이 비동기가 생각한 대로 흘러가지 않는다.</p>\n<p>왜 그런걸까?</p>\n<br>\n<h2 id=\"간단한-예제부터-시작\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%98%88%EC%A0%9C%EB%B6%80%ED%84%B0-%EC%8B%9C%EC%9E%91\" aria-label=\"간단한 예제부터 시작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단한 예제부터 시작</h2>\n<p>그냥 급조한 예제 코드다…<br>\n와인의 재고를 찾는 코드가 있다고 해보자.<br>\n(여담인데 떼땅져… 6만원 밖에 안하는데 정말 맛있다.)</p>\n<p><strong>그리고 아래 코드는 <a href=\"https://www.typescriptlang.org/play\">타입스크립트 플레이그라운드</a>에서 동작하는 코드다.</strong><br>\n만약 직접 typescript 코드를 작성한다면 일부 코드에 <strong>await</strong>키워드를 붙여야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//와인 수량 저장 스토어</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//떼땅져는 10개</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//파이퍼 하이직은 12개</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//앙드레 끌루에는 21개</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//오퍼스원은 5개</span>\n    pounamu<span class=\"token operator\">:</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//푸나무는 31개</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">//찾는 시간</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">//와인 검사</span>\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnt\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span><span class=\"token string\">'opus_one'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p><strong>findTime 함수</strong>는 1~3초 랜덤으로 찾는 시간을 밀리세컨으로 생성한다.<br>\n<strong>checkWineCnt</strong> 함수는 전달받은 와인 이름으로 몇개가 있는지 조회를 한다.</p>\n<p>현실은 그냥 와인셀러 열고 꺼내면 되지만 -_-;;<br>\n뭐 그냥 샘플 예제니까…넘 억까라 해도 양해 바란다.</p>\n<p>무튼 이렇게 반복문을 안쓰는 예제에서 시작해보겠다.<br>\n만약 스토어에 있는 모든 와인을 조회해보고 싶다면 아래처럼 하단에 코드를 변경할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runFunc</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> wineList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">searchAllFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이렇게 할 경우 우리가 생각한 대로 동작을 한다.</p>\n<p><img src=\"/4dc532e83b0f514b924c0802e79b5a35/loop02.gif\"></p>\n<br>\n<h3 id=\"foreach\" style=\"position:relative;\"><a href=\"#foreach\" aria-label=\"foreach permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ForEach</h3>\n<p>근데 <strong>for</strong>를 사용하면 우리가 생각한 대로 잘 동작하지만, 고차함수를 통해서 작업을 하면 다르게 처리된다.<br>\n위와 같은 작업을 고차함수인 <strong>foreach</strong>로 바꾸면 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span>\n\n  wineList<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>이렇게 하고 결과를 보면 아래와 같다.</p>\n<p><img src=\"/fec68f491faa98cde1f4896426968883/loop03.gif\"></p>\n<p>전혀 비동기로 동작하지 않는다.<br>\n이유는 간단하다.</p>\n<p><strong>고차함수인 ForEach는 비동기를 기다리지 않는다.</strong><br>\n좀 더 정확히 이야기 하면 <strong>ForEach는 Promise를 인지하지 못한다.</strong></p>\n<br>\n<h3 id=\"how-to-solve\" style=\"position:relative;\"><a href=\"#how-to-solve\" aria-label=\"how to solve permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to solve?</h3>\n<p>뭐 간단하다.</p>\n<ol>\n<li>For loop를 사용한다.</li>\n<li>For of를 사용한다.</li>\n</ol>\n<p>1번은 맨 처음 예제에서 사용한 방식이고, 2번은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">forOfLoop</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> wineList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">forOfLoop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>뭐 좀 억지스럽긴 한 코드인데, 이해를 돕는 코드이니 넘어가자.<br>\n사실 제일 좋은 건 1번인 것 같다.</p>\n<p>굳이 비동기 루프 코드를 따로 작성하지 않고, 그냥 그 자리에서 For를 시전하면 되니까?<br>\n취향껏 쓰자.</p>\n<br>\n<h3 id=\"map\" style=\"position:relative;\"><a href=\"#map\" aria-label=\"map permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Map</h3>\n<p>이번엔 와인의 이름과 수량을 문자열로 합쳐서 만드는 것을 해야 한다고 가정하자.<br>\n결과물을 배열이고, 안에는 와인명-수량 이라는 형태로 간다고 하자.</p>\n<p>예를 들면 [taittinger-10, “piper_heidsieck-12”…] 이렇게 말이다.</p>\n<p>그럼 고차함수인 <strong>Map</strong>을 활용해서 변환할 수 있다.<br>\n아래의 코드를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> idx<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> item <span class=\"token operator\">+</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">+</span> cnt\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result = '</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>우리가 원하는 결과는 아마 <strong>checkWineCnt</strong>함수를 수행하면서 find start end 맨트가 각각 뜨고,<br>\n그 다음 마지막으로 result의 콘솔 결과가 출력되길 원할 것이다.</p>\n<p>하지만 결과는…</p>\n<p><img src=\"/7ba8651a0f60c5c63075dfdc5d87dcb3/map01.gif\"></p>\n<br>\n<p>그리고 중간에 로그를 보면 다음과 같이 되어 있는 것을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\"result = \",  [Promise: {}, Promise: {}, Promise: {}, Promise: {}]</code></pre></div>\n<p>그렇다.<br>\n전부 <strong>Promise</strong>형태로 된 배열이 있다.<br>\n즉 <strong>Map</strong>도 비동기를 처리하지 못한다는 뜻이다.</p>\n<p>물론 얘는 Promise가 왔으니 해결할 방법은 있다.</p>\n<br>\n<h3 id=\"how-to-solve-1\" style=\"position:relative;\"><a href=\"#how-to-solve-1\" aria-label=\"how to solve 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to solve?</h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnt\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> mapResult <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> idx<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> item <span class=\"token operator\">+</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">+</span> cnt\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callPromiseAll</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>mapResult<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data = '</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> data\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">callPromiseAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>위 코드를 수행하면 아래처럼 확인할 수 있다.</p>\n<p><img src=\"/79e846aae8d4b717242698ce4b7250cc/map02.gif\"></p>\n<p>보면 <strong>checkWineCnt</strong>함수의 실행은 비동기로 동작하지 않지만, 결과는 제대로 나온다.</p>\n<br>\n<h3 id=\"filter\" style=\"position:relative;\"><a href=\"#filter\" aria-label=\"filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filter</h3>\n<p>이번엔 수량이 20개 이상인 와인만 가져오고 싶다고 가정해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnt\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> filterResult <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnt <span class=\"token operator\">>=</span> <span class=\"token number\">20</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterResult = '</span><span class=\"token punctuation\">,</span> filterResult<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>이렇게 하면 앙드레 끌루에만 배열로 반환되어야 한다.<br>\n근데 결과를 보면 전체 다 반환된다.</p>\n<p><img src=\"/c89c280d74e2235be9d2b910c4d7a25a/filter01.gif\"></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> \"filterResult = \",  [\"taittinger\", \"piper_heidsieck\", \"andre_clouet\", \"opus_one\"]</code></pre></div>\n<p>이유는 이것도 Map과 비슷한데<strong>filter의 콜백은 Promise</strong>를 반환하고, 이는 언제나 <strong>true</strong>로 인정된다.<br>\n그래서 전체 다 반환되는 것이다.</p>\n<p>얘는 해결하려면 약간 코드가 너저분해지는데 map을 사용해서 처리할 수 있다.</p>\n<br>\n<h3 id=\"how-to-solve-2\" style=\"position:relative;\"><a href=\"#how-to-solve-2\" aria-label=\"how to solve 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to solve?</h3>\n<p>아래는 해결 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>v <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnt\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> promiseWineList <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> cntWineList <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>promiseWineList<span class=\"token punctuation\">)</span> <span class=\"token comment\">//[10, 12, 21, 5]</span>\n\n  <span class=\"token keyword\">const</span> filterResult <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> cntWineList<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> cnt <span class=\"token operator\">>=</span> <span class=\"token number\">20</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterResult = '</span><span class=\"token punctuation\">,</span> filterResult<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>그럼 아래와 같이 출력된다.</p>\n<p><img src=\"/c976f7cbdfb13e62fbfa99b5536ee8bf/filter02.gif\"></p>\n<p>코드가 약간 지저분해지는데 처리는 된다.</p>\n<br>\n<h3 id=\"reduce\" style=\"position:relative;\"><a href=\"#reduce\" aria-label=\"reduce permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reduce</h3>\n<p>이번엔 저 와인들의 수량을 모두 합치는 것을 해보려 한다고 가정하자.<br>\n뭐 그냥 for문 사용해서 할 수 있지만, 고차함수 중 <strong>reduce</strong>라는 것을 쓰면 더 편하게 할 수 있다.<br>\n아래는 와인 총합을 구하는 <strong>reduce</strong>를 사용한 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> sum0 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>sum<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> sum<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cnt\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>근데 이렇게 작성하면 typescript 에러가 발생할 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1096px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/f7f62/img01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQY03WPyQ7DIBBD8/8fCWHfEoiicHZrKlB76OFp7BnJ8mzWWRhjEIJ/T42UEkrJOI4DOedBKQUxxnHj5I563qnJfd/YYkzY9x1CCEgpoZRaeO9H2HVdqLWitfaXWht67wyMI1BrvQKp2dpau0Jnw88HZbWb8D4aOud+WtETBoUQxutsd57n4ttTT/88D15CFSoV/dAswAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/77434/img01.webp 300w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/411c4/img01.webp 600w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/d2558/img01.webp 1096w\"\n              sizes=\"(max-width: 1096px) 100vw, 1096px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/a8a0d/img01.png 300w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/dface/img01.png 600w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/f7f62/img01.png 1096w\"\n            sizes=\"(max-width: 1096px) 100vw, 1096px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/f7f62/img01.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<br>\n<p>뭔가 장황한 에러가 있는데 그냥 쉽게 생각하면 <strong>sum : number</strong>라는 것에 있다.<br>\nasync 함수가 되는 순간 반환은 <strong>Promise</strong>값으로 온다.</p>\n<p>저기 reduce 함수의 첫 인자는 반환 값인데 보면 쎙으로 <strong>number</strong>로 되어 있다.<br>\n또한 초기 값도 Promise가 아닌 0으로 되어 있다.<br>\n그래서 저 부분을 고치면…</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> sum <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>sum<span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> sum<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cnt\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>이렇게 바꾸면 이제 정상적으로 출력이 된다.</p>\n<p><img src=\"/19676a4266c36716d00f068124ce87b8/reduce.gif\"></p>\n<p>위 코드가 typescript라서 미연에 방지가 된거다.<br>\n만약 javascript를 사용하고 있었더라면 이상한 Promise랑 겹쳤을 것이다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>지금까지 고차함수의 일부에서 비동기를 사용할 때 문제점과 해결방법을 알아봤다.<br>\n약간 억까 예제가 좀 있었지만… 문제의 본질과 해결 방법은 충분히 전달되었을거라 믿는다.</p>\n<p>다시한번 정리하면 다음과 같다.</p>\n<ol>\n<li>foreach는 비동기를 할 수 없기에 다른 반복문을 사용하자.</li>\n<li>map은 <strong>Promise</strong> 배열을 반환하기에 <strong>Promise.all()</strong>을 사용하여 처리하자.</li>\n<li>filter는 map 등으로 처리 후 Promise.all()로 값을 변환한 후 사용하자.</li>\n<li>reduce는 typescript 사용으로 미연에 방지할 수 있으며, 반환 값의 Promise를 잘 사용하자.</li>\n</ol>\n<p>이정도로만 알고 있으면 잘 쓸수 있다.<br>\n근데 모르면 그냥 GPT한테 예제를 보여달라고 하자.<br>\n그렇다고 운영코드를 올리진 말고…</p>","frontmatter":{"title":"반복문에서 비동기 처리하기 (for, map, async, await)","date":"May 23, 2023"}}},"pageContext":{"slug":"/js_ts/230523_loop-in-async/","previous":{"fields":{"slug":"/next-js/230505_nextjs_title/"},"frontmatter":{"title":"Next.Js에서 title 태그 변경 처리"}},"next":{"fields":{"slug":"/til/230523_til/"},"frontmatter":{"title":"23년 5월 23일 개인 프로젝트 관리 (Notion, Github)"}}}},"staticQueryHashes":["3128451518","903436796"]}