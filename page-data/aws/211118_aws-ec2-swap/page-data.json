{"componentChunkName":"component---src-templates-post-jsx","path":"/aws/211118_aws-ec2-swap/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab"}},"markdownRemark":{"id":"4ab7f453-6359-5b37-8b56-7d7db69b94a2","excerpt":"최근 AWS의 EC2 인스턴스가... 현재 베타 테스트로 진행 중인 AWS의 EC2 인스턴스가 자꾸 상태이상 1/2 상태로 되면서 접속이 불가능했었다. 간헐적으로 일어나는걸 보면 뭔가 문제가 좀 심각한 거 같았다. AWS…","html":"<h2 id=\"최근-aws의-ec2-인스턴스가\" style=\"position:relative;\"><a href=\"#%EC%B5%9C%EA%B7%BC-aws%EC%9D%98-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EA%B0%80\" aria-label=\"최근 aws의 ec2 인스턴스가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>최근 AWS의 EC2 인스턴스가...</h2>\n<p>현재 베타 테스트로 진행 중인 AWS의 EC2 인스턴스가 자꾸 상태이상 1/2 상태로 되면서 접속이 불가능했었다.<br>\n간헐적으로 일어나는걸 보면 뭔가 문제가 좀 심각한 거 같았다.</p>\n<p>AWS를 잘 쓰는 타입은 아니라서...<br>\n클라우드 워치인가 모니터링 툴을 봤는데 CPU 사용률이 갑자기 치솟다가 멈춰 버리는 구간이 보였다.</p>\n<p>정확히 표현하면 내가 운영하는 서비스에 로그가 기록되는데, 일정 시간 마지막 로그를 보면 그 CPU 사용률이 튄 뒤부터 로그가 끊겼다.<br>\n그렇다고 내 서비스가 CPU 파워를 엄청 쓰는 것도 아니고...접속률은 베타라서 그렇게 많지 않다.</p>\n<p>커널 로그인가에서 메모리 관련 에러를 찾아봤지만 없었다. (근데 메모리가 범인...)</p>\n<p>도데체 뭐가 문제인가 하다가 이것저것 검색을 하던 도중 나랑 <a href=\"https://sundries-in-myidea.tistory.com/102\">비슷한 증상을 가진 글</a> 을 보게 되었다.<br>\n여기에 나온것과 같이 메모리 문제였다.</p>\n<p><strong>근데 나 같은 경우 위에서 나온 명령어는 동작하지 않았다.</strong></p>\n<p>내 환경은 <strong>Ubuntu 20.04 LTS</strong>였다. (물론 지금 베타테스트 환경은 또 다르다...)\n위 운영체제를 기준으로 작성하겠다.</p>\n<br>\n<h3 id=\"swap-생성\" style=\"position:relative;\"><a href=\"#swap-%EC%83%9D%EC%84%B1\" aria-label=\"swap 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Swap 생성</h3>\n<ol>\n<li>sudo fallocate -l 10G /swapfile</li>\n<li>sudo chmod 0600 /swapfile</li>\n<li>sudo mkswap /swapfile</li>\n<li>sudo swapon /swapfile</li>\n<li>free -m</li>\n</ol>\n<br>\n<p>위 명령어를 풀어서 설명하면...</p>\n<ol>\n<li>스왑 파일을 만드는 것 (난 대략 10Gb 정도 잡았다.)</li>\n<li>권한을 준다</li>\n<li>스왑 생성 (처리 결과는 아래 참조)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test@ip-999-99-999-99:/$ sudo mkswap /swapfile\nmkswap: /swapfile: warning: wiping old swap signature.\nSetting up swapspace version 1, size = 10 GiB (10737414144 bytes)\nno label, UUID=8a30d01e-c3b0-4ccc-bbbb-ada01aaaaac</code></pre></div>\n<ol start=\"4\">\n<li>스왑을 실행</li>\n<li>메모리 할당 확인 (아래 확인 -> 숫자는 임의로 적음 참고만..)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">              total        used        free      shared  buff/cache   available\nMem:            968         485          90           0         393         330\nSwap:         10239         260        9979</code></pre></div>\n<br>\n<p>만약 뭔가 꼬이거나 스왑을 풀어야 할 경우 다시 아래대로 해준다.</p>\n<h3 id=\"swap-해제\" style=\"position:relative;\"><a href=\"#swap-%ED%95%B4%EC%A0%9C\" aria-label=\"swap 해제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Swap 해제</h3>\n<ol>\n<li>sudo swapoff -v /swapfile</li>\n<li>sudo rm /swapfile</li>\n<li>free -m</li>\n</ol>\n<br>\n<p>보충 설명은 아래...</p>\n<ol>\n<li>스왑 해체</li>\n<li>스왑 파일 제거</li>\n<li>스왑이 풀렸는지 확인해본다</li>\n</ol>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>EC2가 갑자기 내려가는 경우는 다양한데, 이번처럼 CPU 파워를 막 치고 가다 다운되는게 메모리 부족때문인지는 몰랐다.<br>\n사실 내가 잘못 로직을 짠게 있나 싶었는데...<br>\n무튼 이 뒤로 한 4일 갔는데 아직 증상이 나타나진 않고 안정적으로 잘 되고 있다.</p>\n<p>찾아보니 스왑은 아무래도 램이 아닌 하드 또는 SSD를 쓰는 거라서 퍼포먼스에서 이슈가 발생할 수 있다.<br>\n하지만 베타테스트 운영이나 개발 목적으로는 스왑을 써도 충분한거 같다.</p>\n<p>나중에는 결국 하드웨어 스팩을 돈으로 올려야 하겠지만 말이다. ㅎㅎ</p>\n<div class=\"gatsby-highlight\" data-language=\"toc\"><pre class=\"language-toc\"><code class=\"language-toc\"></code></pre></div>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%B5%9C%EA%B7%BC-aws%EC%9D%98-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4%EA%B0%80\">최근 AWS의 EC2 인스턴스가...</a></p>\n<ul>\n<li><a href=\"#swap-%EC%83%9D%EC%84%B1\">Swap 생성</a></li>\n<li><a href=\"#swap-%ED%95%B4%EC%A0%9C\">Swap 해제</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>","frontmatter":{"title":"aws ubuntu에서 swap 메모리 설정하기 (with EC2가 갑자기 상태 이상으로 접속 및 접근 불가)","description":"Ec2에서 메모리가 부족할 때...","date":"November 18, 2021","tags":["Aws","Ubuntu","Infra"],"series":"Aws","previewImage":"aws_logo.webp","isPrivate":null,"writer":null}},"previous":{"fields":{"slug":"/node-js/211111_node-async/"},"frontmatter":{"title":"Node.js에서 request를 통해 가져온 값을 화면에 뿌릴 때 문제가 생기는 경우 (async, await... 동기/비동기에 대한 간단한 이해)","isPrivate":null}},"next":{"fields":{"slug":"/til/211207_devnote/"},"frontmatter":{"title":"21년 12월 7일 연구일지 (with SML (Save My Link) 그냥 즐겨찾기 프로그램 만든 후기)","isPrivate":null}}},"pageContext":{"id":"4ab7f453-6359-5b37-8b56-7d7db69b94a2","previousPostId":"cf122d2f-6c6c-5109-9471-c4b9614eed2b","nextPostId":"9275cbe3-201c-5cdf-8400-3e014a22da2d"}},"staticQueryHashes":[],"slicesMap":{}}