{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/next-js/230404_nextjs_in_adsense/","result":{"data":{"cur":{"id":"74742c3d-fa9e-5f5d-b27c-66e770c047d5","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQoz8XSTQ+CMAwG4G1l3SB8LAgBYhxODSYa49n//8Neww7eQaKHXt6kT5O2QgiBjesHoFQKddOgaVt0fQ+2NuYk5TqwMoy79wjDgNfljL1z2GmNh6vQGF4O1qzxLHKcUwtvGLcij1jNjCG1kEvBlAi14YhcywKHLENnDUqdYLA2Dlx1lGTe21ZXVkqBiJAQwWkNTfTJFoNz0ziOCCHg6D1OWYbgPaZpivkM//cPv6k34DvkDCc7FkQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0f378fe27c998e1f54e68293d1e77adb/7c297/thumbnail_nextjs.webp 180w,\n/static/0f378fe27c998e1f54e68293d1e77adb/33ecc/thumbnail_nextjs.webp 360w,\n/static/0f378fe27c998e1f54e68293d1e77adb/df77d/thumbnail_nextjs.webp 720w,\n/static/0f378fe27c998e1f54e68293d1e77adb/d0742/thumbnail_nextjs.webp 900w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0f378fe27c998e1f54e68293d1e77adb/e9ea2/thumbnail_nextjs.png 180w,\n/static/0f378fe27c998e1f54e68293d1e77adb/53918/thumbnail_nextjs.png 360w,\n/static/0f378fe27c998e1f54e68293d1e77adb/242a6/thumbnail_nextjs.png 720w,\n/static/0f378fe27c998e1f54e68293d1e77adb/e7448/thumbnail_nextjs.png 900w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0f378fe27c998e1f54e68293d1e77adb/242a6/thumbnail_nextjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"구글-애드센스를-달아보려\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%EA%B8%80-%EC%95%A0%EB%93%9C%EC%84%BC%EC%8A%A4%EB%A5%BC-%EB%8B%AC%EC%95%84%EB%B3%B4%EB%A0%A4\" aria-label=\"구글 애드센스를 달아보려 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구글 애드센스를 달아보려…</h1>\n<p>흑우집합소에 애드센스를 달려고 했다.<br>\n근데 ads.txt 파일만 넣었는데 뭔가 안되는거 같아서 찾아보니 대부분 Script 추가 방식을 사용했다..</p>\n<p>그래서 나도 이 방식도 같이 추가했고, 이를 포스팅으로 남긴다.</p>\n<h2 id=\"how-to\" style=\"position:relative;\"><a href=\"#how-to\" aria-label=\"how to permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How To?</h2>\n<p>먼저 <a href=\"https://adsense.google.com/intl/ko_kr/start/\">Google adsense</a>에 가입이 다 되어 있고 준비가 된 것을 가정한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 403px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5ElEQVQ4y6WU3XLaMBCF88Z9pl71EXrb3HSaNgTiBAK2MT+pDSHYWIAD2Ja+jmRjSoEQpjtzRquVdXalPfKVUoo9SwNIPXQ0TTd81DSPxpWe2LZN/e7OLPTuP/Hl6zd+h9Bo1Hhq27Se2nz/cYPrevT6A+r3FvWGRdfrmTXfD8zePJcF4WKxQMSCTGXUxy0enmGTZrxOp0xep3i9Po/NFmE0IwwjExuPX5hOQ/xgRBhFhlBKQ7g7spKy9PSouMTyPC8qvHESshwWK0Wy1qMkThTiTSESeRb6eymL+zMVfr6eYQ02/HRX3Lor40/miiCSjGbn4UeS5VqZE1WEv9wV180EZ5RhBykvsSKYyXexJdSJ3zZ/Ebb9daEWCZmEXEGyUWehSZK1Yp2qSjZlU6Bj21iWxWQywXEdlMy3bbpIh4ZQKsVw+GykoeUThiF52e2tWM/hoMJTGXf+ezhCeFurUburk6Yp1sOjqfi/KvSDgGA0MgH9EpbLhEutItTq1klkGdguFso/BXl0XhLmVRZZPb3Tpl+FIZA76H0VoZFNx6bd7hALQbPZwnFcup5noONut4vtOPQHAxbL5VFJ7d3hYDjEdbsmSxzHCDFHCIGYzwuUvpZVlmUHDdsjPPjBfrAB//pbwj8433TbMt7lmgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fd3a5cd85ec4de15ccef26230569c922/7c297/img01.webp 180w,\n/static/fd3a5cd85ec4de15ccef26230569c922/33ecc/img01.webp 360w,\n/static/fd3a5cd85ec4de15ccef26230569c922/c6e54/img01.webp 403w\"\n              sizes=\"(max-width: 403px) 100vw, 403px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fd3a5cd85ec4de15ccef26230569c922/e9ea2/img01.png 180w,\n/static/fd3a5cd85ec4de15ccef26230569c922/53918/img01.png 360w,\n/static/fd3a5cd85ec4de15ccef26230569c922/6945a/img01.png 403w\"\n            sizes=\"(max-width: 403px) 100vw, 403px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fd3a5cd85ec4de15ccef26230569c922/6945a/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>메뉴에서 사이트를 선택한다.<br>\n그리고 새 사이트 추가를 해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 423px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABl0lEQVQ4y51US07jQBD1KTgAFwCWsGED92E3S9iAhAQHYM1JWCERIEOCP8HOR7EzJHYiwsQfnO7qh7oSh4CCZGipVF2leq+eq6w2AEAphd+cAreMN4pgMBjAth14nof7ahWWZeHmpgLTNFGvP6JSqXD8aJqc0/UF2bItCMfjMdqdDoIgQLvdgdds4vb2Do3GE1zXZavV6mi1WlxTEH49C0JJhHw65S5SSuR5zp6IIITgvM7pu85pVJZlSJIEaZou7OOTwxC202B12lu2zSPw/QAOq/RQ/fvAea3+ud9Ht+vDsh08uS6CXg+O04BRdilfa77DGMubkqRASoHmnmNSn8DF8FcthJdSTqFaCV5JWJDFb4RWJNAZCvbNcGb/XiSrLTsaQ8hZ0cVVjLWDZ6z/6WPzKMT2cYiNwwG2jkK8psQ1VEahoBnh5XWCjUNNFGH3NMLe2RA7JxH2z4eYZFReYVGUThX8kUDvRbLvjgT8kUT0X86JSs4Q+sLtaUU/YiL9I5e1mcI5+2SSIE5SZG854jjhRvTDh+Mdb3cyLWacU1QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c869f9589dbf37223c50ef4828b06194/7c297/img02.webp 180w,\n/static/c869f9589dbf37223c50ef4828b06194/33ecc/img02.webp 360w,\n/static/c869f9589dbf37223c50ef4828b06194/008d7/img02.webp 423w\"\n              sizes=\"(max-width: 423px) 100vw, 423px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c869f9589dbf37223c50ef4828b06194/e9ea2/img02.png 180w,\n/static/c869f9589dbf37223c50ef4828b06194/53918/img02.png 360w,\n/static/c869f9589dbf37223c50ef4828b06194/6fe3b/img02.png 423w\"\n            sizes=\"(max-width: 423px) 100vw, 423px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c869f9589dbf37223c50ef4828b06194/6fe3b/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>추가할 사이트 주소를 작성해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 517px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVQ4y52SwW7TQBCG8xY8AW/BU3DlygWJOySkhya9xY1iONFwQ2rsxOmhvAE3kJLWDqUgiqIiWomSxLITktre9Yd2HStFoillpE87O/L8M56dQrP5Cs8b4Loug8GAw0MX1/X0vd/v30iv18PzPF7u7LC5WaGwv/8GZWE4xfd9Li8jgiBgPp9zG+t2u5TLGxSUkyQJR0cfODjoc3LyheOPxwyHQ4QQSCnXonKVtVoWpdIzCu1ORwcSCZGAWKyqCpneSCLkUrCVCe51HWLg+zhiFET404TxTPAzFIymci2TmeRsEut827Yo5oJRCvNI8j+2iITOty2LYrG0EjybJPi/sqr/wngm9feqQ5Xftpcz7HQcXSmKJbFIrydZ+VGyQnWYz1B3mAtKKUhTeS2QajI/NxXL7ru7rT87VCuQpulfUYnhQjJdZMmv3/7gvvGJR82vPDA/M5qB01YzvCKodm6d4CgUXATZzm05p9x5+I57ZZe7j9/zbSzYc2yePL3yy7d62RjO/Vg/yEUQ65iVL3a1ukWj0cAwjLXUaga15Vnf3uZ5o84Ls65P0zSpVKqa3y7cqKJb7RxBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8197b751bd9db796d45c81576e57d010/7c297/img03.webp 180w,\n/static/8197b751bd9db796d45c81576e57d010/33ecc/img03.webp 360w,\n/static/8197b751bd9db796d45c81576e57d010/df279/img03.webp 517w\"\n              sizes=\"(max-width: 517px) 100vw, 517px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8197b751bd9db796d45c81576e57d010/e9ea2/img03.png 180w,\n/static/8197b751bd9db796d45c81576e57d010/53918/img03.png 360w,\n/static/8197b751bd9db796d45c81576e57d010/3414f/img03.png 517w\"\n            sizes=\"(max-width: 517px) 100vw, 517px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8197b751bd9db796d45c81576e57d010/3414f/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 두 가지 방식으로 검증을 받을 수 있다.<br>\n여기서 원하는 방식을 선택하거나, 나처럼 하나가 안되서 다른 방식으로 인증을 해도 된다.</p>\n<br>\n<h3 id=\"1-script-인증-방식\" style=\"position:relative;\"><a href=\"#1-script-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D\" aria-label=\"1 script 인증 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Script 인증 방식</h3>\n<p>스크립트 인증 방식은 별도의 <strong>script</strong> 태그를 추가해서 인증을 받는 방식이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQ4y41T206FMBA8/x8/yPig/6AmxvjgMRwDQQ6UXqBl2462oYhyCZNsWkg7nd2dPXnvERAWq85wporfbdsiu1yQ5zmcc+MZvxsBp7QhctDlA2R2D+IVhJQ4nz9QFMV0GEjrf/jpwVPaWGtBALTsQG11SNGqwnSRyEJJgYYxOH+cLJQjiFkqdA6dUhBCwI81mxI6QLpQGNAIjbppYXSPYTDQWqPruknBFlZTjp0VPcqKoaoZvq4MDWtjtzkXUEpBjqHGYG0bH90g9MjLK7KCoWw6FJVE3wWlA4wxm2HHdFcVhvTq+gqZvaN7fYR4e4HgHNqYSBzUBJK0/np4hTCpjPYZCI4IztLMg0s450HWw22lLLWHsb9W9TsdDmRzY68qlKoHYzw2Yq+zievpMuDmVqDkKz6cpoUo1svNir2uzuOzIdw99+C9WxIOA8GY4Y/r983sZ7O9knJQlOLw2MUJG8nCvx/Cb0YmnPGHUpVlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0b7956aa21c5eb0963e9ba1ba1d46da5/7c297/img04.webp 180w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/33ecc/img04.webp 360w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/df77d/img04.webp 720w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/5c666/img04.webp 1080w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/00c56/img04.webp 1245w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0b7956aa21c5eb0963e9ba1ba1d46da5/e9ea2/img04.png 180w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/53918/img04.png 360w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/242a6/img04.png 720w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/b4ad3/img04.png 1080w,\n/static/0b7956aa21c5eb0963e9ba1ba1d46da5/ed9c8/img04.png 1245w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0b7956aa21c5eb0963e9ba1ba1d46da5/242a6/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>여기서 나온 스크립트는 바닐라js용이고, 비슷하지만 Next.Js에서는 다음과 같이 해준다.<br>\n아래의 코드를 <strong>Head</strong> 태그 내에 넣어야 하는데 보통 <strong>_app.tsx</strong>에 넣을 것이다.</p>\n<p>근데 나는 <strong>Head</strong>태그 위치가 <strong>_document.tsx</strong>라서 저 곳에 넣었다.<br>\n근데 Google analytics는 <strong>_app.tsx</strong>에 넣어도 잘 되는거 보면 크게 상관 없지 않을까 싶다.</p>\n<p>그 전에 위에 나온 사진에서 <strong>client</strong>쪽의 쿼리 값인 <strong>ca-pub</strong>을 난 따로 설정으로 빼줬다.</p>\n<p>Next.js에서 설정 파일은 .env 두고 쓰는데,<br>\n설정을 클라이언트 쪽에서 쓰기에 앞에 <strong>NEXT_PUBLIC</strong>접두사를 붙임으로써 접근 가능하게 해줬다.</p>\n<p>그래서 아래와 같은 설정을 붙여서 작성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Html</span></span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ko<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-theme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>emerald<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span>\n                        <span class=\"token attr-name\">httpEquiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span>\n                        <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IE=edge,chrome=1<span class=\"token punctuation\">\"</span></span>\n                    <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n                    //기타 meta 및 html 코드\n\n                    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Script</span></span>\n                        <span class=\"token attr-name\">async</span>\n                        <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NEXT_PUBLIC_GOOGLE_ADS_CLIENT_ID</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span>\n                        <span class=\"token attr-name\">strategy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazyOnload<span class=\"token punctuation\">\"</span></span>\n                        <span class=\"token attr-name\">crossOrigin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span>\n                    <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                    ....\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Html</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 해주면 <strong>Script 인증 방식</strong>은 끝이다.</p>\n<br>\n<h3 id=\"2-adstxt-인증-방식\" style=\"position:relative;\"><a href=\"#2-adstxt-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D\" aria-label=\"2 adstxt 인증 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Ads.txt 인증 방식</h3>\n<p>이건 1. 방식보다 더 쉽다.(?)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxElEQVQ4y42US5KbMBiEfdgcbA6Q3CKbrCcrZ5FMJWZ4SgIhQC++lGT8iidl/1UNoiSa7l9qdgDruhK8Ifg5PRJjRGt9xmlNwqPawUqI4IrP2MMXgg84Z9nv97y+fufX29sN4SPs0mLvPYu1jLJm+PENosc5zzzPee5Yj9VlhYk1WfQ+YK0j+nhn7ZGquCErTBfnHOM4Utc10zSd+xjjY4upQggZZ4WpjDGZNBH9a/Hk4oL1CvG2hydCay1K9VlhGksTmeaFeZ6e2t07Qq0HqqqiquuMomyo64aqLBFdhxAit6RtW6SUdLKnFQNlI9BmPpOeCQ+VohWKXimEVMhhQA6aru8R/UAjFbWQdKpH6JFKWQ7txJ/G0A32nnBaPGZasN5jjWGtCta2gqZkbUpI4w1rXRCNJq6RNQZ88OdeXiyPI03bIVSPalts8RtbvWPL4hZVgX0/sCiJnh1KW+bF3RIeEQnbzqW7jWDz/WO4ELKrTnt684HCn7VF9UNu+DAM+QOkuf8gbu+9fDV8epG0+uocJlh/TIvzPsctPkpHPBKLMXAQHp9+CGwKU+TS2Uv5fTZul6Ss9+cwR2dLwbNE10qvI/oXUzDk1MdRW9MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/38d54232a87e9653faed1fb43677558c/7c297/img05.webp 180w,\n/static/38d54232a87e9653faed1fb43677558c/33ecc/img05.webp 360w,\n/static/38d54232a87e9653faed1fb43677558c/df77d/img05.webp 720w,\n/static/38d54232a87e9653faed1fb43677558c/5c666/img05.webp 1080w,\n/static/38d54232a87e9653faed1fb43677558c/b495b/img05.webp 1105w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/38d54232a87e9653faed1fb43677558c/e9ea2/img05.png 180w,\n/static/38d54232a87e9653faed1fb43677558c/53918/img05.png 360w,\n/static/38d54232a87e9653faed1fb43677558c/242a6/img05.png 720w,\n/static/38d54232a87e9653faed1fb43677558c/b4ad3/img05.png 1080w,\n/static/38d54232a87e9653faed1fb43677558c/0b602/img05.png 1105w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/38d54232a87e9653faed1fb43677558c/242a6/img05.png\"\n            alt=\"img05\"\n            title=\"img05\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>저기 스니펫을 복사해준다.<br>\n그리고 Next.Js의 폴더 중에 <strong>public</strong> 디렉토리에 <strong>ads.txt</strong>라는 파일을 하나 만들어준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 154px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.038961038961034%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABtElEQVQoz42SbY7SUBhGZx0SpN/ft53SAgXEosC0FkaBYSLqmDjGqHED+sNE9+Iy3I/bOIYrQyQyIz/e3LZ578l5nvRENQNU08cLYhS/hb7+TJCN8UVC3B7Qy89Iu0N0W6AYnty9a05UK5CL0WmLupuQfP1B9/Idw1HF04srOcX0AtuPaeju8cDNcsPw8BSdsSOwrADdCVG2kBu7/1lKoHwxPPxWn3HQ5Neba149Lng0WzFfXTEq51tQcBxwt7Sx0j1CxcbQPTRbyO8b+1rDoK5aO8vbwFtDT8aNwpR7SQfn2xfSccEgL5hUS86qJeX5Jf282OvxEHRnqJg+gUio+RHJpw90yikiapMNxpSzlYydZjn3NedP37q7M/0bvBe5oTlobog6KagbLmGc4YoUzRIYTojhRth+E1ckWF58RIebOCLG/PgWJW6RD0vWr98zna85X7xktnjBcDKjevZcVnEo9h5QnnaEmYzkc61h7sW7uaRZgZw7O5RAzUYPe3S//8TslDyp5izX1+SjqbTLHoyoq/Y//+WtHcrTEtiDBVrQJk57JJ2HiDjjNO3jBM29y4cMfwNUwXEByAI8BgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b798e0640c6f6690d9d6439b5ac50fa2/f58a0/img06.webp 154w\"\n              sizes=\"(max-width: 154px) 100vw, 154px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b798e0640c6f6690d9d6439b5ac50fa2/9d5da/img06.png 154w\"\n            sizes=\"(max-width: 154px) 100vw, 154px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b798e0640c6f6690d9d6439b5ac50fa2/9d5da/img06.png\"\n            alt=\"img06\"\n            title=\"img06\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이렇게 하면 끝이다.<br>\n자신의 사이트에서 뒤에 ads.txt 접근이 가능하면 끝이다.</p>\n<p>예를 들어 abc.com/ads.txt 했을 때 저 문구가 나오면 된다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>이렇게 만든 다음 배포하면 끝이다.<br>\n물론 이렇게만 한다고 구글에 광고를 바로 내어주진 않고 검토를 하고 준다.</p>\n<p>그리고 광고가 게재될 영역도 만들어줘야 한다.<br>\n근데 이 부분은 일단 광고 승인이 난 뒤에 포스팅 해봐야겠다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#how-to\">How To?</a></p>\n<ul>\n<li><a href=\"#1-script-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D\">1. Script 인증 방식</a></li>\n<li><a href=\"#2-adstxt-%EC%9D%B8%EC%A6%9D-%EB%B0%A9%EC%8B%9D\">2. Ads.txt 인증 방식</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","excerpt":"구글 애드센스를 달아보려… 흑우집합소에 애드센스를 달려고 했다. 근데 ads.txt 파일만 넣었는데 뭔가 안되는거 같아서 찾아보니 대부분 Script 추가 방식을 사용했다.. 그래서 나도 이 방식도 같이 추가했고, 이를 포스팅으로 남긴다. How To? 먼저 Google adsense에 가입이 다 되어 있고 준비가 된 것을 가정한다.  메뉴에서 사이트를 선택한다. 그리고 새 사이트 추가를 해준다.  추가할 사이트 주소를 작성해준다.  그럼 두 가지 방식으로 검증을 받을 수 있다. 여기서 원하는 방식을 선택하거나, 나처럼 하나가 안되서 다른 방식으로 인증을 해도 된다. 1. Script 인증 방식 스크립트 인증 방식은 별도의 script 태그를 추가해서 인증을 받는 방식이다.  여기서 나온 스크립트는 바닐라js용이고, 비슷하지만 Next.Js에서는 다음과 같이 해준다. 아래의 코드를 Head 태그 내에 넣어야 하는데 보통 _app.tsx에 넣을 것이다. 근데 나는 Head태그 위치가…","frontmatter":{"date":"2023.04.04","title":"Next.Js에 구글 애드센스(Adsense) 등록하기","categories":"next-js","emoji":"📜"},"fields":{"slug":"/next-js/230404_nextjs_in_adsense/"}},"next":{"id":"88dc838e-7fb7-51b1-8879-691337b52b2c","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB4zZGdJL/AP/EABoQAAICAwAAAAAAAAAAAAAAAAABAhEQEiH/2gAIAQEAAQUCtibucu6rCP/EABYRAQEBAAAAAAAAAAAAAAAAAAAREv/aAAgBAwEBPwHSv//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAZEAEBAAMBAAAAAAAAAAAAAAABABAhIjH/2gAIAQEABj8C9jbcsxj/xAAbEAACAwADAAAAAAAAAAAAAAABEQAhMVFhkf/aAAgBAQABPyFI37Hs6XdRgYdS0FCFXiAC3P/aAAwDAQACAAMAAAAQwP8A/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAwEBPxCMEp//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QykP/xAAZEAEBAQEBAQAAAAAAAAAAAAABEQAhQXH/2gAIAQEAAT8QWGInt4cFCtTFPPmByQI0na/PJjksDmFCgeuuMhYzu//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/7c297/thumbnail_nginx.webp 180w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/33ecc/thumbnail_nginx.webp 360w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/84c6d/thumbnail_nginx.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/98e5d/thumbnail_nginx.jpg 180w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/543cd/thumbnail_nginx.jpg 360w,\n/static/498bbc62b7c7109bb1e79faf8d355cb5/40619/thumbnail_nginx.jpg 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/498bbc62b7c7109bb1e79faf8d355cb5/40619/thumbnail_nginx.jpg\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"서비스를-열어두면\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A5%BC-%EC%97%B4%EC%96%B4%EB%91%90%EB%A9%B4\" aria-label=\"서비스를 열어두면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서비스를 열어두면…</h1>\n<p>오픈을 하고나면 정말 많은 일들이 생긴다.<br>\n도메인 주소를 어떻게 알고 이상한 메일들도 오고, 다양한 방법으로 연락이 온다. -_-;;</p>\n<p>그래봤자 넷상이니까?<br>\n근데 이제 서비스 접근 로그 또는 nginx에 접근 로그를 보면 대환장 파티다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">128.90.135.254 - - [04/Feb/2023:14:03:43 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0\"\n159.223.56.86 - - [04/Feb/2023:14:17:38 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n20.231.80.56 - - [04/Feb/2023:14:24:53 +0000] \"GET /wp-login.php HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:09 +0000] \"GET /.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:10 +0000] \"POST /.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:10 +0000] \"GET /.aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:11 +0000] \"POST /.aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:12 +0000] \"GET /.aws/config HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:12 +0000] \"POST /.aws/config HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:13 +0000] \"GET /aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:14 +0000] \"POST /aws/credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:14 +0000] \"GET /credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:15 +0000] \"POST /credentials HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:16 +0000] \"GET /test.php HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:16 +0000] \"POST /test.php HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:17 +0000] \"GET /laravel/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:17 +0000] \"POST /laravel/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:18 +0000] \"GET /demo/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:19 +0000] \"POST /demo/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:19 +0000] \"GET /web/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:20 +0000] \"POST /web/.env HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:21 +0000] \"GET /phpinfo HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n109.237.98.53 - - [04/Feb/2023:14:41:21 +0000] \"POST /phpinfo HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36\"\n178.62.72.53 - - [04/Feb/2023:20:28:52 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n159.223.56.86 - - [04/Feb/2023:23:44:00 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n165.227.89.199 - - [05/Feb/2023:00:23:58 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n159.223.56.86 - - [05/Feb/2023:01:15:39 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n5.62.58.235 - - [05/Feb/2023:02:16:29 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"\n205.210.31.157 - - [05/Feb/2023:04:08:24 +0000] \"GET / HTTP/1.1\" 301 178 \"-\" \"Xpanse, a Palo Alto Networks company, indexes customer network perimeters. If you have any questions or concerns, please reach out to: scaninfo@paloaltonetworks.com.\"</code></pre></div>\n<br>\n<p>이건 내 Nginx 접근 기록에서 따온 로그 중 일부다.<br>\n저기 <strong>109.237.98.53</strong>IP 접근을 보라.</p>\n<p>파이썬이나 기타 언어로 봇 만들어서 취약점을 열심히 찾는…<br>\n참 부지런하다…</p>\n<p>난 게을러서 저런 노력도 못할 듯 싶다 -_-;;<br>\n무튼 서비스가 오픈되면 어떻게들 귀신같이 알고 저렇게 온다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQC/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQD/2gAMAwEAAhADEAAAAZM3ylOsNqUGgR//xAAcEAACAgMBAQAAAAAAAAAAAAAAAQIDERITITL/2gAIAQEAAQUC4WjosOEzd5hN7tmPYfbR/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAEDAQE/ASN//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAECAQE/AWd//8QAGhAAAQUBAAAAAAAAAAAAAAAAAAEQEUGR4f/aAAgBAQAGPwLpWlNCtLVh/8QAHBAAAgICAwAAAAAAAAAAAAAAAAERMSFRQWHw/9oACAEBAAE/Id7Q2g8GUJGGr7ZC6MG5QLLDWw//2gAMAwEAAgADAAAAEPvIAv/EABYRAAMAAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxBlP//EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQIBAT8QVlCz/8QAHBABAQACAwEBAAAAAAAAAAAAAREAUTFB4SFh/9oACAEBAAE/ECh8Pc8Yz4oHT4xNkz5G6pMcKJTRomFFXHWIF5RNZCsmkygVP76z/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3e4311ec4e2b3062af0e05a248a4cac2/7c297/img01.webp 180w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/33ecc/img01.webp 360w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/df77d/img01.webp 720w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/5ce83/img01.webp 1032w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3e4311ec4e2b3062af0e05a248a4cac2/98e5d/img01.jpg 180w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/543cd/img01.jpg 360w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/20801/img01.jpg 720w,\n/static/3e4311ec4e2b3062af0e05a248a4cac2/1c049/img01.jpg 1032w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3e4311ec4e2b3062af0e05a248a4cac2/20801/img01.jpg\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>무튼 예전부터 나는 이걸 보호할 방법을 찾았고 적용했었다.<br>\n그리고 포스팅 해야지 하다가..(아마 흑우집합소 1세대쯤이었…)</p>\n<p>그래서 이걸 이제야 포스팅 해본다.</p>\n<h2 id=\"how-to\" style=\"position:relative;\"><a href=\"#how-to\" aria-label=\"how to permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How To?</h2>\n<p>일단 nginx가 설치되어 있다는 것을 가정한다.<br>\nnginx의 기본 설정 파일을 vim이던 원하는 편집기로 연다.</p>\n<p>보통은 경로가 <strong>/etc/nginx/nginx.conf</strong> 일거다.<br>\n물론 보안을 생각하면 다른 장소로 옮겨둔 사람도 있겠지만…</p>\n<p>이 conf파일에 작성해도 좋지만 나 같은 경우 따로 빼뒀다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http {\n    ## Some Config\n\n    ## 별도 경로로 빼둔 설정파일들\n\tinclude /home/mymy/nginx/ip-block-list.conf;  #ip block\n  \tinclude /home/mymy/nginx/hack_word.conf; #Hack word\n  \tinclude /home/mymy/nginx/ip-range-block-list.conf; #ip range block\n}</code></pre></div>\n<p>저 설정파일들은 nginx에서 사용할 변수를 만들어 둔 파일들이다.<br>\n그리고 저 설정파일들은 아래서 더 자세하게 설명하겠다.</p>\n<br>\n<h3 id=\"개별-ip-막기\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%B3%84-ip-%EB%A7%89%EA%B8%B0\" aria-label=\"개별 ip 막기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개별 IP 막기</h3>\n<p>위의 <strong>ip-block-list.conf</strong> 파일에는 다음과 같이 되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip {\n    5.62.41.163 1;\n    5.62.58.235 1;\n    default 0;\n}</code></pre></div>\n<p>상단에 geo를 적고 **$**표시가 변수 이름이다.<br>\n그리고 안에 값은 밴 시킬 ip는 1을 주고, 그 외는 허용하려 하기에 0을 줬다.</p>\n<p>여기까지 하고 되면 참 좋겠지만…<br>\n이제 몇 가지 설정이 남았다.</p>\n<p>다시 nginx.conf 파일을 열거나 자신의 서비스에 맞는 설정을 빼뒀으면 그 config를 열어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n  #기본 설정\n  listen 80;\n  listen [::]:80;\n  root /var/www/html;\n\n  server_name bcow.world;\n\n  #Ban black ip\n  if ($bad_ip) { return 444; }\n\n  #Ban ip range\n  if ($bad_ip_range) { return 444;  }\n\n  #특정 url 패턴을 거부\n  if ($bad_word = 1) { return 444; }\n\n  underscores_in_headers    on;  #1. 언더형식의 헤더를 허용 합니다.\n\n  #실제 사용 처리\n  location / {\n    proxy_set_header Range $saferange;\n\n    proxy_pass http://localhost:11122334;\n    proxy_pass_request_headers\ton; ## 요청 헤더 바로 전달\n  }\n}</code></pre></div>\n<p>설정을 저렇게 해주면 된다.<br>\n<strong>if ($bad_ip) { return 444; }</strong> 이 설정으로 인해,<br>\n해당 IP는 444응답… 즉 아무 응답도 못받고 죽은 서버라는 응답을 받게 된다.</p>\n<p>만약 특정 Ip 영역대를 밴 시키고 싶다면?</p>\n<br>\n<h3 id=\"ip-class로-막기\" style=\"position:relative;\"><a href=\"#ip-class%EB%A1%9C-%EB%A7%89%EA%B8%B0\" aria-label=\"ip class로 막기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IP Class로 막기</h3>\n<p>IP는 알다시피 A클래스, B클래스, C클래스 영역으로 나눠져있다.<br>\n그리고 서브넷 등등…</p>\n<p>자세한 건 네트워크 쪽 찾아보거나 시스코의 CCNA 자격증 공부하면 줄기차게 나온다.<br>\n무튼…</p>\n<p>이번엔 위에서 설명된 <strong>ip-range-block-list.conf</strong> 설정을 열람해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip_range {\n\t# A\n\t103.0.0.0/8 1; #VN-21-11-29\n  \t185.0.0.0/8 1; #DE-21-12-27\n\n    # B\n  \t5.161.0.0/16 1; #22-01-02\n  \t45.83.0.0/16 1; #log4j\n\n    # C\n  \t77.111.247.0/24 1; #NO-21-12-16\n  \t167.172.62.0/24 1; #22-01-02\n\n    default 0;\n}</code></pre></div>\n<p>얘도 아까 단일 Ip랑 같은 설정을 가진다.<br>\n단지 A클래스일 경우 앞 대역 주소를 적고 나머진 0.0.0 즉 해당 네트워크 주소(시작 주소)를 적어둔다.</p>\n<p>그리고 뒤에 서브넷을 입력한다.<br>\nA클래스니까 당연 서브넷은 8이다.</p>\n<p>B랑 C는 A랑 같기에 설명은 생략한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 199px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 127.22222222222224%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAFa6hQNREJ1XnaQmNB//8QAHhAAAwACAQUAAAAAAAAAAAAAAQIDABIEEyIxMjT/2gAIAQEAAQUCdjbJDWC7YEIsGdlej7pXvk/TlVy1X88n5p+n/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHhAAAgIBBQEAAAAAAAAAAAAAAQIAESEDEBJBcTH/2gAIAQEABj8CZaJfliKFHUzHr7AVHsNairXRjc8FoS5wIxCxpp+7f//EAB0QAAMAAgIDAAAAAAAAAAAAAAABESExQVEQYfD/2gAIAQEAAT8hq9g466HziZLmmJ5bLoxadEqVdmyNRNAu7IGNLngve03trxPl9Go//9oADAMBAAIAAwAAABDTCwz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAhEAEAAgIBAwUAAAAAAAAAAAABABEhMUFRobEQYYGRwf/aAAgBAQABPxBospgxaldoH1nirBn5u4k1ToPBFwC0G7d59mdXHwqmkD7zKHEWC9F8dWK4NrrOj8IHDnVbb0dW2WFXilcE7h8zuHl6f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0d97179dbf34cf3d16f524aa7fce4407/7c297/img04.webp 180w,\n/static/0d97179dbf34cf3d16f524aa7fce4407/cb05f/img04.webp 199w\"\n              sizes=\"(max-width: 199px) 100vw, 199px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0d97179dbf34cf3d16f524aa7fce4407/98e5d/img04.jpg 180w,\n/static/0d97179dbf34cf3d16f524aa7fce4407/ac59e/img04.jpg 199w\"\n            sizes=\"(max-width: 199px) 100vw, 199px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0d97179dbf34cf3d16f524aa7fce4407/ac59e/img04.jpg\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>무튼 이것도 변수를 선언하고 메인 설정에서 단일 Ip 밴시키듯 아래 설정을 두면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#Ban ip range\n  if ($bad_ip_range) { return 444;  }</code></pre></div>\n<p>근데 이 블록 Ip는 잘보고 막자.<br>\n가끔 B클래스가 같은거 같아서 막 막다보면 엄한 영역도 막을 수 있다.</p>\n<p>그래서 ip조회 서비스 등을 조회해서 대상 B클래스 주소가 같은 지역 같은 호스트,<br>\n비슷한 것 같으면 그 때 막는게 좋다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVQoz22TS3LbMBBEdf9L5AC5SKpSWWSdhS1Z4hck8Rn8CEKdmiElO3YWUwAJ4qGnGzytpSCvq1TKGeS9jFut2Lbtvfi5VtRakdYN339XfPtZ0egN91qQSwGzTjEl+agctR4LZdveq2zIa0bOWUY+8Nc54sdLgrIRa04IMUqdrHO4DQqLUnB9jxSCKPkI5AN8IBBZkHcwVsO7CTVbOKef7xw5nLjF16bD+XLFcrshWPtstxytMpDIwXsH5yxGNWLWC8iTgBi4yLPfgX8uN7yeLyClkFP6R+EDGIIXIAOss1CzgjYLQiB5L/MYduC56dC3HRIRSin/BfpjIyt0ZEXRMA6Y5glqntD2HXzw7CGhHRT8PKBsZQ/nQ6qfgVzWGWijBf5Qy0DOY1fY9lBdAz+NiERfUn60zF5xzcsMY43MWS0fEqNHTBEnR4TbMEK9XWD7FnYcQPMs4QRjEJ17KpQknRW/OCQr7R+js4jxAF67Aep6wXJ9g24aeK1FaXAW67qKSgbItaG9TYZz0qz04amEwsCXa4tRT8g57X/F/f7FQ7ketAdijBYPF7OI2t1LswN9CM9f76Nnn4tbYx9jDFK82YuvJHNeSznhLzKUnhxY8kGvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dc9ea991615ab825e918c5032c2d0094/7c297/img03.webp 180w,\n/static/dc9ea991615ab825e918c5032c2d0094/33ecc/img03.webp 360w,\n/static/dc9ea991615ab825e918c5032c2d0094/df77d/img03.webp 720w,\n/static/dc9ea991615ab825e918c5032c2d0094/5c666/img03.webp 1080w,\n/static/dc9ea991615ab825e918c5032c2d0094/10f44/img03.webp 1158w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dc9ea991615ab825e918c5032c2d0094/e9ea2/img03.png 180w,\n/static/dc9ea991615ab825e918c5032c2d0094/53918/img03.png 360w,\n/static/dc9ea991615ab825e918c5032c2d0094/242a6/img03.png 720w,\n/static/dc9ea991615ab825e918c5032c2d0094/b4ad3/img03.png 1080w,\n/static/dc9ea991615ab825e918c5032c2d0094/69083/img03.png 1158w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dc9ea991615ab825e918c5032c2d0094/242a6/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이건 <a href=\"https://ip-api.com/\">IP-API</a>사이트에서 조회한 것인데 저렇게 밑에 hosting이라 되어 있으면 일단 막는게 좋다.<br>\n그리고 사진에 나온 것처럼 미국인데 asname이 텐센트…</p>\n<p>물론 클라우드를 통해 접근해서 지역은 상관 없긴 하지만…<br>\n일단 중국은 다 막자.</p>\n<p>다음은 url에 특정 키워드가 포함된 것을 잡는 것을 알아보자.</p>\n<br>\n<h3 id=\"url-keyword\" style=\"position:relative;\"><a href=\"#url-keyword\" aria-label=\"url keyword permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Url keyword</h3>\n<p>이것도 원리는 같다.<br>\n<strong>hack_word.conf</strong> 설정 파일을 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#Request Bad Word\nmap $request_uri $bad_word {\n\tdefault 0;\n\t~*(wp-includes|wlwmanifest|xmlrpc|wordpress|administrator|wp-admin|wp-login|owa|a2billing) 1;\n\t~*(fgt_lang|flu|stalker_portal|streaming|system_api|exporttool|ecp|vendor|LogService|invoke|phpinfo) 1;\n\t~*(Autodiscover|console|eval-stdin|staging|magento|demo|rss|root|mifs|git|graphql|sidekiq|c99|GponForm) 1;\n\t~*(header-rollup-554|fckeditor|ajax|misc|plugins|execute-solution|wp-content|php|telescope) 1;\n\t~*(idx_config|DS_Store|nginx|wp-json|ads|humans|exec|level|monitoring|configprops|balancer|actuator) 1;\n\t~*(meta-data|web_shell_cmd|latest|remote|_asterisk|bash|Bind|binding|appxz|bankCheck|GetAllGameCategory) 1;\n\t~*(exchangerateuserconfig|exchange_article|kline_week|anquan|dns-query|nsepa_setup|java_script|gemini-iptv) 1;\n\t~*(j_spring_security_check|wps|cgi|asmx|HNAP1|sdk|evox) 1;\n\t~*(_ignition|alvzpxkr|ALFA_DATA|wp-plain) 1;\n\t~*(ldap|jndi|dns|securityscan|rmi|ldaps|iiop|corba|nds|nis) 1; # log4j\n}</code></pre></div>\n<p>일단 내가 주로 막는 유형만 가져왔다.<br>\n저렇게 하면 url에 저 키워드가 들어가면 조건에 걸린다.</p>\n<p>내가 집요하게 로그를 분석하며 취약점 찾으려 들어온 놈들 키워드를 분석했다.<br>\n이것도 메인 설정에 박아두면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if ($bad_word = 1) { return 444; }</code></pre></div>\n<p>이렇게 하면 어느정도 취약점 찾는 놈들은 막을 수 있을 것이다.</p>\n<h2 id=\"기타\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%ED%83%80\" aria-label=\"기타 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기타</h2>\n<p>또 막는 설정은 다양한게 있겠지만…</p>\n<p>요새는 영악해서 가짜 UA 달고 오는게 예의지만…<br>\nUserAgent 공백으로 오는 무성의한 놈들도 있다. (아주 가끔…)</p>\n<p>이런 놈들은 아래 설정으로 막을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#공백 UserAgent 차단\nif (\\$http_user_agent = \"\") { return 444; }</code></pre></div>\n<p>그리고 악의적인 행위로 유명한 봇들도 있다.<br>\n이건 아래 내용을 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#Bot\nmap $http_user_agent $limit_bots {\n        default 0;\n        ~*(MJ12bot|ltx71|Adsbot/3.1/WordPress|BLEXBot|UCBrowser|Mb2345Browser) 1;\n        ~*(MicroMessenger|LieBaoFast|Headless|netEstate|PetalBot) 1;\n        ~*(bingbot|FeedDemon|GrapeshotCrawler|DuckDuckBot|MegaIndex) 1;\n        ~*(VelenPublicWebCrawler|SimplePie|YandexBot|SCMGUARD|DotBot) 1;\n        ~*(AhrefsBot|SemrushBot) 1;\n\t~*(wget|curl) 1;\n    }</code></pre></div>\n<p>이걸 또 메인 설정(또는 개인 서비스 설정)에 아래와 같이 넣어준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#불필요 로봇 차단\nif (\\$limit_bots = 1) { return 444; }</code></pre></div>\n<p>이렇게하면 일단 가드를 완전히 올린 셋팅은 아니지만 어중이 떠중이는 못들어오게 막아준다.</p>\n<br>\n<p>nginx 책도 빌렸는데 공부를 좀 해서 더 견고하게 막아보도록 노오력해봐야겠다.<br>\n아래는 범위 ip 설정을 올려본다.</p>\n<p>단일은 진짜 넘 커서…<br>\n이건 깃허브나 파일로 제공해야 할 듯 싶다.</p>\n<p>해외 서비스 하는 분은 잘 알아보고 적용하고,<br>\n국내나 국외 크게 신경 안쓰시는 분은 아래 내용을 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip_range {\n\t# A\n    #34.0.0.0/8 1; #22-07-01 => Google Bot 있을 수 있음\n\t103.0.0.0/8 1; #VN-21-11-29\n  \t185.0.0.0/8 1; #DE-21-12-27\n\t159.0.0.0/8 1; #22-04-17\n\t20.0.0.0/8 1; #22-04-30\n\t15.0.0.0/8 1; #22-06-10\n\t51.0.0.0/8 1; #22-06-27\n\t35.0.0.0/8 1; #22-07-01\n\n  \t# B\n    # 66.249.0.0/16 1; #US_21-11-15 => Google Bot 있을 수 있음\n  \t5.161.0.0/16 1; #22-01-02\n  \t45.83.0.0/16 1; #log4j\n  \t51.159.0.0/16 1; #FR-21-11-17\n  \t137.184.0.0/16 1; #22-01-02\n  \t167.71.0.0/16 1; #US(NE)-21-11-25\n  \t185.220.0.0/16 1; #log4j\n\t20.119.0.0/16 1; #22-02-02\n\t92.223.0.0/16 1; #22-04-05\n\t46.101.0.0/16 1; #22-06-09\n\t163.172.0.0/16 1; #22-06-10\n\t198.235.0.0/16 1; #22-06-28\n\t5.62.0.0/16 1;\n\t178.62.0.0/16 1;\n\t146.70.0.0/16 1;\n\t14.116.0.0/16 1;\n\t144.168.0.0/16 1;\n\t144.126.0.0/16 1;\n\t143.198.0.0/16 1;\n\t128.199.0.0/16 1;\n\t18.118.0.0/16 1;\n\t18.234.0.0/16 1;\n\t159.65.0.0/16 1;\n\t159.65.0.0/16 1;\n\t34.240.0.0/16 1;\n\t157.245.0.0/16 1;\n\t170.247.0.0/16 1;\n\t159.223.0.0/16 1;\n\t165.232.0.0/16 1;\n\t168.119.0.0/16 1;\n\t188.166.0.0/16 1;\n\t198.244.0.0/16 1;\n\t35.86.0.0/16 1;\n\t35.89.0.0/16 1;\n\t106.75.0.0/16 1;\n\t205.185.0.0/16 1;\n\t209.141.0.0/16 1;\n\t209.127.0.0/16 1;\n\t43.130.0.0/16 1;\n\t35.93.0.0/16 1;\n\n  \t# C\n  \t77.111.247.0/24 1; #NO-21-12-16\n  \t167.172.62.0/24 1; #22-01-02\n  \t171.25.193.0/24 1; #log4j\n\t92.118.160.0/24 1; #22-04-10\n\t220.181.51.0/24 1; #22-04-12\n\t95.142.120.0/24 1; #22-04-25\n\t5.188.62.0/24 1; #22-05-10\n\t116.179.33.0/24 1; #22-06-10\n\n\t92.223.85.0/24 1;\n\t93.158.91.0/24 1;\n\t93.158.90.0/24 1;\n\t36.99.136.0/24 1;\n\t111.7.100.0/24 1;\n\t117.187.173.0/24 1;\n\t156.146.35.0/24 1;\n\t185.54.229.0/24 1;\n\t185.27.99.0/24 1;\n\t185.181.60.0/24 1;\n\t198.235.24.0/24 1;\n\t205.169.39.0/24 1;\n\t205.210.31.0/24 1;\n\t208.80.194.0/24 1;\n\t111.7.100.0/24 1;\n\t205.210.31.0/24 1;\n\t51.222.253.0/24 1;\n\t89.187.163.0/24 1;\n\t95.142.120.0/24 1;\n\t42.83.147.0/24 1;\n\t54.36.148.0/24 1;\n\t64.43.117.0/24 1;\n\t191.102.179.0/24 1;\n\t199.244.88.0/24 1;\n\n  \tdefault 0;\n}</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#how-to\">How To?</a></p>\n<ul>\n<li><a href=\"#%EA%B0%9C%EB%B3%84-ip-%EB%A7%89%EA%B8%B0\">개별 IP 막기</a></li>\n<li><a href=\"#ip-class%EB%A1%9C-%EB%A7%89%EA%B8%B0\">IP Class로 막기</a></li>\n<li><a href=\"#url-keyword\">Url keyword</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B8%B0%ED%83%80\">기타</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.04.01","title":"Nginx에서 특정 IP 접근 금지 시키기 (With Url 문자열 접근 막기)","categories":"nginx","emoji":"📜"},"fields":{"slug":"/nginx/230401_defense_attacker/"}},"prev":{"id":"b863dbc5-e3fa-504b-a5a5-c45eb7c2c86d","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQoz42S0Y6CMBBFW6Cl0GmhxYorrJpAsolP+v8fdzetrqtmxX24GToZztxOhzHGcC+vCEOzwqA9drTCJ3XYmRX2NuDQrJN647A2LYzSeP6fPSciQBTir8KknGegvESTqwRXolwGRmdK/haFEDBNE7bDAOf9Q+26btCWehkYryfy4nbWWmMcxwQmopTjjF+aVRauomVgnFWeZQ85znnSc21XEnxtl4FxLnFOPyApZXJpjEFd18jumnmp0Wn7D4dXYLziPM84Ho84n844n06pwc2hJHS6eePQBpTi8srRTV4UYJwl5fLx9Z3UCNQuA3tlMbuPtIss42grwtZ22BiHnlz6vpw9Dm2PWqpl4A1cWXyFEVRWqLmAzmQSpShSLHnxfrH5NZJQmNzm5YK/0jegveteJRG0qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/7c297/thumbnail_til.webp 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/33ecc/thumbnail_til.webp 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/df77d/thumbnail_til.webp 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dd3ab/thumbnail_til.webp 895w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/e9ea2/thumbnail_til.png 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/53918/thumbnail_til.png 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png 895w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"흑우집합소에-애드센스를-준비하던-도중\" style=\"position:relative;\"><a href=\"#%ED%9D%91%EC%9A%B0%EC%A7%91%ED%95%A9%EC%86%8C%EC%97%90-%EC%95%A0%EB%93%9C%EC%84%BC%EC%8A%A4%EB%A5%BC-%EC%A4%80%EB%B9%84%ED%95%98%EB%8D%98-%EB%8F%84%EC%A4%91\" aria-label=\"흑우집합소에 애드센스를 준비하던 도중 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>흑우집합소에 애드센스를 준비하던 도중…</h1>\n<p>혹시 Next.Js에서 애드센스를 다는 것이 궁금하면 <a href=\"https://elfinlas.github.io/next-js/230404_nextjs_in_adsense/\">Next.Js에 구글 애드센스(Adsense) 등록하기</a>포스팅을 참고하자.</p>\n<p>뭐 아직 이르긴 하지만 구글 광고를 달려고 <strong>Adsense</strong>를 신청했었다.<br>\n근데 신청 후 몇일 뒤 아래와 같은 메일이 왔다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACD0lEQVQoz22Qy2oUQRSG+wH0DRQVvAQCEs0D6EIZDbrRpcSF4sKgi+AkjkMC6koxcYzgVlcBidGtoG58AJeKoCaKk+nqnurqnu659+WTrp6O48SCv85/zqn6z8W4+sLlxMM6U08khceSsxXJ6aUMZwb+VCXj51cc7afv8lxhWXJqSTJ536byLsA4fs9m90yNsbLgwLzg8B3BkbJgfMHSdl9RMFa2OFgSTN619Zu9RcGhUvZ2zy2TXTM1jEtVbq56GKnq7MsGpdcBt1OsB5qnmH/lU1xraMwNbM6HUVr3ubHq8eZTGwMg7vqI3z+wqhtYW5uI6gZ27ScNWaPpWvhK0HBMvNT3bALXot9yddwfxCFMpTDiBFrtDo7jUjMFll3HFJa20lGEUUwYJQOb8ShFnAziWS714yTJOgyCANMUmKaJqxS210OqAKUcHKV0zPV8TNnEdT2klHiep2HbNkop4jjOOkyvXq9Hq9XSwmEYkuhUdrODQ5IkJElu/0IL5mT4tLsRTpAjK9Bpt1h7/gzfU9uioyfJRx6t0uyE/Kr3+brVx25ky067fzp3jermd+3nIw7/2x55uIL+3Imw/WgQyz4uLi4wcWycixfOIWrVf0SHz38FpR/y4UsXy4+oBzGdXsTK7GUKE/uZPnkU8e3ztuDo6MbIEvS+oigeCmX84/u3XL8yzfKjB0Rhf8eacsE/EGNUNbME/bwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2bd71ecdb5ca03106b439fda5f24d760/7c297/img01.webp 180w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/33ecc/img01.webp 360w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/df77d/img01.webp 720w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/88613/img01.webp 771w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2bd71ecdb5ca03106b439fda5f24d760/e9ea2/img01.png 180w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/53918/img01.png 360w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/242a6/img01.png 720w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/f0a60/img01.png 771w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2bd71ecdb5ca03106b439fda5f24d760/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>뭐가 문젠지 봤더니 승인 상태 옆에 저렇게 찾을 수 없음이 뜬다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 579px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVQY03WOyQ7CMAxE8//fiBBIRU1omrVZuqSD4l5KKJbmYM/YzwxN7fv+o6v6l2OlFJzVHqh9mzlyDQCgOWvJ67pCCIG+51BKIed8+WGMEZxzSCnRdS947wnOtq3g0EaEZVnItM5hmibM80zeVr5zKWcobWCdhzEWMSbyWCWdFULEIEdoY+i7lBLaTEwJwRvo4Y5R3OB0T+DqsbpwVh3KUUFrc/SNfygjTBZqeEK9H7CaE7we/ABwbdT/GBze0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1dda1503c7e2cd7f16c3b09bd33f92e5/7c297/img02.webp 180w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/33ecc/img02.webp 360w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/96ba3/img02.webp 579w\"\n              sizes=\"(max-width: 579px) 100vw, 579px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1dda1503c7e2cd7f16c3b09bd33f92e5/e9ea2/img02.png 180w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/53918/img02.png 360w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/ff2d6/img02.png 579w\"\n            sizes=\"(max-width: 579px) 100vw, 579px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1dda1503c7e2cd7f16c3b09bd33f92e5/ff2d6/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h2 id=\"문제는-쉽게-찾을-수-있었다\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%89%BD%EA%B2%8C-%EC%B0%BE%EC%9D%84-%EC%88%98-%EC%9E%88%EC%97%88%EB%8B%A4\" aria-label=\"문제는 쉽게 찾을 수 있었다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제는 쉽게 찾을 수 있었다.</h2>\n<p>먼저 ads.txt에 접근이 되어야 하는데 이상하게 접근이 되지 않았다.</p>\n<p>일전에 <a href=\"https://elfinlas.github.io/nginx/230401_defense_attacker/\">Nginx에서 특정 IP 접근 금지 시키기</a> 포스팅을 하면서 뭔가 본거 같기도…<br>\n그래서 포스팅을 확인해본 결과…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">~*(idx_config|DS_Store|nginx|wp-json|ads|humans|exec|level|monitoring|configprops|balancer|actuator) 1;</code></pre></div>\n<p><strong>Url Keyword</strong>방식을 적은 부분에서 <strong>ads</strong>단어가 있었다…</p>\n<p>이래서 <strong>ads.txt</strong> 파일에 접근이 불가능했던 것이다.<br>\n그래서 접근 확인을 한 후 재검토를 신청했다.</p>\n<h2 id=\"응-거절이야\" style=\"position:relative;\"><a href=\"#%EC%9D%91-%EA%B1%B0%EC%A0%88%EC%9D%B4%EC%95%BC\" aria-label=\"응 거절이야 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>응 거절이야~</h2>\n<p>또 저 해맑은 아저씨 메일이 왔다 -_-;;<br>\n그래서 몇개 생각을 하다가 Nginx에서 막은게 문제겠지 싶었다.</p>\n<p>그러다가 하나 생각이 난게 IP 접근에서 뭔가 있었던 것 같았다.<br>\n그래서 불법 침입 시도를 확인할 겸 접근 로그를 보다가…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">66.249.66.65 - - [03/Apr/2023:00:22:03 +0900] \"GET /robots.txt HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\"\n66.249.66.89 - - [03/Apr/2023:00:24:00 +0900] \"GET /robots.txt HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\"</code></pre></div>\n<p>그렇다…<br>\n내가 구글 봇 클라이언트를 막은 것 같았다…</p>\n<p>근데 구글 봇 클라이언트가 저거 하나만 돌지 아니면 여려 개 돌지 확인할 수 있는 방법이 없었다.<br>\n그럼 궁금하니 <strong>ChatGPT</strong>에게 기대를 걸고 물어봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.44444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVQ4y5VUia7jIAzM/3/g9sp9NSe52yZp69VMoIe0T0+LNDIYMMYe2xrHUYqilKqqiVoprtM0k3meBeP5fP4KM6zH4yH3+10e94dgbrCuq/zPMIattuulqhvpul6appWm6aSuG0qlWqJpt3mtGlH6DPcbrVOtjONFpukqVpJmcjg64nqhOG4gx5Mrf/YnSqP3/Ehcb9s72Z6cHJ9ngd3+xP1puhBWlpey29uyP9i8vDvYYruBeEHEg3FyljBKxQ9iSZJMwiihIT+IqLMdX2Bjnhe5Xm9iVZWSOD7LOSskLypewhdut5kH/oXPvZuWl8uVsJZ5kXVZZVkWjZWvIcNv+QaMAZ/rz7MWaKNUI30/EG3bMUF931M/DKN0fU8d8NuwcLEsKyLPC3IQwNrws64VZVnV1MGrn/hpgYPg3Of3zPehRwggiWVlzMDTHz1EIE3KDcZx0nKbv9cTA48wAFh3/cA96Jnl87kgPYIwJh0wt7X0/I2DoAYkOAid2Q/CRI62R1YMw0QHSGxwCpvGAPgFTpoL0DteoPm37eEOJB5r256hoofpOWcFgLDGGEkbxtqjSA5H9+2l49PD/dGhRNl+8TBOspdB8xXX37wD2VEFQFGABaUgRGVZCxwpyvpF8FcM0QhwAYfKSrHYCz03STKvG4xaP4yToLlgboyylm3XZ1JMoFG7rg4+4kT44fZdx2dYcu15Vatvgyh+dBVT6FtnCV/dhAnRho0xxJhfRu2nGY2+DCJOaEGmTUVxSi8hsYa3GwOM99ucj/ghWZCmOauHBtEk8RqSgxdRMe8GoKvnowF87y2yaJ1Jyl+LK+oq6r+lsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5842486a061f8ea2a4c91efc594534e0/7c297/img03.webp 180w,\n/static/5842486a061f8ea2a4c91efc594534e0/33ecc/img03.webp 360w,\n/static/5842486a061f8ea2a4c91efc594534e0/df77d/img03.webp 720w,\n/static/5842486a061f8ea2a4c91efc594534e0/c7309/img03.webp 754w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5842486a061f8ea2a4c91efc594534e0/e9ea2/img03.png 180w,\n/static/5842486a061f8ea2a4c91efc594534e0/53918/img03.png 360w,\n/static/5842486a061f8ea2a4c91efc594534e0/242a6/img03.png 720w,\n/static/5842486a061f8ea2a4c91efc594534e0/a0d62/img03.png 754w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5842486a061f8ea2a4c91efc594534e0/242a6/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>한글과 영어로 물어봤지만…<br>\n자기도 모른다 한다.. -_-;;</p>\n<p>그래서 직접 내가 찾아봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYElEQVQ4y51UaW8TMRD1//+IQEUUWlXhUoVoaVIov6C0iB65s6S5uptk78u5N3loZuMkqhKEsPTksdd+8+ZYi+urK7zNZPDj8hJxHGOxAJIkQZLMMOc54X0pJQaDAWQsIeM4taVc7dOZyWQCcfE1i/PcKXJnn3GePcH3iyzbZ6fHyH35xDbhW+4Exx8OcfTmBd5n9vHx3SGODl7i4PVeilfPsb/3DOL29ifu729w8+sapeIdGg8atFoZv7Uqo1Yto1wq4KFeQ61aQqVcQLVSQLVcRKmYX6FcyqOYv4PwfA9xHIFmCuV/B6dqPofQahpc14VlmTB0Hbquo9vtwjAMhrJpTr8ZPNNer9eFZVswTRO2Y2M6nUI0m03Yts2bhqEvkZLphp6CCLoGHvVHXitSuuM4NkzL5AipgII2Pc+DZVlLrz2GsaFkU6lyyIoNne+5rsPzcDSEoMtUeprbnTareOx0OJx+v78COSaQTWeVTepMsw/f9zGbzSA816OUwglMJqZeGo/H3IOLxeKvmM/nK1sNEQQBHMeBlNsrTF7Je7zsgM3L6wqvnYhKpbLKBxFTpXYp2kb0dC00TWMFaetYiKLon5Rsc8aE1DL0L1Lo8UZjj0YjTr4qAn3fRUr3wiDCMJIQioAUUvuoQQVqt9vcOo1Gg6u6K8wwDOC6PqQfQigvREihbyNstVqcjqcK1ZrS5HkBBn60JqSCEKgVaFAY9Bd1Oh3U63UOe1feAlLo+JDehkL15qlBvUgOSDmFG4bhjkdhsXonx7FMCWmoht58NIfDIReHQDadITvZ0vSqyn8AY3hRIitcsaIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b9208c94e6578c63a2edab4e3bd94d64/7c297/img04.webp 180w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/33ecc/img04.webp 360w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/df77d/img04.webp 720w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/3300c/img04.webp 972w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b9208c94e6578c63a2edab4e3bd94d64/e9ea2/img04.png 180w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/53918/img04.png 360w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/242a6/img04.png 720w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/84a58/img04.png 972w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b9208c94e6578c63a2edab4e3bd94d64/242a6/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>근데 다 나오진 않고 일부만 주고 정보를 파는 사이트였다.</p>\n<p><a href=\"https://searchengineland.com/google-publishes-the-list-of-googlebot-ip-addresses-375935\"></a></p>\n<p>그래서 21년도 자료긴 한데 <a href=\"https://searchengineland.com/google-publishes-the-list-of-googlebot-ip-addresses-375935\">구글봇 주소 정보글(영문)</a>에서 약간의 정보를 찾을 수 있었다.<br>\n저 본문 중 구글 봇의 범위 주소 (IpV4(서브넷으로 나뉨), IpV6)를 <a href=\"https://developers.google.com/search/apis/ipranges/googlebot.json\">공개한 구글봇 주소 공식 api</a>를 확인해봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 498px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQ4y62U2W7EIAxF5///MA95yFv2fd+ojqU7Qm2STqVG8hjM+HIAw2vbNneepzuOw2xdV0cMvyyLted5NiOGqU8eH17tFz95nrsgCFwYhi6KItd1nZumyWVZ5pqmMV8Uhavr2vppmlrfF9RnguM42p+qqnon9n1vNIzRbtvWJsKgI86kPwjVYGl8JEKBKEsmkZhvwzCYIXwpiJG477sJlWVptCSQyAT0GcNEjb8lBB9BBPgzniUT92MY5MTxt4LQIAgd+4gniT3T3hLDiGnpt4IQXBFqH0VHW4SM3woySB1SQpQJniRIoKIPJQYh+8rEj4QIigYxTl40ohOhCv1fCFVaj4QQsIf+folQZH8i9E8ZmqdT1s15POXvdair59ehjMmJ394Uf8ncBN0K/+rpYRCZhH89FMR09bRkTSJjEuIfFbYOBe8fil82ehM/KhuesTiOrXRIho5DSpLExvTMYVDeCjIIoQw6veL0r9pXD+wXEYDIRe/C07AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/267c080f6e6669d2c83b7021429971b0/7c297/img05.webp 180w,\n/static/267c080f6e6669d2c83b7021429971b0/33ecc/img05.webp 360w,\n/static/267c080f6e6669d2c83b7021429971b0/b042d/img05.webp 498w\"\n              sizes=\"(max-width: 498px) 100vw, 498px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/267c080f6e6669d2c83b7021429971b0/e9ea2/img05.png 180w,\n/static/267c080f6e6669d2c83b7021429971b0/53918/img05.png 360w,\n/static/267c080f6e6669d2c83b7021429971b0/c365b/img05.png 498w\"\n            sizes=\"(max-width: 498px) 100vw, 498px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/267c080f6e6669d2c83b7021429971b0/c365b/img05.png\"\n            alt=\"img05\"\n            title=\"img05\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>일단 최신 자료이고, 하단에 ipv4 정보도 있었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 462px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVQ4y5WUi66DIBBE/f8f9Vm1ttXWR/fmkIzZEKpekw0I7nAYFjMzs+/3a+/32+Z5tqIorCxLq+vans+njeMY+m3bhmiaxvq+N+UR/sk0QfK6rrvI6/UKCyzLYtM0hQUVjJ8KksSH0EABDcKM07/f7zYMQ5ijvUz4eDyCEO+eUCFy5cVPFnsIAXG73UIyIl3XBUL5yByLp0R3Qci2bdsJvYe8syDi6kvop+Dn8wkhOhEiIEKCPpSe0IsmCRGKCUXHOISnHh4RUnecLIT0maN/SEhCipCtxR5SAZ4yKUiyJ1QdIkxfPtIydrpleQgpCb4O5aFuDN95wSShPOSmeA9jQt3n0y2LEDIdBnSpu8zCnu6QUH8aQoTylBPWTeHbS4TeLxF6MrXex0PCPM8DJcH2CfmKj7R4eJlQfpFADRJaTKX1b0L9tUVYVdVen/L39JRJZFX9so48jGvRC/4B5CUaCAizXmQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4841cd42400ec3d9bb8e31bc69cdbacc/7c297/img06.webp 180w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/33ecc/img06.webp 360w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/0b6e4/img06.webp 462w\"\n              sizes=\"(max-width: 462px) 100vw, 462px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4841cd42400ec3d9bb8e31bc69cdbacc/e9ea2/img06.png 180w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/53918/img06.png 360w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/a9e02/img06.png 462w\"\n            sizes=\"(max-width: 462px) 100vw, 462px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4841cd42400ec3d9bb8e31bc69cdbacc/a9e02/img06.png\"\n            alt=\"img06\"\n            title=\"img06\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그래서 저기 나온 주소를 토대로 내가 막은게 있나 봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip_range {\n\t# A\n    34.0.0.0/8 1; #22-07-01 => Google Bot 있을 수 있음\n\t103.0.0.0/8 1; #VN-21-11-29\n  \t185.0.0.0/8 1; #DE-21-12-27\n\t159.0.0.0/8 1; #22-04-17\n\t20.0.0.0/8 1; #22-04-30\n\t15.0.0.0/8 1; #22-06-10\n\t51.0.0.0/8 1; #22-06-27\n\t35.0.0.0/8 1; #22-07-01\n\n    # B\n    66.249.0.0/16 1; #US_21-11-15 => Google Bot 있을 수 있음\n  \t5.161.0.0/16 1; #22-01-02\n  \t45.83.0.0/16 1; #log4j\n}</code></pre></div>\n<p>그렇다…<br>\n범위 계열에서 A클래스 주소 중 34 주소를 다 막아버린 것이다… -_-;;;</p>\n<p>그리고 B클래스에서도 막은 곳이 있었다.<br>\n얼른 이 부분은 주석 처리 후 Nginx를 리스타트 했다.</p>\n<p>C 클래스에는 다행히 없었다.<br>\n그리고 각 Ip 밴 시킨 부분도 몇 개 검토해서 다시 풀었다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>이제 한번 기다려보면 될 것 같다.<br>\n근데 구글 문서에서 몇 가지 찾은 정보가 있는데, 유저 에이전트를 확인하라고 한다.</p>\n<p><a href=\"https://developers.google.com/search/docs/crawling-indexing/overview-google-crawlers?hl=ko\">Google 크롤러(사용자 에이전트) 개요</a> 페이지를 참고하자.<br>\n그리고 <a href=\"https://developers.google.com/search/docs/advanced/crawling/verifying-googlebot?hl=ko#use-automatic-solutions\">Googlebot과 다른 Google 크롤러 확인</a> 이라는 문서도 있다.</p>\n<p>여기에 의하면 <strong>host</strong> 명령어를 통해서 해당 에이전트를 확인하라고 하는데 아래와 같이 확인이 가능했다.\n먼저 역방향 DNS를 조회해본다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 628px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.111111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAATUlEQVQI1x3HQQqAIBRAwW4UhhF9U4RScZN0nWgThHTrF7kaprtEU0XxyMA99VQ78ori9IYQC1sspHywhr1pbESWwGxC87/zGWMTg3Z83yckn+vsoPgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/af4dde69d25370a589d3bcf6ed8f425b/7c297/img07.webp 180w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/33ecc/img07.webp 360w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/189c6/img07.webp 628w\"\n              sizes=\"(max-width: 628px) 100vw, 628px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/af4dde69d25370a589d3bcf6ed8f425b/e9ea2/img07.png 180w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/53918/img07.png 360w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/5e4bf/img07.png 628w\"\n            sizes=\"(max-width: 628px) 100vw, 628px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/af4dde69d25370a589d3bcf6ed8f425b/5e4bf/img07.png\"\n            alt=\"img07\"\n            title=\"img07\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 domain name에 google-proxy-…값이 뜨는데 이 값을 이용해 순방향 DNS를 조회해본다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 542px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.777777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiElEQVQI1z2NWwqCUAAF3UHlIswtBFFimt6Xz6uYeYugDVrtbyI/+jgMzMccb95umIM179D/7xX6fIIV025PLC3HSKBMh1AtcWJIs5JDJBGyJc0qknOJ1BalO7y7KphyxSUV3KTBCb3wWTWMvaO20xJr2iu66BnGB7ZznBKzHPxcltfY3hHFii/oQkyMOz0DgQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/79cfa149a4df418abb89030d87401672/7c297/img08.webp 180w,\n/static/79cfa149a4df418abb89030d87401672/33ecc/img08.webp 360w,\n/static/79cfa149a4df418abb89030d87401672/535ba/img08.webp 542w\"\n              sizes=\"(max-width: 542px) 100vw, 542px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/79cfa149a4df418abb89030d87401672/e9ea2/img08.png 180w,\n/static/79cfa149a4df418abb89030d87401672/53918/img08.png 360w,\n/static/79cfa149a4df418abb89030d87401672/47f85/img08.png 542w\"\n            sizes=\"(max-width: 542px) 100vw, 542px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/79cfa149a4df418abb89030d87401672/47f85/img08.png\"\n            alt=\"img08\"\n            title=\"img08\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 처음 접근한 주소의 IP와 순방향 조회 IP를 비교해서 같으면 된다.</p>\n<p>근데 <a href=\"https://developers.google.com/search/apis/ipranges/googlebot.json\">공개한 구글봇 주소 공식 api</a>문서를 통해서 자동으로 차단 처리를 할 수 있을 듯 한데…<br>\n이건 좀 나중에 해봐야겠다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%89%BD%EA%B2%8C-%EC%B0%BE%EC%9D%84-%EC%88%98-%EC%9E%88%EC%97%88%EB%8B%A4\">문제는 쉽게 찾을 수 있었다.</a></li>\n<li><a href=\"#%EC%9D%91-%EA%B1%B0%EC%A0%88%EC%9D%B4%EC%95%BC\">응 거절이야~</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.04.04","title":"23년 4월 3일 TIL & 개발노트 (Google Bot)","categories":"til","emoji":"📜"},"fields":{"slug":"/til/230403_til/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/next-js/230404_nextjs_in_adsense/","nextSlug":"/nginx/230401_defense_attacker/","prevSlug":"/til/230403_til/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}