{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/next-js/230505_nextjs_title/","result":{"data":{"cur":{"id":"3f357e9a-fa0f-59b4-8a40-6fdb24afc4ac","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQoz8XSTQ+CMAwG4G1l3SB8LAgBYhxODSYa49n//8Neww7eQaKHXt6kT5O2QgiBjesHoFQKddOgaVt0fQ+2NuYk5TqwMoy79wjDgNfljL1z2GmNh6vQGF4O1qzxLHKcUwtvGLcij1jNjCG1kEvBlAi14YhcywKHLENnDUqdYLA2Dlx1lGTe21ZXVkqBiJAQwWkNTfTJFoNz0ziOCCHg6D1OWYbgPaZpivkM//cPv6k34DvkDCc7FkQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0f378fe27c998e1f54e68293d1e77adb/7c297/thumbnail_nextjs.webp 180w,\n/static/0f378fe27c998e1f54e68293d1e77adb/33ecc/thumbnail_nextjs.webp 360w,\n/static/0f378fe27c998e1f54e68293d1e77adb/df77d/thumbnail_nextjs.webp 720w,\n/static/0f378fe27c998e1f54e68293d1e77adb/d0742/thumbnail_nextjs.webp 900w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0f378fe27c998e1f54e68293d1e77adb/e9ea2/thumbnail_nextjs.png 180w,\n/static/0f378fe27c998e1f54e68293d1e77adb/53918/thumbnail_nextjs.png 360w,\n/static/0f378fe27c998e1f54e68293d1e77adb/242a6/thumbnail_nextjs.png 720w,\n/static/0f378fe27c998e1f54e68293d1e77adb/e7448/thumbnail_nextjs.png 900w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0f378fe27c998e1f54e68293d1e77adb/242a6/thumbnail_nextjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"nextjs에서-title-태그를-처리하기\" style=\"position:relative;\"><a href=\"#nextjs%EC%97%90%EC%84%9C-title-%ED%83%9C%EA%B7%B8%EB%A5%BC-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B8%B0\" aria-label=\"nextjs에서 title 태그를 처리하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.Js에서 Title 태그를 처리하기</h1>\n<p>이번에 <a href=\"https://bcow.world\">흑우집합소</a>를 <a href=\"https://searchadvisor.naver.com\">네이버 서치 어드바이저</a>에 등록했다.<br>\n그리고 데이터를 등록하다가 <a href=\"https://searchadvisor.naver.com/tools/sitecheck\">사이트 간단 체크</a>에 돌렸는데 사이트 제목이 미설정이라 떴다.</p>\n<p>그래서 확인해보니 정말 설정이 안되어 있었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 81px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.0246913580247%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVQoz62SyU4CQRCG5zGMxmiiBlFkcWAYZl/YDFsGAVkEBhCVGA/G+AQmejIE9SGMPuRvuhAEEj3N4Ut1VXf/VV3VXK7kwEs4UdHgJZxiWPASElRNewkWk3WTmPmre4t2Mc5F4wnwgoi4pBBhPgZJM+YCUVGip8QSMgRJobVuJedi7CzbS6j6tMJghMfa+gaJ7vr82NzapkPZfBGjm1u03T6cSg3d/gVqjRZaHReNdgdmKoO4rKJcPcPg8grVenPaQ5bJd3CISFTA/mEAx4IISTORPsnhZTzB49MzJm/vuLt/IDuevKLt9mCls1Txaa2Oj88vSsR8TrdT8AeOSHRnz0dZZMOCYadQbTThDoZ0idnh9Qjn3R4yuQI0K0nPLDhl5EsOiuUK+TQUVnogFKYqaVo/A2Fx1h+ykkL9ZFWwi7MeLn4Z6qFsmFBMmzKqVnLpC6xOf3HSS5hTZBLUDEjqL8z/C0n7f5/BBUM8vOQbOTCpAE9mxpgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/bb8da0faa18dcee4740f9466d3ebe146/3e898/img01.webp 81w\"\n              sizes=\"(max-width: 81px) 100vw, 81px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/bb8da0faa18dcee4740f9466d3ebe146/bc658/img01.png 81w\"\n            sizes=\"(max-width: 81px) 100vw, 81px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/bb8da0faa18dcee4740f9466d3ebe146/bc658/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그래서 이것을 수정하려고 자료를 찾아서 적용했다.<br>\n방법은 간단한데 <strong>각 페이지마다 Title 태그를 적용</strong>하는 법과 <strong>전역으로 설정하는 법</strong>이 있다.</p>\n<h2 id=\"1-각-페이지마다-title-처리\" style=\"position:relative;\"><a href=\"#1-%EA%B0%81-%ED%8E%98%EC%9D%B4%EC%A7%80%EB%A7%88%EB%8B%A4-title-%EC%B2%98%EB%A6%AC\" aria-label=\"1 각 페이지마다 title 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 각 페이지마다 title 처리</h2>\n<p>각 페이지마다 Title을 변경해야 할 때가 있다.<br>\n나의 경우 메인과 각 페이지가 다르게 설정해야 했다.</p>\n<p>메인은 아래처럼 진행해야 했고…</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 255px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtUlEQVQI1y2NTWvCQBRF818qdFfBJPM9yWSCiaigi+IiFptCLO1K6P+HU2ZwcXi8ew/cQhlPQmhHJTSVMJS1ppYGmTNDLe3zGqpE9jRC2eykXrsGFyJFWUpeVq/4JrLcf5jnhcfjj/P5HW0a5q+Fy2Xi/v3L9eOT6XrL3jTd2B9OaOMZd0eU9tjQUaSlt/UGqRyxH+niwDAeaNo+Z+lPY7EfaENP6LbZSzgfENJiXUAoh207/gG17mpO5CCvCwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9b40ca5d4be654cbb4b06081d3082572/7c297/img02.webp 180w,\n/static/9b40ca5d4be654cbb4b06081d3082572/a12a6/img02.webp 255w\"\n              sizes=\"(max-width: 255px) 100vw, 255px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9b40ca5d4be654cbb4b06081d3082572/e9ea2/img02.png 180w,\n/static/9b40ca5d4be654cbb4b06081d3082572/18417/img02.png 255w\"\n            sizes=\"(max-width: 255px) 100vw, 255px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9b40ca5d4be654cbb4b06081d3082572/18417/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>번호 생성쪽은 그에 맞춰서 다른 것으로 해줘야 했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 275px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVQozz1R207CQBDtn3hBBAyl3bbb7Y0WRESJQS1IgwmaqAkgICAgISH6I/rqbx6zg/owmZ05szNn5ijZXB5qwUBBMyEcH9x2wW2PYp1ZMC1nm+MuTEuAGZywP9N0C7mjAnZ2U9jbT0ORCdlUNlssVpi9LrHZfKB100GzlWA4muDxqYfJdI71eoNmM4FhCggngC18XMdtGpo+zOK8fgFFTrG4S2xkoQRt4VGOGTbFOuP02fXC31pOmDQZS1L7qQwOM0dQzusNosxMG3lVRzEswQ8iaur5RZTKJyiGZWi6XJGRZ4ZFBORbLWxzOpO4AaV6WkfqIAsuPKiageu4hYvGFSrVGi6vYjQuY9TO6nQ/W7g0yHEDeH5IZ7K4vLFDXpoSFMvEIoyOSYxMTsVZpYYoiKBq5v9qW3G8f2HyKqNVPT8iTK4ucaU/GOLu/gGj8QRJcgvdEPj+/ML7coWk08VstsBoPEWvP0Sn00V/MMLz8AVRqYIwquB1uUbcbGM+fyPhfgC/HfT/xXakSwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5ad10c742262fcd8939bfd38ac5d7746/7c297/img03.webp 180w,\n/static/5ad10c742262fcd8939bfd38ac5d7746/8acbf/img03.webp 275w\"\n              sizes=\"(max-width: 275px) 100vw, 275px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5ad10c742262fcd8939bfd38ac5d7746/e9ea2/img03.png 180w,\n/static/5ad10c742262fcd8939bfd38ac5d7746/88b8e/img03.png 275w\"\n            sizes=\"(max-width: 275px) 100vw, 275px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5ad10c742262fcd8939bfd38ac5d7746/88b8e/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>처리하는 방법은 간단하다.<br>\n<strong>pages</strong> 디렉토리 안에 라우팅 되는 곳에 아래의 코드로 설정이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> Head <span class=\"token keyword\">from</span> <span class=\"token string\">'next/head'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> MainPageProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">흑우집합소 - 다음 1등은 당신입니다 ^^</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 된다.</p>\n<h2 id=\"전역-설정하기\" style=\"position:relative;\"><a href=\"#%EC%A0%84%EC%97%AD-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"전역 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>전역 설정하기</h2>\n<p>여기는 더 쉽다.<br>\n<strong>_app.js</strong> 파일에 위 처럼 작성해서 넣어주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Html<span class=\"token punctuation\">,</span> Head <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next/document'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyDocument</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Document</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Html</span></span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>ko<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">data-theme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>emerald<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">흑우집합소 - 다음 1등은 당신입니다 ^^</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Html</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>생각보다 어렵지 않다.<br>\n단지 페이지가 많으면 약간 귀찮을 뿐이다.</p>\n<p>자신만의 서비스에 title 적용이 안되어 있다면 얼른 적용해보도록 하자.</p>","excerpt":"Next.Js에서 Title 태그를 처리하기 이번에 흑우집합소를 네이버 서치 어드바이저에 등록했다. 그리고 데이터를 등록하다가 사이트 간단 체크에 돌렸는데 사이트 제목이 미설정이라 떴다. 그래서 확인해보니 정말 설정이 안되어 있었다.  그래서 이것을 수정하려고 자료를 찾아서 적용했다. 방법은 간단한데 각 페이지마다 Title 태그를 적용하는 법과 전역으로 설정하는 법이 있다. 1. 각 페이지마다 title 처리 각 페이지마다 Title을 변경해야 할 때가 있다. 나의 경우 메인과 각 페이지가 다르게 설정해야 했다. 메인은 아래처럼 진행해야 했고…  번호 생성쪽은 그에 맞춰서 다른 것으로 해줘야 했다.  처리하는 방법은 간단하다. pages 디렉토리 안에 라우팅 되는 곳에 아래의 코드로 설정이 가능하다. 이렇게 하면 된다. 전역 설정하기 여기는 더 쉽다. _app.js 파일에 위 처럼 작성해서 넣어주면 된다. 정리 생각보다 어렵지 않다. 단지 페이지가 많으면 약간 귀찮을 뿐이다. 자…","frontmatter":{"date":"2023.05.05","title":"Next.Js에서 title 태그 변경 처리","categories":"next-js","emoji":"📜"},"fields":{"slug":"/next-js/230505_nextjs_title/"}},"next":{"id":"c3860bc5-326d-51dc-af1d-1b91fc8e2c55","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"chat-gpt에게-코드를-맡기다가\" style=\"position:relative;\"><a href=\"#chat-gpt%EC%97%90%EA%B2%8C-%EC%BD%94%EB%93%9C%EB%A5%BC-%EB%A7%A1%EA%B8%B0%EB%8B%A4%EA%B0%80\" aria-label=\"chat gpt에게 코드를 맡기다가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chat GPT에게 코드를 맡기다가…</h1>\n<p>MongoDB쪽에서 데이터를 가져오는 부분에 대해서 GPT에게 명령을 줬다.<br>\n근데 가져올 때 코드를 보니 신기한 게 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//내가 작성한 코드</span>\n<span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>entity<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdAndDelete</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//GPT가 제시한 코드</span>\n<span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>entity<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdAndDelete</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>itemId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>근데 GPT가 제공한 코드를 보면 끝에 **.exec()**를 사용한다.<br>\n그래서 이 부분에 대해 궁금했다.</p>\n<p>쓰면서 딱히 문제는 안되었는데 이런 부분은 모르고 넘어가면 더 큰 문제가 발생할 수 있으니까?</p>\n<h2 id=\"exec는\" style=\"position:relative;\"><a href=\"#exec%EB%8A%94\" aria-label=\"exec는 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exec()는?</h2>\n<p>사실 exec()를 쓰고 안쓰고는 큰 차이는 없다.<br>\n왜냐하면 <strong>기능적으로는 완전히 동일</strong>하다.</p>\n<p>Mongoose에서 대부분의 쿼리 메서드는 exec()를 호출하지 않아도 잘 동작한다.<br>\n하지만 <strong>save()</strong> 같은 쿼리 메서드에는 붙이지 않는다.</p>\n<p>근데 이게 Mogoose 3 버전대에서는 쿼리 메서드에서 사용하는 쿼리를 프로미스로 만들기 위해서는 exec()를 필수로 붙여줘야 했다.<br>\n하지만 4버전 이후부터는 자체적으로 처리를 하기 때문에 exec()를 붙이지 않아도 되게 되었다.</p>\n<p>하지만 가독성과 다른 코드와의 일관성을 위해서 exec()를 사용하는 것을 권장한다.<br>\n공식문서에서도 exec() 사용을 권장한다.</p>\n<p><a href=\"https://mongoosejs.com/docs/promises.html\">Mongoose 공식 문서 Promise 참고</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#exec%EB%8A%94\">exec()는?</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.05.05","title":"Mongoose 사용 시 exec()는 무엇인가?","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230505_mongoose_exec/"}},"prev":{"id":"8bcd37ce-7e47-5eb6-9451-dcf9125c3d4e","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJq0lEQVRIxyXSh18V9BrH8Z/eUsOBqOwhyDoHj2wQZYkL5ChbWSobDofDGeypiALCEQRFkbScuVLLzFWuq5Vl2rj2us7SHGkqzrgoiZ/7wp4/4P36Ps/zFan5CtSFarTFSrSFCpqaG0hTKMjRqiltKENbVsK+/XuAV/zV84QX3V08fnafB4/ucuvOr9y7/zul1Q04uYcyedo8RKpKQUF5GblaBeVlKnbv3kSuOh+FJp/KxnLKqss4dGg//dPd201373NedD+m68kD7t2/zZ27v3Hi1Ela2zvRlixCLFTmUFpdQZ5WQU1lPkcObEelU6PU5rOkuZK6umpOnThEH/C/3le87HvF/3r/4smLLh503ePuHzf57eYVrl+/yPcXTiMW5GRQVVNNcamassJsDn26FW2BBnWBmsa2ata2LuPC2eP83Q/+3Q/+zcu+lzzvecrDpw+5/+Auly7/zIXzX3H2m+OIpMyFVC1ZhK4ojwJ1Ooc+2URxsQ5dYT4r2xeztaORi+dP/wO+7uVl3xtevfmb7t6/ePy8i3sP7nLz5hUu/eccv/x0FpGYmUHV0ipSslNQKhZwcO8HVFQUolbnsHJVJZtW1/HTuX/zGuh5/ZqXb/rf00fP6x6edj/hz6773Lpzncv/Pc/P/StnlpZRsXQpWRo1+boU9u1cw6o1y9GVqGhuq2J92xIufHvynxv29fHyTX/CPnr6enjW84wHTx5w594Nrly+wI/nTyF0izUUL6kir0JN1bJSdu9oZ/uuDVTUVrJcX4e+qYbvvj3Nm/6EfX30Ar30wz28ePWcR88fcfPWlbfgLxe/QdTX62hoKkNXnUK9fjGbN7Wyd+8GKmuL6OhsR99Sz6kzx97W5uXr13T3vqK7t4cXL5/z8OkD7vx5m1t3r3H92o/8cvFrxLoGHeuayykpT6FOv4iWlYs4cngHBaV5LKqpoLKmksPHDr8FHz19wtWbV/nz8X3+eHiHG7evc+77r/j9zjVu377EpUtnEQc7StiyQkdxSQYqXQZLags5sH8L1YtLycrLIFut4IuTX7wFu553ceOPazx79YiuF/e5cesKZ77+kkvXfubXmxe5fOU7ROeqWpZV55CcGkm2cj7ZihTa2htZs76DFFUpqop6KhvWsHrDbtZt2UVL+0YaWzawqmMTOzduZG3zepobW1leW09RvhpRt7iK5OhQlAlhaBdGUpYVR3VhHhs715KVkIwqNYf8FDUZcTkUaSspzNORFb+QWHk0ep2e92s+ZYv+M7br99FU0onIT1tAZlQQyoRQsudORZ0cimLuDN5vraMwPRbV/AjKcpMpzoyjIDeH9KQ4MuPlxIQGooopoEq3jfKSDahL1lNb1YFoqy+lvaGItloNdaVZVKjnU67JoHOVHk3aPBJnBZAcMZVkeRDKtBQSomYzN2wqcaFBFCVUsbjwY2rrd6Ot2YZ++SaEKmkWJRkxFKdGUJ4mp6lwIeXps6nInIsqXk5KxBRSIqeSFDmdEmU2uuRoEmdNI3ZGIIUJdZSoPqS8chPaRbtpbdyBcBg1mPFmBsgnGBHvM5TsUAmpU2xQhbuiiZyCJjEU7fw5LIoLpiknkaLY6WTOCiErxJvMyBp0mo/ISG0jIXwZkTPLEY4mwwl3N6Z6jiVJkw1QJkwiZ5YzxZEeLEmWkyYPxEcmITdASqs6FU1yNOqkOApTUsmMSqc4VYeuaDMpms0k5G1AuJgNQxVqQW2UGeWzLdlSNIvWrEk0L/gHnO3hjLGREcNGGtKQKScrLIjMmb4kTXQk0ceCxEApRQVbyCnfx4K8DxG+Y4dRGDYGfYIVZaEmNMXas7kgjMZ5UnQRwST7jsPa3AQxcCAzfCczP8CDYMdhxHoaE+U1nKTAONSpW8nP60RZvQuxOGAgq8MH0RxhSJHPO+gjHVmtCEfjZ0zuJHvKIifiZGPK0KHDkDqMozghkkR/e+L9rcmdHYZ23mbmh+iZ7qxBHlyNOBYvOBAj2CoXNIUMpsB3BPXzvCnwM0ThZUlNvBx3O2uGGBgwxsgQK1NTsmKjyIyZit8EHdlx10kMO0f0zB8IDfgBcSxW8GWc4OMIQUvIAIq8B5PpKFCOF5R6CSpDgpnkOJkxo0dgNHIUQgjGS8PxHO/GeIdMFkTcJX7OVeLmXGXm9CuIg3MEX8YI9s4W6AMFBe4ChfMAFM4D0U0QVE20x99xEkajhmNoOBJTk5H4eMzB1toOdxclyXEPmRf9G1HRvzMt7DbiUITgYJTgozBBpadAKRFkOw0g1VaQNE6gmmSOq70NgwyGYmttSViQB2NtnLEwM8VFkkTy/BPMnfcR4eFrkbnXIraECjZMF6wIEKjHC7IcBOn2gnxvQ1ZkyPm8bSlR00OwtjDHztqKkSNHYDzGDOMxxliYW2JhboGluQWmxuaMMTJDVPkJyn0HUOAhUE54F5XXCOpj3TncomVbUQpHW6qJmxmCvY0l42ysGDXKCFtrJyzMzbGzmIiXfSF2FnJszOIxN45FaDwH0p4RxPaKeHZVJ/N5Yy6n15VztK2ATxrUHFldy+wp/tiPtcLB1gYTY2OsLa1xsncixE+Ov30NMpM6RhtEY2gQg1DIBB9q5JzpLOFku47jbWpOrC5gf1M+n+k1fNpSRYC3B2YmxtjZWGFtaYWVhQWmJqZvqzTEYAiTpbV4S5ZiMjoCkSYRrMmayumOIg40ZLFrSQr7m5TsaVCybamSnctLCJnkg4W5GRMkTtjb2uLr4YlM6sLo0UYMfu8djIxMmTN1Jd6uakSIzUBqkwM53qbhTEcBH1QuZGddDrvrFOxv0rCnsZjJHm5IHR0I9HEjwDeIhJg0omdE4mRYjO3wdIa89y7Wlk4kxKxAjBs5kKxQT46uyOWTugw+rk3lSHM+e+uVHGktplWXhqPtWLzdZPi4yvBy90KVmc5cuRypTQL2I3OxMfXh3cECN9lkhNkQQdxkCUda8jmwIo+DK1QcbdVyZKWOPUtzSZ7mhrvUATcXF2QSCa4T3JkZHIyfpw9ubv5I7CJwtp2BibEl7xkMQVgPf4cgiTH6jGm8rw5ng242OxYl0ayMIMrPlhh/C4J9ZEgcnHB3ccHfx4/w6bOYOWUafl5ByCQBODsGY2/rwegxYxCeloOY4TSIhd7/ItXPgBiv4WTNsCFvjgtyXzvkXlZ4OY9lvESKzFmCTCLFU+aOl6s7Mqk7Dg4+SJyDkTr6YzfWGTFv4igS/UYRJhtGoMQQz3EjmOFlS6iPPd6OFvhYDcfV0Q6ZVMIEqRRX6XhcpTJcJDKkEk+kEj9cpAHIpIE4O3ryf/7NbHkbHMa2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c7f6f9db4d1789eb57b2411d018c3137/7c297/img00.webp 180w,\n/static/c7f6f9db4d1789eb57b2411d018c3137/33ecc/img00.webp 360w,\n/static/c7f6f9db4d1789eb57b2411d018c3137/d0171/img00.webp 562w\"\n              sizes=\"(max-width: 562px) 100vw, 562px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c7f6f9db4d1789eb57b2411d018c3137/e9ea2/img00.png 180w,\n/static/c7f6f9db4d1789eb57b2411d018c3137/53918/img00.png 360w,\n/static/c7f6f9db4d1789eb57b2411d018c3137/a4f00/img00.png 562w\"\n            sizes=\"(max-width: 562px) 100vw, 562px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c7f6f9db4d1789eb57b2411d018c3137/a4f00/img00.png\"\n            alt=\"무더운 여름(?)엔 스파클링 와인과 개발을...\"\n            title=\"무더운 여름(?)엔 스파클링 와인과 개발을...\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"반복문에서-비동기를\" style=\"position:relative;\"><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%A5%BC\" aria-label=\"반복문에서 비동기를 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복문에서 비동기를…</h1>\n<p>최근 개발 일정 및 개인 사정으로 인해 포스팅을 전혀 하지 못했다.<br>\n네이버 블로그는 일상이나 가벼운 소재라서 막 쓸수 있지만 개발 블로그는…</p>\n<p>아무렇게나 막 싸지르는 공간도 아니고, 다른 예제 복붙하는거는 정말 싫어해서…<br>\n그래서 더 미루지 않았나 싶다. ㅎㅎ</p>\n<p>흑우집합소 패치 내역이나 개발한 걸 TIL 쪽에 올리려다가 이제는 따로 카테고리를 빼야 할 듯 싶다.<br>\n이것도 많이 밀렸는데 언제 적는지…</p>\n<p>무튼…<br>\n평화롭게(?) 개발을 하다가 반복문을 사용하면서 비동기 처리하다가 조금 막힌 부분이 있었다.<br>\n이번 포스팅에서는 그 문제, 그리고 조사, 해결방법을 공유하고자 포스팅을 남겨본다.</p>\n<h2 id=\"반복문에서-비동기를-쓸-때\" style=\"position:relative;\"><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%A5%BC-%EC%93%B8-%EB%95%8C\" aria-label=\"반복문에서 비동기를 쓸 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>반복문에서 비동기를 쓸 때</h2>\n<p>일반적으로 반복문 내에서 비동기 처리를 하는 경우는 드물게 있다.<br>\n예를 들어 특정 파라메터를 가지는 url의 데이터를 크롤링하거나,<br>\n데이터베이스에서 순차적으로 뽑아오는등… 몇 가지 케이스가 있다.</p>\n<p>근데 <strong>while</strong>이나 <strong>for</strong> 등과 같은 고전파 방식인 반복 순회에서는 비동기가 잘 동작한다.<br>\n하지만 **고차함수(高次函數)**의 <strong>map</strong>, <strong>filter</strong>, <strong>foreach</strong>등에서는 이 비동기가 생각한 대로 흘러가지 않는다.</p>\n<p>왜 그런걸까?</p>\n<br>\n<h2 id=\"간단한-예제부터-시작\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%98%88%EC%A0%9C%EB%B6%80%ED%84%B0-%EC%8B%9C%EC%9E%91\" aria-label=\"간단한 예제부터 시작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단한 예제부터 시작</h2>\n<p>그냥 급조한 예제 코드다…<br>\n와인의 재고를 찾는 코드가 있다고 해보자.<br>\n(여담인데 떼땅져… 6만원 밖에 안하는데 정말 맛있다.)</p>\n<p><strong>그리고 아래 코드는 <a href=\"https://www.typescriptlang.org/play\">타입스크립트 플레이그라운드</a>에서 동작하는 코드다.</strong><br>\n만약 직접 typescript 코드를 작성한다면 일부 코드에 <strong>await</strong>키워드를 붙여야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//와인 수량 저장 스토어</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//떼땅져는 10개</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//파이퍼 하이직은 12개</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//앙드레 끌루에는 21개</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//오퍼스원은 5개</span>\n    pounamu<span class=\"token operator\">:</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//푸나무는 31개</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//찾는 시간</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//와인 검사</span>\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span><span class=\"token string\">'opus_one'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p><strong>findTime 함수</strong>는 1~3초 랜덤으로 찾는 시간을 밀리세컨으로 생성한다.<br>\n<strong>checkWineCnt</strong> 함수는 전달받은 와인 이름으로 몇개가 있는지 조회를 한다.</p>\n<p>현실은 그냥 와인셀러 열고 꺼내면 되지만 -_-;;<br>\n뭐 그냥 샘플 예제니까…넘 억까라 해도 양해 바란다.</p>\n<p>무튼 이렇게 반복문을 안쓰는 예제에서 시작해보겠다.<br>\n만약 스토어에 있는 모든 와인을 조회해보고 싶다면 아래처럼 하단에 코드를 변경할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runFunc</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> wineList<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">searchAllFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 할 경우 우리가 생각한 대로 동작을 한다.</p>\n<p><img src=\"/4dc532e83b0f514b924c0802e79b5a35/loop02.gif\" alt=\"\"></p>\n<br>\n<h3 id=\"foreach\" style=\"position:relative;\"><a href=\"#foreach\" aria-label=\"foreach permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ForEach</h3>\n<p>근데 <strong>for</strong>를 사용하면 우리가 생각한 대로 잘 동작하지만, 고차함수를 통해서 작업을 하면 다르게 처리된다.<br>\n위와 같은 작업을 고차함수인 <strong>foreach</strong>로 바꾸면 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  wineList<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>이렇게 하고 결과를 보면 아래와 같다.</p>\n<p><img src=\"/fec68f491faa98cde1f4896426968883/loop03.gif\" alt=\"\"></p>\n<p>전혀 비동기로 동작하지 않는다.<br>\n이유는 간단하다.</p>\n<p><strong>고차함수인 ForEach는 비동기를 기다리지 않는다.</strong><br>\n좀 더 정확히 이야기 하면 <strong>ForEach는 Promise를 인지하지 못한다.</strong></p>\n<br>\n<h3 id=\"how-to-solve\" style=\"position:relative;\"><a href=\"#how-to-solve\" aria-label=\"how to solve permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to solve?</h3>\n<p>뭐 간단하다.</p>\n<ol>\n<li>For loop를 사용한다.</li>\n<li>For of를 사용한다.</li>\n</ol>\n<p>1번은 맨 처음 예제에서 사용한 방식이고, 2번은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">forOfLoop</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> wineList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">forOfLoop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>뭐 좀 억지스럽긴 한 코드인데, 이해를 돕는 코드이니 넘어가자.<br>\n사실 제일 좋은 건 1번인 것 같다.</p>\n<p>굳이 비동기 루프 코드를 따로 작성하지 않고, 그냥 그 자리에서 For를 시전하면 되니까?<br>\n취향껏 쓰자.</p>\n<br>\n<h3 id=\"map\" style=\"position:relative;\"><a href=\"#map\" aria-label=\"map permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Map</h3>\n<p>이번엔 와인의 이름과 수량을 문자열로 합쳐서 만드는 것을 해야 한다고 가정하자.<br>\n결과물을 배열이고, 안에는 와인명-수량 이라는 형태로 간다고 하자.</p>\n<p>예를 들면 [taittinger-10, “piper_heidsieck-12”…] 이렇게 말이다.</p>\n<p>그럼 고차함수인 <strong>Map</strong>을 활용해서 변환할 수 있다.<br>\n아래의 코드를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> idx<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> item <span class=\"token operator\">+</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result = '</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>우리가 원하는 결과는 아마 <strong>checkWineCnt</strong>함수를 수행하면서 find start end 맨트가 각각 뜨고,<br>\n그 다음 마지막으로 result의 콘솔 결과가 출력되길 원할 것이다.</p>\n<p>하지만 결과는…</p>\n<p><img src=\"/7ba8651a0f60c5c63075dfdc5d87dcb3/map01.gif\" alt=\"\"></p>\n<br>\n<p>그리고 중간에 로그를 보면 다음과 같이 되어 있는 것을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\"result = \",  [Promise: {}, Promise: {}, Promise: {}, Promise: {}]</code></pre></div>\n<p>그렇다.<br>\n전부 <strong>Promise</strong>형태로 된 배열이 있다.<br>\n즉 <strong>Map</strong>도 비동기를 처리하지 못한다는 뜻이다.</p>\n<p>물론 얘는 Promise가 왔으니 해결할 방법은 있다.</p>\n<br>\n<h3 id=\"how-to-solve-1\" style=\"position:relative;\"><a href=\"#how-to-solve-1\" aria-label=\"how to solve 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to solve?</h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> mapResult <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> idx<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> item <span class=\"token operator\">+</span> <span class=\"token string\">'-'</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callPromiseAll</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>mapResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data = '</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> data<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">callPromiseAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>위 코드를 수행하면 아래처럼 확인할 수 있다.</p>\n<p><img src=\"/79e846aae8d4b717242698ce4b7250cc/map02.gif\" alt=\"\"></p>\n<p>보면 <strong>checkWineCnt</strong>함수의 실행은 비동기로 동작하지 않지만, 결과는 제대로 나온다.</p>\n<br>\n<h3 id=\"filter\" style=\"position:relative;\"><a href=\"#filter\" aria-label=\"filter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filter</h3>\n<p>이번엔 수량이 20개 이상인 와인만 가져오고 싶다고 가정해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> filterResult <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt <span class=\"token operator\">>=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterResult = '</span><span class=\"token punctuation\">,</span> filterResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>이렇게 하면 앙드레 끌루에만 배열로 반환되어야 한다.<br>\n근데 결과를 보면 전체 다 반환된다.</p>\n<p><img src=\"/c89c280d74e2235be9d2b910c4d7a25a/filter01.gif\" alt=\"\"></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> \"filterResult = \",  [\"taittinger\", \"piper_heidsieck\", \"andre_clouet\", \"opus_one\"]</code></pre></div>\n<p>이유는 이것도 Map과 비슷한데<strong>filter의 콜백은 Promise</strong>를 반환하고, 이는 언제나 <strong>true</strong>로 인정된다.<br>\n그래서 전체 다 반환되는 것이다.</p>\n<p>얘는 해결하려면 약간 코드가 너저분해지는데 map을 사용해서 처리할 수 있다.</p>\n<br>\n<h3 id=\"how-to-solve-2\" style=\"position:relative;\"><a href=\"#how-to-solve-2\" aria-label=\"how to solve 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to solve?</h3>\n<p>아래는 해결 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> wineStore<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    taittinger<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n    piper_heidsieck<span class=\"token operator\">:</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    andre_clouet<span class=\"token operator\">:</span> <span class=\"token number\">21</span><span class=\"token punctuation\">,</span>\n    opus_one<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findTime</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> checkWineCnt <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>wineName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ms <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find start... during ms = '</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">findTime</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> wineStore<span class=\"token punctuation\">[</span>wineName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'['</span> <span class=\"token operator\">+</span> wineName <span class=\"token operator\">+</span> <span class=\"token string\">'] count = '</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'find end... '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> wineList<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>wineStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> promiseWineList <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>wineList<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> cntWineList <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>promiseWineList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//[10, 12, 21, 5]</span>\n\n  <span class=\"token keyword\">const</span> filterResult <span class=\"token operator\">=</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> cntWineList<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> cnt <span class=\"token operator\">>=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filterResult = '</span><span class=\"token punctuation\">,</span> filterResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>그럼 아래와 같이 출력된다.</p>\n<p><img src=\"/c976f7cbdfb13e62fbfa99b5536ee8bf/filter02.gif\" alt=\"\"></p>\n<p>코드가 약간 지저분해지는데 처리는 된다.</p>\n<br>\n<h3 id=\"reduce\" style=\"position:relative;\"><a href=\"#reduce\" aria-label=\"reduce permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reduce</h3>\n<p>이번엔 저 와인들의 수량을 모두 합치는 것을 해보려 한다고 가정하자.<br>\n뭐 그냥 for문 사용해서 할 수 있지만, 고차함수 중 <strong>reduce</strong>라는 것을 쓰면 더 편하게 할 수 있다.<br>\n아래는 와인 총합을 구하는 <strong>reduce</strong>를 사용한 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> sum0 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>sum<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> sum<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>근데 이렇게 작성하면 typescript 에러가 발생할 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkElEQVQY03WPywrEIBRD+/8fWev7WS2lrjPEQZkuZnEwMRByN2MNtNbw3kFrhRgjck4opSClNMg5I4QwMr78o545NbnvG1sIEcdxYN93CCEgpVw450bZdV2otaK19pdaG3rvLAyjUCm1Cqm52hizSufC7wV5rZswHwutta9V9IRF3vtxOted57n49dTTP8+DD0IVKhUm14j8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/7c297/img01.webp 180w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/33ecc/img01.webp 360w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/df77d/img01.webp 720w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/5c666/img01.webp 1080w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/d2558/img01.webp 1096w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/e9ea2/img01.png 180w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/53918/img01.png 360w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/242a6/img01.png 720w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/b4ad3/img01.png 1080w,\n/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/f7f62/img01.png 1096w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/9a1b80bc0d27c1929f5ad12f00a6cbf4/242a6/img01.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>뭔가 장황한 에러가 있는데 그냥 쉽게 생각하면 <strong>sum : number</strong>라는 것에 있다.<br>\nasync 함수가 되는 순간 반환은 <strong>Promise</strong>값으로 온다.</p>\n<p>저기 reduce 함수의 첫 인자는 반환 값인데 보면 쎙으로 <strong>number</strong>로 되어 있다.<br>\n또한 초기 값도 Promise가 아닌 0으로 되어 있다.<br>\n그래서 저 부분을 고치면…</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> sum <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> wineList<span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>sum<span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cnt <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkWineCnt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> sum<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cnt<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>이렇게 바꾸면 이제 정상적으로 출력이 된다.</p>\n<p><img src=\"/19676a4266c36716d00f068124ce87b8/reduce.gif\" alt=\"\"></p>\n<p>위 코드가 typescript라서 미연에 방지가 된거다.<br>\n만약 javascript를 사용하고 있었더라면 이상한 Promise랑 겹쳤을 것이다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>지금까지 고차함수의 일부에서 비동기를 사용할 때 문제점과 해결방법을 알아봤다.<br>\n약간 억까 예제가 좀 있었지만… 문제의 본질과 해결 방법은 충분히 전달되었을거라 믿는다.</p>\n<p>다시한번 정리하면 다음과 같다.</p>\n<ol>\n<li>foreach는 비동기를 할 수 없기에 다른 반복문을 사용하자.</li>\n<li>map은 <strong>Promise</strong> 배열을 반환하기에 **Promise.all()**을 사용하여 처리하자.</li>\n<li>filter는 map 등으로 처리 후 Promise.all()로 값을 변환한 후 사용하자.</li>\n<li>reduce는 typescript 사용으로 미연에 방지할 수 있으며, 반환 값의 Promise를 잘 사용하자.</li>\n</ol>\n<p>이정도로만 알고 있으면 잘 쓸수 있다.<br>\n근데 모르면 그냥 GPT한테 예제를 보여달라고 하자.<br>\n그렇다고 운영코드를 올리진 말고…</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%B0%98%EB%B3%B5%EB%AC%B8%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0%EB%A5%BC-%EC%93%B8-%EB%95%8C\">반복문에서 비동기를 쓸 때</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%98%88%EC%A0%9C%EB%B6%80%ED%84%B0-%EC%8B%9C%EC%9E%91\">간단한 예제부터 시작</a></p>\n<ul>\n<li><a href=\"#foreach\">ForEach</a></li>\n<li><a href=\"#how-to-solve\">How to solve?</a></li>\n<li><a href=\"#map\">Map</a></li>\n<li><a href=\"#how-to-solve-1\">How to solve?</a></li>\n<li><a href=\"#filter\">Filter</a></li>\n<li><a href=\"#how-to-solve-2\">How to solve?</a></li>\n<li><a href=\"#reduce\">reduce</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.05.23","title":"반복문에서 비동기 처리하기 (for, map, async, await)","categories":"js_ts","emoji":"📜"},"fields":{"slug":"/js_ts/230523_loop-in-async/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/next-js/230505_nextjs_title/","nextSlug":"/nest_js/230505_mongoose_exec/","prevSlug":"/js_ts/230523_loop-in-async/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}