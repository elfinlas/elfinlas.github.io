{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/til/230119_til/","result":{"data":{"cur":{"id":"a2ac70d7-53cf-5f20-8d93-d95c2e73b834","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQoz42S0Y6CMBBFW6Cl0GmhxYorrJpAsolP+v8fdzetrqtmxX24GToZztxOhzHGcC+vCEOzwqA9drTCJ3XYmRX2NuDQrJN647A2LYzSeP6fPSciQBTir8KknGegvESTqwRXolwGRmdK/haFEDBNE7bDAOf9Q+26btCWehkYryfy4nbWWmMcxwQmopTjjF+aVRauomVgnFWeZQ85znnSc21XEnxtl4FxLnFOPyApZXJpjEFd18jumnmp0Wn7D4dXYLziPM84Ho84n844n06pwc2hJHS6eePQBpTi8srRTV4UYJwl5fLx9Z3UCNQuA3tlMbuPtIss42grwtZ22BiHnlz6vpw9Dm2PWqpl4A1cWXyFEVRWqLmAzmQSpShSLHnxfrH5NZJQmNzm5YK/0jegveteJRG0qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/7c297/thumbnail_til.webp 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/33ecc/thumbnail_til.webp 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/df77d/thumbnail_til.webp 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dd3ab/thumbnail_til.webp 895w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/e9ea2/thumbnail_til.png 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/53918/thumbnail_til.png 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png 895w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"23년-2월-13일-til--개발노트-흑우집합소\" style=\"position:relative;\"><a href=\"#23%EB%85%84-2%EC%9B%94-13%EC%9D%BC-til--%EA%B0%9C%EB%B0%9C%EB%85%B8%ED%8A%B8-%ED%9D%91%EC%9A%B0%EC%A7%91%ED%95%A9%EC%86%8C\" aria-label=\"23년 2월 13일 til  개발노트 흑우집합소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>23년 2월 13일 TIL &#x26; 개발노트 (흑우집합소)</h1>\n<p>금일 흑우집합소를 개발하며 배운 내용 및 겪은 과정을 정리하여 올려본다.</p>\n<p>오늘은 JWT 인증 부분을 처리하였다.</p>\n<h2 id=\"nestjs에서-jwt-사용시-error-커스텀-처리\" style=\"position:relative;\"><a href=\"#nestjs%EC%97%90%EC%84%9C-jwt-%EC%82%AC%EC%9A%A9%EC%8B%9C-error-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%B2%98%EB%A6%AC\" aria-label=\"nestjs에서 jwt 사용시 error 커스텀 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nest.js에서 JWT 사용시 Error 커스텀 처리</h2>\n<ul>\n<li>Passport-JWT를 그대로 사용하려 했는데 Access Jwt의 토큰 만료시에도 401을 띄운다.</li>\n<li>나는 Access Token에 대해서는 토큰 만료 시 서버 내에서 저장된 리프레시 토큰을 확인하고 그에 따른 추가 작업을 하기 원했다.</li>\n<li>물론 try catch로 처리할 수 있지만 이렇게 하면 <strong>AuthExceptionHandler</strong>처리 부분이 너무 지저분해진다.</li>\n<li>그래서 좀 찾아본 결과 <strong>passport-custom</strong>이란 것으로 <strong>Strategy</strong>부터 커스텀 처리를 할 수 있는 것을 찾았다.(이건 따로 포스팅 예정)</li>\n<li>패키지를 설치하고 적용해봤다.</li>\n<li>일일히 JWT에 대한 에러를 핸들링 해야 하는 부분이 있지만 직접 핸들링을 할 수 있어서 더 좋은 것 같다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Inject<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PassportStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Strategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'passport-custom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthException <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../exceptions/auth.exception'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthJwtErrorCode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../exceptions/auth.jwt.error.code'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> VerifyJwtOutboundPort<span class=\"token punctuation\">,</span> <span class=\"token constant\">VERIFY_JWT_OUTBOUND_PORT</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../ports/out/jwt/verify.jwt.outbound.port'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">JWT_TYPE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../types/jwt.enums'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessJwtStrategy</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PassportStrategy</span><span class=\"token punctuation\">(</span>Strategy<span class=\"token punctuation\">,</span> <span class=\"token string\">'jwt'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">VERIFY_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> verifyjwtOutboundPort<span class=\"token operator\">:</span> VerifyJwtOutboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> payload<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> jwt <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'TestJwtKey'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>jwt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">jwtNotFound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verifyjwtOutboundPort<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> jwt<span class=\"token punctuation\">,</span> tokenType<span class=\"token operator\">:</span> <span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> payload<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>덕분에 기존에 있던 JwtStrategy에서 직접 처리를 할 수 있게 되었다.<br>\n전에 <strong>passport-jwt</strong>사용할 때는 생성자에도 주렁주렁 매달아서 보냈었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            jwtFromRequest<span class=\"token operator\">:</span> ExtractJwt<span class=\"token punctuation\">.</span><span class=\"token function\">fromExtractors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> req<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TestJwtKey\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            secretOrKey<span class=\"token operator\">:</span> key<span class=\"token punctuation\">,</span>\n            issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            ignoreExpiration<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            passReqToCallback<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> StrategyOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제는 <strong>Strategy</strong>영역이 좀 깔끔해 진 것 같다.</p>\n<p>그리고 Nest.js에서 제공하는 <strong>JwtService</strong>의 경우 <strong>verify</strong>메서드로 검증을 할 수 있는데,<br>\n이때는 생성했던 JWT의 속성을 다 가지고 와야 한다.<br>\n속성은 <strong>issuer</strong> <strong>audience</strong> 등을 의미한다.</p>\n<p>쉽게 생성할 때와 맞춰주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> payload <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    secret<span class=\"token operator\">:</span> secretKey<span class=\"token punctuation\">,</span>\n    expiresIn<span class=\"token operator\">:</span> expiredTime<span class=\"token punctuation\">,</span>\n    audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>jwtType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 생성할 때 <strong>issuer</strong> <strong>audience</strong>를 전달했다면 검증할 때도 같이 넣어줘야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">verify</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  secret<span class=\"token punctuation\">,</span>\n  audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> JwtVerifyOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이런 식으로 처리했다.<br>\n저 <strong>JwtVerifyOptions</strong> 타입을 타고 들어가면 아래와 같은 것을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token generic-function\"><span class=\"token function\">verify</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> object <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>token<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> JwtVerifyOptions<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">JwtVerifyOptions</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">jwt</span><span class=\"token punctuation\">.</span>VerifyOptions <span class=\"token punctuation\">{</span>\n    secret<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Buffer<span class=\"token punctuation\">;</span>\n    publicKey<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> Buffer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">VerifyOptions</span> <span class=\"token punctuation\">{</span>\n    algorithms<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Algorithm<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    audience<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> RegExp <span class=\"token operator\">|</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> RegExp<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    clockTimestamp<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    clockTolerance<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/** return an object with the decoded `{ payload, header, signature }` instead of only the usual content of the payload. */</span>\n    complete<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    issuer<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    ignoreExpiration<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    ignoreNotBefore<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    jwtid<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/**\n     * If you want to check `nonce` claim, provide a string value here.\n     * It is used on Open ID for the ID Tokens. ([Open ID implementation notes](https://openid.net/specs/openid-connect-core-1_0.html#NonceNotes))\n     */</span>\n    nonce<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    subject<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n    maxAge<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<h2 id=\"궁금점\" style=\"position:relative;\"><a href=\"#%EA%B6%81%EA%B8%88%EC%A0%90\" aria-label=\"궁금점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>궁금점</h2>\n<p>기존에 <strong>AuthGuard</strong>부분에서 좀 더 조작하면 할 수 있을 것 같았는데 너무 시간을 빼먹어서 진행하지 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ExecutionContext<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthGuard <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessJwtAuthGuard</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuthGuard</span><span class=\"token punctuation\">(</span><span class=\"token string\">'accessJwt'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token generic-function\"><span class=\"token function\">handleRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TUser <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>err<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TUser <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">JsonWebTokenError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'errror = '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// return { \"data : \": \"test\" } as any;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'data : '</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token string-property property\">'data : '</span><span class=\"token operator\">:</span> <span class=\"token string\">'aaaa'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> info<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>기존에는 위와 같이 작성했는데 만료하는 시점은 잡을 수 있었지만 컨트롤러에서 바로 에러 응답을 해버렸다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Post</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseGuards</span></span><span class=\"token punctuation\">(</span>AccessJwtAuthGuard<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">testJwt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> ok<span class=\"token operator\">:</span> <span class=\"token string\">\"ok\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>정녕 <strong>passport-jwt</strong>에서는 약간의 커스텀 처리를 못하는 것인지…<br>\n이 부분은 시간이 나면 다시 찾아봐야겠다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#nestjs%EC%97%90%EC%84%9C-jwt-%EC%82%AC%EC%9A%A9%EC%8B%9C-error-%EC%BB%A4%EC%8A%A4%ED%85%80-%EC%B2%98%EB%A6%AC\">Nest.js에서 JWT 사용시 Error 커스텀 처리</a></li>\n<li><a href=\"#%EA%B6%81%EA%B8%88%EC%A0%90\">궁금점</a></li>\n</ul>\n</div>","excerpt":"23년 2월 13일 TIL & 개발노트 (흑우집합소) 금일 흑우집합소를 개발하며 배운 내용 및 겪은 과정을 정리하여 올려본다. 오늘은 JWT 인증 부분을 처리하였다. Nest.js에서 JWT 사용시 Error 커스텀 처리 Passport-JWT를 그대로 사용하려 했는데 Access Jwt의 토큰 만료시에도 401을 띄운다. 나는 Access Token에 대해서는 토큰 만료 시 서버 내에서 저장된 리프레시 토큰을 확인하고 그에 따른 추가 작업을 하기 원했다. 물론 try catch로 처리할 수 있지만 이렇게 하면 AuthExceptionHandler처리 부분이 너무 지저분해진다. 그래서 좀 찾아본 결과 passport-custom이란 것으로 Strategy부터 커스텀 처리를 할 수 있는 것을 찾았다.(이건 따로 포스팅 예정) 패키지를 설치하고 적용해봤다. 일일히 JWT에 대한 에러를 핸들링 해야 하는 부분이 있지만 직접 핸들링을 할 수 있어서 더 좋은 것 같다. 덕분에 기존에 있던 …","frontmatter":{"date":"2023.02.13","title":"23년 2월 13일 TIL & 개발노트 (흑우집합소)","categories":"til","emoji":"📜"},"fields":{"slug":"/til/230119_til/"}},"next":{"id":"12d0116d-0a08-5854-9ab6-3d990c061488","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"블로그용-작은-프로젝트를-만들다가\" style=\"position:relative;\"><a href=\"#%EB%B8%94%EB%A1%9C%EA%B7%B8%EC%9A%A9-%EC%9E%91%EC%9D%80-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EB%A7%8C%EB%93%A4%EB%8B%A4%EA%B0%80\" aria-label=\"블로그용 작은 프로젝트를 만들다가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>블로그용 작은 프로젝트를 만들다가…</h1>\n<p>이번에 <strong>Nest.Js</strong>에서 <strong>Jwt</strong>쓰기 주제로 포스팅을 준비중이다.<br>\n근데 처음부터 다시 설치해서 하려니까 몇 가지 막히는 부분이 있었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//auth.module.ts</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    JwtModule<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">,</span>\n      signOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'60s'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이런 코드가 있다.<br>\n근데 @Module 안에서 process.env로 설정파일에 접근하려 했다.</p>\n<p>근데 아래와 같이 에러가 발생했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2UlEQVQY0zWO6W6DMBCEeZpeSVtuaIOxDTFgczQlXOr7v8dUu1V/jGa0Gn07nhI1rpVD1d6gzMQulIMqKhilUEkJVdbQ4k/lRUNcKoRxgbfwE6f3DA8vIR5PEZ7OMbwglWjHHe2w4mpnNP2CbtzRDBsauo8HZ9MvMD117qjtzK7NhLwwCFOJ59eEoV6QCBg7w00HjLujGzfO3bDCjhuG2w8/a9zCzyhTv+6+IbRDlCnEuYafCPhxAY/otIxA/zD3dcBOO4syiWH9yk6w+EMjyiSCtMTZz3kh6Rfpo4884pD84gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/24c9340c13f5d6f39177875192ad9bf3/7c297/img01.webp 180w,\n/static/24c9340c13f5d6f39177875192ad9bf3/33ecc/img01.webp 360w,\n/static/24c9340c13f5d6f39177875192ad9bf3/df77d/img01.webp 720w,\n/static/24c9340c13f5d6f39177875192ad9bf3/493ca/img01.webp 952w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/24c9340c13f5d6f39177875192ad9bf3/e9ea2/img01.png 180w,\n/static/24c9340c13f5d6f39177875192ad9bf3/53918/img01.png 360w,\n/static/24c9340c13f5d6f39177875192ad9bf3/242a6/img01.png 720w,\n/static/24c9340c13f5d6f39177875192ad9bf3/be2fd/img01.png 952w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/24c9340c13f5d6f39177875192ad9bf3/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>이유가 뭘까 잠깐 고민했는데…<br>\n기존 프로젝트는 이미 다 되어 있는 것이라서 내가 빼 먹은 설정과 패키지가 있었다.</p>\n<h2 id=\"nextjs에서-config\" style=\"position:relative;\"><a href=\"#nextjs%EC%97%90%EC%84%9C-config\" aria-label=\"nextjs에서 config permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next.js에서 Config</h2>\n<p>이유는 간단했다.<br>\n먼저 <strong>Config</strong>관련 패키지를 빼먹었었다.</p>\n<p>먼저 아래의 명령어로 패키지를 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> yarn add @nestjs/config</code></pre></div>\n<p>그리고 모듈의 최상단인 <strong>app.module</strong>을 연다.<br>\n아래와 같이 모듈 파일을 수정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Module <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ConfigModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/config'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./domain/auth/auth.module'</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> AuthModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  controllers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>imports</strong> 부분에서 저렇게 처리하면 된다.</p>\n<p>만약 구동 환경마다 설정파일을 좀 다르게 하고 싶다면 아래와 같이 처리가 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">ConfigModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    envFilePath<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"prod\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\".production.env\"</span> <span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"stage-dev\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\".stagedev.env\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\".dev.env\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>NODE_ENV는 실행 인자에서 전달해주는 것으로 처리했다.<br>\n이렇게 하면 각 구동 인자에 따라 설정 파일을 다르게 넣을 수 있다.</p>\n<p>그리고 아까 예제를 다시 보면…<br>\n약간 코드를 바꿔야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//auth.module.ts</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Module</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    JwtModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">useFactory</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_KEY</span><span class=\"token punctuation\">,</span>\n        signOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'60s'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>registerAsync</strong> 이걸 써줘야 정상적으로 값을 불러올 수 있다.<br>\n저 비동기 등록을 쓰는 이유는 아직 config에서 env를 가져와서 등록하기 위함이다.</p>\n<p>만약 일반적으로 <strong>JwtModule.register</strong>를 사용하면 에러가 발생한다.<br>\n그래서 비동기 등록을 사용해야 한다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>아주 간단한 문제였는데 덕분에 하나 배웠다.<br>\n항상 기존 틀을 이용해서 그대로 진행하니 이런 부분에서 문제가 생기는 것 같다.</p>\n<p>틀에서 벗어나 본질을 이해해야 하는데 이 부분이 부족했던 것 같다…</p>\n<br>\n<p><a href=\"https://stackoverflow.com/questions/63285055/nestjs-how-to-use-env-variables-in-main-app-module-file-for-database-connecti\">참고 Stackoverflow</a><br>\n<a href=\"https://docs.nestjs.com/techniques/configuration\">공식 Next.js confing 문서</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#nextjs%EC%97%90%EC%84%9C-config\">Next.js에서 Config</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.02.13","title":"Nest.Js에서 @Module의 속성에서 process.env 사용하기","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230213_nestjs_module_config_load/"}},"prev":{"id":"433d1180-7b35-5de3-b36b-383ad8fb814f","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQoz42S0Y6CMBBFW6Cl0GmhxYorrJpAsolP+v8fdzetrqtmxX24GToZztxOhzHGcC+vCEOzwqA9drTCJ3XYmRX2NuDQrJN647A2LYzSeP6fPSciQBTir8KknGegvESTqwRXolwGRmdK/haFEDBNE7bDAOf9Q+26btCWehkYryfy4nbWWmMcxwQmopTjjF+aVRauomVgnFWeZQ85znnSc21XEnxtl4FxLnFOPyApZXJpjEFd18jumnmp0Wn7D4dXYLziPM84Ho84n844n06pwc2hJHS6eePQBpTi8srRTV4UYJwl5fLx9Z3UCNQuA3tlMbuPtIss42grwtZ22BiHnlz6vpw9Dm2PWqpl4A1cWXyFEVRWqLmAzmQSpShSLHnxfrH5NZJQmNzm5YK/0jegveteJRG0qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/7c297/thumbnail_til.webp 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/33ecc/thumbnail_til.webp 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/df77d/thumbnail_til.webp 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dd3ab/thumbnail_til.webp 895w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/e9ea2/thumbnail_til.png 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/53918/thumbnail_til.png 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png 895w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"23년-2월-13일-til\" style=\"position:relative;\"><a href=\"#23%EB%85%84-2%EC%9B%94-13%EC%9D%BC-til\" aria-label=\"23년 2월 13일 til permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>23년 2월 13일 TIL</h1>\n<p>금일 흑우집합소를 개발하며 배운 내용 및 겪은 과정을 정리하여 올려본다.<br>\n오늘은 깔끔한 코드 작성에 대해 고민한 부분을 정리하여 올려본다.</p>\n<p>어제 작업하던 JWT 부분에 대해 매듭을 지려고 했다.<br>\n일부분은 <strong>Ports And Adapters Architecture</strong> 방식으로 작성해보려고 노력중이다.</p>\n<p>근데 확실히 레이어드 아키텍쳐보다 더 나은 것 같다.<br>\n이유는 크게 세 가지다.</p>\n<ol>\n<li>하나의 코드 파일의 가독성 증가</li>\n<li>레이어드 보다 더 세분화 가능</li>\n<li>깔끔한 파일 관리</li>\n</ol>\n<p>개인적 사견이 많이 녹여 있어서 다른 사람은 공감 못할 수 있다.<br>\n레이어드 아키텍쳐로도 충분히 구현 가능하지만, 이 아키텍쳐로 인해 명확하게 각 역할이 나눠지는 것을 채감했다.</p>\n<p>이것은 차후에 다루고…<br>\n오늘 했던 고민은 아래와 같다.</p>\n<br>\n<h2 id=\"고민-포인트\" style=\"position:relative;\"><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8\" aria-label=\"고민 포인트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>고민 포인트</h2>\n<p>먼저 내가 jwt를 검증하는 Inbound 영역의 서비스 로직이 있다.<br>\n코드는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">VerifyJwtService</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">VerifyJwtOutboundPort</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> jwtService<span class=\"token operator\">:</span> JwtService<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">DECODE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> decodJwtOutboundPort<span class=\"token operator\">:</span> DecodeJwtOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">FIND_ACCOUNT_EMAIL_JOIN_TYPE_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> findAccountEmailJoinTypeOutboundPort<span class=\"token operator\">:</span> FindAccountEmainJoinTypeOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOGOUT_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> logoutAccountInboundPort<span class=\"token operator\">:</span> LogoutAccountInboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> createJwtOutboundPort<span class=\"token operator\">:</span> CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">excute</span><span class=\"token punctuation\">(</span>params<span class=\"token operator\">:</span> VerifyJwtInputDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      params<span class=\"token punctuation\">.</span>tokenType <span class=\"token operator\">===</span> <span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span>\n        <span class=\"token operator\">?</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">verifyAccessJwt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>jwt<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">verifyRefreshJwt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>jwt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">async</span> <span class=\"token function\">verifyAccessJwt</span><span class=\"token punctuation\">(</span>jwt<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">verify</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_ACCESS_SECRET_KEY</span><span class=\"token punctuation\">,</span>\n        audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> JwtVerifyOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> validResult <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">tokenExceptionHandler</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> jwt<span class=\"token punctuation\">,</span> <span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>validResult <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> validResult<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">//고민 포인트 01</span>\n      <span class=\"token comment\">//액세스 토큰에서 만료가 되면 리프래시 토큰을 검증한다.</span>\n      <span class=\"token comment\">//큰 문제 없다면 AccessToken을 다시 전달한다.</span>\n      <span class=\"token comment\">//이 부분에는 거의 10~20줄 짜리 코드 로직이 들어갔었다.</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * 리프레시 토큰 검증  고민포인트 02\n   * @param jwt\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">async</span> <span class=\"token function\">verifyRefreshJwt</span><span class=\"token punctuation\">(</span>jwt<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>jwtService<span class=\"token punctuation\">.</span><span class=\"token function\">verify</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        secret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">JWT_REFRESH_SECRET_KEY</span><span class=\"token punctuation\">,</span>\n        audience<span class=\"token operator\">:</span> <span class=\"token function\">getJwtAudience</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        issuer<span class=\"token operator\">:</span> <span class=\"token function\">getJwtIssuer</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REFRESH_TOKEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> JwtVerifyOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//고민 포인트 03</span>\n      <span class=\"token comment\">//리프레시 만료시에 대한 처리 로직</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * 토큰 예외 공통 처리 핸들러\n   * @param e\n   * @param jwt\n   * @param tokenType\n   * @returns\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function\">tokenExceptionHandler</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> Error<span class=\"token punctuation\">,</span> jwt<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> tokenType<span class=\"token operator\">:</span> JwtType<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> AuthException <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//토큰 만료 시</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">TokenExpiredError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[tokenExceptionHandler] : TokenExpiredError'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// return true;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">jwtExpired</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> tokenType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// payload가 잘 못 되었을 때 (base64 decode가 안되는 경우 등)</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SyntaxError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[tokenExceptionHandler] : Syntax'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// throw new AuthException(AuthJwtErrorCode.jwtInvalid(jwt, tokenType));</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">jwtInvalid</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> tokenType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// JwtWebTokenError should be later than TokenExpiredError</span>\n    <span class=\"token comment\">//보통 토큰의 시크릿 코드가 변경되었는데 구형 키 값을 사용하여 만들어진 JWT를 사용할 경우 발생</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">JsonWebTokenError</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[tokenExceptionHandler] : JsonWebTokenError'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// throw new AuthException(AuthJwtErrorCode.invalidTokenOrInvalidSignature(jwt));</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">invalidTokenOrInvalidSignature</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> tokenType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//그 외 기타 에러</span>\n    <span class=\"token comment\">//기타 에러</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">jwtEtcError</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">,</span> tokenType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>딱 봐도 코드의 문제가 보인다. (고민 포인트는 아래서 집어볼 예정)<br>\n일단 가장 큰 문제는 코드의 복잡도가 높다는 것이다.</p>\n<p>내가 최근 연습하고 있는 방법은 <strong>하나의 서비스는 하나의 기능만 담당한다</strong> 이다.<br>\n이게 생각보다 어렵다.</p>\n<p>명확하게 나눠지는건 쉽게 자를 수 있지만 위처럼 Jwt를 구현할 때 Access와 Refresh를 같이 쓴다.<br>\n이 경우 아래와 같이 생각할 수 있다.</p>\n<br>\n<ol>\n<li>먼저 한 메서드를 통해 JWT와 타입을 받고 내부 프라이빗 메서드에서 나눠서 처리하는 방법</li>\n<li>검증 자체 목적에 집중하는 서비스 로직과 Access와 Refresh 각각을 담당하는 서비스로 나눠서 처리하는 방법</li>\n<li>검증이라는 목적에 집중하여 Access와 Refresh 검증만 하고 그 외 예외 발생 시 호출 영역으로 전가시키기</li>\n</ol>\n<br>\n<p>맨 처음 내가 구현한 방법은 1번 방식이었고…<br>\n결국 위 코드처럼 복잡도가 매우 많이 상승하게 되었다.</p>\n<p>그럼 2번으로 할 것인가…<br>\n이 부분도 잘 생각해야 하는게 나누고 자르는게 좋지만 너무 나눌 경우 그것 자체로 인해 기능이 너무 산재되어 결국 코드 팔로우가 힘들 것이다.</p>\n<p>그래서 3번의 방법을 선택하게 되었다.<br>\n이렇게 하면서 각 고민 포인트를 고민하고 해결하였다.</p>\n<br>\n<h3 id=\"고민-포인트-01\" style=\"position:relative;\"><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8-01\" aria-label=\"고민 포인트 01 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>고민 포인트 01</h3>\n<p>Access JWT를 검증하고 catch 하는 부분에서 예외에 대하여 직접 처리하려 했더니 catct 부분이 복잡해졌다.<br>\n이로 인해 Refresh JWT 부분의 catch도 같은 문제가 생기게 되었다.</p>\n<p>이 부분은 위에서 언급한 3번 방법으로 해결하게 되었다.</p>\n<p>JWT를 검증하는 로직에서 <strong>AuthException</strong> 이라는 예외를 직접 핸들링하고,<br>\n이 부분에서 내가 의도한 예외(Access의 Expired 같은)는 따로 정상 처리를 하고,<br>\n그 외의 예외는 호출 지점으로 올려서 Controller 단의 <strong>ExceptionHandler</strong>로 흐르게끔 처리했다.</p>\n<p>그래서 이 부분은 해결할 수 있었다.</p>\n<br>\n<h3 id=\"고민-포인트-02\" style=\"position:relative;\"><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8-02\" aria-label=\"고민 포인트 02 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>고민 포인트 02</h3>\n<p>검증 로직에서 Access 와 Refresh를 각각 나눠서 별도의 파일로 관리할 것인가를 고민했었다.<br>\n근데 이것도 위에서 언급한 바와 같이 정답이 아니었다.</p>\n<p>혹시 별도의 JWT가 추가되면 계속 코드 파일이 늘어나기 때문이다.<br>\n그래서 이 부분은 1번 포인트와 같이 검증 목적에 집중하기로 했다.</p>\n<p>결국 신경 쓸 부분은 Refresh가 만료된 시점에 사용자 로그아웃 처리였다.<br>\n이 부분은 검증 로직에서 신경 쓸 것이 아닌 호출 지점에서 처리할 문제였다.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AccessJwtStrategy</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PassportStrategy</span><span class=\"token punctuation\">(</span>Strategy<span class=\"token punctuation\">,</span> <span class=\"token string\">'jwt'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">VERIFY_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> verifyjwtOutboundPort<span class=\"token operator\">:</span> VerifyJwtOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">DECODE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> decodJwtOutboundPort<span class=\"token operator\">:</span> DecodeJwtOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> createJwtOutboundPort<span class=\"token operator\">:</span> CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">FIND_ACCOUNT_EMAIL_JOIN_TYPE_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> findAccountEmailJoinTypeOutboundPort<span class=\"token operator\">:</span> FindAccountEmainJoinTypeOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOGOUT_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> logoutAccountInboundPort<span class=\"token operator\">:</span> LogoutAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> payload<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> jwt <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'testAuth'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>jwt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">(</span>AuthJwtErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">jwtNotFound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>verifyjwtOutboundPort<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        jwt<span class=\"token punctuation\">,</span>\n        tokenType<span class=\"token operator\">:</span> <span class=\"token constant\">JWT_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ACCESS_TOKEN</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">AuthException</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//Access Jwt 만료된 경우</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>errorCode <span class=\"token operator\">===</span> <span class=\"token constant\">ERROR_CODE_JWT_EXPIRED</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> validResult<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">validRefreshJwt</span><span class=\"token punctuation\">(</span>account<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token comment\">//이후 로직 처리</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> payload<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 코드는 <strong>Strategy</strong> 파일이다.<br>\nNest.js에서 사용하는 전략 파일의 일종이고, 이건 Access Jwt의 처리를 담당하는 Strategy다.</p>\n<p>이 부분에서 토큰 검증 이후 만료된 토큰에 대한 처리, 갱신 가능하면 갱신 처리, 각종 Jwt의 예외처리를 담당했다.<br>\n위 코드는 샘플용이라 정확하지 않지만…</p>\n<p>내가 지금 확인해보니 이 Strategy는 import와 몇 주석을 빼면 100줄도 안되는 코드로 변했다.<br>\n기존에 verify에 몰아서 짤 때는 약 300줄이 넘어갔다 -_-;;</p>\n<p>그래서 <strong>목적에 집중한 코드</strong> 덕분에 한결 나아진 코드를 작성할 수 있었다.</p>\n<br>\n<h3 id=\"고민-포인트-03\" style=\"position:relative;\"><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8-03\" aria-label=\"고민 포인트 03 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>고민 포인트 03</h3>\n<p>이 부분도 01, 02와 연계되어 있는데, 결국 Refresh가 만료되었을 때에 대한 처리 빼곤 Access와 동일했다.<br>\n그래서 별도 분리를 하지 않고, verify에서 예외를 호출단으로 넘기고 처리는 호출점에서 담당하는 방식으로 해결했다.</p>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>오늘도 코드를 작성하면서 좀 더 깔끔하고, 유지보수가 쉬운 코드로 작성하는 연습을 하면서 하니…<br>\n사실 시간은 좀 배로 걸리는 것 같다.</p>\n<p>실행 목적에 집중하여 막 짜면 결과는 사실 금방 나온다.<br>\n그리고 이렇게 블로그로 남길거 생각 안하면 더 빠르고…</p>\n<p>근데 이렇게 하여 완성하고 나면 결국 그 뒤가 문제다.<br>\n지금 내가 만든 <strong>MyMe.Link</strong>가 그렇다.</p>\n<p>정말 코드가 판타스틱하다.<br>\n사실 유지보수 해야 하는데 정말 큰 일이 된거 같아서 큰일이다…<br>\n차라리 다시 짜는게 나을 것 같기도 할 정도니 말이다.</p>\n<p>이번 흑우집합소는 그런 전철을 안밟게 하려고 하는데 이게 맞는건지도 사실 잘 모르겠다.<br>\n정답은 없기에…</p>\n<p>일단 이게 최선의 방법인 것 같고 하면서 더 나은 코드를 짜는 방법을 찾는게 목적이 되었다.</p>\n<p>중간에 개발업 내려놨다 왔지만 나름 5년차 백엔드 개발자다.<br>\n물론 약 3년 휴식 + 전에 약간 섞인 물경력이 문제긴 하지만…</p>\n<p>나름 쌓여있는 경험치 덕분에 혼자서도 이렇게 잘(?) 해낼 수 있던 것 같다.</p>\n<p>이제는 다른 사람과 함께 일해보고 싶다.<br>\n근데 일단 매듭은 짓고 다시…</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8\">고민 포인트</a></p>\n<ul>\n<li><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8-01\">고민 포인트 01</a></li>\n<li><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8-02\">고민 포인트 02</a></li>\n<li><a href=\"#%EA%B3%A0%EB%AF%BC-%ED%8F%AC%EC%9D%B8%ED%8A%B8-03\">고민 포인트 03</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.02.14","title":"23년 2월 14일 TIL & 개발노트 (깔끔한 코드에 대한 고민)","categories":"til","emoji":"📜"},"fields":{"slug":"/til/230214_til/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/til/230119_til/","nextSlug":"/nest_js/230213_nestjs_module_config_load/","prevSlug":"/til/230214_til/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}