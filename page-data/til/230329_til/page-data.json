{"componentChunkName":"component---src-templates-blog-post-js","path":"/til/230329_til/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab","siteUrl":"https://elfinlas.github.io","comment":{"disqusShortName":"","utterances":"elfinlas/blog_utterances"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"82da66f3-c506-518c-ad04-b6139fb4c730","excerpt":"흑우집합소 개발을 하며… PS : 아래 예제에서 호출되는 url은 참고용입니다 개발이 거의 끝나가는 무렵이었다. 사실 막 짠 코드가 좀 있었고… 로직이 좀 엉상한 부분도 있었다. 그래서 미래에 또 헤매거나 복잡함을 피하기 위해 찌금 작업을 좀 해두자 라는 마인드로… 일부 리팩토링을 진행했다. 1. 똥이 되어가는 코드를 코드 리팩토링 프론트엔드 영역에서 Axios…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 895px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMklEQVQoz42SW2/CMAyFk7a50Li3lFJGuw2plSbxBP//x50lhjFAo+zhyI3lfj5xLIQQuJW3hKFaY3AeH7TGO7X4KNb4LDvsqw2rLxpsihqFdXj8XzwmIkBl6q9CVioTUGpQpZbhVpllYHRm9W9R13WYpgm7YUDj/V3tJq9QG7cMjNdTaXY9O+cwjiODiYhzUshzs1WJZkXLwDirNEnuclJK1mNtawg+L5eBcS5xTj8grTW7LIoCeZ4juWnmtUPryn84vADjFed5xuFwwOl4Cjpyg6tDTQFYvXAYgEadXzm6SbMwTylYqb5//SY47KheBva2xNy88S6KRKIOQ9+VLbZh93pq+Pt89tjXPXJtl4FXcHjBr24EmRVyqeASzSKOiqOR2evFlpdIymJqtk8X/Jm+AaC961594rpnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/77434/thumbnail_til.webp 300w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/411c4/thumbnail_til.webp 600w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dd3ab/thumbnail_til.webp 895w\"\n              sizes=\"(max-width: 895px) 100vw, 895px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/a8a0d/thumbnail_til.png 300w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dface/thumbnail_til.png 600w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png 895w\"\n            sizes=\"(max-width: 895px) 100vw, 895px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"흑우집합소-개발을-하며\" style=\"position:relative;\"><a href=\"#%ED%9D%91%EC%9A%B0%EC%A7%91%ED%95%A9%EC%86%8C-%EA%B0%9C%EB%B0%9C%EC%9D%84-%ED%95%98%EB%A9%B0\" aria-label=\"흑우집합소 개발을 하며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>흑우집합소 개발을 하며…</h1>\n<blockquote>\n<p>PS : 아래 예제에서 호출되는 url은 참고용입니다</p>\n</blockquote>\n<br>\n<p>개발이 거의 끝나가는 무렵이었다.<br>\n사실 막 짠 코드가 좀 있었고…</p>\n<p>로직이 좀 엉상한 부분도 있었다.<br>\n그래서 미래에 또 헤매거나 복잡함을 피하기 위해 찌금 작업을 좀 해두자 라는 마인드로…<br>\n일부 리팩토링을 진행했다.</p>\n<h2 id=\"1-똥이-되어가는-코드를-코드-리팩토링\" style=\"position:relative;\"><a href=\"#1-%EB%98%A5%EC%9D%B4-%EB%90%98%EC%96%B4%EA%B0%80%EB%8A%94-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%BD%94%EB%93%9C-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\" aria-label=\"1 똥이 되어가는 코드를 코드 리팩토링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 똥이 되어가는 코드를 코드 리팩토링</h2>\n<p>프론트엔드 영역에서 Axios를 호출하는 부분에 대한 고민이 깊어졌다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">await</span> <span class=\"token function\">excuteAxiosInbound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  inboundRequestConfig<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    url<span class=\"token operator\">:</span> <span class=\"token string\">'/api/test/some/url'</span><span class=\"token punctuation\">,</span>\n    data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> url<span class=\"token operator\">:</span> <span class=\"token string\">'acc/logout'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> <span class=\"token string\">'post'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>responseData <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//로그이웃 처리 및 기타 작업 ing~</span>\n    router<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/gogo/somewhere'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">axiosClientErrorHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> axiosError<span class=\"token operator\">:</span> e <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이렇게 되어 있다.<br>\n물론 전체 코드는 아니고 호출되는 영역만 가져왔다.</p>\n<p>근데 이걸 매번 호출할 때마다 반복적으로 작성해야 하는 부분이 마음에 안들었다.<br>\n지금 호출 로직은 아래의 세 가지 문제점이 발생한다.</p>\n<b>\n<blockquote>\n<ol>\n<li>저 호출 부분에서 성공 시 또는 실패 시 처리해야 할 공통 로직이 추가된다면 일일히 바꿔야 하는 문제가 생긴다.</li>\n<li>setLoading과 같은 상태 관리(Zustant)의 로직을 호출 컴포넌트마다 작성해야 한다.</li>\n<li>매번 인바운드(내부 api 주소로 호출하는 영역) 부분의 주소를 적거나 아웃바운드(백엔드 쪽)로 내보내야 하는 부분이 겹칠 때가 있다.</li>\n</ol>\n</blockquote>\n</b>\n<br>\n<p>이런 문제로 인해 저 부분을 공통 로직으로 만들어 쓰기로 하고…<br>\n이를 해결하기 위해 몇 가지 고민을 했다.</p>\n<b>\n<blockquote>\n<ol>\n<li>then 성공 로직에서 성공 시 공통으로 처리할 함수를 적어주기 (예외 발생시 처럼)</li>\n<li>excuteAxiosInbound 함수 자체를 전달인자로 바꾸기</li>\n<li>inbound로 나가는 axios를 개선</li>\n</ol>\n</blockquote>\n</b>\n<br>\n<p>해결법에서 1번은 사실 좋은 선택은 아니었다.<br>\n만들어갈 결과물에 포함될 방법일 뿐 그 자체만으로는 해결이 되지 않는다.</p>\n<p>2번은 생각해보니 성공 실패 로직에 대한 것을 호출 영역에서 함수로 전달하면 될 것 같다는 생각이 들었다.<br>\n3번은 지금도 되어 있긴 한데 문제 2번의 스토어를 넣어서 같이 사용하는 방향으로 하면 좋을 것 같았다.</p>\n<p>그래서 해결을 위해 호출하는 공통 로직을 Custom Hook으로 만들어야 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useCallback <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SweetAlertOptions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'sweetalert2'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SendAxiosRequestConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../lib/axios/axios.type'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> excuteAxiosInbound <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../lib/axios/axios.util'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> axiosClientErrorHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../lib/axios/errors/axios.client.error.handler'</span>\n<span class=\"token keyword\">import</span> useSetAccountInfo <span class=\"token keyword\">from</span> <span class=\"token string\">'./stores/use.account.info'</span>\n<span class=\"token keyword\">import</span> useLoading <span class=\"token keyword\">from</span> <span class=\"token string\">'./stores/use.loading'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">AxiosCallClientHandlerInputDto</span> <span class=\"token punctuation\">{</span>\n  outboundData<span class=\"token operator\">:</span> SendAxiosRequestConfig\n  successAction<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span>\n  failSwal<span class=\"token operator\">:</span> SweetAlertOptions\n  setLoadingAction<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span>\n  outboundHeader<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span> <span class=\"token comment\">//Outbound로 헤더 보낼 때 쓰는 속성</span>\n  inboundUrl<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token comment\">//inbound 호출 URL이 다른 경우 별도 작성 (Default = api/hub)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Axis 내부 호출 Hook\n * @returns\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useAxiosInbound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> handleSetLoading <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useLoading</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> handleLogoutAccountInfo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useSetAccountInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">//변수 선언</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">axiosCallClientHandler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\n    params<span class=\"token operator\">:</span> AxiosCallClientHandlerInputDto\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//로딩</span>\n    <span class=\"token function\">handleSetLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">await</span> <span class=\"token function\">excuteAxiosInbound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      inboundRequestConfig<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        url<span class=\"token operator\">:</span> params<span class=\"token operator\">?.</span>inboundUrl\n          <span class=\"token operator\">?</span> params<span class=\"token punctuation\">.</span>inboundUrl\n          <span class=\"token operator\">:</span> <span class=\"token string\">'/use_api/back/inbound/axios'</span><span class=\"token punctuation\">,</span>\n        data<span class=\"token operator\">:</span> params<span class=\"token punctuation\">.</span>outboundData<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      outboundHeader<span class=\"token operator\">:</span> params<span class=\"token punctuation\">.</span>outboundHeader<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">handleSetLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>responseData <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        params<span class=\"token punctuation\">.</span><span class=\"token function\">successAction</span><span class=\"token punctuation\">(</span>responseData<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">axiosClientErrorHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          axiosError<span class=\"token operator\">:</span> e<span class=\"token punctuation\">,</span>\n          handleLogoutAccountInfo<span class=\"token punctuation\">,</span>\n          failSwal<span class=\"token operator\">:</span> params<span class=\"token punctuation\">.</span>failSwal<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">//메모제이션을 해준다.</span>\n  <span class=\"token keyword\">const</span> handleExcuteAxiosInbound <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span>params<span class=\"token operator\">:</span> AxiosCallClientHandlerInputDto<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">axiosCallClientHandler</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>axiosCallClientHandler<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> handleExcuteAxiosInbound <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>이 Hook은 <strong>handleExcuteAxiosInbound</strong>라는 함수를 반환하는데 여기에 호출할 inputDto인 <strong>AxiosCallClientHandlerInputDto</strong>를 전달하면 된다.<br>\n그래서 호출할 컴포넌트에서는 아래와 같이 간단하게 호출할 수 있었다.</p>\n<p>그리고 <strong>useCallback</strong>을 이용해 재사용성을 하게 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">PagingProps</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//....</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">PagingComponent</span><span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> PagingProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//some logic..</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> handleExcuteAxiosInbound <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useAxiosInbound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handle4PageChange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>page<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleExcuteAxiosInbound</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      outboundData<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        url<span class=\"token operator\">:</span> <span class=\"token string\">'some/page/data/list?page='</span> <span class=\"token operator\">+</span> page <span class=\"token operator\">+</span> <span class=\"token string\">'&amp;pnum=10'</span><span class=\"token punctuation\">,</span>\n        method<span class=\"token operator\">:</span> <span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">successAction</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>responseData<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">clearDataList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> listData <span class=\"token operator\">=</span> responseData<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">.</span>resultData\n        <span class=\"token function\">setDataList</span><span class=\"token punctuation\">(</span>listData<span class=\"token punctuation\">.</span>dataList<span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">//페이지 데이터</span>\n        <span class=\"token keyword\">const</span> pageData <span class=\"token operator\">=</span> listData<span class=\"token punctuation\">.</span>pageData\n\n        <span class=\"token function\">setNowPage</span><span class=\"token punctuation\">(</span>pageData<span class=\"token punctuation\">.</span>nowPage<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">setTotalItemCnt</span><span class=\"token punctuation\">(</span>pageData<span class=\"token punctuation\">.</span>totalItemCnt<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">setTotalPage</span><span class=\"token punctuation\">(</span>pageData<span class=\"token punctuation\">.</span>totalPage<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">setPerPageNum</span><span class=\"token punctuation\">(</span>pageData<span class=\"token punctuation\">.</span>perPageNum<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      failSwal<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        title<span class=\"token operator\">:</span> <span class=\"token string\">'데이터 로드 실패'</span><span class=\"token punctuation\">,</span>\n        html<span class=\"token operator\">:</span>\n          <span class=\"token string\">'페이지 데이터 로드에 실패하였습니다. &lt;br> 관리자에게 문의해 주세요.'</span><span class=\"token punctuation\">,</span>\n        icon<span class=\"token operator\">:</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>\n        confirmButtonText<span class=\"token operator\">:</span> <span class=\"token string\">'확인'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>개선된 코드는 간단 명료하다.<br>\naxios를 사용할 곳에 <strong>useAxiosInbound()</strong>라는 hook을 호출하여 실제 Axios 작업을 하는 함수를 불러온다.</p>\n<p>성공은 호출되는 영역마다 작업이 상이해서 저렇게 함수를 전달하지만,<br>\n실패는 언제나 지정된 양식이 있기에 공통으로 처리하고, 그 이외 예외는 알럿을 호출할 수 있게 해줬다.</p>\n<p>저 inputDto 자체는 재사용이 안되고, 호출 지점마다 고유해서 이 정도만 해도 많이 개선이 되었다고 판단했다.</p>\n<h2 id=\"2-배포만-하면-문제\" style=\"position:relative;\"><a href=\"#2-%EB%B0%B0%ED%8F%AC%EB%A7%8C-%ED%95%98%EB%A9%B4-%EB%AC%B8%EC%A0%9C\" aria-label=\"2 배포만 하면 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 배포만 하면 문제…</h2>\n<p>이제는 몇 가지 테스트를 위해 배포를 해봤는데 자꾸 몇 가지 기능이 정상적으로 동작하지 않았다.<br>\n로그인 부분과 이중 로그인 영역 쪽이었다.</p>\n<p>그래서 20분 고민하다가…<br>\n내 로컬과 배포 환경과의 차이점이 뭘까?</p>\n<b>\n<blockquote>\n<ol>\n<li>pm2 구동환경</li>\n<li>방화벽</li>\n<li>nginx</li>\n<li>aws와 Cloudflare의 환경</li>\n</ol>\n</blockquote>\n</b>\n<p>그래서 각 부분을 하나씩 점검했다.<br>\n1번의 경우 문제는 아니었다.<br>\n어짜피 구동하는건 로컬이나 pm2로 올리나 똑같으니까?</p>\n<p>2번 방화벽도 재점검 했는데 문제는 아니었다.<br>\n백엔드는 지정된 ip와 서버 내, 그리고 nginx에서 제대로 프록싱 하고 있었다.</p>\n<p>3번…이 정답이었다.<br>\nNginx는 기본적으로 헤더를 알려진 값 외에는 막는다.</p>\n<p>그래서 내가 커스텀으로 사용한 헤더가 정상적으로 전달이 되지 않은 문제가 답이었다.<br>\n이와 관련된 내용은 <a href=\"https://elfinlas.github.io/nginx/230330_nginx_header/\">Nginx에서 헤더 전달하기 (프록시 사용)</a> 포스팅을 참고하자.</p>\n<br>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>역시 코드를 잘 작성하는 부분이 중요하다.<br>\n백엔드의 경우 Layer 아키텍쳐에서 포트 앱 어댑으로 바꾸고 나서 정말 코드 보기가 편해졌다.</p>\n<p>그리고 리팩토링…<br>\n개인적으로 리팩토링은 코드를 계속 지속 가능성이 될 수 있도록 해주는 중요한 수단인 것 같다.</p>\n<p>배포환경…<br>\n빨리 찾아서 다행이지…<br>\n좀만 더 늦었으면 와인 까서 마시면서 엄한 곳이나 쑤셨을 듯 싶다…</p>","frontmatter":{"title":"23년 3월 29일 TIL & 개발노트 (코드 리팩토링, 배포환경)","date":"March 30, 2023"}}},"pageContext":{"slug":"/til/230329_til/","previous":{"fields":{"slug":"/my_project/230329_bcow_start/"},"frontmatter":{"title":"로또 커뮤니티 서비스 흑우집합소 오픈하다"}},"next":{"fields":{"slug":"/nginx/230330_nginx_header/"},"frontmatter":{"title":"Nginx에서 헤더 전달하기 (프록시 사용)"}}}},"staticQueryHashes":["3128451518","903436796"]}