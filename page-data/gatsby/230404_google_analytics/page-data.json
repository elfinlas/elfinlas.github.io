{"componentChunkName":"component---src-templates-post-template-index-tsx","path":"/gatsby/230404_google_analytics/","result":{"data":{"cur":{"id":"585cb9fd-cea8-5e38-8fba-76203e6890b7","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADoUlEQVQ4yx3S20+TBwCG8e9P2M3cZmDjVChQ+tGWUtoCQgFXKFQptECRcoZaDoWBQQ5FYCBnkNFwEBAEgsMyTUxGwCzLFpfMmSlmgSVzw8CyycUSdZol7sI9S7j43T3v3Svs3tvmYOceR3s/8NeThzzff8zr33d5ebjHP0e/8PbFU/57dQBvnvH8cAfPhUbM5mx0CgWq4CCUMjk6bSLKSDmn4hMRHmzdYv/+Vxw+/Iajn77jxZMfefnbI/7ef8Srpzv8++ceb57twesD/nj8NQW2ArKyzqIT5Sg/8kMVJaLTxKOIkJGg1SOcd9bT1e5hYmiY8YFBfItz7H67yfKMl66LLfz6/TZvj37mwdYGLfV1FNqLyDSZ0YoiisAAVKKSOLWW6HAZek0cgiYuntR0C/kOJ7aiamyFFZQ4iskyZ6PRp7BxbZr727fJtuQjCZej1ycgRimJFmOIVeuRhsmICBcJk0iJCJUiRItyxGglMTGxJCQkk5KWgUqtRa1Uo1BpsOdZKSl0oIpNIDXNSGpaBrr4FMxmK2K0Gn//QD70DyIgIJTAQAmCLDKCSEkIYpiEOHUsBkMqMqmMkIAAosJCsWaZWVz8HO/UEkvXfdz0bbK6doe1G3eoKK/F3z/4WGBwJGHhSgRpWAjhIUFIJUGIUQokoVLeCQnlfbmMZEMifV39LN24y9zyJt7523hnfUzPbTAx42NweA6TyYLZnENBvoOS4koEqUTCyRPv8sGJ9/DzC+R0mpH2/hGGpq6xsnKTjS+2mJjdwHN5ns7+BboHFhj9bIXuy7N4emeZmFyit6ef5qY2KitqEXRaPalJyeSctVBX4z4OpmbWGb1ynbHJZbxTKwyOL+Fuu0JlwwAN7RN0fDpN78AsdU29nHPUYrEUYjRZiYpUIXS0eujv6WN8cJievkmq6nsoc3VS6mzjXGkD9Y2dtHWOUNfcQ7X7EuWuNvKLakjPyCUxyUiOtZhWzzCDo/O0tA0iuGsb+cTdRK3LTVq6FW1iJgajjdR0G7n5FRSV1NDY1I7T6SYntxB9fMqxPHs5vf1eFhZvcXXex8jYApe6xxCcVS5czlqqKl04iquw2cuxFpQdD/LySzGfsWEwpKPTJZNkyKDa1Yx3epV1311W175k5uo64xOLdHQOYbeXIZgyMkk3mo7fb8o8w8fGTJIMp4nV6JDLFchk0ce0ulNUVru52NpD0wUPdfUtnHc1UVlVj6O4GkuOneTkNP4HjlZGeXlwe9EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/733ebb000f49022bdc81f660329a016f/7c297/thumbnail.webp 180w,\n/static/733ebb000f49022bdc81f660329a016f/33ecc/thumbnail.webp 360w,\n/static/733ebb000f49022bdc81f660329a016f/df77d/thumbnail.webp 720w,\n/static/733ebb000f49022bdc81f660329a016f/5ce83/thumbnail.webp 1032w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/733ebb000f49022bdc81f660329a016f/e9ea2/thumbnail.png 180w,\n/static/733ebb000f49022bdc81f660329a016f/53918/thumbnail.png 360w,\n/static/733ebb000f49022bdc81f660329a016f/242a6/thumbnail.png 720w,\n/static/733ebb000f49022bdc81f660329a016f/92844/thumbnail.png 1032w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/733ebb000f49022bdc81f660329a016f/242a6/thumbnail.png\"\n            alt=\"mhlab\"\n            title=\"mhlab\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"간만에-구글-애널리틱스에-가보니\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%A7%8C%EC%97%90-%EA%B5%AC%EA%B8%80-%EC%95%A0%EB%84%90%EB%A6%AC%ED%8B%B1%EC%8A%A4%EC%97%90-%EA%B0%80%EB%B3%B4%EB%8B%88\" aria-label=\"간만에 구글 애널리틱스에 가보니 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간만에 구글 애널리틱스에 가보니…</h1>\n<p>티스토리나 알려진 블로그 플랫폼은 Google Analytics의 연결이 매우 편리하게 되어있다.<br>\n하지만 그외 플랫폼은 직접 연결을 해줘야 한다.</p>\n<p>사실 붙여놓고 잘 안들어갔다.<br>\n내 개인 블로그를 많이 와주면 고맙겠지만, 이런거 일일히 신경쓰면 피곤하다.</p>\n<p>그래서 오면 오고 안오면 안오나보다 하고 하는게 맘 편하다.<br>\n그리고 내가 무슨 네임드 개발자도 아니고, 그냥 삽질하고, 경험한거 쓰는 블로그인데 뭐…</p>\n<p>그래도 궁금한거 댓글 남기거나 하면 바로바로 답은 해주려고 노력하는 편이다.</p>\n<p>서두가 길었다.<br>\n어느날부터인가…</p>\n<p>애널리틱스 사이트에 들어갔더니 아래처럼 뭔가 떴다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeklEQVQI1zXHyw6CMABEUf7/rwxYiS50o2hjsabUGnklvlDsOCYVFpMzN7roFCqLIdcT7Dcx8m2Cw24aPEoBLYUfW2VJ0KgUzWmJ1q1QaoHKzFGbBUo9Q/R9Wd7bnLdG8Vorfh4FfWfpn0VY6PEPorNk78j+POjI998fUKSS0+rL0gYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/7c297/img01.webp 180w,\n/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/33ecc/img01.webp 360w,\n/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/df77d/img01.webp 720w,\n/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/39914/img01.webp 1043w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/e9ea2/img01.png 180w,\n/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/53918/img01.png 360w,\n/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/242a6/img01.png 720w,\n/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/0b8c0/img01.png 1043w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4d4e8febb7bf19d7a7fe71f7e40afc2f/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>지금이 벌써 23년 4월이니 이제 준비를 안하면 이 집계도 못사용하겠다 싶어서 바꿔봤다.<br>\n근데 내가 쓰는건 만든이가 더 이상 관리하지 않는 오픈소스 테마였기에…</p>\n<p>문제가 있으면 스스로 고쳐서 써야하는 상황이다.<br>\n그래서 그냥 애널리틱스 ID만 바꾸면 쉽게 해결될 것 같아서 <strong>gatsby-meta-config.js</strong>에서 ga 값만 변경해봤다.</p>\n<p>근데 수신을 못해서 계속 페이지에서 데이터 송수신 자료가 없다고 했다.</p>\n<h2 id=\"뭐가-문제일까\" style=\"position:relative;\"><a href=\"#%EB%AD%90%EA%B0%80-%EB%AC%B8%EC%A0%9C%EC%9D%BC%EA%B9%8C\" aria-label=\"뭐가 문제일까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>뭐가 문제일까?</h2>\n<p>먼저 내 테마의 깃허브 이슈를 봤지만…<br>\n역시 관리를 하지 않고, 거의 개인적으로 업데이트 또는 커스터마이징 해서 쓰느라 최신 글도 없었다.</p>\n<p>그래서 구글에 좀 찾아보니 <strong>Gatsby</strong> 깃헙에서 약간의 힌트를 찾을 수 있었다.<br>\n<a href=\"https://github.com/gatsbyjs/gatsby/issues/27627\">여기 이슈 27627</a>에 의하면 <strong>Not updated for New Google Analytics</strong><br>\n즉 최신 구글 애널리틱스가 업데이트 되지 않는다고 한다.<br>\n나랑 증상이 같은 것이다.</p>\n<p>그 중 <strong>rajatrao777</strong>라는 외쿸 성님이 아래와 같이 답을 남겼다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABFUlEQVQoz4WSi26DMAxF+/+fOCiPbYyQYJLwaElIeyubqtOkVVg6saOAfe3kpJovWGvRtApkHablCj8tf1hDRIgJa9ywhvdcQ8QJALZtw/lcoGka9H0Py4mnSRjHUXDOIYSAI5OE6xpQVTWyPEddf0JrjZ4IRITBWilCNEgnznt476UIF2a83wuyMEkYY0TfE7Q28vE8zy9lvOdzttv9jvsBJ17Y+GdtDLpOv2hbBdV1UEqJunEJcE81rGz3FjQGmDFhCbffhEp1+MhyFGWJoihlpll+lrgsK9TfLX744ohENbe5t+v/V8gHPDtjjMxs9ySF2HdmkDildHwp/CScM7h4h4vziOmGGDfEjUlP9jjI04lveQD3i2gSn/gx9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7b2177ef0f32f4f5106c4a8afe97936/7c297/img02.webp 180w,\n/static/b7b2177ef0f32f4f5106c4a8afe97936/33ecc/img02.webp 360w,\n/static/b7b2177ef0f32f4f5106c4a8afe97936/df77d/img02.webp 720w,\n/static/b7b2177ef0f32f4f5106c4a8afe97936/74e18/img02.webp 1047w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7b2177ef0f32f4f5106c4a8afe97936/e9ea2/img02.png 180w,\n/static/b7b2177ef0f32f4f5106c4a8afe97936/53918/img02.png 360w,\n/static/b7b2177ef0f32f4f5106c4a8afe97936/242a6/img02.png 720w,\n/static/b7b2177ef0f32f4f5106c4a8afe97936/094ea/img02.png 1047w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7b2177ef0f32f4f5106c4a8afe97936/242a6/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<p>요약하면 Gatsby 플러그인 중 <strong>google-tag</strong> 플러그인이 이제는 지원하지 않아서,<br>\n새로운 플러그인인 <a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-gtag/\">gatsby-plugin-gtag</a>을 사용하라는 것이다.</p>\n<h2 id=\"그래서-적용은-어떻게\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%A0%81%EC%9A%A9%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C\" aria-label=\"그래서 적용은 어떻게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 적용은 어떻게?</h2>\n<p>이것도 쉽다.<br>\n아래의 순서대로 하나씩 따라 해보자.</p>\n<h3 id=\"1-기존-플러그인-삭제\" style=\"position:relative;\"><a href=\"#1-%EA%B8%B0%EC%A1%B4-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%82%AD%EC%A0%9C\" aria-label=\"1 기존 플러그인 삭제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 기존 플러그인 삭제</h3>\n<p>먼저 기존에 쓰던 플러그인은 제거하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm remove gatsby-plugin-google-analytics</code></pre></div>\n<p>그리고 <strong>gatsby-config.js</strong>파일에서 아래 설정을 지워주자.<br>\n아니면 주석 처리를 해도 되지만 혹시 모르니…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n      resolve: `gatsby-plugin-google-analytics`,\n      options: {\n        //etc option\n      },\n},</code></pre></div>\n<br>\n<h3 id=\"2-gatsby-plugin-gtag-설치\" style=\"position:relative;\"><a href=\"#2-gatsby-plugin-gtag-%EC%84%A4%EC%B9%98\" aria-label=\"2 gatsby plugin gtag 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. gatsby-plugin-gtag 설치</h3>\n<p>아래의 명령어를 통해서 설치해주자.<br>\n혹시 이 플러그인이 궁금하면 <a href=\"https://www.gatsbyjs.com/plugins/gatsby-plugin-gtag/\">gatsby-plugin-gtag</a> 공식 페이지를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save gatsby-plugin-gtag</code></pre></div>\n<br>\n<h3 id=\"3-config-수정\" style=\"position:relative;\"><a href=\"#3-config-%EC%88%98%EC%A0%95\" aria-label=\"3 config 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. config 수정</h3>\n<p><strong>gatsby-config.js</strong>파일을 수정한다.<br>\n아래와 같이 플러그인 설정을 하나 밀어 넣는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> {\n    module.exports = {\n        siteMetadata: metaConfig,\n        plugins: [\n            {...기타 옵션}\n\n            //아래가 밀어넣을 옵션\n            {\n                resolve: `gatsby-plugin-gtag`,\n                options: {\n                    trackingId: metaConfig.ga,\n                    head: true,\n                    anonymize: true,\n                },\n            }\n        ]\n    }\n},</code></pre></div>\n<p>저기 위에서 <strong>trackingId</strong>의 경우 직접 문자열 값을 줘도 된다.<br>\n나 같은 경우 <strong>metaConfig</strong>라는 config 설정에서 값을 가져오는데 아래와 같이 처리해도 무방하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">trackingId: \"G-ABCD1234\",,</code></pre></div>\n<p>당연한 이야기겠지만 나처럼 할 경우 <strong>metaConfig</strong>값을 변경해야 한다.</p>\n<br>\n<h3 id=\"4-빌드-또는-배포\" style=\"position:relative;\"><a href=\"#4-%EB%B9%8C%EB%93%9C-%EB%98%90%EB%8A%94-%EB%B0%B0%ED%8F%AC\" aria-label=\"4 빌드 또는 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 빌드 또는 배포</h3>\n<p>보통 나랑 같은 테마를 쓰거나 또는 다른 테마를 써도 배포할 때는 빌드를 할 것이다.<br>\n그래서 빌드를 따로 하거나, 배포를 해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\"deploy\": \"gatsby build &amp;&amp; gh-pages -d public -b ....\",</code></pre></div>\n<p>위는 내 배포 명령어인데 앞에 빌드를 선행한다.<br>\n그리고 바로 되지 않고, 약 5~30분?</p>\n<p>난 30분 정도 지나니까 아래처럼 수신으로 바뀌었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVQY02VQSQ7CMBDL/38HEhe6Z2nSLQmFVl0xSqCFioNlT2SNJya8nqDsc0dxg4fT0qw7b/oXpfPar0c0M0jILAKqEYs7ItHiSg0CasDr8bDUhbBqBK1GCL1A6hlX1iIqZii77qEk5hYh1UhkhyR/+MWZ6g8XOc3KwQfF+QOiWcDLHpekwSkbDl4i7RO5WZHrxUOa5fBVx+49VT0i3iJkNz/zasA5tjinnb928xNl/7t5Y4Xa+/mE6Qmimbx2nBYD0nL89PjGC5v8etELZoD5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fb8a821253aa6bf3e2882a2fa29907ee/7c297/img03.webp 180w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/33ecc/img03.webp 360w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/df77d/img03.webp 720w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/5c666/img03.webp 1080w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/56a3d/img03.webp 1331w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fb8a821253aa6bf3e2882a2fa29907ee/e9ea2/img03.png 180w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/53918/img03.png 360w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/242a6/img03.png 720w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/b4ad3/img03.png 1080w,\n/static/fb8a821253aa6bf3e2882a2fa29907ee/0b245/img03.png 1331w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fb8a821253aa6bf3e2882a2fa29907ee/242a6/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>근데 이렇게 해도 잠깐 끊겨서 다시 48시간 동안 수집한 정보다 없다고 할 수 있다.<br>\n하지만 시간이 또 흐르면 저렇게 활성화 되었다고 뜨니 너무 걱정하지 말자.</p>\n<p>여차하면 <a href=\"https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna\">크롬 익스텐션-Google Analytics Debugger</a>를 설치해서 써보자.<br>\n설치 후 활성화되고 난 뒤 디버거 콘솔을 열면 아래처럼 정보가 뜬다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 625px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACxklEQVQ4y01U13LbQAzUXzgZySrsPHaxU6J6sSRHzjiT//+UzSxoMn7A3B1wXOwCOI403cJCM6EbNmZzfTD65gtD/LzzPUY/bTrTEC8LLLMSQbiE50cY6YYD1wsRREsoL4TyIjgqQBRn4ndViDDOoPwItuML0Hfg1+lCbPI6h+P6BLRhuz78IIEXxGJhnIoR0LIVwihFlOQS69n1wFyphntXBRjpui3OXhZlGKYznDXdHOJM3gORDZNSCSULmU6yLTJZA0qlRMvxhjNj/JB7sh2YaSYWuiWJaPS7qpfsdNn8MBGjPBabWW3H+yp8JbFeZq+G9eM61JAfpHktH8XLHElaigTuyY4rG0awvFzJPWHjhRLLihplvRbpfhB3gEW1wnpzENvsTsjyWjruSgn+m/i8ENPpArOZJswI1qx3QioIk05yUa1xvT/x/vEH1/sHtvsz6tVWgLOiERZkx5V3oyTrpkCFciahZFkgCGOMDAFc4f7rE+vtEVWzQdPuBIhZeaaRPVcm2h0uOF0fsm93R2HI+wND0r7cntgeLmi33YWybqVeHGg2h0mZgKzIhiwZY205pyyJjA1rSClV0woLyuWZjeD4GJYjc2la7jAiJNHPZJpXyMsGcZJ1ktlqSjxd7jiebzhfH1i1eyRp0dnXW2WteLd/9/3bP5zecH57CJkoTjGyLFck3t5/D4C8xI6y8P1zlKbktfgon2NC1tKwohEwGRvL9bGs1qg3B5TrHer2gCgroVsuDEvBsBV004XpeJjrFqb8y/CnwGGeacjZ5aZFwj8OGZbjCU7TGT6LEn+bFX7nBT6rCs8sxy1NcUuWeGQ5nlWNkx9gpRs4KCX71jSxsWwcPB+1ZiP9OcYoep1hb1q4hRHuQYSL8vGIExyVj41S2CqFnedh7/s4xzE2rgv/5Qe8lxfE4wmyhYZ0vkA4niCevOIf2ZYNfYBc95cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2a62d3a8666b3447b54b076adb237f58/7c297/img04.webp 180w,\n/static/2a62d3a8666b3447b54b076adb237f58/33ecc/img04.webp 360w,\n/static/2a62d3a8666b3447b54b076adb237f58/529ab/img04.webp 625w\"\n              sizes=\"(max-width: 625px) 100vw, 625px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2a62d3a8666b3447b54b076adb237f58/e9ea2/img04.png 180w,\n/static/2a62d3a8666b3447b54b076adb237f58/53918/img04.png 360w,\n/static/2a62d3a8666b3447b54b076adb237f58/b1b4f/img04.png 625w\"\n            sizes=\"(max-width: 625px) 100vw, 625px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2a62d3a8666b3447b54b076adb237f58/b1b4f/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>만약 정보가 안뜨면 뭔가 설정을 빠트리거나 문제가 생긴 것이니 다시 확인해보자.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%AD%90%EA%B0%80-%EB%AC%B8%EC%A0%9C%EC%9D%BC%EA%B9%8C\">뭐가 문제일까?</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%A0%81%EC%9A%A9%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C\">그래서 적용은 어떻게?</a></p>\n<ul>\n<li><a href=\"#1-%EA%B8%B0%EC%A1%B4-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8-%EC%82%AD%EC%A0%9C\">1. 기존 플러그인 삭제</a></li>\n<li><a href=\"#2-gatsby-plugin-gtag-%EC%84%A4%EC%B9%98\">2. gatsby-plugin-gtag 설치</a></li>\n<li><a href=\"#3-config-%EC%88%98%EC%A0%95\">3. config 수정</a></li>\n<li><a href=\"#4-%EB%B9%8C%EB%93%9C-%EB%98%90%EB%8A%94-%EB%B0%B0%ED%8F%AC\">4. 빌드 또는 배포</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n</li>\n</ul>\n</div>","excerpt":"간만에 구글 애널리틱스에 가보니… 티스토리나 알려진 블로그 플랫폼은 Google Analytics의 연결이 매우 편리하게 되어있다. 하지만 그외 플랫폼은 직접 연결을 해줘야 한다. 사실 붙여놓고 잘 안들어갔다. 내 개인 블로그를 많이 와주면 고맙겠지만, 이런거 일일히 신경쓰면 피곤하다. 그래서 오면 오고 안오면 안오나보다 하고 하는게 맘 편하다. 그리고 내가 무슨 네임드 개발자도 아니고, 그냥 삽질하고, 경험한거 쓰는 블로그인데 뭐… 그래도 궁금한거 댓글 남기거나 하면 바로바로 답은 해주려고 노력하는 편이다. 서두가 길었다. 어느날부터인가… 애널리틱스 사이트에 들어갔더니 아래처럼 뭔가 떴다.  지금이 벌써 23년 4월이니 이제 준비를 안하면 이 집계도 못사용하겠다 싶어서 바꿔봤다. 근데 내가 쓰는건 만든이가 더 이상 관리하지 않는 오픈소스 테마였기에… 문제가 있으면 스스로 고쳐서 써야하는 상황이다. 그래서 그냥 애널리틱스 ID만 바꾸면 쉽게 해결될 것 같아서 gatsby-meta-…","frontmatter":{"date":"2023.04.04","title":"Gasty에서 구글 애널리틱스 GA4 처리 문제","categories":"gatsby","emoji":"📜"},"fields":{"slug":"/gatsby/230404_google_analytics/"}},"next":{"id":"b863dbc5-e3fa-504b-a5a5-c45eb7c2c86d","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABMElEQVQoz42S0Y6CMBBFW6Cl0GmhxYorrJpAsolP+v8fdzetrqtmxX24GToZztxOhzHGcC+vCEOzwqA9drTCJ3XYmRX2NuDQrJN647A2LYzSeP6fPSciQBTir8KknGegvESTqwRXolwGRmdK/haFEDBNE7bDAOf9Q+26btCWehkYryfy4nbWWmMcxwQmopTjjF+aVRauomVgnFWeZQ85znnSc21XEnxtl4FxLnFOPyApZXJpjEFd18jumnmp0Wn7D4dXYLziPM84Ho84n844n06pwc2hJHS6eePQBpTi8srRTV4UYJwl5fLx9Z3UCNQuA3tlMbuPtIss42grwtZ22BiHnlz6vpw9Dm2PWqpl4A1cWXyFEVRWqLmAzmQSpShSLHnxfrH5NZJQmNzm5YK/0jegveteJRG0qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/7c297/thumbnail_til.webp 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/33ecc/thumbnail_til.webp 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/df77d/thumbnail_til.webp 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/dd3ab/thumbnail_til.webp 895w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39caabbd44b8d6bf6560fecef746ecb3/e9ea2/thumbnail_til.png 180w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/53918/thumbnail_til.png 360w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png 720w,\n/static/39caabbd44b8d6bf6560fecef746ecb3/b002d/thumbnail_til.png 895w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39caabbd44b8d6bf6560fecef746ecb3/242a6/thumbnail_til.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1 id=\"흑우집합소에-애드센스를-준비하던-도중\" style=\"position:relative;\"><a href=\"#%ED%9D%91%EC%9A%B0%EC%A7%91%ED%95%A9%EC%86%8C%EC%97%90-%EC%95%A0%EB%93%9C%EC%84%BC%EC%8A%A4%EB%A5%BC-%EC%A4%80%EB%B9%84%ED%95%98%EB%8D%98-%EB%8F%84%EC%A4%91\" aria-label=\"흑우집합소에 애드센스를 준비하던 도중 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>흑우집합소에 애드센스를 준비하던 도중…</h1>\n<p>혹시 Next.Js에서 애드센스를 다는 것이 궁금하면 <a href=\"https://elfinlas.github.io/next-js/230404_nextjs_in_adsense/\">Next.Js에 구글 애드센스(Adsense) 등록하기</a>포스팅을 참고하자.</p>\n<p>뭐 아직 이르긴 하지만 구글 광고를 달려고 <strong>Adsense</strong>를 신청했었다.<br>\n근데 신청 후 몇일 뒤 아래와 같은 메일이 왔다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACD0lEQVQoz22Qy2oUQRSG+wH0DRQVvAQCEs0D6EIZDbrRpcSF4sKgi+AkjkMC6koxcYzgVlcBidGtoG58AJeKoCaKk+nqnurqnu659+WTrp6O48SCv85/zqn6z8W4+sLlxMM6U08khceSsxXJ6aUMZwb+VCXj51cc7afv8lxhWXJqSTJ536byLsA4fs9m90yNsbLgwLzg8B3BkbJgfMHSdl9RMFa2OFgSTN619Zu9RcGhUvZ2zy2TXTM1jEtVbq56GKnq7MsGpdcBt1OsB5qnmH/lU1xraMwNbM6HUVr3ubHq8eZTGwMg7vqI3z+wqhtYW5uI6gZ27ScNWaPpWvhK0HBMvNT3bALXot9yddwfxCFMpTDiBFrtDo7jUjMFll3HFJa20lGEUUwYJQOb8ShFnAziWS714yTJOgyCANMUmKaJqxS210OqAKUcHKV0zPV8TNnEdT2klHiep2HbNkop4jjOOkyvXq9Hq9XSwmEYkuhUdrODQ5IkJElu/0IL5mT4tLsRTpAjK9Bpt1h7/gzfU9uioyfJRx6t0uyE/Kr3+brVx25ky067fzp3jermd+3nIw7/2x55uIL+3Imw/WgQyz4uLi4wcWycixfOIWrVf0SHz38FpR/y4UsXy4+oBzGdXsTK7GUKE/uZPnkU8e3ztuDo6MbIEvS+oigeCmX84/u3XL8yzfKjB0Rhf8eacsE/EGNUNbME/bwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2bd71ecdb5ca03106b439fda5f24d760/7c297/img01.webp 180w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/33ecc/img01.webp 360w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/df77d/img01.webp 720w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/88613/img01.webp 771w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2bd71ecdb5ca03106b439fda5f24d760/e9ea2/img01.png 180w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/53918/img01.png 360w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/242a6/img01.png 720w,\n/static/2bd71ecdb5ca03106b439fda5f24d760/f0a60/img01.png 771w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2bd71ecdb5ca03106b439fda5f24d760/242a6/img01.png\"\n            alt=\"img01\"\n            title=\"img01\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>뭐가 문젠지 봤더니 승인 상태 옆에 저렇게 찾을 수 없음이 뜬다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 579px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuElEQVQY03WOyQ7CMAxE8//fiBBIRU1omrVZuqSD4l5KKJbmYM/YzwxN7fv+o6v6l2OlFJzVHqh9mzlyDQCgOWvJ67pCCIG+51BKIed8+WGMEZxzSCnRdS947wnOtq3g0EaEZVnItM5hmibM80zeVr5zKWcobWCdhzEWMSbyWCWdFULEIEdoY+i7lBLaTEwJwRvo4Y5R3OB0T+DqsbpwVh3KUUFrc/SNfygjTBZqeEK9H7CaE7we/ABwbdT/GBze0wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1dda1503c7e2cd7f16c3b09bd33f92e5/7c297/img02.webp 180w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/33ecc/img02.webp 360w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/96ba3/img02.webp 579w\"\n              sizes=\"(max-width: 579px) 100vw, 579px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1dda1503c7e2cd7f16c3b09bd33f92e5/e9ea2/img02.png 180w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/53918/img02.png 360w,\n/static/1dda1503c7e2cd7f16c3b09bd33f92e5/ff2d6/img02.png 579w\"\n            sizes=\"(max-width: 579px) 100vw, 579px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1dda1503c7e2cd7f16c3b09bd33f92e5/ff2d6/img02.png\"\n            alt=\"img02\"\n            title=\"img02\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h2 id=\"문제는-쉽게-찾을-수-있었다\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%89%BD%EA%B2%8C-%EC%B0%BE%EC%9D%84-%EC%88%98-%EC%9E%88%EC%97%88%EB%8B%A4\" aria-label=\"문제는 쉽게 찾을 수 있었다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제는 쉽게 찾을 수 있었다.</h2>\n<p>먼저 ads.txt에 접근이 되어야 하는데 이상하게 접근이 되지 않았다.</p>\n<p>일전에 <a href=\"https://elfinlas.github.io/nginx/230401_defense_attacker/\">Nginx에서 특정 IP 접근 금지 시키기</a> 포스팅을 하면서 뭔가 본거 같기도…<br>\n그래서 포스팅을 확인해본 결과…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">~*(idx_config|DS_Store|nginx|wp-json|ads|humans|exec|level|monitoring|configprops|balancer|actuator) 1;</code></pre></div>\n<p><strong>Url Keyword</strong>방식을 적은 부분에서 <strong>ads</strong>단어가 있었다…</p>\n<p>이래서 <strong>ads.txt</strong> 파일에 접근이 불가능했던 것이다.<br>\n그래서 접근 확인을 한 후 재검토를 신청했다.</p>\n<h2 id=\"응-거절이야\" style=\"position:relative;\"><a href=\"#%EC%9D%91-%EA%B1%B0%EC%A0%88%EC%9D%B4%EC%95%BC\" aria-label=\"응 거절이야 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>응 거절이야~</h2>\n<p>또 저 해맑은 아저씨 메일이 왔다 -_-;;<br>\n그래서 몇개 생각을 하다가 Nginx에서 막은게 문제겠지 싶었다.</p>\n<p>그러다가 하나 생각이 난게 IP 접근에서 뭔가 있었던 것 같았다.<br>\n그래서 불법 침입 시도를 확인할 겸 접근 로그를 보다가…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">66.249.66.65 - - [03/Apr/2023:00:22:03 +0900] \"GET /robots.txt HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\"\n66.249.66.89 - - [03/Apr/2023:00:24:00 +0900] \"GET /robots.txt HTTP/1.1\" 301 178 \"-\" \"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\"</code></pre></div>\n<p>그렇다…<br>\n내가 구글 봇 클라이언트를 막은 것 같았다…</p>\n<p>근데 구글 봇 클라이언트가 저거 하나만 돌지 아니면 여려 개 돌지 확인할 수 있는 방법이 없었다.<br>\n그럼 궁금하니 <strong>ChatGPT</strong>에게 기대를 걸고 물어봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.44444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACa0lEQVQ4y5VUia7jIAzM/3/g9sp9NSe52yZp69VMoIe0T0+LNDIYMMYe2xrHUYqilKqqiVoprtM0k3meBeP5fP4KM6zH4yH3+10e94dgbrCuq/zPMIattuulqhvpul6appWm6aSuG0qlWqJpt3mtGlH6DPcbrVOtjONFpukqVpJmcjg64nqhOG4gx5Mrf/YnSqP3/Ehcb9s72Z6cHJ9ngd3+xP1puhBWlpey29uyP9i8vDvYYruBeEHEg3FyljBKxQ9iSZJMwiihIT+IqLMdX2Bjnhe5Xm9iVZWSOD7LOSskLypewhdut5kH/oXPvZuWl8uVsJZ5kXVZZVkWjZWvIcNv+QaMAZ/rz7MWaKNUI30/EG3bMUF931M/DKN0fU8d8NuwcLEsKyLPC3IQwNrws64VZVnV1MGrn/hpgYPg3Of3zPehRwggiWVlzMDTHz1EIE3KDcZx0nKbv9cTA48wAFh3/cA96Jnl87kgPYIwJh0wt7X0/I2DoAYkOAid2Q/CRI62R1YMw0QHSGxwCpvGAPgFTpoL0DteoPm37eEOJB5r256hoofpOWcFgLDGGEkbxtqjSA5H9+2l49PD/dGhRNl+8TBOspdB8xXX37wD2VEFQFGABaUgRGVZCxwpyvpF8FcM0QhwAYfKSrHYCz03STKvG4xaP4yToLlgboyylm3XZ1JMoFG7rg4+4kT44fZdx2dYcu15Vatvgyh+dBVT6FtnCV/dhAnRho0xxJhfRu2nGY2+DCJOaEGmTUVxSi8hsYa3GwOM99ucj/ghWZCmOauHBtEk8RqSgxdRMe8GoKvnowF87y2yaJ1Jyl+LK+oq6r+lsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5842486a061f8ea2a4c91efc594534e0/7c297/img03.webp 180w,\n/static/5842486a061f8ea2a4c91efc594534e0/33ecc/img03.webp 360w,\n/static/5842486a061f8ea2a4c91efc594534e0/df77d/img03.webp 720w,\n/static/5842486a061f8ea2a4c91efc594534e0/c7309/img03.webp 754w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5842486a061f8ea2a4c91efc594534e0/e9ea2/img03.png 180w,\n/static/5842486a061f8ea2a4c91efc594534e0/53918/img03.png 360w,\n/static/5842486a061f8ea2a4c91efc594534e0/242a6/img03.png 720w,\n/static/5842486a061f8ea2a4c91efc594534e0/a0d62/img03.png 754w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5842486a061f8ea2a4c91efc594534e0/242a6/img03.png\"\n            alt=\"img03\"\n            title=\"img03\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>한글과 영어로 물어봤지만…<br>\n자기도 모른다 한다.. -_-;;</p>\n<p>그래서 직접 내가 찾아봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYElEQVQ4y51UaW8TMRD1//+IQEUUWlXhUoVoaVIov6C0iB65s6S5uptk78u5N3loZuMkqhKEsPTksdd+8+ZYi+urK7zNZPDj8hJxHGOxAJIkQZLMMOc54X0pJQaDAWQsIeM4taVc7dOZyWQCcfE1i/PcKXJnn3GePcH3iyzbZ6fHyH35xDbhW+4Exx8OcfTmBd5n9vHx3SGODl7i4PVeilfPsb/3DOL29ifu729w8+sapeIdGg8atFoZv7Uqo1Yto1wq4KFeQ61aQqVcQLVSQLVcRKmYX6FcyqOYv4PwfA9xHIFmCuV/B6dqPofQahpc14VlmTB0Hbquo9vtwjAMhrJpTr8ZPNNer9eFZVswTRO2Y2M6nUI0m03Yts2bhqEvkZLphp6CCLoGHvVHXitSuuM4NkzL5AipgII2Pc+DZVlLrz2GsaFkU6lyyIoNne+5rsPzcDSEoMtUeprbnTareOx0OJx+v78COSaQTWeVTepMsw/f9zGbzSA816OUwglMJqZeGo/H3IOLxeKvmM/nK1sNEQQBHMeBlNsrTF7Je7zsgM3L6wqvnYhKpbLKBxFTpXYp2kb0dC00TWMFaetYiKLon5Rsc8aE1DL0L1Lo8UZjj0YjTr4qAn3fRUr3wiDCMJIQioAUUvuoQQVqt9vcOo1Gg6u6K8wwDOC6PqQfQigvREihbyNstVqcjqcK1ZrS5HkBBn60JqSCEKgVaFAY9Bd1Oh3U63UOe1feAlLo+JDehkL15qlBvUgOSDmFG4bhjkdhsXonx7FMCWmoht58NIfDIReHQDadITvZ0vSqyn8AY3hRIitcsaIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b9208c94e6578c63a2edab4e3bd94d64/7c297/img04.webp 180w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/33ecc/img04.webp 360w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/df77d/img04.webp 720w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/3300c/img04.webp 972w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b9208c94e6578c63a2edab4e3bd94d64/e9ea2/img04.png 180w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/53918/img04.png 360w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/242a6/img04.png 720w,\n/static/b9208c94e6578c63a2edab4e3bd94d64/84a58/img04.png 972w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b9208c94e6578c63a2edab4e3bd94d64/242a6/img04.png\"\n            alt=\"img04\"\n            title=\"img04\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>근데 다 나오진 않고 일부만 주고 정보를 파는 사이트였다.</p>\n<p><a href=\"https://searchengineland.com/google-publishes-the-list-of-googlebot-ip-addresses-375935\"></a></p>\n<p>그래서 21년도 자료긴 한데 <a href=\"https://searchengineland.com/google-publishes-the-list-of-googlebot-ip-addresses-375935\">구글봇 주소 정보글(영문)</a>에서 약간의 정보를 찾을 수 있었다.<br>\n저 본문 중 구글 봇의 범위 주소 (IpV4(서브넷으로 나뉨), IpV6)를 <a href=\"https://developers.google.com/search/apis/ipranges/googlebot.json\">공개한 구글봇 주소 공식 api</a>를 확인해봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 498px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQ4y62U2W7EIAxF5///MA95yFv2fd+ojqU7Qm2STqVG8hjM+HIAw2vbNneepzuOw2xdV0cMvyyLted5NiOGqU8eH17tFz95nrsgCFwYhi6KItd1nZumyWVZ5pqmMV8Uhavr2vppmlrfF9RnguM42p+qqnon9n1vNIzRbtvWJsKgI86kPwjVYGl8JEKBKEsmkZhvwzCYIXwpiJG477sJlWVptCSQyAT0GcNEjb8lBB9BBPgzniUT92MY5MTxt4LQIAgd+4gniT3T3hLDiGnpt4IQXBFqH0VHW4SM3woySB1SQpQJniRIoKIPJQYh+8rEj4QIigYxTl40ohOhCv1fCFVaj4QQsIf+folQZH8i9E8ZmqdT1s15POXvdair59ehjMmJ394Uf8ncBN0K/+rpYRCZhH89FMR09bRkTSJjEuIfFbYOBe8fil82ehM/KhuesTiOrXRIho5DSpLExvTMYVDeCjIIoQw6veL0r9pXD+wXEYDIRe/C07AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/267c080f6e6669d2c83b7021429971b0/7c297/img05.webp 180w,\n/static/267c080f6e6669d2c83b7021429971b0/33ecc/img05.webp 360w,\n/static/267c080f6e6669d2c83b7021429971b0/b042d/img05.webp 498w\"\n              sizes=\"(max-width: 498px) 100vw, 498px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/267c080f6e6669d2c83b7021429971b0/e9ea2/img05.png 180w,\n/static/267c080f6e6669d2c83b7021429971b0/53918/img05.png 360w,\n/static/267c080f6e6669d2c83b7021429971b0/c365b/img05.png 498w\"\n            sizes=\"(max-width: 498px) 100vw, 498px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/267c080f6e6669d2c83b7021429971b0/c365b/img05.png\"\n            alt=\"img05\"\n            title=\"img05\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>일단 최신 자료이고, 하단에 ipv4 정보도 있었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 462px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVQ4y5WUi66DIBBE/f8f9Vm1ttXWR/fmkIzZEKpekw0I7nAYFjMzs+/3a+/32+Z5tqIorCxLq+vans+njeMY+m3bhmiaxvq+N+UR/sk0QfK6rrvI6/UKCyzLYtM0hQUVjJ8KksSH0EABDcKM07/f7zYMQ5ijvUz4eDyCEO+eUCFy5cVPFnsIAXG73UIyIl3XBUL5yByLp0R3Qci2bdsJvYe8syDi6kvop+Dn8wkhOhEiIEKCPpSe0IsmCRGKCUXHOISnHh4RUnecLIT0maN/SEhCipCtxR5SAZ4yKUiyJ1QdIkxfPtIydrpleQgpCb4O5aFuDN95wSShPOSmeA9jQt3n0y2LEDIdBnSpu8zCnu6QUH8aQoTylBPWTeHbS4TeLxF6MrXex0PCPM8DJcH2CfmKj7R4eJlQfpFADRJaTKX1b0L9tUVYVdVen/L39JRJZFX9so48jGvRC/4B5CUaCAizXmQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4841cd42400ec3d9bb8e31bc69cdbacc/7c297/img06.webp 180w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/33ecc/img06.webp 360w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/0b6e4/img06.webp 462w\"\n              sizes=\"(max-width: 462px) 100vw, 462px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4841cd42400ec3d9bb8e31bc69cdbacc/e9ea2/img06.png 180w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/53918/img06.png 360w,\n/static/4841cd42400ec3d9bb8e31bc69cdbacc/a9e02/img06.png 462w\"\n            sizes=\"(max-width: 462px) 100vw, 462px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4841cd42400ec3d9bb8e31bc69cdbacc/a9e02/img06.png\"\n            alt=\"img06\"\n            title=\"img06\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그래서 저기 나온 주소를 토대로 내가 막은게 있나 봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">geo $bad_ip_range {\n\t# A\n    34.0.0.0/8 1; #22-07-01 => Google Bot 있을 수 있음\n\t103.0.0.0/8 1; #VN-21-11-29\n  \t185.0.0.0/8 1; #DE-21-12-27\n\t159.0.0.0/8 1; #22-04-17\n\t20.0.0.0/8 1; #22-04-30\n\t15.0.0.0/8 1; #22-06-10\n\t51.0.0.0/8 1; #22-06-27\n\t35.0.0.0/8 1; #22-07-01\n\n    # B\n    66.249.0.0/16 1; #US_21-11-15 => Google Bot 있을 수 있음\n  \t5.161.0.0/16 1; #22-01-02\n  \t45.83.0.0/16 1; #log4j\n}</code></pre></div>\n<p>그렇다…<br>\n범위 계열에서 A클래스 주소 중 34 주소를 다 막아버린 것이다… -_-;;;</p>\n<p>그리고 B클래스에서도 막은 곳이 있었다.<br>\n얼른 이 부분은 주석 처리 후 Nginx를 리스타트 했다.</p>\n<p>C 클래스에는 다행히 없었다.<br>\n그리고 각 Ip 밴 시킨 부분도 몇 개 검토해서 다시 풀었다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>이제 한번 기다려보면 될 것 같다.<br>\n근데 구글 문서에서 몇 가지 찾은 정보가 있는데, 유저 에이전트를 확인하라고 한다.</p>\n<p><a href=\"https://developers.google.com/search/docs/crawling-indexing/overview-google-crawlers?hl=ko\">Google 크롤러(사용자 에이전트) 개요</a> 페이지를 참고하자.<br>\n그리고 <a href=\"https://developers.google.com/search/docs/advanced/crawling/verifying-googlebot?hl=ko#use-automatic-solutions\">Googlebot과 다른 Google 크롤러 확인</a> 이라는 문서도 있다.</p>\n<p>여기에 의하면 <strong>host</strong> 명령어를 통해서 해당 에이전트를 확인하라고 하는데 아래와 같이 확인이 가능했다.\n먼저 역방향 DNS를 조회해본다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 628px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.111111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAATUlEQVQI1x3HQQqAIBRAwW4UhhF9U4RScZN0nWgThHTrF7kaprtEU0XxyMA99VQ78ori9IYQC1sspHywhr1pbESWwGxC87/zGWMTg3Z83yckn+vsoPgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/af4dde69d25370a589d3bcf6ed8f425b/7c297/img07.webp 180w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/33ecc/img07.webp 360w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/189c6/img07.webp 628w\"\n              sizes=\"(max-width: 628px) 100vw, 628px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/af4dde69d25370a589d3bcf6ed8f425b/e9ea2/img07.png 180w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/53918/img07.png 360w,\n/static/af4dde69d25370a589d3bcf6ed8f425b/5e4bf/img07.png 628w\"\n            sizes=\"(max-width: 628px) 100vw, 628px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/af4dde69d25370a589d3bcf6ed8f425b/5e4bf/img07.png\"\n            alt=\"img07\"\n            title=\"img07\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 domain name에 google-proxy-…값이 뜨는데 이 값을 이용해 순방향 DNS를 조회해본다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 542px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.777777777777778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiElEQVQI1z2NWwqCUAAF3UHlIswtBFFimt6Xz6uYeYugDVrtbyI/+jgMzMccb95umIM179D/7xX6fIIV025PLC3HSKBMh1AtcWJIs5JDJBGyJc0qknOJ1BalO7y7KphyxSUV3KTBCb3wWTWMvaO20xJr2iu66BnGB7ZznBKzHPxcltfY3hHFii/oQkyMOz0DgQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/79cfa149a4df418abb89030d87401672/7c297/img08.webp 180w,\n/static/79cfa149a4df418abb89030d87401672/33ecc/img08.webp 360w,\n/static/79cfa149a4df418abb89030d87401672/535ba/img08.webp 542w\"\n              sizes=\"(max-width: 542px) 100vw, 542px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/79cfa149a4df418abb89030d87401672/e9ea2/img08.png 180w,\n/static/79cfa149a4df418abb89030d87401672/53918/img08.png 360w,\n/static/79cfa149a4df418abb89030d87401672/47f85/img08.png 542w\"\n            sizes=\"(max-width: 542px) 100vw, 542px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/79cfa149a4df418abb89030d87401672/47f85/img08.png\"\n            alt=\"img08\"\n            title=\"img08\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>그럼 처음 접근한 주소의 IP와 순방향 조회 IP를 비교해서 같으면 된다.</p>\n<p>근데 <a href=\"https://developers.google.com/search/apis/ipranges/googlebot.json\">공개한 구글봇 주소 공식 api</a>문서를 통해서 자동으로 차단 처리를 할 수 있을 듯 한데…<br>\n이건 좀 나중에 해봐야겠다.</p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C%EB%8A%94-%EC%89%BD%EA%B2%8C-%EC%B0%BE%EC%9D%84-%EC%88%98-%EC%9E%88%EC%97%88%EB%8B%A4\">문제는 쉽게 찾을 수 있었다.</a></li>\n<li><a href=\"#%EC%9D%91-%EA%B1%B0%EC%A0%88%EC%9D%B4%EC%95%BC\">응 거절이야~</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</div>","frontmatter":{"date":"2023.04.04","title":"23년 4월 3일 TIL & 개발노트 (Google Bot)","categories":"til","emoji":"📜"},"fields":{"slug":"/til/230403_til/"}},"prev":{"id":"89b49636-e437-581b-a663-d890bf9d5cf6","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVQoz5VSTUsCURT1X7TqY9O+VbRQIdpWizZCqxb1A4JWBS3cFAgtIspNiyCCoEVBRWJJQhqWFbop6GNg+nJSEccZ5+PNeyfm6ehIRnbgvHfhvXvu4d7rAQBGKacbjDFOd/wXbXicwIEliND2I+2F7cKu2Hl3//VwkVwe8nwIBV8AheFJFPwBkCeh1bFFWxL5TazarVTBTFJzaB/y4gqkXh+kHi9y3V4Ux2c47UK0okDd3IW2dwwzcw8jcQ395BzGVQba4RnIo4DK8gas14+mIJUrYFUNRjyFr4FRSP0jyHUNwkikQWUFcnAV+mmCF5YXQjBvstAjcZRng1y0srQOWizVe2jVbBupO6jhbZSm5iD1+ZEfmgARRDC1Cu0oBjOdhXF5C+0gCj2W5I5sUfLwDD16Aevtsy5Ia/0gLyLU8A6UtS0Ux6ZhJNMtze8EjaG4J2WJ76Bluf26UNaYtGPEWbkfa8M/EdKs5iT+gw3BX3eNtbrvBN9Ty+sRGu0ozQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b7685b7a900370c34be4e657df3f862d/7c297/thumbnail_nestjs.webp 180w,\n/static/b7685b7a900370c34be4e657df3f862d/33ecc/thumbnail_nestjs.webp 360w,\n/static/b7685b7a900370c34be4e657df3f862d/84c6d/thumbnail_nestjs.webp 700w\"\n              sizes=\"(max-width: 700px) 100vw, 700px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b7685b7a900370c34be4e657df3f862d/e9ea2/thumbnail_nestjs.png 180w,\n/static/b7685b7a900370c34be4e657df3f862d/53918/thumbnail_nestjs.png 360w,\n/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png 700w\"\n            sizes=\"(max-width: 700px) 100vw, 700px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b7685b7a900370c34be4e657df3f862d/a27c6/thumbnail_nestjs.png\"\n            alt=\"thumbnail\"\n            title=\"thumbnail\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<br>\n<h2 id=\"네이버-로그인-포스팅-3부작\" style=\"position:relative;\"><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91\" aria-label=\"네이버 로그인 포스팅 3부작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>네이버 로그인 포스팅 3부작</h2>\n<p><a href=\"https://elfinlas.github.io/nest_js/230404_naver_login_part01/\">(현재 글) Part01 네이버 로그인 구현하기 (Nest.js 코드 구현)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part02/\">Part02 네이버 로그인 구현하기 (네이버 개발자 센터)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part03/\">Part03 네이버 로그인 구현하기 (검수 요청 및 거절 그리고 기타 경험)</a></p>\n<hr>\n<br>\n<h1 id=\"서비스에-sns-로그인을-구현하려-했다-sns-naver-oauth-login\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90-sns-%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%84-%EA%B5%AC%ED%98%84%ED%95%98%EB%A0%A4-%ED%96%88%EB%8B%A4-sns-naver-oauth-login\" aria-label=\"서비스에 sns 로그인을 구현하려 했다 sns naver oauth login permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서비스에 SNS 로그인을 구현하려 했다. (SNS Naver OAuth Login)</h1>\n<p>흑우집합소를 개발하다가 사용자 계정 관련해서 사용자 계정과 관련하여 고민을 했다.<br>\n직접 계정 가입을 받을 것인지… 아니면 SNS를 활용한 계정을 처리할 것인지…</p>\n<p>마음은 SNS 로그인쪽으로 기울긴 했다.<br>\n왜냐하면 직접 받는다면, 계정의 신원을 E-Mail로 잡을텐데 여기서 검증 이메일을 보내는 로직과 더불어,<br>\n일일히 계정 정보를 다 입력받는 창을 만들고 하면 시간이 너무 많이 먹을 듯 싶었다.</p>\n<p>그래서 구글 네이버 카카오를 사용하기로 결정했다.</p>\n<p>카카오 사태때 SNS 로그인 문제가 있던걸 봐서 고민을 좀 했지만…<br>\n이 부분은 내가 따로 구현처리해서 피할 수 있는 것 같아서 SNS 로그인을 선택했다.</p>\n<p>내가 직접 한 부분을 다 녹여낸 포스팅이니 참고하면 붙이는데 도움이 되실 것이라 사료된다.</p>\n<p>설명에 앞서 Part01에서는 코드 구현부분이 들어가 있다.<br>\n그리고 Part02에서는 네이버 개발자 센터에서 할 일이 있고,<br>\nPart03에서는 몇 가지 정리할 내용들이 들어간다.</p>\n<h2 id=\"뭐-먼저-할까\" style=\"position:relative;\"><a href=\"#%EB%AD%90-%EB%A8%BC%EC%A0%80-%ED%95%A0%EA%B9%8C\" aria-label=\"뭐 먼저 할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>뭐 먼저 할까?</h2>\n<p>코딩적인 부분은 그냥 쉽게쉽게 하던대로 하면 편하지만, 네이버 개발자 센터가 약간 귀찮다.<br>\n아래 순서로 진행해보자.</p>\n<h3 id=\"1-nestjs에-라이브러리-설치\" style=\"position:relative;\"><a href=\"#1-nestjs%EC%97%90-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%84%A4%EC%B9%98\" aria-label=\"1 nestjs에 라이브러리 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Nest.Js에 라이브러리 설치</h3>\n<p>먼저 아래의 패키지들을 설치해주자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yarn add @nestjs/passport\nyarn add passport\nyarn add passport-naver-v2</code></pre></div>\n<p>뭐 npm을 쓰면 npm으로 바꿔서 설치하면 된다.<br>\n참고로 <a href=\"https://www.npmjs.com/package/passport-naver-v2\">passport-naver-v2</a>는 네이버에서 구현한 passport-naver를 개량한 버전이다.<br>\n네이버에서 만든게 아니라 개인이 만드신 듯 하다.</p>\n<br>\n<h3 id=\"2-naver-authguard-작성\" style=\"position:relative;\"><a href=\"#2-naver-authguard-%EC%9E%91%EC%84%B1\" aria-label=\"2 naver authguard 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Naver AuthGuard 작성</h3>\n<p>이제 AuthGuard를 작성해야 한다.<br>\nNest.Js에서 AuthGuard에 대해서는 추후 포스팅하고 여기에 업데이트 하도록 하겠다.</p>\n<p>아래 나오는 것은 샘플 코드이므로 본인의 취향에 맞게 작성해도 된다.<br>\n여기 나온 코드나 위치는 참고만…</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ExecutionContext<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthGuard <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NaverAuthGuard</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuthGuard</span><span class=\"token punctuation\">(</span><span class=\"token string\">'naver'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token generic-function\"><span class=\"token function\">handleRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TUser <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>err<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TUser <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//에러가 존재하면 에러 처리로 넘긴다.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>handleRequest</strong>메서드의 경우 저 nestjs의 AuthGuard의 선언된 타입 중 하나를 구현한 것이다.<br>\n그래서 만약 처리 중 에러가 발생할 경우 에러 자체를 넘겨서 처리할 수 있도록 했다.</p>\n<p>아래 원형을 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">declare</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">IAuthGuard</span> <span class=\"token operator\">=</span> CanActivate <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token generic-function\"><span class=\"token function\">logIn</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n    TRequest <span class=\"token keyword\">extends</span> <span class=\"token punctuation\">{</span>\n      logIn<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n    request<span class=\"token operator\">:</span> TRequest<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token generic-function\"><span class=\"token function\">handleRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TUser <span class=\"token operator\">=</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>err<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span> status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> TUser<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">getAuthenticateOptions</span><span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IAuthModuleOptions <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">declare</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AuthGuard</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>type<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Type<span class=\"token operator\">&lt;</span>IAuthGuard<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>에러는 보통 ExceptionHandler로 처리를 할텐데 이 부분에 대해서는 각자 처리하는 방식이 있기에,<br>\n여기서는 논외로 하겠다.</p>\n<br>\n<h3 id=\"3-naver-strategy-수립-및-코드-작성\" style=\"position:relative;\"><a href=\"#3-naver-strategy-%EC%88%98%EB%A6%BD-%EB%B0%8F-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"3 naver strategy 수립 및 코드 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Naver Strategy 수립 및 코드 작성</h3>\n<p><strong>Strategy</strong>의 경우에도 nest.js의 전략(Strategy)를 받아서 구현하는데,<br>\n이 부분도 향후에 다시 다뤄볼 예정이다.</p>\n<p>일단 내가 구현한 Naver Strategy 코드는 다음과 같다.<br>\n보안을 위해 일부 코드는 누락되어 있으니 참고만 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Inject<span class=\"token punctuation\">,</span> Injectable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PassportStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/passport'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Profile<span class=\"token punctuation\">,</span> Strategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'passport-naver-v2'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountErrorCode <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/exceptions/account.error.code'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountException <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/exceptions/account.exception'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  IsExistAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">IS_EXIST_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/is.exist.account.inbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  JoinAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">JOIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/join.account.inbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  LoginAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">LOGIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/login.account.inbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">ACCOUNT_FIND_TYPE</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">ACCOUNT_STATUS_TYPE</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/types/account.enums'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../ports/out/jwt/create.jwt.outbound.port'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> SnsLoginOutputDto <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../types/strategy.type'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> snsAccountJoin <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helper/join.account.helper'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> snsLoginAccount <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helper/sns.login.helper'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> makeNickName <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/utils/make.nickname.util'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  IsResignAccountInboundPort<span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">IS_RESIGN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/account/ports/in/is.resign.account.inbound.port'</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NaverOAuthStrategy</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PassportStrategy</span><span class=\"token punctuation\">(</span>Strategy<span class=\"token punctuation\">,</span> <span class=\"token string\">'naver'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">JOIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> joinAccountOutboundPort<span class=\"token operator\">:</span> JoinAccountInboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">LOGIN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> loginAccountInboundPort<span class=\"token operator\">:</span> LoginAccountInboundPort<span class=\"token punctuation\">,</span>\n\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">IS_EXIST_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> isExistAccountInboundPort<span class=\"token operator\">:</span> IsExistAccountInboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">CREATE_JWT_OUTBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> createJwtOutboundPort<span class=\"token operator\">:</span> CreateJwtOutboundPort<span class=\"token punctuation\">,</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">IS_RESIGN_ACCOUNT_INBOUND_PORT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> isResignAcountInbound<span class=\"token operator\">:</span> IsResignAccountInboundPort\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      clientID<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NAVER_CLIENT_ID</span><span class=\"token punctuation\">,</span>\n      clientSecret<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NAVER_CLIENT_PW</span><span class=\"token punctuation\">,</span>\n      callbackURL<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NAVER_CALLBACK</span><span class=\"token punctuation\">,</span>\n      passReqToCallback<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>\n    req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n    accessToken<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    refreshToken<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    profile<span class=\"token operator\">:</span> Profile\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>SnsLoginOutputDto<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> email <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> profile\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>email <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        email<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        joinType<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        lastLoginInfo<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        accessToken<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n        bcode<span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//탈퇴 6개월 이내를 체크한다.</span>\n    <span class=\"token keyword\">const</span> isResignAccount <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isResignAcountInbound<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      email<span class=\"token punctuation\">,</span>\n      joinType<span class=\"token operator\">:</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SNS_GOOGLE</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isResignAccount<span class=\"token punctuation\">.</span>isResign<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AccountException</span><span class=\"token punctuation\">(</span>AccountErrorCode<span class=\"token punctuation\">.</span><span class=\"token function\">AccessResignAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//계정이 존재하는지 체크</span>\n    <span class=\"token keyword\">const</span> isExistAccountType <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isExistAccountInboundPort<span class=\"token punctuation\">.</span><span class=\"token function\">excute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      email<span class=\"token punctuation\">,</span>\n      joinType<span class=\"token operator\">:</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SNS_NAVER</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//회원이 가입 안된 상태 => 회원 가입 진행</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isExistAccountType<span class=\"token punctuation\">.</span>findType <span class=\"token operator\">===</span> <span class=\"token constant\">ACCOUNT_FIND_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">NO_EXIST</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//회원가입 진행 로직 수행</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">snsAccountJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//이미 계정이 존재 => 로그인</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isExistAccountType<span class=\"token punctuation\">.</span>findType <span class=\"token operator\">===</span> <span class=\"token constant\">ACCOUNT_FIND_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXIST</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">snsLoginAccount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>상단의 **PassportStrategy(Strategy, ‘naver’)**클래스를 상속받아서,<br>\n<strong>validate</strong>메서드에서 실질적인 구현을 한다.</p>\n<p><strong>PassportStrategy</strong>의 경우 <strong>Strategy</strong>와 구분자 이름을 받는다.<br>\n여기는 깊게 갈 필요는 없고, Strategy는 <strong>passport-naver-v2</strong>의 값을 넣는다.</p>\n<p>그리고 생성자에서 부모 생성자에게 넘길 인자로 네이버 개발자 센터에서 값을 받아와야 하는데,<br>\n이 부분은 일단 공백으로 둬도 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">super({\n      clientID: process.env.NAVER_LOGIN_CLIENT_ID,\n      clientSecret: process.env.NAVER_LOGIN_CLIENT_PW,\n      callbackURL: process.env.NAVER_LOGIN_CALLBACK,\n      passReqToCallback: true,\n    })</code></pre></div>\n<p>지금 작성된 코드의 경우 내가 구현한 것이라서 env파일에서 값을<br>\n끌어오지만 실제로 구현할 때는 잠시 공백으로 둬도 된다.</p>\n<p><strong>passReqToCallback</strong>옵션의 경우 req객체 접근 여부인데,<br>\n나는 req에 실어나를 데이터가 있어서 true로 했다.</p>\n<p><strong>validate</strong>메서드의 전달인자에는 다음과 같이 되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">req: Request,\naccessToken: string,\nrefreshToken: string,\nprofile: Profile</code></pre></div>\n<p>req는 express Request 객체고, accessToken과 refreshToken의 경우 네이버에서 제공하는 토큰이다.<br>\n이걸로 사용자 인증을 사용해도 되고, 나처럼 직접 JWT 토콘을 사용하여 구현해도 된다.</p>\n<p>Nest.Js에서 Jwt 사용이 궁금한 분은 <a href=\"https://elfinlas.github.io/nest_js/230208_nesjs_jwt_part1/\">이곳 포스팅(Nest.Js에서 JWT 사용하기)</a>을 참고하자.</p>\n<p>그리고 마지막으로 profile의 경우 네이버 로그인을 통해 동의받은 사용자 정보를 받는 부분이다.<br>\n값은 아래를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Profile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  provider<span class=\"token operator\">:</span> <span class=\"token string\">'naver'</span><span class=\"token punctuation\">;</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  nickname<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  profileImage<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  age<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  gender<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  email<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  mobile<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  mobileE164<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  name<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  birthday<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  birthYear<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  _raw<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  _json<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<h3 id=\"4-로그인-전략-수립-생각-및-고민해볼-부분\" style=\"position:relative;\"><a href=\"#4-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%A0%84%EB%9E%B5-%EC%88%98%EB%A6%BD-%EC%83%9D%EA%B0%81-%EB%B0%8F-%EA%B3%A0%EB%AF%BC%ED%95%B4%EB%B3%BC-%EB%B6%80%EB%B6%84\" aria-label=\"4 로그인 전략 수립 생각 및 고민해볼 부분 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 로그인 전략 수립 (생각 및 고민해볼 부분)</h3>\n<p>개발자가 신경 쓸 부분은 전략부분이다.<br>\n사용자가 네이버 로그인을 시 <strong>profile</strong>객체 값을 통해 이메일 정보를 알아낼 수 있을 것이다.</p>\n<p>그럼 이 이메일 정보를 토대로 이미 가입이 되어 있는 계정인지…<br>\n아니면 가입이 안되어 있는 계정인지를 확인할 수 있다.</p>\n<p>그래서 위 코드에서도 조회를 해서 가입 처리 또는 로그인 처리를 진행한다.<br>\n참고로 회원 가입 시 몇 가지 정할 것이 있다.</p>\n<p>다중 계정 허용을 할 것인지, 아니면 다중 계정을 막을지,<br>\n이 부분은 향후 포스팅에서 다루겠다.</p>\n<p>일단은 난 다중 계정은 허용하는 방향으로 갔지만,<br>\n다중 게정을 직접적으로 이용하는 것은 막는 방향으로 갔다.</p>\n<p>그리고 만약 탈퇴한 회원이 재가입 하는 경우도 생각해 볼 수 있겠다.</p>\n<p>무튼 이 부분은 프로젝트 성향에 따라 다르기 때문에 각자 알맞게 구현해서 가도록 하자.</p>\n<br>\n<h3 id=\"5-컨트롤러-작성\" style=\"position:relative;\"><a href=\"#5-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EC%9E%91%EC%84%B1\" aria-label=\"5 컨트롤러 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 컨트롤러 작성</h3>\n<p>컨트롤러는 별거 없다.<br>\n아래의 코드를 참고하자.</p>\n<p>참고로 여기에서 쓰이는 주소 값은 나중에 네이버 개발자 센터에서 사용해야 한다.<br>\n이 부분은 Part02 포스트를 참고하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Controller<span class=\"token punctuation\">,</span> Get<span class=\"token punctuation\">,</span> Inject<span class=\"token punctuation\">,</span> Req<span class=\"token punctuation\">,</span> Res<span class=\"token punctuation\">,</span> UseFilters<span class=\"token punctuation\">,</span> UseGuards <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@nestjs/common'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'express'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AuthExceptionHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/auth/exceptions/auth.exception.handle'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NaverAuthGuard <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/auth/guard/naver.guard'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CustomLoggerService <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'src/domain/logger/services/custom.logger'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AccountExceptionHandler <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../exceptions/account.exception.handler'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../types/account.enums'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> LoginControllerHelper <span class=\"token keyword\">from</span> <span class=\"token string\">'./login.controller.helper'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'account'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginSnsNaverController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LoginControllerHelper</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span>CustomLoggerService<span class=\"token punctuation\">)</span> <span class=\"token keyword\">readonly</span> logger<span class=\"token operator\">:</span> CustomLoggerService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'login/sns/naver'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseGuards</span></span><span class=\"token punctuation\">(</span>NaverAuthGuard<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">snsLogin4Naver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'login/sns/naver/cb'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseGuards</span></span><span class=\"token punctuation\">(</span>NaverAuthGuard<span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseFilters</span></span><span class=\"token punctuation\">(</span>AccountExceptionHandler<span class=\"token punctuation\">)</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseFilters</span></span><span class=\"token punctuation\">(</span>AuthExceptionHandler<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">snsLogin4NaverCallBack</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Req</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> req<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Res</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> redirectUrl <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginCallback</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> <span class=\"token constant\">ACCOUNT_JOIN_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SNS_NAVER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">redirect</span><span class=\"token punctuation\">(</span>redirectUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>@Get(‘login/sns/naver’)</strong> 접근 시 네이버의 로그인 쪽으로 가게 된다.<br>\n그래서 여기는 뭔가 따로 처리할 것은 없다.</p>\n<p>그리고 **@Get(‘login/sns/naver/cb’)**콜백을 받는 부분은 아까 Strategy쪽에서 언급한 바와 같이,<br>\nreq 객체에 로그인 또는 회원 가입한 정보를 담고 있다.</p>\n<p>아래와 같이 한번 콘솔을 찍어보면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'req = '</span><span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>물론 저 Strategy쪽에서 return할 때 {} 와 같이 객체로 만들어 보내면 된다.<br>\n일단 이렇게 하면 코드에서 할 부분은 끝이다.</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>코드쪽은 위에서 언급한 바와 같이 그렇게 복잡한 것이 없다.</p>\n<p>단지 프로젝트 성향에 따라 다중 계정 및 회원 가입, 로그인 처리,<br>\n그리고 사용자 인증을 위한 토큰 처리 정도?</p>\n<p>만약 accessToken 및 refreshToken을 직접 구현하는게 아니라,<br>\n네이버에게 위임하여 구현할 겅우 <a href=\"https://developers.naver.com/docs/login/devguide/devguide.md#3-4-5-%EC%A0%91%EA%B7%BC-%ED%86%A0%ED%81%B0%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-%ED%94%84%EB%A1%9C%ED%95%84-api-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0\">접근 토큰을 이용하여 프로필 API 호출</a> 문서를 확인하자.</p>\n<p>다음은 네이버 개발자 페이지에서 처리할 것을 다루는 포스팅으로 넘어간다.</p>\n<br>\n<hr>\n<h4 id=\"네이버-로그인-포스팅-3부작-1\" style=\"position:relative;\"><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91-1\" aria-label=\"네이버 로그인 포스팅 3부작 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>네이버 로그인 포스팅 3부작</h4>\n<p><a href=\"https://elfinlas.github.io/nest_js/230404_naver_login_part01/\">(현재 글) Part01 네이버 로그인 구현하기 (Nest.js 코드 구현)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part02/\">Part02 네이버 로그인 구현하기 (네이버 개발자 센터)</a><br>\n<a href=\"https://elfinlas.github.io/nest_js/230405_naver_login_part03/\">Part03 네이버 로그인 구현하기 (검수 요청 및 거절 그리고 기타 경험)</a></p>\n<hr>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91\">네이버 로그인 포스팅 3부작</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AD%90-%EB%A8%BC%EC%A0%80-%ED%95%A0%EA%B9%8C\">뭐 먼저 할까?</a></p>\n<ul>\n<li><a href=\"#1-nestjs%EC%97%90-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%84%A4%EC%B9%98\">1. Nest.Js에 라이브러리 설치</a></li>\n<li><a href=\"#2-naver-authguard-%EC%9E%91%EC%84%B1\">2. Naver AuthGuard 작성</a></li>\n<li><a href=\"#3-naver-strategy-%EC%88%98%EB%A6%BD-%EB%B0%8F-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\">3. Naver Strategy 수립 및 코드 작성</a></li>\n<li><a href=\"#4-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%A0%84%EB%9E%B5-%EC%88%98%EB%A6%BD-%EC%83%9D%EA%B0%81-%EB%B0%8F-%EA%B3%A0%EB%AF%BC%ED%95%B4%EB%B3%BC-%EB%B6%80%EB%B6%84\">4. 로그인 전략 수립 (생각 및 고민해볼 부분)</a></li>\n<li><a href=\"#5-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EC%9E%91%EC%84%B1\">5. 컨트롤러 작성</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%8F%AC%EC%8A%A4%ED%8C%85-3%EB%B6%80%EC%9E%91-1\">네이버 로그인 포스팅 3부작</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"2023.04.04","title":"Nest.Js에서 네이버 로그인 구현하기 Part.01 (Naver OAuth Login)","categories":"nest_js","emoji":"📜"},"fields":{"slug":"/nest_js/230404_naver_login/"}},"site":{"siteMetadata":{"siteUrl":"https://elfinlas.github.io","comments":{"utterances":{"repo":"elfinlas/blog_utterances"}},"projects":[{"title":"마와셀(웹) - 와인 가격 비교","description":"와인 가격 비교 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223393940649","github":"","web":"https://appmyc.info","googlePlay":"","appStore":""}},{"title":"마와셀(엡) - 와인과 셀러 관리, 시음노트","description":"보유한 와인의 관리, 시음노트 작성, 보유 와인 셀러의 관리 어플리케이션","techStack":["Dart","Flutter","hive","provider"],"thumbnailUrl":"myc_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223531933037","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.myc","appStore":"https://itunes.apple.com/kr/app/apple-store/6474965246"}},{"title":"흑우집합소(웹) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Typescript","React","Next.Js","Nest.Js"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223059966682","github":"","web":"https://bcow.world/","googlePlay":"","appStore":""}},{"title":"흑우집합소(앱) - 로또번호 추천 서비스","description":"로또번호 추천 서비스","techStack":["Dart","Flutter","drift","provider"],"thumbnailUrl":"bcow_icon.png","links":{"post":"https://blog.naver.com/wisseraph/223232966579","github":"","web":"","googlePlay":"https://play.google.com/store/apps/details?id=dev.mhlab.bcow_world","appStore":"https://itunes.apple.com/kr/app/apple-store/6470312130"}}]}}},"pageContext":{"slug":"/gatsby/230404_google_analytics/","nextSlug":"/til/230403_til/","prevSlug":"/nest_js/230404_naver_login/"}},"staticQueryHashes":["1186322783","1321405810","3649515864"]}