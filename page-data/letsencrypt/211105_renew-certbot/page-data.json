{"componentChunkName":"component---src-templates-blog-post-js","path":"/letsencrypt/211105_renew-certbot/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab","siteUrl":"https://elfinlas.github.io","comment":{"disqusShortName":"","utterances":"elfinlas/blog_utterances"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"3924323e-0f65-53c6-a10e-ab965b4532e5","excerpt":"22.09.25 내용 추가 여기서 진행한 방식의 경우 standalone 방식이다. 이 방식은 80포트를 강제로 내려서 인증 대상이 진짜 사용하는 서비스인지를 체크하기에 매우 비효율적인 방식이다. 최근 방식의 경우 Webroot나 DNS 인증을 사용하는데, 이번에 DNS 인증에 대하여 포스팅을 진행했다. Webroot도 사용하지만 와일드카드(ex: *.api.com 등) 인증이 불가하기 때문에 DNS 인증을 사용할 것을 추천한다. DNS…","html":"<h1 id=\"220925-내용-추가\" style=\"position:relative;\"><a href=\"#220925-%EB%82%B4%EC%9A%A9-%EC%B6%94%EA%B0%80\" aria-label=\"220925 내용 추가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>22.09.25 내용 추가</h1>\n<p>여기서 진행한 방식의 경우 <strong>standalone</strong> 방식이다.<br>\n이 방식은 80포트를 강제로 내려서 인증 대상이 진짜 사용하는 서비스인지를 체크하기에 매우 비효율적인 방식이다.</p>\n<p>최근 방식의 경우 Webroot나 DNS 인증을 사용하는데, 이번에 DNS 인증에 대하여 포스팅을 진행했다.<br>\nWebroot도 사용하지만 와일드카드(ex: *.api.com 등) 인증이 불가하기 때문에 DNS 인증을 사용할 것을 추천한다.<br>\nDNS 인증 방식이 필요한 경우 아래 포스팅을 참고하자.</p>\n<p><a href=\"https://elfinlas.github.io/letsencrypt/220923_use-letsencrypt\">LetsEncrypt 적용법 (DNS 인증 &#x26; AWS)</a></p>\n<br>\n<h2 id=\"letsencrypt-유효기간\" style=\"position:relative;\"><a href=\"#letsencrypt-%EC%9C%A0%ED%9A%A8%EA%B8%B0%EA%B0%84\" aria-label=\"letsencrypt 유효기간 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’sEncrypt 유효기간?</h2>\n<blockquote>\n<p>혹시 아직 Let’sEncrypt를 설치하지 않으신 분이라면 <a href=\"https://elfinlas.github.io/letsencrypt/211105_letsencrypt-install/\">Let’sEncrypt 설치후 AWS에 적용하기</a> 에 설치법을 참고하시길 바란다</p>\n</blockquote>\n<p>Let’sEncrypt는 무료인 대신에 인증서를 주기적으로 인증해줘야 한다<br>\n그래서 보통 이것을 크론탭으로 처리해서 편하게 간다.</p>\n<p>경각심(?)을 위해 직접 갱신하는 분(?)도 봤지만…자동으로 하는게 정신 건강에 좋다..<br>\n물론 LetsEncrypt 팀에서 메일을 주기도 한다. (만료 10일전, 당일) 이렇게?</p>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABn0lEQVQoz3WRS4/TMBSF83/Yg8SvY8tmxOyQkHiIDfwAtrOohFgg2E2b0s40L+ed2LGbtE0aH44jViNxpU/Xr2vfc+xVtUQYC1tVJRIhEMcxsizDOI6Ypsm6fL1eDwC+W2t/MN+TV+QZecm1F8zPee7X6XSCN14uVrYthBAjL3uXJMlNFEU3RVG81VqfCYZh+MmiTyz+Sr6Qz+QD+Ujeuzn3ewIvMbN9rAfIprJ13fDutlFKNTzUct86GJjn+b+4ffcwsZ4yPXR/sq6WEp28hScxk4lc/zE9hTXWXe4djZ7DIJgoecrzfEzTdCzL0uXJ+clshUhoSwOjO+iuA2vQKQWl5NJZxzVjDOcKHiVis9lgt9stbLfbBZ/cr9fW931s/D94CAUikSOIU5JxXCBKcoRh6PwHm0Hf9+zwePy93+9fc/E2CII35PZwOHCefGvqavG2Vdrm6oK0PSOTF4iWYzmi6EZUVc2OzWKT89I7n88JJd7xV1d1Xa+KslxVZXFXyGFdGKAw1uZ6tpWZoTqNtqmgKVXJBs4Gp1BKuXyOi79ptlV5YTgfnwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img 01\"\n        title=\"img 01\"\n        src=\"/static/23bd11ee4136eab350fd4b6e5d41bae8/5a190/img_01.png\"\n        srcset=\"/static/23bd11ee4136eab350fd4b6e5d41bae8/772e8/img_01.png 200w,\n/static/23bd11ee4136eab350fd4b6e5d41bae8/e17e5/img_01.png 400w,\n/static/23bd11ee4136eab350fd4b6e5d41bae8/5a190/img_01.png 800w,\n/static/23bd11ee4136eab350fd4b6e5d41bae8/c1b63/img_01.png 1200w,\n/static/23bd11ee4136eab350fd4b6e5d41bae8/ddc6c/img_01.png 1534w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<br>\n<p>저번에 크론탭으로 해뒀는데 뭔가 잘못 건들여서 실행이 안되어 이번에 다시 셋팅하게 되었고 내용을 정리해서 올려본다.</p>\n<h2 id=\"letsencrypt-crontab-적용해보기\" style=\"position:relative;\"><a href=\"#letsencrypt-crontab-%EC%A0%81%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"letsencrypt crontab 적용해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’sEncrypt Crontab 적용해보기</h2>\n<h3 id=\"갱신-기간-여부-확인\" style=\"position:relative;\"><a href=\"#%EA%B0%B1%EC%8B%A0-%EA%B8%B0%EA%B0%84-%EC%97%AC%EB%B6%80-%ED%99%95%EC%9D%B8\" aria-label=\"갱신 기간 여부 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>갱신 기간 여부 확인</h3>\n<p>LetsEncrypt 인증서는 90일 유효하며, 만료 20일 전부터 갱신이 가능하다.<br>\n갱신이 가능한지 여부는 아래의 명령어를 통해 확인이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> sudo certbot certificates</code></pre></div>\n<p>아래는 커맨드 후 결과 예시이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ubuntu@:~$ sudo certbot certificates\nSaving debug log to /your/letsencrypt/path/letsencrypt.log\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nFound the following certs:\n  Certificate Name: dev.net\n    Serial Number: 22233344URSerialNumber\n    Key Type: RSA\n    Domains: dev.net\n    Expiry Date: 2123-12-31 00:00:00+00:00 (VALID: 89 days)\n    Certificate Path: /your/letsencrypt/path/fullchain.pem\n    Private Key Path: /your/letsencrypt/path/privkey.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</code></pre></div>\n<p>인증 기간이 20일 이하면 가능하다.</p>\n<h3 id=\"갱신-여부-확인\" style=\"position:relative;\"><a href=\"#%EA%B0%B1%EC%8B%A0-%EC%97%AC%EB%B6%80-%ED%99%95%EC%9D%B8\" aria-label=\"갱신 여부 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>갱신 여부 확인</h3>\n<p>먼저 갱신이 제대로 되는지 테스트를 해보려면 아래의 명령어를 수행해본다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> sudo certbot renew --pre-hook \"service nginx stop\" --post-hook \"service nginx start\" --dry-run</code></pre></div>\n<p>미들웨어는 자신이 맞는거를 사용하면 된다. (필자는 nginx)<br>\n뒤에 —dry-run 이 테스트를 수행하게 해주는 옵션이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ubuntu@:~$ sudo certbot renew --pre-hook \"service nginx stop\" --post-hook \"service nginx start\" --dry-run\nSaving debug log to /your/letsencrypt/path/letsencrypt.log\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nProcessing /your/letsencrypt/path/renewal/dev.net.conf\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSimulating renewal of an existing certificate for dev.net\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nCongratulations, all simulated renewals succeeded:\n  /your/letsencrypt/path/live/dev.net/fullchain.pem (success)\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</code></pre></div>\n<p>위와 같이 축하한다고 뜨면 인증하는데 문제가 없다는 뜻이다.</p>\n<blockquote>\n<p>PS : 만약 인증이 안된다고 뜨고 에러에 다음과 같은 구문(produced an unexpected error The manual plugin is not working) 이 있는 경우 <a href=\"https://elfinlas.github.io/letsencrypt/211105_renew-certbot\">이곳</a>을 참고하자.</p>\n</blockquote>\n<br>\n<h3 id=\"갱신-처리-with-crontab\" style=\"position:relative;\"><a href=\"#%EA%B0%B1%EC%8B%A0-%EC%B2%98%EB%A6%AC-with-crontab\" aria-label=\"갱신 처리 with crontab permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>갱신 처리 (With crontab)</h3>\n<p>먼저 크론탭을 열어 작성해주고…</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> crontab -e</code></pre></div>\n<p>만약 크론탭이 먼저 선등록 되어 있는지 확인하려면..</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> cat /etc/crontab -> 등록된 크론탭 확인</code></pre></div>\n<p>먼저 난 3개월마다 매 1일에 스크립트를 수행하게 해줬다.<br>\n크론탭 명령어는 아래와 같이 작성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> 1 0 1 1-12/3 * sudo certbot renew --pre-hook \"service nginx stop\" --post-hook \"service nginx start\" >> /mylog/letsencrypt/log/$(date '+%Y%m%d').log</code></pre></div>\n<p>그리고 마지막으로 크론탭을 재시작 해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> sudo service cron restart</code></pre></div>\n<p>그럼 이제 정상적으로 등록이 된 것이다.</p>","frontmatter":{"title":"Let'sEncrypt 자동 갱신 처리하기","date":"November 05, 2021"}}},"pageContext":{"slug":"/letsencrypt/211105_renew-certbot/","previous":{"fields":{"slug":"/letsencrypt/211105_letsencrypt-install/"},"frontmatter":{"title":"Let'sEncrypt 설치후 AWS에 적용하기"}},"next":{"fields":{"slug":"/letsencrypt/211105_letscert-fail/"},"frontmatter":{"title":"Let'sEncrypt 갱신이 불가할 때 (produced an unexpected error The manual plugin is not working)"}}}},"staticQueryHashes":["3128451518","903436796"]}