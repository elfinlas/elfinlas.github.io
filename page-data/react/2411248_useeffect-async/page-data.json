{"componentChunkName":"component---src-templates-post-jsx","path":"/react/2411248_useeffect-async/","result":{"data":{"site":{"siteMetadata":{"title":"MHLab blog","author":"MHLab"}},"markdownRemark":{"id":"bbeabcc7-703a-560e-9950-6e1a376655a2","excerpt":"UseEffect에서 비동기 호출을... useEffect는 다들 알다시피 컴포넌트가 렌더링 이후 실행을 하는 훅(Hook…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1231c0073a9bc0704f04fff13d13ffe0/5a190/thumbnail_react.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.423312883435585%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVR42nWQyQrCQAxA+zedZGa62FZblKJWcAGXgktVEIqe/AAFPXjyIoK/bIYitIOFd0hC3iQTA4VVQdrIJXLBKaCUS245BBJFpYRR1gDQ6nTDLG+tDiip4nDXA5MRjIF6tFZWvhNuj4PHJ7m93N7QG83j8zXc5MEi86fLZroXjQBQ1Mhc0szk/u5fnk6cWFHsT9Jod6JiMFv741S4Xnm+tjbZbRpIoFApfQRMAAYUI82sbm7oB+NSCdQqbIX8obX9l4uD13Rr8hcL7lIfd1tPwAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"thumbnail\"\n        title=\"\"\n        src=\"/static/1231c0073a9bc0704f04fff13d13ffe0/a6d36/thumbnail_react.png\"\n        srcset=\"/static/1231c0073a9bc0704f04fff13d13ffe0/222b7/thumbnail_react.png 163w,\n/static/1231c0073a9bc0704f04fff13d13ffe0/ff46a/thumbnail_react.png 325w,\n/static/1231c0073a9bc0704f04fff13d13ffe0/a6d36/thumbnail_react.png 650w,\n/static/1231c0073a9bc0704f04fff13d13ffe0/5a190/thumbnail_react.png 800w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"useeffect에서-비동기-호출을\" style=\"position:relative;\"><a href=\"#useeffect%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%98%B8%EC%B6%9C%EC%9D%84\" aria-label=\"useeffect에서 비동기 호출을 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UseEffect에서 비동기 호출을...</h1>\n<p>useEffect는 다들 알다시피 컴포넌트가 렌더링 이후 실행을 하는 훅(Hook)이다.<br>\n하나의 함수와, 의존성 배열을 같이 전달받아 처리를 하는데,<br>\n보통은 이 안에서 렌더링 이후의 값 처리 등을 사용한다.</p>\n<p>근데 가끔 이 안에서 비동기 함수를 호출해야 할 때가 있다.<br>\n나의 경우 마와셀에서 와인의 국가코드를 가져오는 부분을 만들 때 사용했었다.<br>\n당시 UI 테스트를 위해 급하게 사용한 거라 지금은 다른 방식으로 구현되어 있지만...</p>\n<p>와인의 생산 국가의 코드를 가져오는 함수는 아래와 같이 구현되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCountryCode</span><span class=\"token punctuation\">(</span>countryName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://restcountries.com/v3.1/all\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> countries <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> country <span class=\"token operator\">=</span> countries<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span>c<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> countryName<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> country <span class=\"token operator\">?</span> country<span class=\"token punctuation\">.</span>cca2<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Unknown country code\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 이를 useState의 함수에 set 해주는데, 처음엔 아래와 같이 구현해보려 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCountryCode</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>country<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">setCountryCode</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>props<span class=\"token punctuation\">.</span>country<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이렇게 해서 되면 모두가 행복했겠지만, 호락호락하지 않다.<br>\n저 useEffect를 보면 정리 함수(()=>{})만 반환이 된다.</p>\n<p>즉 Promise&#x3C;> 이거는 반환이 불가능하다는 이야기다.<br>\n그럼 어떻게 해결을 해야 할까?</p>\n<h2 id=\"result\" style=\"position:relative;\"><a href=\"#result\" aria-label=\"result permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Result</h2>\n<p>뭐 특이한 방법은 아니다.<br>\n그냥 useEffect 내부에서 비동기 함수를 만들어 주고, 그것을 호출하는 형태로 가면 된다.</p>\n<p>코드를 보면 바로 이해가 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> fetchCountryCode<span class=\"token operator\">:</span> <span class=\"token function-variable function\">any</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCountryCode</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>country<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">setCountryCode</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">fetchCountryCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>props<span class=\"token punctuation\">.</span>country<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>이렇게 처리하면 useEffect 내부에서 비동기 함수를 호출 처리할 수 있다.</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#useeffect%EC%97%90%EC%84%9C-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%98%B8%EC%B6%9C%EC%9D%84\">UseEffect에서 비동기 호출을...</a></p>\n<ul>\n<li><a href=\"#result\">Result</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"React의 useEffect 내부에서 비동기(async) 호출하기","description":null,"date":"November 28, 2024","tags":["React"],"series":"React","previewImage":"react_logo.png","isPrivate":null,"writer":null}},"previous":{"fields":{"slug":"/tools/241119_vscode-gradle/"},"frontmatter":{"title":"VSCode에서 No connection to gradle server 문제","isPrivate":null}},"next":null},"pageContext":{"id":"bbeabcc7-703a-560e-9950-6e1a376655a2","previousPostId":"7dac064c-eb07-50ac-9982-a373580e002d","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}